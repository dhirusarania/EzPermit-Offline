<!DOCTYPE html>    
<head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <title>fabric.js-simple text display</title>
    <!-- Get version 1.1.0 of Fabric.js from CDN -->

    <script src="file:///android_asset/drawing2/js/jquery.js" type="text/javascript"></script>
    <script src="file:///android_asset/drawing2/js/fabric.min.js" type="text/javascript"></script>


    <script src="file:///android_asset/drawing2/js/fabric.min.js" ></script>
<!--    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->
    <script type="text/javascript" src="file:///android_asset/drawing2/js/jquery.ui.touch-punch.js"></script>
    <!-- <script src="http://cdnjs.cloudflare.com/ajax/libs/json2/20121008/json2.js"></script> -->
    <script type="text/javascript" src="file:///android_asset/drawing2/js/elfinder.min.js"></script>
    <link rel="stylesheet" type="text/css" href="file:///android_asset/drawing2/css/theme.css">
    <link rel='stylesheet' href="file:///android_asset/drawing2/css/spectrum.css" />
    <link rel='stylesheet' href="file:///android_asset/drawing2/css/grid.css" />
    <link rel="stylesheet" href="file:///android_asset/drawing2/css/signature-pad.css">
    <script type="text/javascript" src="file:///android_asset/drawing2/js/interact.min.js"></script>


    <link rel="stylesheet" href="file:///android_asset/drawing2/photo/photoswipe.css">
    <link rel="stylesheet" href="file:///android_asset/drawing2/photo/default-skin/default-skin.css">

    <script src="file:///android_asset/drawing2/photo/photoswipe.min.js"></script> 
    <script src="file:///android_asset/drawing2/js/taphold.js"></script> 

    <script src="file:///android_asset/drawing2/photo/photoswipe-ui-default.min.js"></script> 


    <script src="file:///android_asset/drawing2/q/pdf.js"></script>
    <script src="file:///android_asset/drawing2/q/pdf.worker.js"></script>
    <script type="text/javascript" src="file:///android_asset/drawing2/js/slick.min.js"></script>
    <script type="text/javascript" src="file:///android_asset/drawing2/css/spectrum.js"></script>
    <link rel="stylesheet" type="text/css" href="file:///android_asset/drawing2/css/slick.css"/>
    <script src="file:///android_asset/drawing2/js/signature_pad.umd.js"></script>
    <script type="text/javascript" src="file:///android_asset/drawing2/js/siteScript.js"></script>

    <link rel="stylesheet" href="file:///android_asset/drawing2/js/croppie/croppie.css"/>
    <script src="file:///android_asset/drawing2/js/croppie/croppie.min.js"></script>
    <script src="https://raw.githubusercontent.com/mudcube/Event.js/master/js/Event.min.js"></script>

    



    <style type="text/css">


    img{ box-sizing: content-box; }

    @keyframes slideInFromLeft {
        0% {
            transform: translateX(100%);
        }
        100% {
            transform: translateX(0);
        }
    }

    .anim {  
        /* This section calls the slideInFromLeft animation we defined above */
        animation: 0.5s ease-out 0s 1 slideInFromLeft;
    }

    #starts_inputDate{
        position: absolute;
        top: 0;
        right: 20px
    }

    #ends_inputDate{
        position: absolute;
        top: 0;
        right: 20px
    }

    label[for='startIsMilestone'], label[for='endIsMilestone'], #endIsMilestone, #startIsMilestone {
        display: none;
    }


    .table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th{
        padding: 0!important
    }

    td{
        border: 0!important;
    }


    .custom-file-upload__drawing{
        white-space: nowrap;
        display: inline-block;
        color: black;
        font-weight: bold;
        padding: 0px!important;
        cursor: pointer;
        position: relative;
    }



    .videoIcon{
        position: absolute;
        height: 25px;
        width: 15px;
        right: 17px;
        bottom: 0;
        top: 15px;
    }
    

    input[type="file"]#updateExcel, input[type="file"]#excelUploader {
        display: none;
    }


    .spinnerSmall{
        height: 18px;
        width: 18px;
        position: absolute;
        top: 50%;
        left: 50%;
        margin: -11px 0 0 -9px;
        -webkit-animation: rotation 1s infinite linear;
        -moz-animation: rotation 1s infinite linear;
        -o-animation: rotation 1s infinite linear;
        animation: rotation 1s infinite linear;
        border: 3px solid rgba(0, 0, 0, 0.2);
        border-radius: 100%;
    }

    .spinnerSmall:before{
        content: "";
        display: block;
        position: absolute;
        left: -3px;
        top: -3px;
        box-sizing: content-box;
        height: 100%;
        width: 100%;
        border-top: 3px solid rgba(255, 255, 255, 1);
        border-left: 3px solid transparent;
        border-bottom: 3px solid transparent;
        border-right: 3px solid transparent;
        border-radius: 100%;
    }



    .layernameP{
        font-size: 13px!important
    }

    .slick-slide{
        padding: 0 5px;
        position: relative;
    }

    .afterPermission{
        background-color: #fafafa!important
    }


    .draggablestart{
        border: 5px solid yellow;
        box-sizing: content-box;
    }

    .textareaEditStyle{
        border: 0!important;
        background-color: #fafafa!important;
        outline: none!important;
    }

    textarea[disabled]{

        background-color: #fafafa!important;

    }


    #div_video{
       position: fixed;
       top: 0;
       right: 0;
       left: 0;
       bottom: 0;
       display: none;
       /* width: 100%; */
       margin: auto;
       height: 100%;
       text-align: center;
       z-index: 999;
       width: 100%;
       /* padding: 119px; */
       background: rgba(0, 0, 0, 0.8);
       box-sizing: content-box;
   }



   #video_ctrl{
    height: 50%;
    width: 50%;
    background: black;
    margin: auto;
    position: absolute;
    top: 0;
    right: 0;
    left: 0;
    bottom: 0;
}


#toolbutton.deactive, #imageEye.deactive, #layersButton.deactive, .deactive{
    opacity: 0.1!important;
    cursor: not-allowed!important;
}
#toolbutton.deactive{
    opacity: 1!important;
    cursor: not-allowed!important;
}

.loader {
    position: fixed;
    left: 0px;
    top: 0px;
    width: 100%;
    height: 100%;
    z-index: 9999;
    background: 50% 50% no-repeat rgba(255,255,255,0.6);
    opacity: 1;
}
.spinner {
    height: 60px;
    width: 60px;
    position: absolute;
    top: 50%;
    left: 50%;
    margin: -30px 0 0 -30px;
    -webkit-animation: rotation 1s infinite linear;
    -moz-animation: rotation 1s infinite linear;
    -o-animation: rotation 1s infinite linear;
    animation: rotation 1s infinite linear;
    border: 6px solid rgba(0, 0, 0, 0.2);
    border-radius: 100%;
}
.spinner:before {
    content: "";
    display: block;
    position: absolute;
    left: -6px;
    top: -6px;
    box-sizing: content-box;
    height: 100%;
    width: 100%;
    border-top: 6px solid rgba(0, 0, 0, 0.8);
    border-left: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-right: 6px solid transparent;
    border-radius: 100%;
}
@-webkit-keyframes rotation {
    from {
        -webkit-transform: rotate(0deg);
    }
    to {
        -webkit-transform: rotate(359deg);
    }
}
@-moz-keyframes rotation {
    from {
        -moz-transform: rotate(0deg);
    }
    to {
        -moz-transform: rotate(359deg);
    }
}
@-o-keyframes rotation {
    from {
        -o-transform: rotate(0deg);
    }
    to {
        -o-transform: rotate(359deg);
    }
}
@keyframes rotation {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(359deg);
    }
}
html{
    min-width: 320px
}

body{
    overscroll-behavior-y: contain;
    overflow: hidden;
}
.no-touch{
    touch-action: none;
}
.data-ul{
    width: 100%
}
#mainNav{
    padding: 0 15px;
}
.navbar-toggler.collapsed{
    transform: rotate(-90deg);
    transition: all 0.2s ease;
}
.navbar-toggler{
    transform: rotate(90deg);
    transition: all 0.2s ease;
}
.elfinder{
    width: 68px;
    overflow: auto
    border: 0;
}
.elfinder-cwd-view-list{
    height: 340px
}
@media only screen and (max-width: 901px) {
    #layerSection{
        right: -10px;
        top: 0px;
        width: 100vw!important;
        z-index: 9
    }
    .elfinder-cwd-wrapper .ui-droppable .native-droppable{
        width: 65vw
    }
    .ui-state-default .elfinder-navbar .ui-resizable{
        width: 30vw
    }
    .elfinder-workzone{
        width: 108vw
    }
    .elfinder{
        width: 68px;
        overflow: auto
        border: 0;
    }
    .elfinder-cwd-view-list{
        width: 100%!important;
        overflow: auto;
        height: 340px
    }
    .ui-helper-clearfix.elfinder-cwd.elfinder-has-checkbox.elfinder-cwd-view-list{
        height: 100%!important;
        z-index: 1;
        background-color: white
    }
    .elfinder-navbar{
        width: 26vw!important;
        min-width: 26vw;
        max-width: 26vw
    }
    #startP p{
        font-size: 15px;
        line-height: 5px;
    }
}
@media only screen and (min-width: 902px) {
    .elfinder-navbar{
        width: 15vw!important;
        min-width: 15vw;
        max-width: 15vw
    }

    .elfinder-button-search{
        position: absolute!important;
        left: 0;
        right: 0;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        left: 30%!important;
    }
    .elfinder-workzone{
        margin-top: 25px!important;
    }
    #startP p{
        font-size: 28px;
        line-height: 20px
    }
}
.elfinder-cwd{
    background-color: white
}
button.temp{
    height: 31px
}
input.temp{
    height: 32px;
    width: 100%
}
@media only screen and (min-width: 1600px) {
    .elfinder-navbar{
        width: 10vw!important;
        min-width: 10vw;
        max-width: 10vw
    }
}
.elfinder-cwd-wrapper-list.elfinder-cwd-fixheader{
    display: none
}
.elfinder-cwd table tr:nth-child(even){
    background-color: white
}
.elfinder-workzone{
    background-color: transparent;
}
.ui-state-default{
    display: none
}
.elfinder-cwd-view-list{
    margin-top: 0!important
}
.elfinder-button-search{
    /*float: left!important;*/
    z-index: 1
}
.ui-helper-clearfix.elfinder-cwd.elfinder-has-checkbox.elfinder-cwd-view-list{
    z-index: 1; background-color: white
}
.elfinder-button-search input[type=text] {
    -moz-border-radius: 2px!important;
    -webkit-border-radius: 2px!important;
    border-radius: 2px!important;
    width: 92%!important;
    padding: 0 6px!important;
    z-index: 1
}
.elfinder-workzone {
    background: transparent!important; 
}
.elfinder .elfinder-button-search {
    margin: 0!important;
    width: 70%!important;
    z-index: 1
}
html {
    touch-action: manipulation;
}
*{
    padding: 0;
    margin: 0;
    transition: transform-origin 0.1s linear
}
    /*.elfinder-toolbar {
    display: none !important;
    }*/
    .elfinder-button-menu{
        display: none!important;
    }
    #body{ background-color: #f4f4f4 }
    p{ color: white;    -webkit-margin-before: 0em;
        -webkit-margin-after: 0em; }
        ul{
            list-style-type: none;
            -webkit-margin-before: 0em;
            -webkit-margin-after: 0em;
            -webkit-margin-start: 0px;
            -webkit-margin-end: 0px;
            -webkit-padding-start: 0px;
        }
        ul li{ /*padding: 10px;*/ box-sizing: border-box; color: black;cursor: pointer;}
        ul li p{ color: black }
        /*#toolbox,#layer{ display: none }*/
        .no-padd{
            padding: 0!important
        }
        .btn-file {
            position: relative;
            overflow: hidden;
        }
        .btn-file input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            background: white;
            cursor: inherit;
            display: block;
        }
        .canvas-container{
            position: absolute;
            right: 0;
            left: 0;
            /*margin: 0 auto;*/
        }
        .tool.row{
            margin: 0
            }               }
            .no-select{
                -webkit-touch-callout: none; /* iOS Safari */
                -webkit-user-select: none; /* Safari */
                -khtml-user-select: none; /* Konqueror HTML */
                -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
    user-select: none; /* Non-prefixed version, currently
    supported by Chrome and Opera */
}
.layer-child{
    background-color: #0c1317;
    padding: 5px 15px;
    line-height: 30px
}
.layer-child p{
    font-size: 10px
}
.layer-child:hover{
    background-color: #3e3e3e
}

#layers{


    -webkit-transform: translate(0px, 0px);
    transform: translate(0px, 0px);

    -ms-touch-action: none;
    touch-action: none;
}

#drag-me::before {
    content: "#" attr(id);
    font-weight: bold;
}

#c,.upper-canvas{
    max-height: 100%;
    object-fit: contain;
    position: absolute;left: 0;right: 0;
    /*margin: 0 auto;*/
    /*transition: all 0.2s*/
}
#pdf-canvas{
    position: absolute;top: 0; bottom: 0;left: 0;right: 0; /*margin: 0 auto;*/ /*transition: all 0.2s*/ display: none
}
.no-mar{ margin: 0!important }
.flex-input{
    display: flex;
    align-items: center;
    margin-bottom: 10px
}
.flex-input label{
    flex-basis: 50%;
    color: white;
    font-size: 10px;
    text-align: center
}
.flex-input input{
    height: 30px;
    outline: none;
    border: 0;
    border: 1px solid #ccc;
    border-color: #ccc!important;
    padding: 0!important;
    width: 24px;
    text-align: left;
    border-left: 0;
    border-right: 0;
}
.col{ padding: 0!important; }
.flex-input input[type = "range"]{
    padding: 0
}
.sp-replacer{
    background-color: white;
    position: relative;
}
    /*      .sp-replacer{
    padding: 0;
    border: 0;
    width: 77%;
    }
    .sp-preview{ height: 30px; width: 100%;border: 0 }
    .sp-preview-inner{ margin-right: 30px }*/
    .sp-dd{
        line-height: 21px;
        position: absolute;
        right: 2px;
        text-align: center;
    }
    .sp-preview{ margin-right: 10px; width: 41px!important }
    .sp-replacer{ width: 60px }
    .hide{
        display: none!important
    }
    .show{
        display: block!important
    }


    .bwinPopupd{


        min-height: 450px;
        margin-top: 30px;
        max-height: 700px;
        overflow: auto;
        opacity: 1;
        top: 0px;
        display: block;
        width: 300px!important;
        min-width: 300px!important;

    }

    .bwinPopupd {
        position: fixed;
        box-shadow: 0 0 0 4px rgba(46, 186, 255, 0.3);
        border: 1px solid rgba(127, 127, 127, 0.3);
        background-color: #fff;
        margin: auto;
        right: 17px;
        padding: 30px 0;
        border-radius: 5px;
        transition: right 0.5s ease
    }



    .bwinPopupd.hide{
        display: block!important;
        right: -300px!important;
        transition: right 0.5s ease

    }










    input[type="number"] {
        position: relative;
        border-color: #BBB #ECECEC #ECECEC #BBB;
    }
    /*/* Spin Buttons modified */
    input[type="number"].mod::-webkit-outer-spin-button, 
    input[type="number"].mod::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0; 
    }
    .editActivate{
        background-color: rgba(89, 210, 255, 0.71)!important;
        border: none!important;
    }
    .bubble
    {
        position:relative;
        background:green;
        float:left;     /* because the image at left */
    }
    .bubbleborder
    {
        position:absolute;
        top:0;
        left:0;
    }
    .bubbletext
    {
        position:absolute;
        top:0;
        left:0;
        width:200px;
        height:170px;
        padding:80px 16px 16px 16px;
        text-align:center
    }
    .highlight{
        background-color: rgb(144, 214, 240)!important
    }
    .selectedTool{
        background-color: black!important
    }
    #drag{ 
        width: 100px;  
        height: 100px;  
        border: 1px solid #ccc;  
        background: #fcfcfc;  
        line-height: 100px;  
        text-align: center;  
        cursor: move;  
        background: #00a7c8;  
        text-transform: uppercase;  
    } 
    .editingTool{
        background: grey!important
    }
    .inline-btn ul li{ color: white!important;font-size: 12px; }
    .inline-btn{ touch-action: none; }
    div.panel div:hover { cursor: pointer; background: #02403a }
    .thumbnail{ width: 50px; height: 50px;padding-right: 10px }
    .gallery img{ height: 50px;  object-fit: contain; }
    .custom-file-input {
        color: transparent;
        outline: none;
        height: 22px;
        line-height: 22px;
        display: none
    }
    .custom-file-input::-webkit-file-upload-button {
        visibility: hidden;
    }
    .photoroom-action div{
        padding: 4px 4px
    }
    .gallery img{
        margin-left: 10px
    }
    img {
        width: 100%;
    }
    .slick-prev{
        position: absolute; left: 0; bottom: 0;color: white; background-color: transparent;
        outline: none;
        border: 0;
        cursor: pointer;
        padding: 3px 4px;
        margin: 5px 14px;
        z-index: 999
    }
    .slick-next{
        position: absolute; right: 0; bottom: 0;color: white; background-color: transparent;
        outline: none;
        border: 0;
        cursor: pointer;
        padding: 3px 4px;
        margin: 5px 14px;
        z-index: 999
    }
    /*.slick-next.fullscreen{ position: fixed; right:40px;top: 0;
    height: 34px;
    bottom: 0;
    margin: auto; }
    .slick-prev.fullscreen{ position: fixed; left:40px; top: 0;
    height: 34px;
    bottom: 0;
    margin: auto;
    }*/
    .slick-slider{
        padding-bottom: 30px
    }
    .slick-track{
        height: 100%;
        /*width: initial!important;*/
    }
    .slick-list{
        width: 100%;
        height: 100%
    }
    /*  .sliderFullScreen{
    position: fixed!important;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 999;
    background-color: rgba(0,0,0,0.7);
    }
    .sliderFullScreen img{
    height: 100%; width: 100%
    }*/
    button.accordion {
        color: #fff;
        background-color: transparent;
        cursor: pointer;
        width: 100%;
        border: none;
        text-align: left;
        outline: none;
        font-size: 12px;
        transition: 0.4s;
        padding: 10px
    }
    div.panel {
        display: none;
        background: blue;
        position: absolute;
    }
    div.panel div{
        padding: 10px;
        height: 14px
    }
    #move{
        cursor: move
    }
    .categories{
        position: absolute;
        width: 100%;
        z-index: 120;
        box-sizing: border-box;
        margin-top: 6px;
    }
    .tooltip-own{
        position: absolute;
        top: -38px;
        left: 43px;
        background: green;
        color: white;
        font-size: 12px;
        padding: 5px;
        border-radius: 12px;
    }
    .remove{
        display: block;
        background: red;
        color: white;
    }
    .imageOptions{
        z-index: 1000;
        position: fixed;
        bottom: 28px;
        display: flex;
    }
    .imageOptions div{
        margin: 10px
    }
    /*  .category.active{
    height: 22px;
    padding: 0 8px;
    line-height: 22px;
    background-color: transparent;
    }*/
    .category{
        height: 22px;
        padding: 0 8px;
        line-height: 22px;
        max-height: 100%
    }
    .category:hover{
        background-color: #09548e
    }
    .optiontext {
        font-size: 10px
    }
    .arrowdown.closed{
        transform: rotate(180deg);
    }
    .arrowdown.open{
        transform: rotate(0deg);
    }
    #snaparea{
        background-color: rgb(10, 84, 142); opacity: 1; width: 233px; border-radius: 0 0 5px 5px
    }
    #liveeditbutton #name{
        border-radius: 5px 5px 0 0;
    }
    #liveeditbutton.added #name{
        border-radius: 5px 5px 0 0;
    }
    .snapimages{
        width: 65px;
        margin: 0 5px;
        border: 1px solid rgba(0,0,0,0.2)
    }
    .snapimages.full{
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        margin: auto;
        height: 100%;
        width: 100%;
        padding: 42px;
        box-sizing: border-box;
        background: rgba(0,0,0,0.8);
        object-fit: contain;
        z-index: 150;
    }
    /*.snapimages.checked{
    border: 1px solid red;
    }
    */
    .btn-view {
        border: none;
        border-radius: 3px;
        display: inline-block;
        height: 26px;
        font-size: 12px;
        background-color: #2196f3;
        color: white;
        line-height: 26px;
        padding: 0 1rem;
        text-transform: uppercase;
        vertical-align: middle;
        -webkit-tap-highlight-color: transparent; }
        .click-effect:active{
            background-color: rgb(144, 214, 240)!important
        }
        .clicked, .tap-effect{
            background-color: rgb(144, 214, 240)!important
        }
    /*.touchOn{
    touch-action: auto!important;
    user-select: auto!important;
    }   
    */
    @media screen and (max-width: 480px) {
        #toolbox {
            right: 0;
            top: 50px
        }
    }   
    @media screen and (min-width: 481px) {
        #toolbox {
            right: 50px;
            top: 0
        }
    }
    .overflow{
        overflow: hidden
    }
    .switch__nonAngular {
        position: relative;
        display: block;
        vertical-align: top;
        cursor: pointer;
        margin: 0;
        font-size: 10px;
        box-sizing:content-box;
    }
    .switch-input {
        position: absolute;
        top: 0;
        left: 0;
        opacity: 0;
        box-sizing:content-box;
    }
    .switch-label {
        position: relative;
        display: block;
        height: inherit;
        border-radius: inherit;
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.12), inset 0 0 2px rgba(0, 0, 0, 0.15);
        box-sizing:content-box;
    }
    .switch-label:before, .switch-label:after {
        position: absolute;
        top: 50%;
        margin-top: -.5em;
        line-height: 1;
        -webkit-transition: inherit;
        -moz-transition: inherit;
        -o-transition: inherit;
        transition: inherit;
        box-sizing:content-box;
    }
    .switch-label:before {
        content: attr(data-off);
        right: 25%;
    }
    .switch-label:after {
        content: attr(data-on);
        left: 25%;
        opacity: 0;
    }
    .switch-input:checked ~ .switch-label {
    }
    .switch-input:checked ~ .switch-label:before {
        opacity: 0;
    }
    .switch-input:checked ~ .switch-label:after {
        opacity: 1;
    }
    .switch-handle {
        position: absolute;
        top: 4px;
        left: 4px;
        width: 28px;
        height: 28px;
        background: linear-gradient(to bottom, #FFFFFF 40%, #f0f0f0);
        background-image: -webkit-linear-gradient(top, #FFFFFF 40%, #f0f0f0);
        border-radius: 100%;
        box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
    }
    .switch-handle:before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        margin: -6px 0 0 -6px;
        width: 12px;
        height: 12px;
        background: linear-gradient(to bottom, #eeeeee, #FFFFFF);
        background-image: -webkit-linear-gradient(top, #eeeeee, #FFFFFF);
        border-radius: 6px;
        box-shadow: inset 0 1px rgba(0, 0, 0, 0.02);
    }
    .switch__nonAngular label .lever:after{ left: 6px; top: 3px }
    .switch__nonAngular label .lever {
        content: "";
        display: inline-block;
        position: relative;
        width: 58px;
        height: 28px;
        cursor: pointer;
        background-color: #818181;
        border-radius: 15px;
        transition: background 0.3s ease;
        vertical-align: middle;
        margin-bottom: 12px!important;
        margin: 0;font-weight: bold}
        .switch__nonAngular label{
            text-align: center;
        }
        .switch__nonAngular span.off{height: 28px;
            display: flex;
            align-items: center;
            right: 0;
            position: absolute;
            right: 5px;
            color: white;
            font-size: 10px;}
            .switch__nonAngular span.on{height: 28px;
                display: flex;
                align-items: center;
                position: absolute;
                left: 7px;
                color: white;
                font-size: 10px;font-weight: bold}
                .switch__nonAngular label input[type=checkbox]:checked + .lever{ background-color: #5abcfe;}
                /*.switch label input[type=checkbox]:checked + .lever:after{ background-color: #365468; left: 34px  }*/
                .switch__nonAngular label input[type=checkbox]:checked + .lever:after{ background-color: #8cff56; left: 32px  }
                .switch__nonAngular label .lever:after{ transition: left 0.1s ease, background .1s ease, box-shadow 0.1s ease; height: 15px; width: 15px }
                .switch__nonAngular label input[type=checkbox] {
                    opacity: 0;
                    width: 0;
                    height: 0;}
                    .switch__nonAngular label .lever:after {
                        content: "";
                        position: absolute;
                        display: inline-block;
                        width: 21px;
                        height: 21px;
                        background-color: #F1F1F1;
                        border-radius: 21px;
                        box-shadow: 0 1px 3px 1px rgba(0, 0, 0, 0.4);
                        left: 5px;
                        top: 3px;
                        transition: left 0.3s ease, background .3s ease, box-shadow 0.1s ease;
                    }   
                    label {
                        display: block;
                        margin-bottom: .3rem;
                        font-size: 1rem;
                        color: #727171;
                    }
                    #deletesnap.show{
                        position: fixed;
                        top: 0;
                        z-index: 9999;
                        right: 48px;
                        width: 25px;
                        display: block;
                    }
                    #deletesnap1.show{
                        position: fixed;
                        top: 0;
                        z-index: 9999;
                        right: 0;
                        width: 25px;
                        display: block;
                    }
                    #deletesnap, #deletesnap1{
                        display: none
                    }
                    .rotate-90 {
                        -moz-transform: rotate(90deg);
                        -webkit-transform: rotate(90deg);
                        -o-transform: rotate(90deg);
                        transform: rotate(90deg);
                    }
                    .rotate-180 {
                        -moz-transform: rotate(180deg);
                        -webkit-transform: rotate(180deg);
                        -o-transform: rotate(180deg);
                        transform: rotate(180deg);
                    }
                    .rotate-270 {
                        -moz-transform: rotate(270deg);
                        -webkit-transform: rotate(270deg);
                        -o-transform: rotate(270deg);
                        transform: rotate(270deg);
                    }
                    .flip {
                        -moz-transform: scaleX(-1);
                        -webkit-transform: scaleX(-1);
                        -o-transform: scaleX(-1);
                        transform: scaleX(-1);
                    }
                    .flip-and-rotate-90 {
                        -moz-transform: rotate(90deg) scaleX(-1);
                        -webkit-transform: rotate(90deg) scaleX(-1);
                        -o-transform: rotate(90deg) scaleX(-1);
                        transform: rotate(90deg) scaleX(-1);
                    }
                    .flip-and-rotate-180 {
                        -moz-transform: rotate(180deg) scaleX(-1);
                        -webkit-transform: rotate(180deg) scaleX(-1);
                        -o-transform: rotate(180deg) scaleX(-1);
                        transform: rotate(180deg) scaleX(-1);
                    }
                    .flip-and-rotate-270 {
                        -moz-transform: rotate(270deg) scaleX(-1);
                        -webkit-transform: rotate(270deg) scaleX(-1);
                        -o-transform: rotate(270deg) scaleX(-1);
                        transform: rotate(270deg) scaleX(-1);
                    }
                    .pswp__button--delete {
                        background: url(assets/drawing2/icons/delete.svg) 0 0 no-repeat;
                        background: url(assets/drawing2/icons/delete.svg) 0 0 no-repeat!important;
                        background-size: 22px 44px!important;
                        background-position: center;
                        margin-right: -12px!important;
                        margin-left: 8px!important;
                    }



                    #layers.hide{
                        display: block!important;
                        right: -320px!important;
                        transition: right 0.5s ease

                    }

                    #layers{
                        transition: right 0.5s ease

                    }

                    #toolbox.hide{
                        display: block!important;
                        right: -300px!important;
                        transition: right 0.5s ease

                    }

                    #toolbox{
                        transition: right 0.5s ease

                    }

                    .showbox {
                        float: left;
                        top: 0;
                        width: 79px;
                        position: absolute;
                        right:0;
                        opacity: 0;
                        visibility: hidden;
                        line-height: 60px;
                        text-align: center;
                        -webkit-transition: 1s ease-in-out;
                        -moz-transition: 1s ease-in-out;
                        -o-transition: 1s ease-in-out;
                        transition: 0.2s ease-in-out;
                    }
                    .showbox.show {
                        right: 45px;
                        opacity: 1;
                        visibility: visible;
                    }
                    .increase, .decrease{
                        background-color: white;
                        border: 1px solid #ccc;
                        border
                        height: 30px; width: 18px; text-align: center
                    }
                    .increase img, .decrease img{
                        height: 30px; width: 8px;
                    }
    /*.increase img{
    padding-bottom: 10px
    }*/

    .pswp__container { transition: transform 0.35s ease-in-out; }
    .pswp__container.hideTransition { transition: none!important }

    .increase{
        height: 30px;
        border: 1px solid #ccc;
    }
    .decrease{
        height: 30px;
        border: 1px solid #ccc;
    }

/*.slick-initialized .slick-slide{
    width: 60px!important;
    }*/

    .layerDiv p{
        color: #727171
    }
    #tableWrapper {
        /*overflow-y: scroll;*/
    }
    #tableWrapper > table{
        width: 300px
    }
    table{width: 100%}
    #layerBody::-webkit-scrollbar-track, #permissionArea::-webkit-scrollbar-track, .textareascroll::-webkit-scrollbar-track
    {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.6);
        background-color: rgba(96, 106, 133, 0.7);
        box-shadow: none
    }
    #layerBody::-webkit-scrollbar, #permissionArea::-webkit-scrollbar, .textareascroll::-webkit-scrollbar
    {
        width: 10px;
        background-color: #F5F5F5;
    }
    #layerBody::-webkit-scrollbar-thumb, #permissionArea::-webkit-scrollbar-thumb
    {
        background-color: #000;
    }

    .textareascroll::-webkit-scrollbar-thumb
    {
        background-color: #a4a4a4;
    }

    .ganttTaskEditor{
        padding: 0 10px
    }


    h2.taskData {
        font-size: 16px!important;
    }

    h1, h2, h3, h4, h5, h6 {
        font-weight: bold!important;
    }


    .bwinPopupd::-webkit-scrollbar-track
    {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.6);
        background-color: #fff;
        box-shadow: none
    }
    .bwinPopupd::-webkit-scrollbar
    {
        width: 10px;
        background-color: #F5F5F5;
        height: 10px
    }
    .bwinPopupd::-webkit-scrollbar-thumb
    {
        background-color: #cacaca;
    }

    #permission_desc1::-webkit-scrollbar-track
    {
        -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.6);
        background-color: #fff;
        box-shadow: none
    }
    #permission_desc1::-webkit-scrollbar
    {
        width: 10px;
        background-color: #F5F5F5;
        height: 10px
    }
    #permission_desc1::-webkit-scrollbar-thumb
    {
        background-color: #cacaca;
    }
    table.dataTable{
        width:300px!important;
    } 
    table.dataTable tr{
        background-color: white
    }
    table.dataTable th, table.dataTable td{
        font-size: 12px
    }
    table.dataTable.display tbody tr.odd>.sorting_1, table.dataTable.order-column.stripe tbody tr.odd>.sorting_1{
        background-color: transparent;
    }
    table.dataTable thead .sorting_asc, table.dataTable thead .sorting_desc{
        background-color: transparent;
    }
    table.dataTable thead th, table.dataTable thead td{
        padding: 5px 10px;
        text-align: left
    }
    .layerSelected{
        /*background-color: #fff!important*/
    }

    .layerSelected.layerDiv p{
        color: rgb(26, 189, 254)
    }

    .white-text{
        color:white!important;
    }

    .modal-card{
        display: flex;
        align-items: center;
        justify-content: center;
        top: 0; bottom: 0; left: 0; right: 0; position: fixed;z-index: 999;
        transition: all 0.1s linear;
        visibility: visible;
        opacity: 1;
    }
    .modal-card.close{
        opacity: 0; visibility: hidden; transition: all 0.1s linear;
    }
    .modal{width: 250px;
        background: white;
        position: relative;
        display: initial;
        font-size: 12px;
        border-radius: 5px;
        box-sizing: border-box;
    }
    .modal.grey{
        background: rgba(0,0,0,0.5)!important; 
    }
/*    .modal.grey .modal-body{
        height: 38px
        }*/
        .modal-card:before{
            content: '';
            position: fixed;
            overflow: auto;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-image: linear-gradient(to bottom right, #0c1317, #0c1317);
            opacity: .3;
        }
        .modal >.modal-header{
            font-size: 14px;
            padding: 7px 15px 2px;
            border-bottom: 1px solid rgba(134,134,134,0.3);
            display: flex;
            font-weight: bold;
            justify-content: center;
        }
        .modal >.modal-header{
            color: #000000
        }
        .modal-header-img{
            padding-right: 8px; width: 13px; height: 11px;opacity: 0.6;
        }
        .modal-action{
            display: flex;
            justify-content: space-around;
            width: 100%;
            border-top: 1px solid rgba(134,134,134,0.3);
        }   
        .modal-body{
            display: flex;
            align-items: center;
            padding: 10px 15px 10px;
            line-height: 15px;
            font-family: 'montserrat-light';
        }   
        .modal-body p{
           font-size: 13px;
           font-weight: bold
       }   
       .modal-body.donotshow{
        display: flex;
        align-items: center;
        flex-direction: column;
    }   
    .modal p{
        color: #727171;
        padding: 4px;
    }   
    .modal-action p{
        width: 100%;
        padding: 10px;
        text-align: center;
        cursor: pointer;
    }   
    .modal-action p:first-child{
        border:0;
    }   
    /*.modal-action p:last-child{
    border-left: 1px solid rgba(134,134,134,0.3);
    }*/
    .modal-action p:first-child{
        background-color: #03a9f4;
        color: white;
        border-radius: 0 0 0 5px;
        font-weight: bold
    }
    .cancel-modal.yes{
        background-color: #bbbbbb!important;
        color: white;
        font-weight: bold;
        border-radius: 0 0 5px 0
    }
    .toolbox-button{
        height: 30px; width: 30px;border: 1px solid #ccc;display: flex;justify-content: center;align-items: center;margin-right: 10px
    }
    .toolbox-button img{
        width: 20px; height: 20px
    }
    .cancel-modal.yes.blue{
        background-color: #03a9f4!important
    }
    .layerDiv{
        height: 35px
    }

    .signature-pad{
        z-index: 999;
        top: 0;
        left: 0;
        position: fixed;
    }


    .newLayerNotice{

        color: red!important;
        font-weight: bold;
        font-size: 10px;
        margin-right: 15px;
    }


</style>
<script type="text/javascript">

    var loginSession

    $("#fullDiv").addClass('hide')

    $(".loader").show().fadeIn('slow');

    // console.log(<?php if(isset($_SESSION['loginSession'])){ echo $_SESSION['loginSession']; }?>)


    var v = getAllUrlParams(window.location.href).v
    var filelocationURL = decodeURIComponent(getAllUrlParams(window.location.href).filelocation)

    console.log(filelocationURL)

    console.log("ppppppppppppppppppppppppppppppppppppppppppppppppppppppppppppp")

    function init(val){

        alert(val)

        console.log("vallllllllllllllllllllllllll")
        console.log(val)

    }


    $("#filename1").val(filelocationURL);

    var fileurlParamter = 0

    console.log(v)

    if(v == undefined){


        if(filelocationURL != undefined){

            console.log("-------filelocation--------------")
            console.log(decodeURIComponent(filelocationURL))
            filelocationURL =  decodeURIComponent(filelocationURL).replace(/^.*\/\/[^\/]+/, '')

            fileurlParamter = 1

        }else{

            console.log("Sdsd")
            localStorage.setItem('layerID', -"1");

        }


    }
    else {


        localStorage.setItem('layerID', v);

    }



    // $.get('assets/views/phppages/allProjectController.php?getloginSession=getloginSession', function(data, status){

        console.log("ssss")

        data = '{"zz":"351","response":1}'

        var obj = JSON.parse(data)
        console.log(data)

        console.log("session set as: ")
        console.log(data)

        loginSession = obj.response



        console.log("CLOGIN SESSUIONL:" + loginSession)
    // var loginSession = localStorage.getItem("loginSession");

    if(loginSession == 2){
        console.log("loginnnnn 111")
        // localStorage.setItem("loginSession" , '1')

        $(".loader").show().fadeIn('slow');

        $.get('assets/views/phppages/allProjectController.php?setloginSession=setloginSession&sessionValue=' + 1, function(data, status){

            var obj = JSON.parse(data)
            console.log(data)

            console.log("session set as: ")
            console.log(data)

            loginSession = obj.response

            window.location.reload();   

        });


    }else{







       if(v == undefined){

          if(fileurlParamter == 0 || filelocationURL == "undefined" ){
             console.log("Sdsd")
             sharedLink = 0
             $(".loader").hide().fadeOut('slow');

         }else{
             console.log("Sdsd")
             sharedLink = 1
    // alert('Link loaded')
}

console.log("undefined vvvv")


$("#fullDiv").removeClass('hide')
}
else if(loginSession == 1){

    console.log("loginsesion 2")
            // sharedLink = 1
    // localStorage.setItem('loginSession', '0');
    $.get('assets/views/phppages/allProjectController.php?setloginSession=setloginSession&sessionValue=' + 0, function(data, status){
        var obj = JSON.parse(data)
        console.log(data)

        console.log("session set as: ")
        console.log(data)

        loginSession = obj.response

            // $(".loader").hide().fadeOut('slow');

            $("#fullDiv").removeClass('hide')

        });

}
else if(loginSession == 0){


    localStorage.setItem('layerID', v);

    $(".loader").show().fadeIn('slow');

    console.log("loginsesiosn zeroooooooooo")
    window.location = '#/login/?v=' + v;
    // return false;
    console.log("Sdsd2")


    
}

}



// });








function getAllUrlParams(url) {

  // get query string from url (optional) or window
  var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

  // we'll store the parameters here
  var obj = {};

  // if query string exists
  if (queryString) {

    // stuff after # is not part of query string, so get rid of it
    queryString = queryString.split('#')[0];

    // split our query string into its component parts
    var arr = queryString.split('&');

    for (var i=0; i<arr.length; i++) {
      // separate the keys and the values
      var a = arr[i].split('=');

      // in case params look like: list[]=thing1&list[]=thing2
      var paramNum = undefined;
      var paramName = a[0].replace(/\[\d*\]/, function(v) {
        paramNum = v.slice(1,-1);
        return '';
    });

      // set parameter value (use 'true' if empty)
      var paramValue = typeof(a[1])==='undefined' ? true : a[1];

      // (optional) keep case consistent
      // paramName = paramName.toString().toLowerCase();
      // paramValue = paramValue.toString().toLowerCase();

      // if parameter name already exists
      if (obj[paramName]) {
        // convert value to array (if still string)
        if (typeof obj[paramName] === 'string') {
            obj[paramName] = [obj[paramName]];
        }
        // if no array index number specified...
        if (typeof paramNum === 'undefined') {
          // put the value on the end of the array
          obj[paramName].push(paramValue);
      }
        // if array index number specified...
        else {
          // put the value at that index number
          obj[paramName][paramNum] = paramValue;
      }
  }
      // if param name doesn't exist yet, set it
      else {
        obj[paramName] = paramValue;
    }
}
}

return obj;
}






jQuery(document).ready(function($) {
    $(".decrease").click(function(event) {
        $(this).addClass('clicked')
        var val = parseFloat($(this).siblings("input").val())
        var step = parseFloat($(this).siblings("input").attr('step'))
        var min = parseFloat($(this).siblings("input").attr('min'))
        if( val > min ){
            val = val * 100
            val = val - (step * 100)
            val = val / 100
        }
        console.log(val , step)
        $(this).siblings("input").val(val)
        $(this).siblings("input").trigger("change");
        setTimeout(function(){ $(".decrease").removeClass('clicked') }, 50);
    });

    $(".increase").click(function(event) {
        $(this).addClass('clicked')
        var val = parseFloat($(this).siblings("input").val())
        var step = parseFloat($(this).siblings("input").attr('step'))
        var max = parseFloat($(this).siblings("input").attr('max'))
        if( val < max ){
            val = val * 100
            val = val + (step * 100)
            val = val / 100
        }
        console.log(val , step)
        $(this).siblings("input").val(val)
        $(this).siblings("input").trigger("change");
        setTimeout(function(){ $(".increase").removeClass('clicked') }, 50);
    });

    $(".childCss").click(function(event) {
        if($("#submitText").length != 0){
            $("#layerName-" + prevActive).html(inputTempBuffer)
            $('.temp').remove()
        }


        if(selection == 4  && polygonCreated == 0){

            escaped = 1

            prototypefabric.polygon.generatePolygon(pointArray);


            selection = 0;
            $(".selectedTool").removeClass('selectedTool')
            $("#selection").click()

        }


        canvas.discardActiveObject()
        canvas.renderAll()

        escaped = 0

        $(".showbox").toggleClass('show')
        $("#liveeditbutton").addClass('hide')


        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);
        $("#layers").attr('data-y', 0);

        $("#layers").addClass('hide');
        $(".mainNav").addClass('hide');
        if($(this).children('img').hasClass('highlight')){
            $(this).children('img').removeClass('highlight')
        }
        else{
            $('.highlight').removeClass('highlight')
            $(this).children('img').addClass('highlight')
        }
    });

    $(document).on('click', '.tapHere', function(event) {


        $(this).addClass('clicked')

        setTimeout(function(){ $(".tapHere").removeClass('clicked') }, 100);

    });

});


var filenameparam

console.log('or here')

function yyyymmdd() {

  var x = new Date();
  var y = x.getFullYear().toString();
  var m = (x.getMonth() + 1).toString();
  var d = x.getDate().toString();
  (d.length == 1) && (d = '0' + d);
  (m.length == 1) && (m = '0' + m);
  var yyyymmdd = y + "-" + m + "-" + d;
  return yyyymmdd;
}



console.log('here')



// var d1 = document.getElementById('datenow');
// d1.insertAdjacentHTML('beforeend', yyyymmdd());

console.log('also here')

$(function(){

  $("body").removeClass('fullwidth')




  // app.controller('drawingTool',function($scope,$http,$sessionStorage,$localStorage,$cookies,$location, $timeout,$window){






  //  $("#body").click(function(){







  //  })


  //       //          $(window).load(function() {
  //       // });

  //       // $(".loader").hide().fadeOut('slow');

  //       $('html').attr('id','ss')
  //       var elem = document.getElementById("ss");
  //       var elem1 = document.getElementById("fullScreen");

  //       // $scope.goback =  function () {

  //       //      // $(".loader").show().fadeIn('slow');
  //       //      $("#saveAlert-modal").removeClass('close')
  //       //                      // window.location.href = '#/app/ViewProjectDetails';
  //       //      }



  //       var tempViewport=[];

  //       if (screenfull.enabled) {
  //           screenfull.on('change', event => {
  //               console.log('Am I fullscreen?', screenfull.isFullscreen ? 'Yes' : 'No');
  //               console.log(event)
  //               $("#filename1").val( event.target.clientHeight );
  //           });
  //       }

  //       elem1.onclick = function() {


  //           if(fullsc == 0){
  //               fullsc = 1
  //               console.log("fullscreens start")
  //   //             tempViewport = viewportData
  //               // console.log(tempViewport)
  //               req = elem.requestFullScreen || elem.webkitRequestFullScreen || elem.mozRequestFullScreen;
  //               req.call(elem)

  //               $("#fullScreen").children('img').attr('src', 'assets/drawing2/icons/collapse.svg')
  //           }
  //           else if(fullsc == 1){
  //               $("#fullScreen").children('img').attr('src', 'assets/drawing2/icons/expand.svg')
  //               console.log("fullscreens Ezir")
  //               // viewportData = tempViewport
  //               // console.log("sdsdsdsdsd")
  //               // console.log(tempViewport)
  //               fullsc = 0

  //               if (document.exitFullscreen) {
  //                   document.exitFullscreen();
  //               } else if (document.msExitFullscreen) {
  //                   document.msExitFullscreen();
  //               } else if (document.mozCancelFullScreen) {
  //                   document.mozCancelFullScreen();
  //               } else if (document.webkitExitFullscreen) {
  //                   document.webkitExitFullscreen();
  //               }
  //           }

  //       }

  //       document.addEventListener("fullscreenchange", onFullScreenChange, false);
  //       document.addEventListener("webkitfullscreenchange", onFullScreenChange, false);
  //       document.addEventListener("mozfullscreenchange", onFullScreenChange, false);

  //       function onFullScreenChange() {
  //           var fullscreenElement = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement;
  //           if (document.webkitIsFullScreen === false || document.mozFullScreen === false || document.msFullscreenElement === false)
  //           {
  //               $("#fullScreen").children('img').attr('src', 'assets/drawing2/icons/expand.svg')
  //               fullsc =  0
  //           }

  //       }

  //       var currentUser = $window.localStorage.getItem("currentUser");
  //       var projectID = $window.localStorage.getItem("serviceAccountId");
  //       var invitedServiceAccountId = localStorage.getItem('invitedServiceAccountId');

  //       // $scope.getAll = function(){

  //       //      $http({method:'GET', url:'assets/views/phppages/allProjectController.php?checkSupervisor=checkSupervisor&invitedAccount='+ invitedServiceAccountId}).success(function(response){    

  //       //      })
  //       //  }

  //       //  $scope.getAll()




  //   })

})

console.log(filenameparam)

</script>
</head>

<body class="body">
    <div class="wrapper">
        <div id="body" ng-controller="drawingTool">
            <div class="loader anim">
                <div class="spinner"></div>
            </div>


<!-- <form id="uploadimage" action="" method="post" enctype="multipart/form-data">
<div id="image_preview"><img id="previewing" src="noimage.png" /></div>
<hr id="line">
<div id="selectImage">
<label>Select Your Image</label><br/>
<input type="file" name="file" id="file" required />
<input type="submit" value="Upload" class="submit" />
</div>
</form>

<h4 id='loading' >loading..</h4>
<div id="message"></div>

-->




<div id="fullDiv">

    <div id="modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p><img src="icons/lock.svg" class="modal-header-img"> 레이어 잠금해제</p>
            </div>
            <div class="modal-body" style="flex-direction: column">
                <div style="display: flex;align-items: center;">
                    <p style="padding: 0 6px">비밀번호</p>
                    <input class="mod" placeholder="Enter Password" type="password" id="inputVal" autocomplete="off" style=" padding: 6px 6px;
                    border: 1px solid #b7b6b6;
                    border-radius: 2px;
                    outline: none;
                    height: 37px;
                    box-shadow: none;"></div>
                    <span class="error-message hide" style="color: red">잘못된 비밀번호입니다</span>
                </div>
                <div class="modal-action">
                    <p id="modal-action">해제</p>
                    <p class="cancel-modal yes">취소</p>
                </div>
            </div>
        </div>
        <div id="creator-modal" class="modal-card close">
            <div class="modal">
                <div class="modal-header">
                    <p><img src="icons/lock.svg" class="modal-header-img">레이어 잠금설정</p>
                </div>
                <div class="modal-body">
                    <p style="padding: 0 4px; font-weight: bold">비밀 번호 입력</p>
                    <input class="mod" placeholder="Enter Password" id="passwordInput" type="password" style="padding: 6px 6px;
                    border: 1px solid #b7b6b6;
                    border-radius: 2px;
                    outline: none;
                    box-shadow: none;">
                </div>
                <div class="modal-action">
                    <p id="creator-modal-action">잠금설정</p>
                    <p class="cancel-modal yes">취소</p>
                </div>
            </div>
        </div>
        <div id="edit-modal" class="modal-card close">
            <div class="modal">
                <div class="modal-header">
                    <p><img src="icons/lock.svg" class="modal-header-img">잠금설정된 레이어입니다</p>
                </div>
                <div class="modal-body">
                    <p style="padding: 0 4px; font-weight: bold">비밀번호입력 </p>
                    <input class="mod" placeholder="Enter Password" style="padding: 6px 6px;
                    border: 1px solid #b7b6b6;
                    border-radius: 2px;
                    outline: none;
                    box-shadow: none;">
                </div>
                <div class="modal-action">
                    <p id="edit-modal-action">입력</p>
                    <p class="cancel-modal yes">취소</p>
                </div>
            </div>
        </div>
        <div id="permissionYes-modal" class="modal-card close">
            <div class="modal">
                <div class="modal-header">
                    <p><img src="icons/lock.svg" class="modal-header-img">공정기록승인</p>
                </div>
                <div class="modal-body">
                    <p style="padding: 0 4px; font-weight: bold"> 기록된 공정진행 내역을 최종승인합니다. 승인 후 되돌릴 수 없습니다. 계속하시겠습니까?  </p>
                </div>
                <div class="modal-action">
                    <p id="permissionYes-action">승인</p>
                    <p class="cancel-modal yes">취소</p>
                </div>
            </div>
        </div>
        <div id="cancelpermission-modal" class="modal-card close">
            <div class="modal">
                <div class="modal-header">
                    <p><img src="icons/lock.svg" class="modal-header-img">승인취소</p>
                </div>
                <div class="modal-body">
                    <p style="padding: 0 4px; font-weight: bold">승인이 취소되면 검수자의 모든 기재사항이 삭제되고 승인이전상태로 돌아갑니다 계속하시겠습니까?</p>
                </div>
                <div class="modal-action">
                    <p id="cancelpermission-action">승인취소</p>
                    <p class="cancel-modal yes">취소</p>
                </div>
            </div>
        </div>
        <div id="copylink-modal" class="modal-card close">
            <div class="modal">
                <div class="modal-header">
                    <p>Copy Link</p>
                </div>
                <div class="modal-body">
                    <input class="mod copylink" placeholder="Enter Password" type="text" style="padding: 6px 6px;
                    border: 1px solid #b7b6b6;
                    border-radius: 2px;
                    width: 100%;
                    outline: none;
                    box-shadow: none;">
                </div>
                <div class="modal-action">
                    <p id="copylink-action">Copy</p>
                    <p class="cancel-modal yes">Cancel</p>
                </div>
            </div>
        </div>
        <div id="createLayer-modal" class="modal-card close">
            <div class="modal">
                <div class="modal-header">
                    <p>새 레이어 생성</p>
                </div>
                <div class="modal-body donotshow">
                    <p style="padding: 0 4px;">새 레이어를 생성하여 배경 이미지에 작업내용을 기록 할 수 있습니다  레이어를 생성 할까요?</p>
                    <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
                        <input id="createLayer-checkbox" class="checkedBox" type="checkbox">
                        <label for="createLayer-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
                    </div>
                </div>
                <div class="modal-action">
                    <p id="createLayer-action">생성</p>
                    <p class="cancel-modal yes">취소</p>
                </div>
            </div>
        </div>
        <div id="imageEyeDeleting-modal" class="modal-card close">
            <div class="modal">
                <div class="modal-header">
                    <p>슬라이더 삭제</p>
                </div>
                <div class="modal-body donotshow">
                    <p style="padding: 0 4px; ">이 슬라이더 아이콘은 첨부이미지를 가지고 있습니다. 삭제하면 되돌릴 수 없습니다. 계혹하시겠습니까?</p>
                </div>
                <div class="modal-action">
                    <p id="imageEyeDeleting-action">삭제</p>
                    <p class="cancel-modal yes">취소</p>
                </div>
            </div>
        </div>
        <div id="editLayer-modal" class="modal-card close">
            <div class="modal">
                <div class="modal-header">
                    <p>레이어 편집</p>
                </div>
                <div class="modal-body donotshow">
                    <p style="padding: 0 4px; ">레이어에 내용을 추가하거나 편집하시겠습니까?</p>
                    <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
                        <input id="editLayer-checkbox" class="checkedBox" type="checkbox">
                        <label for="editLayer-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
                    </div>
                </div>
                <div class="modal-action">
                    <p id="editLayer-action">레이어 편집</p>
                    <p class="cancel-modal yes">취소</p>
                </div>
            </div>
        </div>
<!--    <div id="saveAlert-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>다른 화면으로 이동</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">레이어에 내용을 추가하거나 편집하시겠습니까?</p>
                <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
                    <input id="editLayer-checkbox" class="checkedBox" type="checkbox">
                    <label for="editLayer-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
                </div>
            </div>
            <div class="modal-action threebutton">
                <p id="saveAlert-action">레이어 편집</p>
                <p id="saveAlertSave-action">레이어 편집</p>
                <p class="cancel-modal yes">취소</p>
            </div>
        </div>
    </div> -->
    <div id="saveAlert-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>다른화면 이동</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">저장하지 않은 내용은 삭제됩니다 계속할까요?</p>
                <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
                    <input id="editLayer-checkbox" class="checkedBox" type="checkbox">
                    <label for="editLayer-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
                </div>
            </div>
            <div class="modal-action">
                <p id="saveAlert-action">이동</p>
                <p class="cancel-modal yes">취소</p>
            </div>
        </div>
    </div>
    <div id="deleteLayer-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>레이어 삭제</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">이 레이어와 레이어에 포함된 사진을 모두 삭제합니다. 삭제하시겠습니까?</p>
            </div>
            <div class="modal-action">
                <p id="deleteLayer-action">삭제</p>
                <p class="cancel-modal yes">취소</p>
            </div>
        </div>
    </div>
    <div id="editText-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p> 레이어 타이틀 변경</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">레이어 타이틀을 변경하시겠습니까?</p>
                <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
                    <input id="editText-checkbox" class="checkedBox" type="checkbox">
                    <label for="editText-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
                </div>
            </div>
            <div class="modal-action">
                <p id="editText-action">변경</p>
                <p class="cancel-modal yes">취소</p>
            </div>
        </div>
    </div>
    <div id="snapshot-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>스냅샷 앨범</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ;text-align: center">현재 화면을 캡쳐하여 보관함으로 이동, 다른이와 공유합니다</p>
                <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
                    <input id="snapshot-checkbox" class="checkedBox" type="checkbox">
                    <label for="snapshot-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
                </div>
            </div>
            <div class="modal-action">
                <p id="snapshot-action">보관함으로</p>
                <p class="cancel-modal yes">취소</p>
            </div>
        </div>
    </div>
    <div id="imageObject-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>이미지 슬라이더</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">원하는 위치에 슬라이더를 설치하여 이미지를 첨부 열람 할 수 있습니다 </p>
                <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
                    <input id="imageObject-checkbox" class="checkedBox" type="checkbox">
                    <label for="imageObject-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
                </div>
            </div>
            <div class="modal-action">
                <p id="imageObject-action">설치</p>
                <p class="cancel-modal yes">취소</p>
            </div>
        </div>
    </div>
    <div id="clearCanvas-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>다른화면 이동</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">저장하지 않은 내용은 삭제됩니다 계속할까요?</p>
                <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
                    <input id="editLayer-checkbox" class="checkedBox" type="checkbox">
                    <label for="editLayer-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
                </div>
            </div>
            <div class="modal-action">
                <p id="clearCanvas-action">이동</p>
                <p class="cancel-modal yes">취소</p>
            </div>
        </div>
    </div>
    <div id="saveRequired-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>다른 작업으로 이동</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">작성중인 내용이 저장되지 않았습니다. 저장하시겠습니까?</p>
            </div>
            <div class="modal-action">
                <p id="saveRequired-action">저장</p>
                <p class="cancel-modal yes">취소</p>
            </div>
        </div>
    </div>
    <div id="saveRequiredNocreate-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>다른 작업으로 이동</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">작성중인 내용이 저장되지 않았습니다. 저장하시겠습니까?</p>
            </div>
            <div class="modal-action">
                <p id="saveRequiredNocreate-action">저장</p>
                <p class="saveRequiredNocreate-cancel-modal yes">아니요</p>
            </div>
        </div>
    </div>
<!--    <div id="clearCanvas-modal" class="modal-card close">
        <div class="modal">
            <div class="modal-header">
                <p>업로드</p>
            </div>
            <div class="modal-body donotshow">
                <p style="padding: 0 4px; ">새 도면/이미지를 캔버스에 업로드 합니다. 저장하지 않은 기존 내용은 삭제 됩니다. 계속하시겠습니까?</p>
        <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 8px">
          <input id="clearCanvas-checkbox" class="checkedBox" type="checkbox">
          <label for="clearCanvas-checkbox" style="margin: 0; margin-left: 10px; font-size: 10px">이 메세지를 다시 표시하지 않습니다 </label>
      </div>
  </div>
  <div class="modal-action">
    <p id="clearCanvas-action">계속</p>
    <p class="cancel-modal yes">취소</p>
  </div>
</div>
</div> -->
<div id="jpgpngonly-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p>업로드 불가</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">jpg나 png 파일만 업로드가 가능합니다</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="permissionLayerEditing-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p>알림</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">다른 사용자가 편집중인 레이어가 있어 승인작업이 불가합니다
            잠시 후 다시 이용하여 주세요 </p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="permissionPermissionEditing-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p>알림</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">검수인이 최종 승인중인 레이어 입니다
            편집할 수 없습니다. 잠시 후 다시 이용하여 주세요 </p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="uploadfailed-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p>업로드 실패</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">업로드에 실패하였습니다. 다시 시도하여 주세요</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>

<div id="copiedAlertFilename-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">알림</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">도면명이 리포트 드롭다운 메뉴에 추가되었습니다</p>
        </div>
    </div>
</div>

<div id="copiedAlertLayername-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">알림</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">해당 레이어가 리포트 드롭다운 메뉴에 저장되었습니다</p>
        </div>
    </div>
</div>

<div id="alertTool-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p>레이어 없음</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">드로잉 툴을 이용하려면 레이어를 적용하여야 합니다. 우측 레이어 버튼을 클릭하세요</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="alertEye-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p>레이어 없음</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">포토룸 슬라이더는 레이어 상에만 적용가능합니다. 우측 레이어 버튼을 클릭하여 이용할 수 있습니다 </p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue" style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="editError-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p>편집불가</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">다른 사용자가 편집중입니다. 잠시 후 다시 시도하여 주세요</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue" style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="aftersave-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">저장완료</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">변경사항이 저장되었습니다</p>
        </div>
    </div>
</div>
<div id="fileDoesntExist-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p>Error</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">이 링크에 포함된 도면파일이 삭제되어 레이어를 표시할 수 없습니다</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue" style="border-radius: 0 0 5px 5px!important"><a href="javascript:window.open('','_self').close();" class="white-text">Close</a></p>
        </div>
    </div>
</div>
<div id="editStart-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">레이어 편집모드</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">대상을 선택하여 편집하거나 드로잉 툴을 클릭하여 새로운 대상을 추가 할 수 있습니다</p>
        </div>
    </div>
</div>
<div id="editEnd-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">편집모드 해제 </p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">레이어 편집 모드가 해제되었습니다</p>
        </div>
    </div>
</div>
<div id="permissionDone-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">알림</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">최종 승인되었습니다</p>
        </div>
    </div>
</div>
<div id="layerCreated-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">레이어 생성</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">레이어가 생성 되었습니다 편집 버튼을 클릭하여 레이어에 내용을 입력하거나 수정할 수 있습니다</p>
        </div>
    </div>
</div>
<div id="errorLink-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p class="">등록 계정</p>
        </div>
        <div class="modal-body donotshow">
            <p class="" style="padding: 0 4px; ">프로젝트에 등록되지 않은 계정입니다. 운영자에게 등록을 요청하세요</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="userdoesnt-exist-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p class="">알림</p>
        </div>
        <div class="modal-body donotshow">
            <p class="" style="padding: 0 4px; ">프로젝트에 등록 되지 않은 사용자 입니다. 사이트 관리자에게 등록을 요청하세요</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="filedeletedOnSave-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p class="">저장불가</p>
        </div>
        <div class="modal-body donotshow">
            <p class="" style="padding: 0 4px; ">도면파일이나 원본레이어가 삭제되거나 옮겨져 저장할 수 없습니다</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="layerSavedNeededForImageSlider-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p class="">폴더 미생성 </p>
        </div>
        <div class="modal-body donotshow">
            <p class="" style="padding: 0 4px; ">아직 레이어와 이미지를 저장할 폴더가 생성되지 않았습니다. 저장 버튼을 눌러 생성한 후 이용하여 주세요</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="permissionError-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p class="">승인 불가 </p>
        </div>
        <div class="modal-body donotshow">
            <p class="" style="padding: 0 4px; ">기재되지 않은 내역이 있어 승인 처리 할 수 없습니다 </p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="fullStorageOnPhotoUpload-modal" class="modal-card close">
    <div class="modal">
        <div class="modal-header">
            <p class="">서버용량 초과</p>
        </div>
        <div class="modal-body donotshow">
            <p class="" style="padding: 0 4px; ">구매하신 서버 용량을 초과하여 업로드 할 수 없습니다. 서비스 운영자에게 업그레이드를 신청하세요</p>
        </div>
        <div class="modal-action">
            <p class="cancel-modal yes blue"  style="border-radius: 0 0 5px 5px!important">확인</p>
        </div>
    </div>
</div>
<div id="sessionExpired-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p>세션완료</p>
        </div>
        <div class="modal-body donotshow">
            <p style="padding: 0 4px; ">일정시간 사용하지 않아 다시 로그인하여야합니다</p>
        </div>
    </div>
</div>

<div id="layerDeleted-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">삭제</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">해당 레이어가 삭제 되었습니다</p>
        </div>
    </div>
</div>
<div id="snapshotadded-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">삭제</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">스넵샷 이미지가 저장 되었습니다</p>
        </div>
    </div>
</div>
<div id="layerlocked-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">레이어 잠금</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">이 레이어가 잠금 설정 되었습니다</p>
        </div>
    </div>
</div>
<div id="layerunlocked-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">잠금 해제</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">잠금 해제 되었습니다. 편집할 수 있습니다</p>
        </div>
    </div>
</div>
<div id="gmlock-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">잠금불가</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">레이어 관리자만이 잠금 설정할 수 있습니다</p>
        </div>
    </div>
</div>
<div id="passwordLockOpen-modal" class="modal-card close">
    <div class="modal grey">
        <div class="modal-header">
            <p class="white-text">잠금해제</p>
        </div>
        <div class="modal-body donotshow">
            <p class="white-text" style="padding: 0 4px; ">잠금해지'/'잠금설정이 해지되었습니다. 편집할 수 있습니다</p>
        </div>
    </div>
</div>



<div id="signature-pad" class="signature-pad hide">
    <div class="signature-pad--body">
        <canvas id="signArea"></canvas>
    </div>
    <div class="signature-pad--footer" style="position: absolute;bottom: 10px;left: 0;right: 0;">
        <div class="signature-pad--actions" style="display: flex;justify-content: space-around;">
            <div class="hide">
                <button type="button" class="button" data-action="change-color">Change color</button>
                <button type="button" class="button" data-action="undo">Undo</button>

            </div>
            <button type="button" class="button btn clear" data-action="clear">Clear</button>
            <button type="button" class="button btn saveSignature" style="background-color: #03A9F4; color:white">Save</button>
            <button type="button" class="button btn closeThisArea" style="background-color: #03A9F4; color:white">Close</button>
            <div class="hide">
                <button type="button" class="button save" data-action="save-png">Save as PNG</button>
                <button type="button" class="button save" data-action="save-jpg">Save as JPG</button>
                <button type="button" class="button save" data-action="save-svg">Save as SVG</button>
            </div>
        </div>
    </div>
</div>



<div id="div_video"></div>


<div id="test1" style="position: fixed; left:10px; top: 20px;z-index: 103">
    <div style="display: flex; flex-direction: column;align-items: center;">
        <div class="no-select click-effect" style="background-color: rgba(0,0,0,0.5); margin-bottom: 10px; border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;cursor: pointer;" id="fullScreen">
            <img title="배경에 삽입된 도면과 이미지를 원위치 합니다" alt="배경에 삽입된 도면과 이미지를 원위치 합니다" src="icons/expand.svg" style="width: 20px; height: 20px">
        </div>
        <div class="no-select click-effect" style="background-color: rgba(0,0,0,0.5); margin-bottom: 10px; border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;cursor: pointer;" id="centerFit">
            <img title="배경에 삽입된 도면과 이미지를 원위치 합니다" alt="배경에 삽입된 도면과 이미지를 원위치 합니다" src="icons/target.svg" style="width: 20px; height: 20px">
        </div>
        <div class="no-select click-effect" style="background-color: rgba(0,0,0,0.5); border-radius: 5px 5px 0 0;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;cursor: pointer;" id="zoominbutton">
            <p title="도면/이미지 확대" alt="도면/이미지 확대" style="font-size: 25px">+</p>
        </div>
        <div class="no-select click-effect" style="background-color: rgba(0,0,0,0.5); border-radius: 0 0 5px 5px;height: 40px;width: 40px; margin-bottom: 10px; display: flex;justify-content: center;align-items: center;cursor: pointer;" id="zoomoutbutton">
            <p title="도면/이미지 축소" alt="도면/이미지 축소" style="font-size: 25px">-</p>
        </div>
        <div class="no-select tool-main" style="cursor:pointer; display: flex;justify-content: center;align-items: center;position: relative;border-radius: 5px;">
            <!--  <img class="click-effect" title="드로잉 툴을 이용하여 레이어에 작업내용을 표시하거나 편집합니다" alt="드로잉 툴을 이용하여 레이어에 작업내용을 표시하거나 편집합니다" id="toolbutton" src="icons/icon.png" style="width: 20px; height: 20px;background-color: rgba(0,0,0,0.5);padding: 10px;border-radius: 5px;"> -->
            <div id="toolbox" class="hidden-click closer" style="touch-action: none;position: fixed;top: 38px; right: 10px;border-radius: 5px;z-index:105;background-color: rgba(23, 55, 85, 1);opacity:0.8;box-shadow: 0px 4px 8px -3px rgba(17, 17, 17, .06);padding-top: 20px;width: 300px">
                <div style="height:30px; display: flex;align-items: center;padding: 0 15px;display:flex;justify-content: flex-end;">
                    <div style="display: flex;align-items: center;width: 100%;justify-content: flex-end;">
                        <div class="hide" style="height: 30px; width: 30px;display: flex;justify-content: inherit;align-items: center;padding-right: 12px">
                            <div id="lock-toggle">
                                <div class="switch__nonAngular">
                                    <label>
                                        <input type="checkbox" id="multidrawValue">
                                        <span class="lever" style="margin-top: -7px!important">
                                            <span class="on">연속</span>
                                            <span class="off">일반</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div title="이전" alt="이전" class="no-select" style="height: 30px; width: 30px;border: 1px solid #ccc;display: flex;justify-content: center;align-items: center;margin-right: 10px" id="undo">
                            <img src="icons/undo.svg" style="width: 20px;height: 20px">
                        </div>
                        <div title="다음" alt="다음" class="no-select" style="height: 30px; width: 30px;border: 1px solid #ccc;display: flex;justify-content: center;align-items: center;margin-right: 10px" id="redo">
                            <img src="icons/redo.svg" style="width: 20px;height: 20px">
                        </div>
                        <div title="이동" alt="이동" class="no-select highlight" style="height: 30px; width: 30px;border: 1px solid #ccc;display: flex;justify-content: center;align-items: center;margin-right: 10px" id="selection">
                            <img src="icons/move.svg" style="width: 20px;height: 20px">
                        </div>
                        <div title="지우기" alt="지우기" class="no-select" style="height: 30px; width: 30px;border: 1px solid #ccc;display: flex;justify-content: center;align-items: center;margin-right: 10px" id="delete">
                            <img src="icons/eraser.svg" style="width: 20px;height: 20px">
                        </div>
                        <div title="지우기" alt="지우기" class="no-select" style="height: 30px; width: 30px;border: 1px solid #ccc;display: flex;justify-content: center;align-items: center;margin-right: 10px" id="imageEye">
                            <img title="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" alt="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" src="icons/eyeWhite.svg" style="width: 20px; height: 20px">
                        </div>
                    </div>
                </div>
                <div style="height: 100%;padding: 8px 7px">
                    <p style="font-size: 10px;">드로잉 도구 선택</p>
                    <div style="display: flex;padding-top: 6px;justify-content: flex-end;">
                        <div title="선" alt="선" class="toolbox-button" id="free">
                            <img src="icons/free.svg">
                        </div>
                        <div title="직선" alt="직선" class="toolbox-button" id="Line">
                            <img src="icons/line.svg">
                        </div>
                        <div title="다각형" alt="다각형" class="toolbox-button" id="polyline">
                            <img src="icons/polygon.svg">
                        </div>
                        <div title="사각형" alt="사각형" class="toolbox-button" id="rectangle">
                            <img src="icons/rectangle.svg">
                        </div>
                        <div title="원" alt="원"  class="toolbox-button" id="circle">
                            <img src="icons/circle.svg">
                        </div>
                        <div title="텍스트" alt="텍스트" class="toolbox-button" id="text">
                            <img src="icons/text.svg">
                        </div>
                        <div title="화살표" alt="화살표" class="toolbox-button" id="arrow">
                            <img src="icons/arrow.svg">
                        </div>
                    </div>
                </div>
                <div style="height: 100%;padding-right: 15px;">
                    <div class="tool-options" style="display: none">
                        <div class="tool tool-point row hide">
                            <p class="optiontext" style="padding: 0 0.75rem">Point</p>
                            <div class="col s12 flex-input">
                                <label>Radius</label>
                                <div class="quantity">
                                    <input id="point-size" class="mod" type="number" min="2" max="15" step="1" value="5" >
                                    <div>
                                        <div class="increase"><img src="icons/arrow-down.svg"></div>
                                        <div class="decrease"><img src="icons/arrow-down.svg" style="transform: rotate(180deg);"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="point-color" value="#333" />
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 너비</label>
                                <div class="quantity">
                                    <input id="point-stroke-width" class="mod" type="number" min="0" max="15" step="1" value="1">
                                    <div>
                                        <div class="increase"><img src="icons/arrow-down.svg"></div>
                                        <div class="decrease"><img src="icons/arrow-down.svg" style="transform: rotate(180deg);"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 색</label>
                                <input type='text' class="color-picker" id="point-stroke-color" value="#333" />
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>불투명도</label>
                                <div class="quantity">
                                    <input id="point-opacity" class="mod" type="number" min="0" max="1" step="0.1" value="1" >
                                    <div>
                                        <div class="increase"><img src="icons/arrow-down.svg"></div>
                                        <div class="decrease"><img src="icons/arrow-down.svg" style="transform: rotate(180deg);"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tool tool-free row">
                            <p class="optiontext" style="padding: 0 0.75rem">선</p>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="free-color" value="#ff0000" />
                            </div>
                            <div class="col s12 flex-input">
                                <label>너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="free-width" type="number" class="mod" min="0" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>불투명도</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="free-opacity" type="number" class="mod" min="0" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                        </div>
                        <div class="tool tool-line hide">
                            <p class="optiontext" style="padding: 0 0.75rem">직선</p>
                            <div class="row no-mar">
                                <div class="col s12 flex-input">
                                    <label>색</label>
                                    <input id="line-stroke-color"  type='text' class="color-picker" id="line-color" value="#ff0000" >
                                </div>
                                <div class="col s12 flex-input">
                                    <label>너비</label>
                                    <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                    <input id="line-stroke-width" type="number" class="mod" min="0" max="50" step="1" value="10" >
                                    <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                                </div>
                                <div class="col s12 flex-input hide">
                                    <label>불투명도</label>
                                    <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                    <input id="line-opacity" type="number" class="mod" min="0" max="1" step="0.1" value="1" >
                                    <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                                </div>
                                <div class="col s12 flex-input">
                                    <label>Angle</label>
                                    <input id="line-angle" type="checkbox" class="mod">
                                </div>
                            </div>
                        </div>
                        <div class="tool tool-triangle hide row">
                            <p class="optiontext" style="padding: 0 0.75rem">Triangle</p>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="triangle-color" value="#333" />
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 색</label>
                                <input type='text' class="color-picker" id="triangle-stroke-color" value="#333" />
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>불투명도</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="triangle-opacity" type="number" class="mod" min="0" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="triangle-stroke-width" type="number" class="mod" min="0" max="20" step="1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                        </div>
                        <div class="tool tool-polygon hide row">
                            <p class="optiontext" style="padding: 0 0.75rem">다각형</p>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="polygon-color" value="#ff0000" />
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>불투명도</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="polygon-opacity" type="number" class="mod" min="0" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 색</label>
                                <input type='text' class="color-picker" id="polygon-stroke-color" value="#ff0000" />
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="polygon-stroke-width" type="number" class="mod" min="0" max="20" step="1" value="5" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>점선너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="polygon-dash-width" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>점선간격</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="polygon-dash-space" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                        </div>
                        <div class="tool tool-rectangle hide row">
                            <p class="optiontext" style="padding: 0 0.75rem">사각형</p>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="rectangle-color" value="rgba(0,0,0,0)" />
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>불투명도</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="rectangle-opacity" type="number" min="0" class="mod" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 색</label>
                                <input type='text' class="color-picker" id="rectangle-stroke-color" value="rgba(0,0,0,0.5)" />
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>테두리 너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="#rectangle-stroke-opacity" type="number" min="0" class="mod" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="rectangle-stroke-width" class="mod" type="number" min="0" max="20" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>

                            <div class="col s12 flex-input">
                                <label>점선너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="rectangle-dash-width" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>점선간격</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="rectangle-dash-space" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                        </div>
                        <div class="tool tool-circle hide row">
                            <p class="optiontext" style="padding: 0 0.75rem">원</p>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="circle-color" value="rgba(0,0,0,0)" />
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="circle-opacity" type="number" class="mod" min="0" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 색</label>
                                <input type='text' class="color-picker" id="circle-stroke-color" value="#ff0000" />
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="circle-stroke-width" type="number" min="0" class="mod" max="20" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>점선너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="circle-dash-width" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>점선간격</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="circle-dash-space" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                        </div>
                        <div class="tool tool-ellipse hide row">
                            <p class="optiontext" style="padding: 0 0.75rem">Ellipse</p>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="ellipse-color" value="#333" />
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 색</label>
                                <input type='text' class="color-picker" id="ellipse-stroke-color" value="#333" />
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>불투명도</label>
                                <input id="ellipse-opacity" type="number" min="0" class="mod" max="1" step="0.1" value="1" >
                                <div>
                                    <div class="increase"><img src="icons/arrow-down.svg"></div>
                                    <div class="decrease"><img src="icons/arrow-down.svg" style="transform: rotate(180deg);"></div>
                                </div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>테두리 너비</label>
                                <input id="ellipse-stroke-width" type="number" min="0" class="mod" max="20" step="1" value="1" >
                                <div>
                                    <div class="increase"><img src="icons/arrow-down.svg"></div>
                                    <div class="decrease"><img src="icons/arrow-down.svg" style="transform: rotate(180deg);"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tool tool-text hide row">
                            <p class="optiontext" style="padding: 0 0.75rem">텍스트</p>
                            <div class="col s24 flex-input">
                                <label style="flex-basis: 17%">텍스트</label>
                                <textarea id="text-content" value="Note" style="width: 100%; flex-basis: 93%;height: 55px;padding: 10px;box-sizing: border-box;">Note</textarea>
                            </div>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="text-color" value="rgb(255,255,255)" />
                            </div>
                            <div class="col s12 flex-input">
                                <label>폰트사이즈</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="text-font" type="number" min="0" class="mod" max="100" step="1" value="30" />
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input no-mar hide">
                                <label>불투명도</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="text-opacity" type="number" min="0" class="mod" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s24 flex-input no-padd no-mar">
                                <p class="optiontext" style="padding: 7px 0.75rem">배경색</p>
                            </div>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="text-backgroundcolor" value="rgba(102, 102, 102, 0.9)" />
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>불투명도</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="text-backgroundopacity" type="number" min="0" class="mod" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                        </div>

                        <div class="tool tool-arrow hide row">
                            <p class="optiontext" style="padding: 0 0.75rem">화살표</p>
                            <div class="col s12 flex-input">
                                <label>색</label>
                                <input type='text' class="color-picker" id="arrow-color" value="#666666" />
                            </div>
                            <div class="col s12 flex-input">
                                <label>너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="arrow-width" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input hide">
                                <label>불투명도</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="arrow-opacity" type="number" min="0" class="mod" max="1" step="0.1" value="1" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>점선너비</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="arrow-dash-width" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                            <div class="col s12 flex-input">
                                <label>점선간격</label>
                                <div class="decrease click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(-90deg);"></div>
                                <input id="arrow-dash-space" type="number" min="0" class="mod" max="50" step="1" value="10" >
                                <div class="increase click-effect"><img src="icons/arrow-down.svg" style="transform: rotate(90deg);"></div>
                            </div>
                        </div>
                        <div style="display: flex;justify-content: flex-end;  margin-bottom: 10px; align-items: center;">
                            <p style="font-size: 10px; margin-right: 10px" class="toolhide">선택</p>
                            <div style="height: 30px; width: 30px;border: 1px solid #ccc;display: flex;justify-content: center;align-items: center;margin-right: 20px;" id="toolhide">
                                <img class="click-effect" src="icons/ic_edit_24px.svg" style="width: 20px;height: 20px">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="no-select click-effect" style="background-color: rgba(0,0,0,0.5); margin-top: 10px; border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;cursor: pointer;" onclick="goback()">
            <img title="프로젝트 상세화면으로 이동" alt="프로젝트 상세화면으로 이동" src="icons/longArrow.svg" style="width: 20px; height: 20px;transform: rotate(180deg);">
        </div>
        <div class="no-select click-effect hide" style="background-color: rgba(0,0,0,0.5); margin-top: 10px; border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;cursor: pointer;" data-mode="selection" id="modeToggler">
         <img title="켄버스 스크롤(S)" alt="켄버스 스크롤(S)" src="icons/move.svg" style="width: 20px; height: 20px;transform: rotate(180deg);">
     </div>
 </div>
</div>
<div style="position: fixed; right:10px; top: 10px;z-index: 102" id="test2">
    <div style="display: flex; flex-direction: column;align-items: center;">
        <div class="no-select" style="cursor:pointer;display: flex;justify-content: center;align-items: center;margin-top: 10px;position: relative;">
            <div class="childCss">
                <img class="click-effect" title="이지퍼밋 서버나 기기에서 도면이나 이미지를 캔버스에 업로드합니다" alt="이지퍼밋 서버나 기기에서 도면이나 이미지를 캔버스에 업로드합니다" src="icons/cloud.svg" style="width: 20px; height: 20px;background-color: rgba(0,0,0,0.5); border-radius: 5px;padding: 10px; z-index: 101">
                <div class="showbox" style="display: flex!important;justify-content: space-around;">
                    <div class="no-select btn btn-file" style="margin-right: 5px;padding: 0;height: 40px; width: 40px; justify-content: center;
                    display: flex;border: 2px solid #1abdfe;
                    align-items: center;">
                    <img src="icons/devices.svg" style="width: 25px;height: 25px"><input type="file"  title="로컬기기에서 업로드" alt="로컬기기에서 업로드"  id="image"  accept="image/*,application/pdf">
                </div>
                <div class="no-select btn btn-file" style="padding: 0;height: 40px; width:40px;
                display: flex; border: 2px solid #1abdfe;
                justify-content: center;
                align-items: center;">
                <img class="click-effect" title="ezPermit 클라우드 서버" alt="ezPermit 클라우드 서버" src="icons/Logo-1.png" style="width: 26px; height: 26px;border-radius: 5px; z-index: 100"  id="pdf-upload">
            </div>
        </div>
    </div>
    <div class="hide closer" id="layerSection" style="position: absolute; right: -10px; top: 0px; width: 500px;z-index: 100;height: 420px">
        <!-- <div id="elfinder" style="height: 350px"></div> -->

        <!-- <iframe id="EditCommonStorage" style="width:100%; height:100%;border: 0px;" src="elfinder.html#elf_l1_Lw"></iframe> -->
    </div>
</div>
<div class="no-select"  style="cursor:pointer;display: flex;justify-content: center;align-items: center;margin-top: 6px;position: relative;">
    <img class="click-effect" title="레이어를 추가하거나 기존레이어를 관리합니다" alt="레이어를 추가하거나 기존레이어를 관리합니다" id="layersButton" src="icons/layers.svg" style="width: 20px; height: 20px;background-color: rgba(0,0,0,0.5); border-radius: 5px;padding: 10px; z-index: 10">
    <div id="layers" class="hidden-click closer hide" style="position: fixed;top: 0; right: 0;z-index: 105; bottom:0;height:100%;width: 320px; box-shadow: 0 1px 6px #ccc;border-radius: 5px">

        <div id="layerCloseButton" class="btn btn-primary transparent" style="position: fixed;bottom: 10px; right: 30px; z-index: 200;width: 100px;background: transparent;border-color: white;color: white;">
            닫기
        </div>

        <div id="name" style="background-color: rgba(96, 106, 133, 0.9) ; height:38px; display: flex;align-items: center;padding: 10px 10px 10px;border-radius: 5px 5px 0 0">
            <div style="display: flex; justify-content: space-between; padding: 5px; align-items: center;width: 100%">
                <p style="font-size: 15px;display: flex;align-items: center;"><img class="click-effect" title="레이어를 추가하거나 기존레이어를 관리합니다" alt="레이어를 추가하거나 기존레이어를 관리합니다" id="layersButton" src="icons/layers.svg" style="width: 15px; height: 15px;z-index: 10;padding-right: 8px">진행현황기록/관리</p>
                <img class="click-effect" title="드로잉 툴을 이용하여 레이어에 작업내용을 표시하거나 편집합니다" alt="드로잉 툴을 이용하여 레이어에 작업내용을 표시하거나 편집합니다" id="toolbutton" src="icons/icon.png" style="width: 20px; height: 20px;padding: 10px;border-radius: 5px;">
                <div style="display: flex; align-items: center; ">
                    <img id="showViewer" class="tapHere hide" src="icons/rising.svg" style="width: 25px;height: 25px;">
                </div>
                <div id="ifcreator" style="display: flex; align-items: center; ">
                   <img id="createLayer" class="tapHere" src="icons/add.svg" style="width: 25px;height: 25px;">
               </div>
           </div>
       </div>
       <div id="layerBody" style="background-color: rgba(96, 106, 133, 0.7); padding: 0 0 10px 10px;height: 100%;overflow-y: scroll;">
         <div id="hideThis" style="height: 192px;display: flex;justify-content: center;align-items: center;">
            <p style="font-size: 12px; color: white;padding-left: 5px;white-space: pre-line;line-height: 20px">이 파일에 적용된 레이어가 없습니다. 우상
             단의 생성 아이콘을 이용하여 레이어를 추
         가할 수 있습니다</p></div>
         <div id="tableWrapper">
            <div class="display layerTable" cellspacing="0" width="100%" style="background-color: #fafafa;opacity: 0.9">
               <div id="layerTable">
               </div>
           </div>
       </div>
       <div style="background-color: rgba(96, 106, 133, 0.9);height: 30px;display: flex;align-items: center;padding: 5px 0 5px 0px; flex-direction: column;border-radius: 0px 0 5px 5px;">
        <p style="text-align: center;padding: 0 0 0;width: 100%" id="permission">작업내용승인</p>
        <div style="width: 100%;background-color: white;margin-bottom: 10px; margin-top: 10px;" class="hide" id="permissionArea">
            <div style="display: flex;">

             <input style="color: #727171;font-weight: bold;width: 100%;font-size: 16px;height:35px;border: 0" id="permission_title" value="작업내용승인">
             <p style="color: #727171;font-weight: bold;width: 100%;font-size: 16px;margin-bottom: 10px;border: 0" class="hide" id="permission_title1"></p>
             <a href="" id="zipDownload" class="hide" ><img src="icons/down-arrow.svg" title="확정된 레이어 테이블을 다운받아 증빙으로 보관합니다" alt="확정된 레이어 테이블을 다운받아 증빙으로 보관합니다" style="width: 33px;height: 20px; object-fit: contain;"></a>

             <label class="custom-file-upload__drawing btn" style="width: 100px;background: transparent;border-color: grey;color: grey;line-height: 30px;height: 30px;margin: 2px;">
                <input style="position: relative;" class="input__blocker"  accept=".xlsx,.zip" type="file" id="excelUploader" onchange="changed(this)">
                <p style="color: black">보고서식등록</p>
            </label>

            <div class="btn transparent custom-file-remove__drawing" style="width: 100px;background: transparent;border-color: grey;color: grey;" onclick="removeStandardFile()">
                Remove
            </div>
        </div>

        <textarea  onkeyup="auto_grow(this)" wrap="hard" style="width: 100%;min-height: 50px" style="color: #727171;width: 100%;font-size: 14px;border: 0" id="permission_desc" value="상기 작업내용을 정히 검수 하였으며...">상기 작업내용을 정히 검수 하였으며...</textarea> 
        <p style="width: 100%;min-height: 50px;color: #727171;width: 100%;font-size: 14px;border: 0;overflow-x:auto;padding-bottom: 30px;white-space: pre-line; " class="hide" id="permission_desc1"></p> 
        <div id="signaturePadToggle" style="padding: 10px 5px 0; width: 100%; margin: 10px 0 0;height: 100px">
          <p style="color: #727171; text-align: center;width: 100%" id="datenow"></p>


          <p style="color: #727171; text-align: center;width: 100%" class="hide" id="datenow1"></p>
          <div id="signIMGContainer" style="height: 90px"><img id="signIMG" class="hide" style="margin-bottom: 45px;object-fit: contain;height: 100%;" src=""><img id="signIMGDone" class="hide" style="margin-bottom: 45px;object-fit: contain;height: 100%;" src=""></div>
          <p style="color: black;border-top: 1px solid black">Signature</p>
      </div>


      <ul class="data-ul" style="margin-top: 40px"> <li class="navToggleDrawing" id="permissionUserData" class="no-select" style="position: relative;z-index: 3; display: flex;align-items: center;background-color: #F1F2F3;height: 72px;"></li> </ul>


      <div style="display: flex;justify-content: space-around;" id="permission_action">
          <div class="btn deactive" id="permissionDone">진행기록승인</div>
      </div>

      <div style="display: flex;justify-content: space-around;">
          <div class="btn hide" id="cancelPermission" style="background: transparent;
          border-color: red;
          color: red;
          height: 28px;
          line-height: 14px;
          font-size: 11px;
          margin: 6px;">승인해제</div>
      </div>
  </div>
</div> 
</div>
<!--         <div style="background-color: rgba(96, 106, 133, 0.7);height: 30px;height: 100%;display: flex;align-items: center;padding: 0 0 10px 10px; flex-direction: column;border-radius: 0px 0 5px 5px;">
            <p style="text-align: center;padding: 0 0 0;width: 100%" id="permission">작업내용승인</p>
            <div style="width: 100%;background-color: white;margin-bottom: 10px; margin-top: 10px; height: 220px; overflow: auto;" class="hide" id="permissionArea">
                <div style="display: flex;">
                    <input style="color: #727171;font-weight: bold;width: 100%;font-size: 16px;height:35px;border: 0" id="permission_title" value="작업내용승인">
                    <p style="color: #727171;font-weight: bold;width: 100%;font-size: 16px;margin-bottom: 10px;border: 0" class="hide" id="permission_title1"></p>
                    <a href="" id="zipDownload" class="hide" ><img src="icons/down-arrow.svg" style="width: 33px;height: 15px; object-fit: contain;"></a>
                </div>

                <textarea  onkeyup="auto_grow(this)" wrap="hard" style="width: 100%;min-height: 50px" style="color: #727171;width: 100%;font-size: 14px;border: 0" id="permission_desc" value="상기 작업내용을 정히 검수 하였으며...">상기 작업내용을 정히 검수 하였으며...</textarea> 
                <p style="width: 100%;min-height: 50px;color: #727171;width: 100%;font-size: 14px;border: 0;overflow-x:auto;padding-bottom: 30px;white-space: pre-line; " class="hide" id="permission_desc1"></p> 
                <div id="signaturePadToggle" style="padding: 10px 5px 0; width: 100%; margin: 10px 0 0;height: 100px">
                    <p style="color: #727171; text-align: center;width: 100%" id="datenow"></p>
                    <p style="color: #727171; text-align: center;width: 100%" class="hide" id="datenow1"></p>
                    <div id="signIMGContainer" style="height: 90px"><img id="signIMG" class="hide" style="margin-bottom: 45px;object-fit: contain;height: 100%;" src=""><img id="signIMGDone" class="hide" style="margin-bottom: 45px;object-fit: contain;height: 100%;" src=""></div>
                    <p style="color: black;border-top: 1px solid black">Signature</p>
                </div>


                <ul class="data-ul" style="margin-top: 40px"> <li class="navToggleDrawing" id="permissionUserData" class="no-select" style="position: relative;z-index: 3; display: flex;align-items: center;background-color: #F1F2F3;height: 72px;"></li> </ul>


                <div style="display: flex;justify-content: space-around;" id="permission_action">
                    <button class="btn deactive" id="permissionDone">Permision</button>
                </div>
            </div>
        </div> -->
    </div>

</div>
</div>
<div class="no-select" style="cursor:pointer; border-radius: 5px 5px 0 0;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;margin-top: 10px;position: relative;">
    <img class="click-effect" title="저장된 스냅샷 이미지를 공유합니다" alt="저장된 스냅샷 이미지를 공유합니다" id="liveedit" src="icons/share.svg" style="width: 20px; height: 20px; border-radius: 5px 5px 0 0;padding: 10px; z-index: 10;background-color: rgba(0,0,0,0.5)">
    <div id="liveeditbutton" class="hidden-click closer hide" style="position: absolute;top: 0; right: 110px;z-index: 105;width: 190px">
        <div style="background-color: rgba(141, 168, 197, 1); width: 233px; height:30px; display: flex;align-items: center;padding: 0 30px;border-radius: 5px 5px 0 0">
            <p style="font-size: 12px"> 스탭샷 보관함</p>
        </div>
        <div id="snaparea">
            <p id="hideThis2" style="font-size: 14px; line-height: 30px; padding-left: 30px; border-radius: 0 0 10px 10px;background-color: rgba(141, 168, 197, 1); ">보관중인 스냅샷이 없습니다</p>
        </div>
        <div id="snapcontrols" style="background-color: transparent;">
            <div id="deletesnap"><img src="icons/delete.svg" style="width: 26px; height: 26px"></div>
            <div id="deletesnap1"><img src="icons/close.svg" style="width: 15px; height: 26px"></div>
        </div>
    </div>
</div>

<div class="no-select click-effect"  id="saveCanvas" style="cursor:pointer;background-color: rgba(0,0,0,0.5); border-radius: 0 0 5px 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;position: relative;">
    <img title="현재 화면을 스냅샷 엘범에 저장합니다" alt="현재 화면을 스냅샷 엘범에 저장합니다" src="icons/ic_center_focus_weak_24px.svg" style="width: 20px; height: 20px">
</div>


<!-- <div class="no-select click-effect deactive"  id="imageEye" style="cursor:pointer;background-color: rgba(0,0,0,0.5); border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;margin-top: 10px;position: relative;">
    <img title="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" alt="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" src="icons/eyeWhite.svg" style="width: 20px; height: 20px">
</div> -->

<div style="position: absolute;display: flex;right: 0">
<!-- <div class="no-select click-effect"  id="copy" onclick="copy()" style="cursor:pointer;background-color: rgba(0,0,0,0.5); border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;margin-top: 10px;position: relative;">
    <img title="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" alt="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" src="icons/copy.svg" style="width: 20px; height: 20px">
</div> -->

<div class="no-select hide click-effect"  id="paste" onclick="paste()" style="cursor:pointer;background-color: rgba(0,0,0,0.5); margin-left: 10px; border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;margin-top: 10px;position: relative;">
    <img title="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" alt="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" src="icons/paste.svg" style="width: 20px; height: 20px">
</div>

<div class="no-select click-effect hide"  id="cancel" onclick="paste()" style="cursor:pointer;background-color: rgba(0,0,0,0.5); margin-left: 10px; border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;margin-top: 10px;position: relative;">
    <p>Cancel</p>
</div>
</div>

<div class="no-select"  style="    position: fixed;
left: 0%;
top: 0;
bottom: 0;
height: 25px;
margin: auto;">
<img class="click-effect hide" title="레이어를 추가하거나 기존레이어를 관리합니다" alt="레이어를 추가하거나 기존레이어를 관리합니다" id="dependsTableButtonLeft" src="assets/drawing2/images/back.svg" style="width: 20px; height: 20px;border-radius: 5px;padding: 10px; z-index: 10">
<div id="dependsLeft" class="hidden-click closer hide" style="position: absolute;top: 0; left: 50px;z-index: 105;width: 253px; box-shadow: 0 1px 6px #ccc;border-radius: 5px">
    <div id="dependsTableBodyBodyLeft" style="background-color: rgba(255, 255, 255, 0.7); padding: 13px;">
        <div id="dependsTableBodyWrapper">
            <div class="display dependsTableBodyLeft" cellspacing="0" width="100%" style="background-color:  rgba(255, 255, 255, 0.7)">
                <div id="dependsTableBodyLeft" style="display: flex;flex-direction: column;">

                </div>
            </div>
        </div>
    </div>
</div>

</div>

<div class="no-select"  style="    position: fixed;
right: 0%;
top: 0;
bottom: 0;
height: 25px;
margin: auto;">
<img class="click-effect hide" title="레이어를 추가하거나 기존레이어를 관리합니다" alt="레이어를 추가하거나 기존레이어를 관리합니다" id="dependsTableButtonRight" src="assets/drawing2/images/right-arrow.svg" style="width: 20px; height: 20px; border-radius: 5px;padding: 10px; z-index: 10">
<div id="dependsRight" class="hidden-click closer hide" style="position: absolute;top: 0; right: 50px;z-index: 105;width: 253px; box-shadow: 0 1px 6px #ccc;border-radius: 5px">
    <div id="dependsTableBodyBodyRight" style="background-color:rgba(255, 255, 255, 0.7); padding: 10px;">
        <div id="dependsTableBodyWrapperRight">
            <div class="display dependsTableBodyRight" cellspacing="0" width="100%" style="background-color: rgba(255, 255, 255, 0.7);">
                <div id="dependsTableBodyRight" style="display: flex;flex-direction: column;">

                </div>
            </div>
        </div>
    </div>
</div>

</div>


<!-- <div class="no-select click-effect"  id="saveDatatoFile" style="cursor:pointer;background-color: rgba(0,0,0,0.5); border-radius: 5px;height: 40px;width: 40px;display: flex;justify-content: center;align-items: center;margin-top: 10px;position: relative;">
    <img title="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" alt="도면에 아이콘을 표기하고 관련사진을 업로드 합니다" src="icons/save.svg" style="width: 20px; height: 20px">
</div> -->
</div>

<canvas id="c"></canvas>
<div id="startP" style="position: fixed; top: 0; bottom: 0; left: 0;  right: 0;display: flex; background-color: #f4f4f4;
justify-content: center;
align-items: center; flex-direction: column;">
<p style="color: grey; opacity: 0.5; text-align: center;width: 100%">아직 도면이나 배경이미지가 업로드 되지 않았습니다</p>
<br>
<p style=" color: grey; opacity: 0.5; text-align: center; width: 100%">우 상단의 클라우드 아이콘을 이용하여 서버와 기기에 </p>
<br>
<p style="color: grey; opacity: 0.5; text-align: center;width: 100%">저장된 도면이나 배경이미지를 업로드 하세요</p>
</div>
<div style="position: fixed; bottom: 20px; left: 10px;display: flex; align-items: flex-end;">
    <div id="filesection" class="hide" style="margin-right: 20px">
        <!-- <p style="border-radius: 5px; font-size: 12px; padding: 10px 5px; background-color: rgba(0,0,0,0.5); color: white; text-align: center; line-height: 20px; width: 100%"></p> -->

        <div id="filename__action-section" class="hide">
            <p style="cursor: pointer;
            margin: 5px 0 10px 0;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            padding: 5px 5px;
            color: white;
            text-align: center;
            line-height: 20px;
            width: 61%;
            background: transparent;
            border: 1px solid #676767;
            color: #565353;" id="filenameAddTo">Add to</p>
<!--            <p style="cursor: pointer;
            margin: 5px 0 10px 0;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            padding: 5px 5px;
            color: white;
            text-align: center;
            line-height: 20px;
            width: 61%;
            background: transparent;
            border: 1px solid #676767;
            color: #565353;" id="filenameCopy">Copy from</p> -->
        </div>

        <input id="filename" readonly="readonly" style="border: none;border-radius: 5px; font-size: 12px; padding: 5px 5px; background-color: rgba(0,0,0,0.5)!important; color: white; text-align: center; line-height: 20px; width: 100%">
    </div>
    <div id="layersection" class="hide">

        <div id="layername__action-section" class="hide">
            <p style="cursor: pointer;
            margin: 5px 0 10px 0;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            padding: 5px 5px;
            color: white;
            text-align: center;
            line-height: 20px;
            width: 61%;
            background: transparent;
            border: 1px solid #676767;
            color: #565353;" id="layernameAddTo">Add to</p>
    <!--        <p style="cursor: pointer;
            margin: 5px 0 10px 0;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            padding: 5px 5px;
            color: white;
            text-align: center;
            line-height: 20px;
            width: 61%;
            background: transparent;
            border: 1px solid #676767;
            color: #565353;" id="layernameCopy">Copy from</p> -->
        </div>


        <input id="layername" readonly="readonly" style="border: none;border-radius: 5px; font-size: 12px; padding: 5px 5px; background-color: rgba(0,0,0,0.5)!important; color: white; text-align: center; line-height: 20px; width: 100%">
    </div>
</div>
<div id="canvasforpdf" style="position: relative;z-index: 99;">
</div>
  <!-- <div style="position: relative;z-index: 99;display: none">
    <canvas id="saveBuffer"></canvas>
</div> -->
<div id="menuContainer">
</div>


<!-- <div class="bwinPopupd hide" style="width: 800px; min-height: 450px; margin-top: 164.5px; max-height: 959px; overflow: auto; opacity: 1; top: 0px; display: block; min-width: 800px;">
   <span class="teamworkIcon close popUpClose" style="cursor:pointer;position:absolute;">x</span>
   <div class="ganttTaskEditor" __template="TASK_EDITOR" alertonchange="true">
      <h2 class="taskData">일정요약</h2>
      <table cellspacing="1" cellpadding="5" width="100%" class="taskData table" border="0" style="table-layout: fixed">
         <tbody>
            <tr>
               <td valign="top">          
                <label for="code">코드명</label><br>        
                   <input type="text" name="code" id="code_cal" value="" size="15" class="formElements" autocomplete="off" maxlength="255" style="width:100%" oldvalue="1">
               </td>
               <td valign="top"><label for="name" class="required">일정명</label><br><input type="text" name="name" id="name_cal" class="formElements" autocomplete="off" maxlength="255" style="width:100%" value="" required="true" oldvalue="1"></td>
            </tr>
         </tbody>
      </table>
      <table cellspacing="1" cellpadding="5" width="100%" class="taskData table" border="0">
         <tbody>
            <tr class="dateRow">
               <td>
                  <div style="position:relative">
                    <input type="text" name="start" id="start" size="8" class="formElements dateField validated date" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DATE">
                    <span title="calendar" id="starts_inputDate" class="teamworkIcon openCalendar" onclick="$(this).dateField({inputField:$(this).prevAll(':input:first'),isSearchField:false});">m</span>
                </div>
               </td>
               <td>           <input type="text" name="end" id="end" size="8" class="formElements dateField validated date" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DATE">
                <span title="calendar" id="ends_inputDate" class="teamworkIcon openCalendar" onclick="$(this).dateField({inputField:$(this).prevAll(':input:first'),isSearchField:false});">m</span>
            </td>
               <td stye="padding-top:19px">
                <label for="duration" class=" ">수행기간</label><br>
                <input style="width:100%" type="text" name="duration" id="duration" size="4" class="formElements validated durationdays center" title="Duration is in working days." autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DURATIONDAYS">&nbsp;
            </td>
            </tr>
            <tr>
               <td colspan="2">
                  <label for="status" class=" ">현재상태</label><br>           
                  <select id="status" name="status" class="taskStatus" status="STATUS_ACTIVE" onchange="$(this).attr('STATUS',$(this).val());">
                     <option value="STATUS_ACTIVE" class="taskStatus" status="STATUS_ACTIVE">진행중</option>
                     <option value="STATUS_SUSPENDED" class="taskStatus" status="STATUS_SUSPENDED">중지</option>
                     <option value="STATUS_DONE" class="taskStatus" status="STATUS_DONE">완료</option>
                     <option value="STATUS_FAILED" class="taskStatus" status="STATUS_FAILED">실패</option>
                     <option value="STATUS_UNDEFINED" class="taskStatus" status="STATUS_UNDEFINED">기타</option>
                  </select>
               </td>
               <td valign="top" nowrap="">
                    <label>진행율(%)</label><br>
                    <input type="text" name="progress" id="progress" size="7" class="formElements validated percentile center" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="PERCENTILE">
                </td>
            </tr>
            <tr>
               <td colspan="4">
                <label for="description">상세</label><br>
                <textarea rows="3" cols="30" id="description" name="description" class="formElements" style="width:100%"></textarea>
            </td>
            </tr>
         </tbody>
      </table>
      <h2 style="font-size:16px">자원배치현황</h2>
      <table cellspacing="1" cellpadding="0" width="100%" class="assigsTable" id="assigsTable">
         <tbody class="assigsTable">
            <tr>
               <th style="width:100px;">자원명</th>
               <th style="width:70px;">역할</th>
               <th style="width:30px;display: none">근무시간</th>
               <th ng-if="!isInspector" style="width:30px;" class="" id="addAssig"><span class="teamworkIcon" style="cursor: pointer">+</span></th>
            </tr>
         </tbody>
      </table>
      <div style="text-align: right; padding-top: 20px" ng-if="!isInspector">     <span id="saveButton" class="button first hide" onclick="$(this).trigger('saveFullEditor.gantt');">Save</span>    <span id="cancelEditCalendar" class="button first hide">Cancel</span>    <span id="allowEdit" class="button first">Edit</span>   </div>
   </div>
</div>
-->




<div class="bwinPopupd hide" style="width: 800px; min-height: 450px; margin-top: 164.5px; max-height: 959px; overflow: auto; opacity: 1; top: 0px; display: block; min-width: 800px;touch-action:none">
 <span class="teamworkIcon close popUpClose" style="cursor:pointer;position:absolute;right:10px">x</span>
 <div class="ganttTaskEditor" __template="TASK_EDITOR" alertonchange="true">
  <h2 class="taskData">일정요약</h2>
  <table cellspacing="1" cellpadding="5" width="100%" class="taskData table" border="0" style="table-layout: fixed">
   <tbody>
    <tr>
     <td valign="top">       
         <label for="code">코드명</label>
         <input type="text" name="code" id="code_cal" value="" size="15" class="formElements" autocomplete="off" maxlength="255" style="width:100%" oldvalue="1">  
     </td>
     <td valign="top"><label for="name" class="required">일정명</label><input type="text" name="name" id="name_cal" class="formElements" autocomplete="off" maxlength="255" style="width:100%" value="" required="true" oldvalue="1"></td>
 </tr>
</tbody>
</table>
<table cellspacing="1" cellpadding="5" width="100%" class="taskData table" border="0">
   <tbody>
    <tr class="dateRow">
     <td style="padding-top:20px!important; text-align: center;">
      <div style="position:relative">
        <label for="start">시작일</label>
        <input style="width: 120px" type="text" name="start" id="start"  onfocus="$(this).blur()" size="8" class="formElements dateField validated date" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DATE">
        <span title="calendar" id="starts_inputDate" class="teamworkIcon openCalendar" onclick="$(this).dateField({inputField:$(this).prevAll(':input:first'),isSearchField:false});">m</span>
    </div>
</td>
<td style="padding-top:20px!important; text-align: center;">  <div style="position:relative">     <label for="start">종료일</label>    <input style="width: 120px" type="text" name="end" id="end"  onfocus="$(this).blur()" size="8" class="formElements dateField validated date" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DATE">
    <span title="calendar" id="ends_inputDate" class="teamworkIcon openCalendar" onclick="$(this).dateField({inputField:$(this).prevAll(':input:first'),isSearchField:false});">m</span></div>
</td>
<td style="padding-top:20px!important; width:58px; text-align: center;">  
    <label for="duration" class=" ">수행기간</label>      
    <input style="width:100%" type="text" name="duration" id="duration" readonly disabled size="4" class="formElements validated durationdays center" title="Duration is in working days." autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="DURATIONDAYS">&nbsp;         </td>
</tr>
</tbody>
</table>
<table cellspacing="1" cellpadding="5" width="100%" class="taskData table" border="0" style="padding-bottom: 20px">
   <tbody>
    <tr>
     <td colspan="2">
      <label for="status" class=" ">현재상태</label>           
      <select id="status" name="status" class="taskStatus" status="STATUS_ACTIVE" onchange="$(this).attr('STATUS',$(this).val());">
       <option value="STATUS_ACTIVE" class="taskStatus" status="STATUS_ACTIVE">진행중</option>
       <option value="STATUS_SUSPENDED" class="taskStatus" status="STATUS_SUSPENDED">중지</option>
       <option value="STATUS_DONE" class="taskStatus" status="STATUS_DONE">완료</option>
       <option value="STATUS_FAILED" class="taskStatus" status="STATUS_FAILED">실패</option>
       <option value="STATUS_UNDEFINED" class="taskStatus" status="STATUS_UNDEFINED">기타</option>
   </select>
</td>
<td valign="top" nowrap="">      
    <label>진행율(%)</label>    
    <input type="text" name="progress" id="progress" size="7" class="formElements validated percentile center" autocomplete="off" maxlength="255" value="" oldvalue="1" entrytype="PERCENTILE">         </td>
</tr>
</table>
<table cellspacing="1" cellpadding="5" width="100%" class="taskData table" border="0">
   <tbody>
    <tr>
     <td colspan="4">           
         <label for="description">상세</label>      
         <textarea rows="3" cols="30" id="description" name="description" class="formElements" style="width:100%"></textarea>             </td>
     </tr>
 </tbody>
</table>
<h2 style="font-size:16px">자원배치현황</h2>
<table cellspacing="1" cellpadding="0" width="100%" class="assigsTable" id="assigsTable">
   <tbody class="assigsTable">
    <tr>
     <th style="width:100px;">자원명</th>
     <th style="width:70px;">역할</th>
     <th style="width:30px;display: none">근무시간</th>
     <th style="width:30px;" class=""><span id="addAssig" class="teamworkIcon hide" style="cursor: pointer">+</span></th>
 </tr>
</tbody>
</table>
<div style="text-align: right; padding-top: 20px" ng-if="!isInspector">     <span id="saveButton" class="button first hide" onclick="$(this).trigger('saveFullEditor.gantt');">Save</span>    <span id="cancelEditCalendar" class="button first hide">Cancel</span>    <span id="allowEdit" class="button hide first">Edit</span>   </div>
</div>
</div>










<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
        <div class="pswp__bg"></div>
        <!-- Slides wrapper with overflow:hidden. -->
        <div class="pswp__scroll-wrap">
      <!-- Container that holds slides. 
        PhotoSwipe keeps only 3 of them in the DOM to save memory.
        Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <!--  <button class="pswp__button pswp__button--share" title="Share"></button> -->
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--delete hide" onclick="deleteImage()" title="Delete"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</body>

<script type="text/javascript" src="assets/drawing2/js/screenfull.min.js"></script>

<script type="text/javascript" src="//wurfl.io/wurfl.js"></script>

<script>
    $(function() {
        $(".elfinder-button-search input[type=text]").attr("placeholder", "검색")
    });
    var slideIndex = 0;




//     function is_touch_device() {
//         var prefixes = ' -webkit- -moz- -o- -ms- '.split(' ');
//         var mq = function(query) {
//             return window.matchMedia(query).matches;
//         }

//         if (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {
//             return true;
//         }

//   // include the 'heartz' as a way to have a non matching MQ to help terminate the join
//   // https://git.io/vznFH
//   var query = ['(', prefixes.join('touch-enabled),('), 'heartz', ')'].join('');
//   return mq(query);
// }


function is_touch_device() {

  // include the 'heartz' as a way to have a non matching MQ to help terminate the join
  // https://git.io/vznFH
  var query = ("ontouchstart" in window) || (navigator.msMaxTouchPoints || navigator.maxTouchPoints) > 2;
  return query;
}


// var
//     ua = navigator.userAgent,
//     browser = /Edge\/\d+/.test(ua) ? 'ed' : /MSIE 9/.test(ua) ? 'ie9' : /MSIE 10/.test(ua) ? 'ie10' : /MSIE 11/.test(ua) ? 'ie11' : /MSIE\s\d/.test(ua) ? 'ie?' : /rv\:11/.test(ua) ? 'ie11' : /Firefox\W\d/.test(ua) ? 'ff' : /Chrome\W\d/.test(ua) ? 'gc' : /Chromium\W\d/.test(ua) ? 'oc' : /\bSafari\W\d/.test(ua) ? 'sa' : /\bOpera\W\d/.test(ua) ? 'op' : /\bOPR\W\d/i.test(ua) ? 'op' : typeof MSPointerEvent !== 'undefined' ? 'ie?' : '',
//     os = /Windows NT 10/.test(ua) ? "win10" : /Windows NT 6\.0/.test(ua) ? "winvista" : /Windows NT 6\.1/.test(ua) ? "win7" : /Windows NT 6\.\d/.test(ua) ? "win8" : /Windows NT 5\.1/.test(ua) ? "winxp" : /Windows NT [1-5]\./.test(ua) ? "winnt" : /Mac/.test(ua) ? "mac" : /Linux/.test(ua) ? "linux" : /X11/.test(ua) ? "nix" : "",
//     mobile = /IEMobile|Windows Phone|Lumia/i.test(ua) ? 'w' : /iPhone|iP[oa]d/.test(ua) ? 'i' : /Android/.test(ua) ? 'a' : /BlackBerry|PlayBook|BB10/.test(ua) ? 'b' : /Mobile Safari/.test(ua) ? 's' : /webOS|Mobile|Tablet|Opera Mini|\bCrMo\/|Opera Mobi/i.test(ua) ? 1 : 0,
//     tablet = /Tablet|iPad/i.test(ua),
//     touch = 'ontouchstart' in document.documentElement;

//     console.log(ua)



// alert(is_touch_device())


// console.log("WURFL")
// console.log(WURFL)




$('#layersButton').addClass('deactive')



    // $.ajax({ 
    //     url: 'http://wurfl.io/wurfl.js',
    //     type: 'get',

    //     success: function(data){
    //         console.log('getdata')
    //         console.log(data)
    //     }, 
    //     dataType: "json"
    // });





    var isMobile = 0

    if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || is_touch_device == true ) {
        $("#layerSection").css('left', -(width-49));

        $(".pswp__container").addClass('hideTransition')

        isMobile = 1

        $("#zoominbutton").addClass('hide')
        $("#zoomoutbutton").addClass('hide')

    }

// var something =  isMobile
// var somethin1g =  is_touch_device()

// alert(something)
// alert(somethin1g)



function removeStandardFile(){

    $.get("file:///android_assets/views/phppages/allProjectController.php?deleteDrwStandardFile=deleteDrwStandardFile" , function(data, status){

        $("#excelArea").empty()

        $(".custom-file-upload__drawing").removeClass('hide')
        $(".custom-file-remove__drawing").addClass('hide')

        standardFile = 0

        standardFileAdded = 0

        isExcelAdded = 0



    })




}



$(document).on('click', '#cancelPermission', function(){



    $("#cancelpermission-modal").removeClass('close')



})





$(document).on('click', '#cancelpermission-action', function(){

 $("#cancelpermission-modal").addClass('close')


 $.get("file:///android_assets/views/phppages/allProjectController.php?deletePermissionFile=deletePermissionFile&fileurl=" + getFile.url + "&deleteExcel=" + fileJSON.permission.excelfileurl , function(data, status){
    var obj = JSON.parse(data)
    console.log(data)

    if(obj.status == "success" || obj.status == "404" || obj.status == "500"){

        $("#excelArea").empty()

        $("#permissionDone").removeClass('deactive')
        $("#createLayer").removeClass('hide')
        $("#permission_title").removeClass('hide')
        $("#permission_desc").removeClass('hide')
        $("#datenow").removeClass('hide')
        $("#signIMG").removeClass('hide')
        $(".editButton").removeClass('hide')
        $(".editButton").hide()
        $(".upbutton ").removeClass('hide')



        $("#permission_title1").addClass('hide')
        $("#permission_desc1").addClass('hide')
        $("#datenow1").addClass('hide')

        $("#signIMGDone").addClass("hide")

        $("#zipDownload").attr('href' , "#")
        $("#zipDownload").addClass('hide')
        $("#cancelPermission").addClass('hide')
        $("#signIMG").addClass('hide')
        $("#permission_action").removeClass('hide')
        $("#permissionDone").addClass('deactive')





        layerFinished = 0

        cancelPermissionVar = 1


        if(usertype == 0 || usertype == 1 || usertype == 2){

            console.log('its here')

            $("#permission").addClass('hide')
            $("#permissionArea").addClass('hide')

        }else if(usertype == 3){

            $("#permission").removeClass('hide')
            console.log('its here')

        }



        layerUserID.map(function(a,index) { 



            if(usertype == 0 || usertype == 1){

                $(".passwordLock").parent().removeClass('hide')
                $(".layerDelete").parent().removeClass('hide')
                $(".saveLayer").parent().removeClass('hide')
                $(".copyObject").parent().removeClass('hide')


                $(".passwordLock").removeClass('hide')
                $(".layerDelete").removeClass('hide')
                $(".saveLayer").removeClass('hide')
                $(".copyObject").removeClass('hide')

                $("#createLayer").removeClass('hide')
                $(".editButton").show('hide')
                $(".editButton").removeClass('hide')

            }else if((usertype == 2 || usertype == 3) && a.user_id == user_id){

              $(".passwordLock").parent().removeClass('hide')
              $(".layerDelete").parent().removeClass('hide')
              $(".saveLayer").parent().removeClass('hide')
              $(".copyObject").parent().removeClass('hide')


              $(".passwordLock").removeClass('hide')
              $(".layerDelete").removeClass('hide')
              $(".saveLayer").removeClass('hide')
              $(".copyObject").removeClass('hide')

              $("#createLayer").removeClass('hide')
              $(".editButton").show('hide')
              $(".editButton").removeClass('hide')







          }






      })




        getStandard()




        if(isExcelAdded == 1){

            $(".custom-file-upload__drawing").addClass('hide')
            $(".custom-file-remove__drawing").removeClass('hide')

        }else{
            $(".custom-file-upload__drawing").removeClass('hide')
            $(".custom-file-remove__drawing").addClass('hide')
            
        }
        


        permissionStatus = 0





    }else  if(obj.status == "failed"){



        console.log('failed')


    }else{


        console.log('something wrong')

    }

})





})




var first_name, last_name, email, job_position, company_name, phone_1, phone_2, service_id, user_id, UserProfileImage, usertype
var creator = 0;

var serviceAccount, projectid
var sharedLink
var linked = 0
// var change = 0


// var v = localStorage.getItem("layerID");





var type,filename,nameofFile


var initialLayer = 0
var sharedLayerId



console.log(v)
console.log(fileurlParamter)

console.log("Sdsd")

if( v == undefined){

    if(fileurlParamter == 0){
        console.log("Sdsd")
        sharedLink = 0

    }else{
        console.log("Sdsd")
        sharedLink = 1

    }
}
else{
    console.log("Sdsd2")
    sharedLink = 1
    linked = 1 


    $.get("file:///android_assets/views/phppages/allProjectController.php?isLogged=isLogged", function(data, status){
        var obj = JSON.parse(data)
        console.log(data)
        if(obj.isLogged == 0){
            $("#login-div").removeClass('hide')
        }

    })




}


if(sharedLink == 1){
    // alert('layer link')
    linked = 1 
    // $.get("file:///android_assets/views/phppages/allProjectController.php?setSession=setSession&v=" + v, function(data, status){


    // })
}









function getFileExtension(filename)
{
    var ext = /^.+\.([^.]+)$/.exec(filename);
    return ext == null ? "" : ext[1];
}


document.body.style.zoom = screen.logicalXDPI / screen.deviceXDPI




Array.prototype.pushIfNotExist = function(val) {
    if (typeof(val) == 'undefined' || val == '') { return; }
    val = $.trim(val);
    if ($.inArray(val, this) == -1) {
        this.push(val);
    }
};



function pwacheck(fileurl){


    // var standalone = true

    // var baseRegex = new RegExp( `${ window.location.hostname}` );

    // if ( window.matchMedia( '(display-mode: standalone)' ).matches ) {
    //     standalone = true

    // }

    // console.log(standalone)
    // console.log("/#/drawing?filelocation=" + fileurl)


    // if(standalone == true) { window.location.href = "/#/drawing?filelocation=" + fileurl; window.location.reload();}
    // else { window.open("/#/drawing?filelocation=" + fileurl, '_blank'); }


    window.open("/#/drawing?filelocation=" + fileurl, '_blank');

}



$(document).on('click', "#dependsTableButtonLeft", function(){

    $("#dependsLeft").removeClass('hide')
    $("#dependsRight").addClass('hide')


})

$(document).on('click', "#dependsTableButtonRight", function(){

    $("#dependsLeft").addClass('hide')
    $("#dependsRight").removeClass('hide')


})




function changed(a){

    $(".loader").show()


    console.log('Hahahahahahahahaha')

    var myFormData = new FormData();
    myFormData.append('file', a.files[0]);
    myFormData.append('projectID', "-38");

    console.log(a)
    console.log(myFormData)

    $.ajax({
        url: 'assets/views/phppages/excelUploader.php',
        type: 'POST',
              processData: false, // important
              contentType: false, // important
              dataType : 'json',
              data: myFormData,
              success: function (result) {

                console.log(result)

                excelURL = serviceAccount  + "/Common/" + project_id  +"/"+ result.uploadedToFolder +"/" +  result.uploadedfilename


                $("#excelArea").empty()

                $('#excelUploader').val(null);

                // $(".custom-file-upload__projectDetails").addClass('hide')

                $(".custom-file-upload__drawing").addClass('hide')
                $(".custom-file-remove__drawing").removeClass('hide')



                $("#excelArea").prepend('<a data-place="filechanged" style="display: flex;flex-direction: column;align-items: center;" href="https://www.easypermit.net/test/spread2/drwExcel.html?v=' + serviceAccount  + "/Common/" + project_id  +"/"+ result.uploadedToFolder +"/" +  result.uploadedfilename + '" target="_blank"><img id="theImg" style="width: 30px;height: 100%" src="assets/images/excel.svg" /><p style="width: 90px;text-align:center;word-break: break-all;font-size: 10px;">'+ result.uploadedfilename +'</p></a>')


                isExcelAdded = 1


                $(".loader").hide()


            }
        });


}


data = '{"serviceAccountId":"52","invited":0,"SUPERVISOR":0}'

// $.get("file:///android_assets/views/phppages/allProjectController.php?checkSupervisor=checkSupervisor", function(data, status){

    var obj = JSON.parse(data)
    console.log(obj)

    localStorage.setItem('invitedServiceAccountId', obj.invited);



    var invitedServiceAccountId = localStorage.getItem('invitedServiceAccountId');

    // $.get("file:///android_assets/views/phppages/allProjectController.php?getCurrentUserData=getCurrentUserData&invitedAccount=" + invitedServiceAccountId, function(data, status){

        // obj = '{"extension":{"dirname":"\/storage\/52\/Common\/151\/drw(progress)","basename":"cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg","extension":"jpg","filename":"cats_of_world_34490424_466714877105081_2706313812956413952_n"},"extensionqqqq":"\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg","hash":"cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg","baseFolder":"\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg","sszzw":"cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg","filename":"cats_of_world_34490424_466714877105081_2706313812956413952_n","hash66":"\/storage\/52\/Common\/151\/drw(progress)\/","extensiosssssssssn":"\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg","ex00":"jpg","freeURL":"\/storage\/52\/Common\/151\/drw(progress)\/","hash1":"","directory":"\/var\/www\/html\/storage\/52\/Common\/151\/drw(progress)\/","normal11":null,"foldername":"","urr":"https:\/\/easypermit.net\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg","name":"cats_of_world_34490424_466714877105081_2706313812956413952_n","ttt":"\/var\/www\/html\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n","folder":"cats_of_world_34490424_466714877105081_2706313812956413952_n","finall":"\/var\/www\/html\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n\/cats_of_world_34490424_466714877105081_2706313812956413952_n","expfile":"\/var\/www\/html\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n\/cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg.ezp","\"undefined3511555105048664\"":"\/var\/www\/html\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n\/cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg-undefined3511555105048664.ezp","vv":"{\"canvasData\":[],\"eyeIcon\":{},\"imageCountArray\":0,\"eyeIconLen\":0,\"layers\":{\"id\":1,\"user_id\":\"351\",\"currentDate\":\"2019\/04\/13\",\"time\":\"3:7\",\"totalLayerCount\":\"undefined3511555105048664\",\"creator\":0,\"layerName\":\"2019\/04\/13\",\"project_id\":\"151\",\"isPassword\":0,\"UserProfileImage\":\"_profile351\",\"first_name\":\"\uae40\uc774\ub984\",\"last_name\":\"\",\"job_position\":\"\ucc28\uc7a5\",\"phone_1\":\"01230123213\",\"phone_2\":\"0127312312\",\"company_name\":\"\uc774\uc9c0\uc0b0\uc5c5\",\"email\":\"1234@naver.com\",\"completed\":0,\"descrip\":\"\"}}","vj":{"canvasData":[],"eyeIcon":{},"imageCountArray":0,"eyeIconLen":0,"layers":{"id":1,"user_id":"351","currentDate":"2019\/04\/13","time":"3:7","totalLayerCount":"undefined3511555105048664","creator":0,"layerName":"2019\/04\/13","project_id":"151","isPassword":0,"UserProfileImage":"_profile351","first_name":"\uae40\uc774\ub984","last_name":"","job_position":"\ucc28\uc7a5","phone_1":"01230123213","phone_2":"0127312312","company_name":"\uc774\uc9c0\uc0b0\uc5c5","email":"1234@naver.com","completed":0,"descrip":""}},"permissionStatus":0,"canvasData":[],"allitems":[],"imageCountArray":{"undefined3511555105048664":0},"layers":[{"id":1,"user_id":"351","currentDate":"2019\/04\/13","time":"3:7","totalLayerCount":"undefined3511555105048664","creator":0,"layerName":"2019\/04\/13","project_id":"151","isPassword":0,"UserProfileImage":"_profile351","first_name":"\uae40\uc774\ub984","last_name":"","job_position":"\ucc28\uc7a5","phone_1":"01230123213","phone_2":"0127312312","company_name":"\uc774\uc9c0\uc0b0\uc5c5","email":"1234@naver.com","completed":0,"descrip":""}],"eyeIcon":{},"status":1,"fileContent":"{\"canvasData\":[],\"eyeIcon\":{},\"imageCountArray\":0,\"eyeIconLen\":0,\"layers\":{\"id\":1,\"user_id\":\"351\",\"currentDate\":\"2019\/04\/13\",\"time\":\"3:7\",\"totalLayerCount\":\"undefined3511555105048664\",\"creator\":0,\"layerName\":\"2019\/04\/13\",\"project_id\":\"151\",\"isPassword\":0,\"UserProfileImage\":\"_profile351\",\"first_name\":\"\uae40\uc774\ub984\",\"last_name\":\"\",\"job_position\":\"\ucc28\uc7a5\",\"phone_1\":\"01230123213\",\"phone_2\":\"0127312312\",\"company_name\":\"\uc774\uc9c0\uc0b0\uc5c5\",\"email\":\"1234@naver.com\",\"completed\":0,\"descrip\":\"\"}}"}'

        // var obj = JSON.parse(data)
        // console.log(obj)

    // localStorage.setItem('layerID', '-1');

    // if(obj.status == 'error'){

    //     // $("#errorLink-modal").removeClass('close')


    //     sharedLink = 0

    //     $(".loader").hide().fadeOut('slow');

    //     $("#userdoesnt-exist-modal").removeClass('close')



    // }else{


        // var obj = JSON.parse(data)



        obj = {"0":{"id":"52","service_id":"52","user_id":"351","email":"1234@naver.com","first_name":"김이름","last_name":"","company_name":"이지산업","country":"0","address":"","UserProfileImage":"_profile351","job_position":"차장","phone_1":"01230123213","phone_2":"0127312312","pricing":"0","staffCount":"0","timestamp":"2019-04-03 08:04:01","USERTYPE":0},"PROJECTID":"151","invitedAccount":"0","SERVICERUNNER":"52","CURRENTUSER":"351","SUPERVISOR":0}


        console.log(obj)



        serviceAccount = obj.SERVICERUNNER;
        projectid = obj.PROJECTID;

        first_name = obj["0"].first_name
        last_name = obj["0"].last_name
        project_id = obj.PROJECTID
        email = obj["0"].email
        job_position = obj["0"].job_position
        company_name = obj["0"].company_name
        phone_1 = obj["0"].phone_1
        UserProfileImage = obj["0"].UserProfileImage
        phone_2 = obj["0"].phone_2






        usertype = obj["0"].USERTYPE

        if(usertype == 0 || usertype == 1){


            $("#cancelPermission").removeClass('hide')
            
        }


        if(usertype == 3){




            // $.get("file:///android_assets/views/phppages/allProjectController.php?getDrawingStandardFile=getDrawingStandardFile", function(data, status){

            //     var obj = JSON.parse(data)
            //     console.log(obj)

            //     excelURL = obj.path + obj.files['0']

            //     console.log(excelURL)

            //     $("#excelArea").prepend('<a data-place="" style="display: flex;flex-direction: column;align-items: center;" href="https://www.easypermit.net/test/spread/index.html?v=' + excelURL +'" target="_blank"><img id="theImg" style="width: 30px;height: 100%;" src="assets/images/excel.svg" /><p style="width: 90px;text-align:center;word-break: break-all;font-size: 10px;">'+ obj.uploadedfilename +'</p></a>')


            //     isExcelAdded = 1

            // })






        }else{
            $("#layerBody").css('padding-bottom', '10px')
            $("#permission ").addClass('hide')
        }


        if(invitedServiceAccountId == 1){

            service_id = obj["0"].service_account_id

        }else if(invitedServiceAccountId == 0){

            service_id =  obj.SERVICERUNNER
            creator  = 1

        }

        if(obj.SUPERVISOR == 1){
            creator = 2
        }

        user_id = obj["0"].user_id

        var userdata =  '<div style="flex-basis: 20%; text-align:center;align-items: center;display: flex;justify-content: center;"> <img  src="storage/'+ service_id +'/Private/'+ user_id +'/.info/'+ UserProfileImage +'" onerror=this.src="images/noPic.png" style="width: 46px;height:46px;border-radius:10px"> </div> <div style="flex-basis: 65%;display: flex;justify-content: flex-start;flex-direction: column;"> <p style="font-size: 12px;font-weight: bold;color: #727171;">'+ first_name + ' ' + last_name + '</p> <p style="font-size: 12px;color: #727171;">'+ email +'</p> <p style="font-size: 12px;color: #727171;">'+ job_position +' ' + company_name +'</p> </div></div><div id="excelArea"></div>' 

        var d1 = document.getElementById('permissionUserData');
        d1.insertAdjacentHTML('beforeend', userdata);



        if(sharedLink == 1 ){

            linked = 1 

            console.log(v)


            // $.get("file:///android_assets/views/phppages/allProjectController.php?checkifURLExist=checkifURLExist&v=" + v + "&filelocation=" + filelocationURL, function(data, status){

                data = '{"locationws":"\/var\/www\/html\/storage\/52\/Common\/151\/drw(progress)\/cats_of_world_34490424_466714877105081_2706313812956413952_n.jpg","file_check":true,"status":"success"}'

                console.log(data)


                var obj = JSON.parse(data)

                var getFile = []


                console.log(obj)

                if(obj.status == "success"){

                    if(fileurlParamter == 0){

                        if(obj["0"].type == 1){
                            type = "pdf"
                            getFile.mime = "pdf"
                        }else if(obj["0"].type == 2){
                            type = "image"
                            getFile.mime = "image"
                        }

                        filename = obj["0"].filelocation
                        nameofFile = obj["0"].nameofFile

                        sharedLayerId = obj["0"].layer


                        initialLayer = 1



                    }else if(fileurlParamter == 1){


                        console.log("extension Chewck")
                        console.log(getFileExtension(filelocationURL))

                        if(getFileExtension(filelocationURL) == 'pdf'){


                            $("#filename1").val('this is reached for pdf')

                            filename = filelocationURL

                            type = "pdf"
                            getFile.mime = "pdf"
                            getFile.name = filelocationURL.substring(filelocationURL.lastIndexOf('/')+1);

                            filename = filelocationURL
                            nameofFile = getFile.name



                        }else if(getFileExtension(filelocationURL) == 'jpg' || getFileExtension(filelocationURL) == 'JPG' || getFileExtension(filelocationURL) == 'JPEG' || getFileExtension(filelocationURL) == 'png' || getFileExtension(filelocationURL) == 'PNG'){



                            $("#filename1").val('this is reached for image')

                            filename = filelocationURL

                            type = "image"
                            getFile.mime = "image"
                            getFile.name = filelocationURL.substring(filelocationURL.lastIndexOf('/')+1);

                            filename = filelocationURL
                            nameofFile = getFile.name




                        }


                    }



                    console.log(filename)





                    $("#showViewer").click(function(){


                        $(".bwinPopupd").toggleClass('hide')

                        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
                        $(".bwinPopupd").attr('data-x', 0);
                        $(".bwinPopupd").attr('data-y', 0);


                        $('.bwinPopupd').css('margin-top', ($(body).height() - $('.bwinPopupd').outerHeight()) / 2)


                    })


                    $(".popUpClose").click(function(){

                        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
                        $(".bwinPopupd").attr('data-x', 0);
                        $(".bwinPopupd").attr('data-y', 0);


                        $(".bwinPopupd").addClass('hide')


                    })





                    $("#saveButton").click(function(){

                        var myDate= $('#start').val()
                        myDate=myDate.split("/");
                        var newDate=myDate[1]+"/"+myDate[2]+"/"+myDate[0];

                        var myDate2= $('#end').val()
                        myDate2=myDate2.split("/");
                        var newDate2=myDate2[1]+"/"+myDate2[2]+"/"+myDate2[0];

                        var json = originalCalData.tasks[iIndex]

                        console.log(json)


                        var date1 = new Date($("#start").val());
                        var date2 = new Date($("#end").val());
                        var timeDiff = Math.abs(date2.getTime() - date1.getTime());
                        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24)); 

                        json.name =  $('#name_cal').val()
                        json.code =  $('#code_cal').val()
                        json.start =  new Date(newDate).getTime()
                        json.end =  new Date(newDate2).getTime()
                        json.duration =  diffDays + 1
                        json.progress =  $('#progress').val()
                        json.description =  $('#description').val()
                        json.startIsMilestone =  $('#startIsMilestone').prop('checked')
                        json.endIsMilestone =  $('#endIsMilestone').prop('checked')
                        json.status =  $('#status').val()


                        console.log(json)

                        var assingee = []


                        
                        for(i = 0 ; i < $(".assigEditRow").length; i++){


                            var temp = {}
                            temp['resourceId'] = ($(".assigEditRow").eq(i).find('.resource_1').val())
                            temp['roleId'] =  ($(".assigEditRow").eq(i).find('.resource_2').val())
                            temp['id'] = $(".assigEditRow").attr('assid')

                            assingee.push(temp)





                        }

                        console.log(assingee)

                        json.assigs =  assingee

                        originalCalData.tasks[iIndex] = json

                        saveProject = originalCalData

                        console.log(saveProject)


                        var person = {
                            data :  JSON.stringify(saveProject)
                        }


                        $.ajax({
                            url: 'file:///android_assets/views/phppages/allProjectController.php?saveganttCalendarThird=saveganttCalendarThird',
                            type: 'post',
                            dataType: 'json',
                            data: person,
                            success: function (data) {

                                console.log(data)

                                console.log('success uploade')

                                $(".formElements").prop('disabled', true)
                                $("#saveButton").addClass('hide')
                                $("#addAssig").addClass('hide')
                                $("#cancelEditCalendar").addClass('hide')
                                $("#allowEdit").removeClass('hide')
                                $(".deleteTrash").addClass('hide')

                            }
                        });











                    })

                    // $.ajax({
                    //     url: 'file:///android_assets/views/phppages/allProjectController.php?getUserTypeProject=getUserTypeProject',
                    //     type: 'post',
                    //     async : false,
                    //     dataType: 'json',
                    //     success: function (obj) {

                        obj = '{"USERTYPE":"0","INVITED":"0","SUPERVISOR":0,"OWNER":"1","CLIENT":"0","projectid":"151"}'

                        console.log("datssssssssssssssssssssssssssssssa")
                        console.log(obj)

                        _global_usertype = parseInt(obj.USERTYPE)

                        console.log(_global_usertype)

                        _global_userinvited = obj.INVITED 
                        _global_supervisor = obj.SUPERVISOR 
                        _global_owner = obj.OWNER 


                        console.log($('#projectDetail-open_supervisor').length)


                            // $.ajax({
                            //     url: 'assets/views/phppages/allProjectController.php?getPermissionListArray=getPermissionListArray&projectID='+ obj.projectid,
                            //     type: 'get',
                            //     async : false,
                            //     success: function (response) {

                                response = '{"Phone_2":"[true,true,true,true,true,true,true,false,true,true,true,true,true,true,true,false,true,true,true,true,true,true,true,false,true,true,true,true,true,true,true,false,true,true,true,true,true,true,true,false,true,true,true,true,true,true,false,false,true,true,true,true,true,true,true,false,true,true,true,true,true,true,true,false,null,null,null,null,null,null,null,null]"}'

                                var response = JSON.parse(response)

                                console.log(response)

                                console.log(response.Phone_2)


                                console.log($('#projectDetail-open_supervisor').length)

                                var a = JSON.parse(response.Phone_2)

                                console.log(a)


                                if(_global_usertype == 0){

                                    console.log('Servicre')

                                    if(a[56]) { $("#showViewer").removeClass('hide') }
                                        if(a[60]) { $("#allowEdit").removeClass('hide') }

                                    }

                                if(_global_usertype == 1){

                                    if(a[57]) { $("#showViewer").removeClass('hide') }
                                        if(a[61]) { $("#allowEdit").removeClass('hide') }


                                    }

                                if(_global_usertype == 2){

                                   if(a[58]) { $("#showViewer").removeClass('hide') }
                                       if(a[62]) { $("#allowEdit").removeClass('hide') }
                                   }

                               if(_global_usertype == 3){

                                if(a[59]) { $("#showViewer").removeClass('hide') }
                                    if(a[63]) { $("#allowEdit").removeClass('hide') }


                                }


                            // }

                        // })

                        // }
                    // });




                    // $.get("file:///android_assets/views/phppages/allProjectController.php?checkifFileExist=checkifFileExist&fileURL=" + filename, function(data, status){
                    //     console.log("")
                    //     var obj = JSON.parse(data)





                    // })


                    



                    $(document).on('click', '.deleteTrash', function(event) {

                        $(this).closest('tr').remove()

                    })

                    $("#allowEdit").click(function(){

                        $(".formElements").prop('disabled', false)
                        $("#saveButton").removeClass('hide')
                        $("#addAssig").removeClass('hide')
                        $(".deleteTrash").removeClass('hide')
                        $("#cancelEditCalendar").removeClass('hide')
                        $("#allowEdit").addClass('hide')

                    })

                    $("#cancelEditCalendar").click(function(){

                        $(".formElements").prop('disabled', true)
                        $("#saveButton").addClass('hide')
                        $("#addAssig").addClass('hide')
                        $(".deleteTrash").addClass('hide')
                        $("#cancelEditCalendar").addClass('hide')
                        $("#allowEdit").removeClass('hide')

                    })




                    $("#addAssig").click(function(){

                        var string

                        for(i = 0; i < resource.length; i++){



                          string = string + '<option value="'+ resource[i].id +'">'+ resource[i].name +'</option>'

                      }

                      console.log(string)

                      var d1 = document.getElementById('assigsTable');

                      d1.insertAdjacentHTML('beforeend', ' <tr taskid="tmp_1537223566597" assid="tmp_1548205772360_1" class="assigEditRow" __template="ASSIGNMENT_ROW">   <td><select name="resourceId" class="formElements resource_1">'+ string +'</select></td>  <td><select type="select" name="roleId" class="formElements resource_2"><option value="tmp_1">Project Manager</option><option value="tmp_2">Worker</option><option value="tmp_3">Stakeholder</option><option value="tmp_4">Customer</option></select></td>      <td align="center" class="deleteTrash"><span class="teamworkIcon delAssig del" style="cursor: pointer">d</span></td>   </tr>');



                  })




                    Android.checkifFileExistFunction('checkifFileExist' , localStorage.getItem("drwFileName") + ".ezp" , localStorage.getItem("drwFileName"))



function sendVideo(a, imageCount, activeLayer){


    alert("hahahah")
    console.log("SendVideo")
    console.log(imageCount)
    console.log(activeLayer)

    a = "file:///" + a;

    console.log(a)

    var d1 = document.getElementById('gallery-'+ imageCount + activeLayer);

            console.log('this is arrea')
            console.log(d1)


            d1.insertAdjacentHTML('beforeend', '<div><img data-tag="'+ imageCount + '" data-parent="'+ imageCount +'" class="videoOpen" id="image-' +  activeLayer + '-'  + '" src="' + a +'"></div>');



            console.log("imageCount" + imageCount + activeLayer)
$('#gallery-'+ imageCount + activeLayer + '.slick-initialized').slick("unslick");
$('#gallery-li-'+ imageCount + activeLayer).removeClass('hide')

$('#gallery-'+ imageCount + activeLayer).slick({
    infinite: true,
    slidesToShow: 3,
    slidesToScroll: 3,
    dots: false,
    prevArrow: false,
    nextArrow: false
})



}



                    function java(a){
                        console.log("JAVA")
                        console.log(a)

                        fileJSON = a

                        // filelocationURLSimplified = obj.urr.replace(/^.*\/\/[^\/]+/, '')



                        console.log(obj)
                        if(obj.status == -1){
                            console.log("restrict")
                            clearEverything()
                        }
                        else{

                            editON = 0

                            console.log(editON)
                            console.log('sssssssssssssssssssssssssssssssssssssssssssss')

                            $("#clearCanvas-action").click()
                        }

                        getInit()


                    }



                }else if(obj.status == "failed"){
                    $(".loader").hide().fadeOut('slow');

                    $("#fileDoesntExist-modal").removeClass('close')
                }


            }else{



                $(".loader").hide().fadeOut('slow');

            }






            var _config = {
                canvasState             : [],
                currentStateIndex       : -1,
                undoStatus              : false,
                redoStatus              : false,
                undoFinishedStatus      : 1,
                redoFinishedStatus      : 1,
                undoButton              : document.getElementById('undo'),
                redoButton              : document.getElementById('redo'),
            };

//init values

var selection = 0;
var mouseover = 0;
var freehandColor;
var imageObject;
var totalObject;
var imageAction = 0;
var imageObjectCreated = 0;
var polygonCreated = 0;
var allowMove = 1;
var pdfcanvas;
var pdfcanvasWidth;
var pdfcanvasHeight;
var canvasPageZoom
var backgroundImageLoaded = 0
var zoomLevel = 1
var editTextClicked = 0
var layerisCreating = 0
var _imageCount = 0

var objectAdded = 0

var layerBeingCreated = 0

var showNotification = 0

var permissionStatus = 0

var cancelPermissionVar = 0



var standardFile = 0

var standardFileAdded = 0

var taskid = 0
var notification_list = []

var canvasImageLoaded;
var pdfImageLoaded;
var ifPDFAdded = 0;
var snapshot = 0;
var snapselectedID
var created
var multidrawEnabled = 0
var isobjectselected = 1
var created = 0
var imageX, imageY
var inputWait = 0

var inputTempBuffer
var prevActive

var isPdfUpload = 0
var canvasViewport

var layerOrderArray = [];

var totalLayerCount = 0
var layerCount = 0

var activeLayer = 0
var snapArray = []
var eyeIconLen = 0

var signatureData = []


var pausePanning = false

var prevX, prevY

var imageObjectCount = 0
var imageCountArray = []

var isExcelAdded = 0

var excelURL

var localOpen = 0
var serverOpen = 0


var layernamep = 0
var textareaeditCLick = 0

var isLocked = 0
var imageW
var getFile = []
var ifFileExist = 0
var fileExist = 0
var fileJSON
var isLayerEditing

var zoomValue = 100;
var pageNum = 1;
  var pdfScale = 2; // make pdfScale a global variable
  var shownPdf; // another global we'll use for the buttons
  var pdf_firstload = 0
  var viewportData
  var imageHeightData
  var imageWidthData

  // var fullscreenHeight = 

  var previousSelection = 0
  
  var ctx;
  
  var logEvents = false;
  // Global vars to cache event state
  var evCache = new Array();
  var prevDiff = -1;
  
  var stabilize = 0
  
  var curYPos = 0;
  var curXPos = 0;
  var escaped = 0
  var defaultZoomValue = 1;

  var allitems = []
  var buffer = []
  
  var valThis, gallery, current, parent
  
  var photoswipeClose = 0
  


  var depends = []
  var dependsLeft = []
  var dependsRight = []
  var dependsTest = []
  var arrayI
  var originalCalData, resource
  var iIndex



  var isFingerDown = 0;
  var c,d
  var errorRotation = 0
  var _correction
  var layerUserID = []
  var editON = 0
  var copyOn = 0
  
  var lastX = 0, lastY = 0
  
  var panner = 0

  var auto_save = 0;

  var height, width

 // alert( screen.height + "," +   $(window).innerHeight() + "," + "," +   $(window).offsetHeight())
 // alert(document.documentElement.clientHeight)

 var normalHeight = document.documentElement.clientHeight
 var originalHeight = screen.height

 var normalWidth = document.documentElement.clientWidth
 var originalWidth = screen.width


 if(isMobile == 1){

    height = $(window).height()
    width =  $(window).width()




}else if(isMobile == 0){


    height =  screen.height
    width =  screen.width


}


// var proxied = new Proxy(obj, {
//   get: function(target, prop) {
//     console.log({ type: 'get', target, prop });
//     return Reflect.get(target, prop);
// },
// set: function(target, prop, value) {
//     console.log({ type: 'set', target, prop, value });
//     return Reflect.set(target, prop, value);
// }
// });






var savedCounter = []

var layerFinished = 0


  // Obtain a canvas drawing surface from fabric.js
  var saveBuffer = new fabric.Canvas('saveBuffer',{
    width: width, height: height, selection : false
});
  
  
  
  
  var current;
  var list = [];
  var state = [];
  var index = 0;
  var index2 = 0;
  var action = false;
  var refresh = true;
  
  
  
  
  
  fabric.devicePixelRatio = 1
  
  // Obtain a canvas drawing surface from fabric.js
  var canvas = new fabric.Canvas('c',{
    width: width, height: height, selection : false, controlsAboveOverlay:true,
    centeredScaling:true,
    allowTouchScrolling: true
});



  
  pausePanning = true

  console.log("aaa1")
  
  $(".canvas-container").css({
    height: window.screen.availHeight + 'px!important',
    width: window.screen.availWidth + 'px!important'
});
  $(".canvas-container").addClass('hehe')
  
  
  document.body.style.backgroundColor = "#f4f4f4";
  



  $('#toolbutton').addClass('deactive')
  $('#imageEye').addClass('deactive')
  
  
  $('#layeraction-' + activeLayer).find(".editButton").removeClass('editActivate')
  $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
  $('#layeraction-' + activeLayer).find(".cancelEdit").addClass('hide')

  editON = 0

  $('.deleteVideo').addClass('hide')

  $("#toolbutton").addClass('hide');

  $(".categories").addClass('hide')
  $(".pswp__button--delete").addClass('hide')
  
  var flag = 0



  init();
  var ctx;
  var drag = false;
  function init(){
    ctx = document.getElementById('c').getContext('2d');
    ctx.canvas.onmousedown = dragStart;
    ctx.canvas.onmousemove = dragStep;
    ctx.canvas.onmouseup = dragEnd;
    ctx.canvas.onmouseout = dragEnd;
    drawBubble(ctx,100,100,200,100,20);
}
function drawBubble(ctx,x,y,w,h,radius,px,py){
    var r = x + w;
    var b = y + h;
    if(py<y || py>y+h){
        var con1 = Math.min(Math.max(x+radius,px-10),r-radius-20);
        var con2 = Math.min(Math.max(x+radius+20,px+10),r-radius);
    }
    else{
        var con1 = Math.min(Math.max(y+radius,py-10),b-radius-20);
        var con2 = Math.min(Math.max(y+radius+20,py+10),b-radius);
    }
    var dir;
    if(py < y) dir = 2;
    if(py > y) dir = 3;
    if(px < x && py>=y && py<=b) dir = 0;
    if(px > x && py>=y && py<=b) dir = 1;
    if(px >= x && px <= r && py >= y && py <= b) dir = -1;
    ctx.clearRect(0,0,400,400);
    ctx.beginPath();
    ctx.strokeStyle="black";
    ctx.lineWidth="2";
    ctx.moveTo(x+radius,y);
    if(dir==2){
        ctx.lineTo(con1,y);
        ctx.lineTo(px,py);
        ctx.lineTo(con2,y);
        ctx.lineTo(r-radius,y);
    }
    else ctx.lineTo(r-radius,y);
    ctx.quadraticCurveTo(r,y,r,y+radius);
    if(dir==1){
        ctx.lineTo(r,con1);
        ctx.lineTo(px,py);
        ctx.lineTo(r,con2);
        ctx.lineTo(r,b-radius);
    }
    else ctx.lineTo(r,b-radius);
    ctx.quadraticCurveTo(r, b, r-radius, b);
    if(dir==3){
        ctx.lineTo(con2,b);
        ctx.lineTo(px,py);
        ctx.lineTo(con1,b);
        ctx.lineTo(x+radius,b);
    }
    else ctx.lineTo(x+radius,b);
    ctx.quadraticCurveTo(x, b, x, b-radius);
    if(dir==0){
        ctx.lineTo(x,con2);
        ctx.lineTo(px,py);
        ctx.lineTo(x,con1);
        ctx.lineTo(x,y+radius);
    }
    else ctx.lineTo(x,y+radius);
    ctx.quadraticCurveTo(x, y, x+radius, y);
    ctx.stroke();
}
function dragStart(){
    drag = true;
}
function dragStep(e){ if(drag){
    drawBubble(ctx,100,100,200,100,20,e.offsetX,e.offsetY);
}}
function dragEnd(){
    drag = false;
}


//   var elf = $('#elfinder').elfinder({
//          // url: 'php/connector.minimal.php',
//          url: 'http://13.124.239.52/elFinder-2.1.29/php/connector.minimal.php',
//          defaultView : 'list',
//          resizable: true,
//          onlyMimes: ["application/pdf", "image"],
//          contextmenu : {
//                     // navbarfolder menu
//                     navbar : [],

//   // current directory menu
//   cwd    : [],


//   // current directory file menu
//   files  : [
//   'getfile', '|','open', 'quicklook', '|',  'info'
//   ]
// },

// uiOptions : {
//   // toolbar configuration
//   toolbar : [
//   ['search']
//   ],

//   // directories tree options
//   tree : {
//     // expand current root on init
//     openRootOnLoad : true,
//     // auto load current dir parents
//     syncTree : true
// },

//   // navbar options
//   navbar : {
//      minWidth : 150,
//      maxWidth : 500
//   },

//   // current working directory options
//   cwd : {
//     // display parent directory in listing as ".."
//     oldSchool : false
// }
// },
// getFileCallback : function(file) {

//  getFile = file

//  if(backgroundImageLoaded == 0 && isPdfUpload == 0){
//      $("#clearCanvas-action").click()
//  }else if($('#clearCanvas-modal').find(".checkedBox").prop('checked')){
//      $("#clearCanvas-action").click()
//  }else{  
//      $("#clearCanvas-modal").removeClass('close')
//  }


// } 
// }).elfinder('instance');



var wrapper = document.getElementById("signature-pad");
var clearButton = wrapper.querySelector("[data-action=clear]");
var changeColorButton = wrapper.querySelector("[data-action=change-color]");
var undoButton = wrapper.querySelector("[data-action=undo]");
var savePNGButton = wrapper.querySelector("[data-action=save-png]");
var saveJPGButton = wrapper.querySelector("[data-action=save-jpg]");
var saveSVGButton = wrapper.querySelector("[data-action=save-svg]");
var canvassign = wrapper.querySelector("canvas");
var signaturePad = new SignaturePad(canvassign, {
  // It's Necessary to use an opaque color when saving image as JPEG;
  // this option can be omitted if only saving as PNG or SVG
  backgroundColor: 'rgb(255, 255, 255)',
  minWidth: 2.5,
  maxWidth: 4.5
});

// Adjust canvas coordinate space taking into account pixel ratio,
// to make it look crisp on mobile devices.
// This also causes canvas to be cleared.
function resizeCanvas() {
  // When zoomed out to less than 100%, for some very strange reason,
  // some browsers report devicePixelRatio as less than 1
  // and only part of the canvas is cleared then.
  var ratio =  Math.max(window.devicePixelRatio || 1, 1);

  // This part causes the canvas to be cleared
  canvassign.width = canvassign.offsetWidth * ratio;
  canvassign.height = canvassign.offsetHeight * ratio;
  canvassign.getContext("2d").scale(ratio, ratio);

  $(".signature-pad--body").width($(window).width()).height($(window).height());

  $("#signArea").attr({
    width: $(window).width(),
    height: $(window).height()
})

  // This library does not listen for canvas changes, so after the canvas is automatically
  // cleared by the browser, SignaturePad#isEmpty might still return false, even though the
  // canvas looks empty, because the internal data of this library wasn't cleared. To make sure
  // that the state of this library is consistent with visual state of the canvas, you
  // have to clear it manually.
  signaturePad.clear();
}

// On mobile devices it might make more sense to listen to orientation change,
// rather than window resize events.
window.onresize = resizeCanvas;
resizeCanvas();

function download(dataURL, filename) {
    var blob = dataURLToBlob(dataURL);
    var url = decodeURIComponent(window.URL.createObjectURL(blob));

    console.log(url)

    var a = document.createElement("a");
    a.style = "display: none";
    a.href = url;
    a.download = filename;

    document.body.appendChild(a);
    a.click();

    window.URL.revokeObjectURL(url);
}



// One could simply use Canvas#toBlob method instead, but it's just to show
// that it can be done using result of SignaturePad#toDataURL.
function dataURLToBlob(dataURL) {
  // Code taken from https://github.com/ebidel/filer.js
  var parts = dataURL.split(';base64,');
  var contentType = parts[0].split(":")[1];
  var raw = window.atob(parts[1]);
  var rawLength = raw.length;
  var uInt8Array = new Uint8Array(rawLength);

  for (var i = 0; i < rawLength; ++i) {
    uInt8Array[i] = raw.charCodeAt(i);
}

return new Blob([uInt8Array], { type: contentType });
}

clearButton.addEventListener("click", function (event) {
    signatureData = []
    $("#permissionDone").addClass('deactive')
    signaturePad.clear();
});

undoButton.addEventListener("click", function (event) {
    var data = signaturePad.toData();

    if (data) {
    data.pop(); // remove the last dot or line
    signaturePad.fromData(data);
}
});

changeColorButton.addEventListener("click", function (event) {
    var r = Math.round(Math.random() * 255);
    var g = Math.round(Math.random() * 255);
    var b = Math.round(Math.random() * 255);
    var color = "rgb(" + r + "," + g + "," + b +")";

    signaturePad.penColor = color;
});

savePNGButton.addEventListener("click", function (event) {
    if (signaturePad.isEmpty()) {
        alert("Please provide a signature first.");
    } else {
        var dataURL = signaturePad.toDataURL();
        download(dataURL, "signature.png");
    }
});

saveJPGButton.addEventListener("click", function (event) {
    if (signaturePad.isEmpty()) {
        alert("Please provide a signature first.");
    } else {
        var dataURL = signaturePad.toDataURL("image/jpeg");
        download(dataURL, "signature.jpg");
    }
});

saveSVGButton.addEventListener("click", function (event) {
    if (signaturePad.isEmpty()) {
        alert("Please provide a signature first.");
    } else {
        var dataURL = signaturePad.toDataURL('image/svg+xml');
        download(dataURL, "signature.svg");
    }
});

$('#elfinder').mousedown(function(e){
    e.stopPropagation();
});


function goUp(e){

    console.log("eee")
    console.log(e)

    var layerid = e
// e = e - 1
var e = $("#layerTR-" + e);
// move up:
e.prev().insertAfter(e);
// move down:
// e.next().insertBefore(e);

console.log(layerOrderArray)



Array.prototype.move = function(from,to){
    this.splice(to,0,this.splice(from,1)[0]);
    return this;
};

var index = layerOrderArray.indexOf(String(layerid));

if(index != 0){

    layerOrderArray.move(index,index-1);


    $.get("file:///android_assets/views/phppages/allProjectController.php?goUplayer=goUplayer&index=" + index + "&baseURL=" + getFile.url, function(data, status){


        data = JSON.parse(data)

        console.log(data)
    })

}

// layerOrderArray = layerOrderArray.reverse()

console.log(index)
console.log(layerOrderArray)

// layerOrderArray = layerOrderArray.reverse()



}





$(document).on('click', '#createLayer', function(event) {

    if(layernamep == 1){


        $('#saveRequired-modal').removeClass('close')


    }else{



        if($('#createLayer-modal').find(".checkedBox").prop('checked')){
            $("#createLayer-action").click()
        }else{

            $("#createLayer-modal").removeClass('close')

        }

    }



})



$(document).on('click', '#saveRequired-action', function(event) {



    saveLayer()

    $('#createLayer-action').click()

    $("#saveRequired-modal").addClass('close')



})


$(document).on('click', '#saveRequiredNocreate-action', function(event) {


    saveLayer()

    $("#saveRequiredNocreate-modal").addClass('close')



})

$(document).on('click', '.saveRequiredNocreate-cancel-modal', function(event) {

    layernamep = 0

    endEditMode()
    $("#saveRequiredNocreate-modal").addClass('close')


})

$('#deletesnap1').click(function(event) {

    $('.snapimages').removeClass('full')
    $('#deletesnap').removeClass('show')
    $(this).removeClass('show')
    console.log("clickedjsdks")
});


$(document).on('click', '#createLayer-action', function(event) {



    canvas.discardActiveObject()

    layerBeingCreated = 1

    canvas.renderAll()

    $("#hideThis").addClass('hide')

    console.log(activeLayer)


    $("#layerName-" + activeLayer).addClass("textareaEditStyle")

    $("#layerName-" + activeLayer).prop("disabled", true);

    $('#layeraction-' + activeLayer).find(".editButton").removeClass('editActivate')
    $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
    $('#layeraction-' + activeLayer).find(".cancelEdit").addClass('hide')

    editON = 0

    $('.deleteVideo').addClass('hide')

    $("#toolbutton").addClass('hide');

    $("#paste").addClass('hide')
    $("#submitText").click()
    $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
    $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
    $(".categories").addClass('hide')
    $(".pswp__button--delete").addClass('hide')

    $("#createLayer-modal").addClass('close')




    if(backgroundImageLoaded == 0 && isPdfUpload == 0) document.body.style.backgroundColor = "#fff"; 
    else canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));

    flag = 1

    $(".canvas-container").removeClass('hide')

    layerCount++

    var uniqid = service_id + user_id + new Date().getTime()

    var fullDate = new Date()

    // var twoDigitMonth = ((fullDate.getMonth().length+1) === 1)? (fullDate.getMonth()+1) : '0' + (fullDate.getMonth()+1);

    // var currentDate = + fullDate.getFullYear() + "/" + twoDigitMonth + "/" + fullDate.getDate()

    var dd = fullDate.getDate();
var mm = fullDate.getMonth()+1; //January is 0!
var yyyy = fullDate.getFullYear();

if(dd<10) {
    dd = '0'+dd
} 

if(mm<10) {
    mm = '0'+mm
} 

var currentDate = yyyy + '/' + mm + '/' + dd;




var time = fullDate.getHours() + ":" + fullDate.getMinutes();

$(".layerSelected").removeClass('layerSelected')

if(usertype != '3'){
    $(".upbutton").removeClass('hide')
}


$(".upbutton").addClass("hide")

$(".layerSubDiv").addClass('hide')


$('#toolbutton').addClass('deactive')
$('#imageEye').addClass('deactive')

$(".editButton").addClass('hide')

$('#layeraction-' + activeLayer).find(".editButton").removeClass('editActivate')
$('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
$('#layeraction-' + activeLayer).find(".cancelEdit").addClass('hide')
$(".editButton").removeClass('hide')
editON = 0
$('.deleteVideo').addClass('hide')
$("#toolbutton").addClass('hide');
$("#paste").addClass('hide')
$(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
$(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
$(".categories").addClass('hide')
$(".pswp__button--delete").addClass('hide')
selection = 0
flag = 0


var data = '<div id="layerTR-'+ uniqid +'"><div style="border: 1px solid #f4f4f4"><div id="layerDiv-'+ uniqid +'" class="layerDiv layerSelected" data-section="'+ uniqid +'" style="display: flex;justify-content: space-between; align-items: center; width: 100%; padding: 0 10px; box-sizing: border-box;"><input type="text" disabled class="mod temp 1 layernameP textareaEditStyle" style="flex-basis: 100%; font-weight: bold;display: flex; font-size: 13px;align-items:center;justify-content: space-between" value='+ currentDate + ' '+ time + '  id="layerName-'+ uniqid +'" ><p style="flex-basis: 10%;width: 32px;height: 32px;border: 1px solid #1abdfe;box-sizing:border-box;margin-top:3px;font-size:10px;text-align:center;line-height:32px;font-weight: bold;color:#1abdfe;border-radius: 5px" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="upbutton tapHere" onclick="if(event.stopPropagation){}event.cancelBubble=true;goUp(&quot;'+ uniqid +'&quot;)">UP</p></div><div class="layerSubDiv" data-subsection="'+ uniqid +'" style="padding: 4px 10px 10px"><div style="display: flex;align-items: center;padding: 0 0 10px 5px;"><input id="allowNotification'+ uniqid +'" type="checkbox" class="no-mar"><label style="font-size:12px;" class="no-margin no-padding" for="allowNotification'+ uniqid +'">배지로 업데이트 알림</label></div><div class="layeraction" id="layeraction-'+ uniqid +'" style="display: flex;justify-content: space-between;padding: 0 10px"><p><img title="이 레이어 타이틀을 변경합니다" alt="이 레이어 타이틀을 변경합니다" class="editText tapHere" src="icons/editText.svg" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p><img title="이 레이어를 삭제합니다" alt="이 레이어를 삭제합니다" class="layerDelete tapHere" data-delete="'+ uniqid +'" src="icons/delete_black.svg" style="width: 32px;height: 32px;border: 1px solid #1abdfe;object-fit:contain;padding:5px;box-sizing:border-box;"></p><p><img title="이 레이어의 변경사항을 저장합니다" alt="이 레이어의 변경사항을 저장합니다" src="icons/save.svg" class="saveLayer tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p><img title="이 레이어의 링크를 복사하여 다른이와 공유합니다" alt="이 레이어의 링크를 복사하여 다른이와 공유합니다" src="icons/link.svg" class="createURL tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p><img title="이 레이어를 복사해 클립보드에 저장합니다. 다른 레이어에 붙여 넣을수 있습니다" alt="이 레이어를 복사해 클립보드에 저장합니다. 다른 레이어에 붙여 넣을수 있습니다" src="icons/copy.svg" class="copyObject tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p class="cancelCopy hide tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;color:#1abdfe;text-align:center;line-height:29px;box-sizing:border-box;font-size:9px">cancel</p><p style="border:1px solid #1abdfe;width: 32px;height: 32px;box-sizing:border-box;font-size:10px;text-align:center;padding:4px;font-weight: bold;color:#1abdfe;" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="editButton tapHere"><img src="icons/edit.png"></p><p style="width: 32px;height: 32px;box-sizing:border-box;font-size:10px;text-align:center;line-height:32px;font-weight: bold;color:white;border:1px solid #1abdfe" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="cancelEdit hide"><img style="width:16px" src="icons/cancel.png"></p></div><div class="hide textareaonedit-'+ uniqid +'"><textarea class="textareaEditStyle textareascroll textareaeditCLick" onkeyup="auto_grow(this)" style="margin-top: 15px;width: 100%;height: 80px;max-height: 160px;min-height: 50px;overflow-y: auto;" disabled></textarea></div><div style="display: flex; background-color: #f4f4f4; border-radius: 5px; align-items: center;margin-top:10px"><ul class="data-ul"> <li class="navToggleDrawing" id="navToggleDrawing-'+ uniqid +'" class="no-select" style="position: relative;z-index: 3; display: flex;align-items: center;background-color: #F1F2F3;height: 72px;border: 1px solid rgba(149,12,154,0.12);"> <div style="flex-basis: 20%; text-align:center;align-items: center;display: flex;justify-content: center;"> <img src="storage/'+ service_id +'/Private/'+ user_id +'/.info/_profile'+ user_id +'?v='+ new Date().getTime() +'" onerror=this.src="images/noPic.png" style="width: 46px;height:46px;border-radius:10px"> </div> <div style="flex-basis: 65%;display: flex;justify-content: flex-start;flex-direction: column;"> <p style="font-size: 12px;font-weight: bold;color: #727171;">'+ first_name + ' ' + last_name + '</p> <p style="font-size: 12px;color: #727171;">'+ email +'</p> <p style="font-size: 12px;color: #727171;">'+ job_position +' ' + company_name +'</p> </div> <div style="flex-basis: 15%;display: flex;justify-content: center;"> <img src="icons/navbar_icon_back.svg" class="navbar-toggler collapsed" style="height: 20px;width: 14px;"> </div> </li> <li style="position: relative;z-index: 2;top: 0; background-color: #f1f2f3;border: 1px solid rgba(149,12,154,0.12);height: 170px" id="mainNav" class="mainNav navbar collapsed hide"> <table> <tbody style="line-height: 35px"><tr><td style="font-size: 10px;color: #727171; line-height: 40px">Phone</td><td><div class="btn-blank"><a href="tel:'+ phone_1 +'" style="color:#00b6fe;font-size: 15px;margin-bottom: 0;padding: 0;background-color: transparent;">'+ phone_1 +'</a></div></td></tr><tr><td></td><td style="line-height: 40px"><div class="btn-blank"><a href="tel:'+ phone_2 +'" style="color:#00b6fe;font-size: 15px;margin-bottom: 0;padding: 0;background-color: transparent;">'+ phone_2 +'</a></div></td></tr><tr><td style="font-size: 10px;color: #727171; line-height: 40px">Email/SNS</td><td><div class="btn-blank"><a href="mailto:'+ email +'" style="font-size: 15px; color: #00b6fe; margin-bottom: 0;padding: 0;background-color: transparent;" target="_top">'+ email +'</a></div></td></tr></tbody> </table> <div style="display: flex;justify-content: space-around;padding: 0; align-items: center;position: relative;"> <div> <div class="btn-blank"><a href="skype:dhirusarania?chat"> <img src="assets/images/navicon/skype.svg" style="height: 36px;width: 36px;"></a></div> </div> <div> <div class="btn-blank"><a href="https://line.me/R/Sin5406"> <img src="icons/Image 118.svg" style="height: 36px;width: 36px;"></a> </div> </div> <div> <div class="btn-blank"><a href="https://twitter.com"> <img src="icons/twitter.svg" style="height: 36px;width: 36px;"></a></div> </div> <div> <div class="btn-blank"> <a href="javascript:sendLink()"><img src="icons/Image 117.svg" style="height: 36px;width: 36px;"> </a></div> </div> </div> </li></ul></div></div></div></div>'


layernamep = 0

var d1 = $('#layerTable');

d1.append(data);

layerOrderArray.push(uniqid)


var obj = {
    'id' : layerCount, 
    'user_id': user_id,
    "currentDate" : currentDate,
    "time" : time,
    "totalLayerCount": uniqid,
    "creator": creator,
    "layerName": currentDate + " " + time,
    'project_id': project_id,
    'service_id': service_id,
    'isPassword' : 0,
    'UserProfileImage' : UserProfileImage,
    'first_name' : first_name,
    'last_name' : last_name,
    'job_position' : job_position,
    'phone_1' : phone_1,
    'phone_2' : phone_2,
    'company_name' : company_name,
    'email' : email,
    'completed' : 0
}

$('#layerCreated-modal').removeClass("close")

setTimeout(function(){ $('#layerCreated-modal').addClass("close");}, 3000);


layerUserID.push(obj);

console.log(layerUserID)

imageCountArray[uniqid] = 0


if(usertype == 3){
  $("#permission ").removeClass('hide')

  $("#layerBody").css('padding-bottom', '0')
}else{

  $("#permission ").addClass('hide')
  $("#layerBody").css('padding-bottom', '10px')

}


var eyeContainer = '<div id="inline-btn-container-' + uniqid + '" class="inline-btn-container"></div>';
var d1 = $('#menuContainer');
d1.append(eyeContainer);


if(localOpen == 1){
  $(".layeraction").remove()
  $("#navToggleDrawing-" + uniqid).remove()
}



$("#startP").addClass('hide')
$("#layersection").removeClass('hide')

if($("#submitText").length != 0){
  $("#layerName-" + prevActive).html(inputTempBuffer)
  $('.temp').remove()
}

$("#layername").val(currentDate + " " + time)

activeLayer = uniqid

$(".inline-btn").addClass('hide')


for(i = 1; i <= canvas.getObjects().length; i++){


  object = canvas.item(i-1)

  Lid = object.get("layerId")


        // object.set("opacity", 0)
        object.visible=false
        canvas.renderAll()


    }


    $(".editButton").addClass("hide")

    $('#layeraction-' + activeLayer).find(".editButton").removeClass("hide")

    $(".upbutton").addClass("hide")

    console.log('hiddddddddddddddddddddddddd')

    $("#imageEye").addClass('deactive')

    layerIsCreatedModal = 1

    $("#layeraction-" + activeLayer + " .saveLayer").click()


});



$(document).on('click', '#name, .layerSubDiv', function(event) {

    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }


});

$(document).on('click', '.navToggleDrawing', function(event) {


    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }


    $(this).siblings('.mainNav').toggleClass('hide'); 
    $(this).find('.navbar-toggler').toggleClass('collapsed')
});



$(".toolbox-button").click(function(){



    $("#toolhide").removeClass('hide')
    $(".toolhide").removeClass('hide')

})


$('#toolbutton').click(function(event) {


    if($('#toolbutton').hasClass('deactive')){
        $("#alertTool-modal").removeClass('close')
    }
    $(".inline-btn").addClass('hide')
});


$('#imageEye').click(function(event) {

    if(selection == 4  && polygonCreated == 0){

        escaped = 1

        prototypefabric.polygon.generatePolygon(pointArray);


        selection = 0;
        $(".selectedTool").removeClass('selectedTool')
        $("#selection").click()

    }


    canvas.discardActiveObject()
    canvas.renderAll()

    escaped = 0

    // if(($('#imageEye').hasClass('deactive') && activeLayer == 0) || savedCounter.includes(activeLayer) || editON == 0){
 //        // $("#alertEye-modal").removeClass('close')
 //    }else if(!savedCounter.includes(activeLayer)){
 //     $("#layerSavedNeededForImageSlider-modal").removeClass('close')
 //    } 
});



var e = $("#div_2");
// move up:
e.prev().insertAfter(e);
// move down:
e.next().insertBefore(e);


function poll(){  


    var person = {
        layer_id :  activeLayer,
        hash: getFile.hash,
        url: getFile.url
    }

    console.log(person)
    console.log(person)

    poll_xhr = $.ajax({ 
        url: 'file:///android_assets/views/phppages/allProjectController.php?longPoll=longPoll',
        type: 'post',
        data: person,

        success: function(data){
            console.log(data)

            console.log(data.exist)
            console.log(permissionStatus)


            if(data.exist == "yes" && permissionStatus == 0){


                console.log('reload')

                // window.location = 'https://www.easypermit.net/#/drawing?filelocation=https://www.easypermit.net' + filelocationURL;

                // window.location.reload()

            }


            if(editON == 1 && data.array == 1){

                setTimeout(poll, 20000);

            }
        }, 
        dataType: "json",
        timeout: 30000 
    });
}


$("#filesection").click(function(){
    console.log("mouseovber")
    $("#filename__action-section").toggleClass('hide');
    $("#layername__action-section").addClass('hide');
});

$("#filenameAddTo").click(function(){

    jQuery.ajax({
        contentType: false,
        cache: false,
        processData: false,
        url: 'file:///android_assets/views/phppages/allProjectController.php?addFromDrw=addFromDrw&filename=' + $("#filename").val(),
        success: function (result) {

            console.log(result)


            $("#copiedAlertFilename-modal").removeClass('close')

            $('#filenameAddTo').addClass('hide')


            setTimeout(function(){ $('#copiedAlertFilename-modal').addClass("close");}, 3000);
        }
    })




});

$("#filenameCopy").click(function(){

    copyTextFunction("filename")

});

$("#layersection").click(function(){
    $("#layername__action-section").toggleClass('hide');
    $("#filename__action-section").addClass('hide');
});

$("#layernameCopy").click(function(){
    copyTextFunction("layername")
});


$("#layernameAddTo").click(function(){


    var type

    var url = user_id + service_id  + new Date().getTime()

    console.log(url)


    if(sharedLink == 1){
      getFile.name = nameofFile
      getFile.url = filename

  }

  if(getFile.mime == 'application/pdf' || getFile.mime == "pdf"){
      type = 1
  }
  else{
      type = 2
  }


  $.get("file:///android_assets/views/phppages/allProjectController.php?createURL=createURL&url=" + url + "&nameofFile=" + getFile.name + "&layer=" + activeLayer+ "&filelocation=" + getFile.url+ "&type=" + type, function(data, status){

      console.log(data)

      data = JSON.parse(data)

        // $(".saveLayer").click()
        
        // alert(data['url'])

        console.log(data['url'])
        console.log(encodeURIComponent(data['url']))



        jQuery.ajax({
          contentType: false,
          cache: false,
          processData: false,
          url: 'file:///android_assets/views/phppages/allProjectController.php?addFromDrwLayer=addFromDrwLayer&filename=' + encodeURIComponent(data['url']) + '&layername=' + $("#layerName-" + activeLayer).val(),
          success: function (result) {

             console.log(result)



             $("#copiedAlertLayername-modal").removeClass('close')

             $('#layernameAddTo').addClass('hide')


             setTimeout(function(){ $('#copiedAlertLayername-modal').addClass("close");}, 3000);


         }
     })


    })





});


function copyTextFunction(id) {
    /* Get the text field */
    var copyText = document.getElementById(id);

    /* Select the text field */
    copyText.select();

    /* Copy the text inside the text field */
    document.execCommand("copy");

    /* Alert the copied text */
    alert("Copied the text: " + copyText.value);

    window.getSelection().removeAllRanges();

}




$(document).on('click', '#tableWrapper', function(event) {

    $("#toolbox").addClass('hide')

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);


})



$(document).on('click', '#editLayer-action', function(event) {

    $("#editLayer-modal").addClass('close')


    setTimeout(function(){ $('#editStart-modal').addClass("close");}, 3000);


    if(localOpen == 0 && serverOpen == 1){  

     console.log(activeLayer)
     console.log(getFile.name)
        // console.log(getFile.hash)
        // console.log(getFile.ts)
        console.log(new Date().getTime())


        // $.get("file:///android_assets/views/phppages/allProjectController.php?checkLayerStatus=checkLayerStatus&layerId=" + activeLayer + "&filename=" + getFile.name + "&fileURL=" + getFile.url + "&hash=" + getFile.name + "&timestamp=" + new Date().getTime() , function(data, status){

            // console.log(data)

            // var obj = JSON.parse(data)
            // console.log(obj)
            // if(obj.status == 1){ 
                if(true){ 


                // poll()


                layernamep = 1

                var a = layerUserID.filter(function(a){
                    if(a.totalLayerCount == activeLayer){
                        if(a.user_id == user_id) {return 1}
                            else{ return 0;}
                    }
                })

                var isOwner = a.map(function(a,index) { 
                    if(a.totalLayerCount == activeLayer){
                        if(a.user_id == user_id) {return 1}
                            else{ return 0}
                        }
                })

                console.log(isOwner)


                if(!$(this).parents('.layerDiv').hasClass('locked') && isOwner[0] == 0 && creator == 0){
// http://13.124.239.52/#/layer?v=24151530249951610


        // canvas.skipTargetFind = false
        canvas.selection = true



        console.log("aaa1")

        $('#layeraction-' + activeLayer).find(".editButton").addClass('editActivate')
        $('#layeraction-' + activeLayer).find(".editButton").addClass('hide')
        $('#layeraction-' + activeLayer).find(".cancelEdit").removeClass('hide')
        $('.editButton').addClass('hide')
        $('.deleteVideo').removeClass('hide')

        editON = 1
        
        // if(usertype == "0" || usertype == "1"){

            $('.iframeImageUploader').removeClass('hide')
            
        // }


        $("#toolbutton").removeClass('hide');

        $("#toolbutton").attr('src', 'icons/icon1.png');


        if(copyOn == 1){
            $("#paste").removeClass('hide')

        }

        $("#editText-action").click()

        // $(".textareaonedit-" + activeLayer + " textarea").removeClass("textareaEditStyle")

        $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", false);

        $(".categories").removeClass('hide')
        $(".pswp__button--delete").removeClass('hide')



        $(".inline-btn").addClass('hide')



        $('#toolbutton').removeClass('deactive')
        $('#imageEye').removeClass('deactive')

        selection = 0


        flag = 1 

        var sectionId = activeLayer

        $(".editButton").attr('src', 'icons/ic_edit_24px_black.svg');

        

        $(".layerSubDiv").not(".layerSubDiv[data-subsection='" + sectionId + "']").addClass('hide')


        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);
        $("#layers").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);

        // $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')
        $(this).parents(".layerDiv").addClass('layerSelected')
        $(".upbutton").addClass('hide')

        objs = canvas.getObjects().map(function(o) {
            console.log(o)
            return o.set({
                hoverCursor: 'move',
                selectable : true,
                editable : true
            });
        });

        console.log("edititng1")


        activeLayer = sectionId

        $(".highlight").removeClass('highlight')
        $("#selection").addClass('highlight')
        $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')

    }
    else{

       console.log("edititng2")

       $('#layeraction-' + activeLayer).find(".editButton").addClass('editActivate')
       $('#layeraction-' + activeLayer).find(".editButton").addClass('hide')
       $('#layeraction-' + activeLayer).find(".cancelEdit").removeClass('hide')
       $('.editButton').addClass('hide')
       editON = 1
       $('.deleteVideo').removeClass('hide')
     // if(usertype == "0" || usertype == "1"){

        $('.iframeImageUploader').removeClass('hide')

    // }
    $("#toolbutton").removeClass('hide');
    $("#toolbutton").attr('src', 'icons/icon1.png');
    $("#editText-action").click()


    if(copyOn == 1){
      $("#paste").removeClass('hide')

  }
  flag = 1

        // $(".textareaonedit-" + activeLayer + " textarea").removeClass("textareaEditStyle")
        $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", false);


        $(".categories").removeClass('hide')
        $(".pswp__button--delete").removeClass('hide')
        $(".pswp__button--delete").removeClass('hide')
        $(".inline-btn").addClass('hide')



        $('#toolbutton').removeClass('deactive')
        $('#imageEye').removeClass('deactive')



        $("#layerDiv-" + activeLayer).siblings('.layerSubDiv').find('.passwordLock').attr({
            'src': 'assets/drawing2/icons/lock-closed.svg',
            'title': '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다',
            'alt' : '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다'
        });

        $("#layerDiv-" + activeLayer).removeClass('locked')

        $("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").removeClass('deactive')
        $("#layeraction-" + activeLayer).find(".editButton").removeClass('deactive')


        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);
        $("#layers").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);

        // $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')

        $(this).parents(".layerDiv").addClass('layerSelected')
        $(".upbutton").addClass('hide')
        objs = canvas.getObjects().map(function(o) {
            console.log(o)
            return o.set({
                hoverCursor: 'move',
                selectable : true,
                editable : true
            });
        });

        $("#edit-modal").addClass('close')

    }


    for(i = 1; i <= canvas.getObjects().length; i++){

                //item = canvas.getItem("imageObject")
                object = canvas.item(i-1)

                type = object.get("id")

                if( type == 'imageObject'){
                    object.lockMovementX = object.lockMovementY = false
                    object.lockScalingX = object.lockScalingX = false
                    object.lockRotation = false
                    object.hasBorders= true
                    object.hasControls= true
                    object.editable= true


                    object.set('selectable', true)

                }
            }   


            $('#editStart-modal').removeClass("close")


        }else if(obj.status == 0){
            console.log("Error")
            $('#imageEye').addClass('deactive')


            if(obj.mess == 1){
                $("#permissionPermissionEditing-modal").removeClass('close')
            }else{
                $('#editError-modal').removeClass("close")

            }


            $('.editButton').addClass('hide')
            $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
        }



    }else if(localOpen == 1 && serverOpen == 0){


        if(!$(this).parents('.layerDiv').hasClass('locked')){



        // canvas.skipTargetFind = false
        canvas.selection = true



        console.log("aaa1")

        $('#layeraction-' + activeLayer).find(".editButton").addClass('editActivate')
        $('#layeraction-' + activeLayer).find(".editButton").addClass('hide')
        $('#layeraction-' + activeLayer).find(".cancelEdit").removeClass('hide')
        $('.editButton').addClass('hide')

        editON = 1
        $('.deleteVideo').removeClass('hide')
        // if(usertype == "0" || usertype == "1"){

            $('.iframeImageUploader').removeClass('hide')
            
        // }
        $("#toolbutton").removeClass('hide');
        $("#toolbutton").attr('src', 'icons/icon1.png');
        $("#editText-action").click()


        if(copyOn == 1){
            $("#paste").removeClass('hide')

        }

        // $(".textareaonedit-" + activeLayer + " textarea").removeClass("textareaEditStyle")

        $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", false);

        $(".categories").removeClass('hide')
        $(".pswp__button--delete").removeClass('hide')



        $(".inline-btn").addClass('hide')



        $('#toolbutton').removeClass('deactive')
        $('#imageEye').removeClass('deactive')

        selection = 0


        flag = 1 

        var sectionId = activeLayer

        $(".editButton").attr('src', 'icons/ic_edit_24px_black.svg');

        $(".layerSubDiv").not(".layerSubDiv[data-subsection='" + sectionId + "']").addClass('hide')


        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);
        $("#layers").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);

        $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')
        $(this).parents(".layerDiv").addClass('layerSelected')
        $(".upbutton").addClass('hide')
        objs = canvas.getObjects().map(function(o) {
            console.log(o)
            return o.set({
                hoverCursor: 'move',
                selectable : true,
                editable : true
            });
        });

        console.log("edititng1")


        activeLayer = sectionId

        $(".highlight").removeClass('highlight')
        $("#selection").addClass('highlight')
        $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')

    }
    else{

        console.log("edititng2")

        $('#layeraction-' + activeLayer).find(".editButton").addClass('editActivate')
        $('#layeraction-' + activeLayer).find(".editButton").addClass('hide')
        $('#layeraction-' + activeLayer).find(".cancelEdit").removeClass('hide')
        $('.editButton').addClass('hide')
        editON = 1
        $('.deleteVideo').removeClass('hide')
        // if(usertype == "0" || usertype == "1"){

            $('.iframeImageUploader').removeClass('hide')
            
        // }
        $("#toolbutton").removeClass('hide');
        $("#toolbutton").attr('src', 'icons/icon1.png');
        $("#editText-action").click()
        flag = 1


        if(copyOn == 1){
            $("#paste").removeClass('hide')

        }

        // $(".textareaonedit-" + activeLayer + " textarea").removeClass("textareaEditStyle")
        $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", false);
        $(".categories").removeClass('hide')
        $(".pswp__button--delete").removeClass('hide')
        $(".pswp__button--delete").removeClass('hide')
        $(".inline-btn").addClass('hide')



        $('#toolbutton').removeClass('deactive')
        $('#imageEye').removeClass('deactive')



        $("#layerDiv-" + activeLayer).siblings('.layerSubDiv').find('.passwordLock').attr({
            'src': 'assets/drawing2/icons/lock-closed.svg',
            'title': '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다',
            'alt' : '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다'
        });

        $("#layerDiv-" + activeLayer).removeClass('locked')

        $("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").removeClass('deactive')
        $("#layeraction-" + activeLayer).find(".editButton").removeClass('deactive')


        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);
        $("#layers").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);


        $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')

        $(this).parents(".layerDiv").addClass('layerSelected')
        $(".upbutton").addClass('hide')

        objs = canvas.getObjects().map(function(o) {
            console.log(o)
            return o.set({
                hoverCursor: 'move',
                selectable : true,
                editable : true
            });
        });

        $("#edit-modal").addClass('close')

    }


    for(i = 1; i <= canvas.getObjects().length; i++){

                //item = canvas.getItem("imageObject")
                object = canvas.item(i-1)

                type = object.get("id")

                if( type == 'imageObject'){
                    object.lockMovementX = object.lockMovementY = false
                    object.lockScalingX = object.lockScalingX = false
                    object.lockRotation = false
                    object.hasBorders= true
                    object.hasControls= true
                    object.editable= true


                    object.set('selectable', true)

                }
            }   





        } 

// ll



})





$(document).on('click', '#clearCanvasSave-action', function(event) {

    $("#saveDatatoFile").click()
    $("#clearCanvas-modal").addClass('close')
    $("#clearCanvas-action").click()


})
$(document).on('click', '#clearCanvas-action', function(event) {

    $("#clearCanvas-modal").addClass('close')

    console.log("innn")


    if(change == 0 && sharedLink == 0){

        console.log("change0 sl0")
        console.log(getFile.url)


        $.ajax({
            url: getFile.url,
            type:'HEAD',
            async: false,
            error: function()
            {
                console.log("exifailed")
                fileExist = 0
        //file not exists
    },
    success: function()
    {
        //file exists
        console.log("existsssd")
        fileExist = 1
    }
});

        localOpen = 0
        serverOpen = 1
        sharedLink = 0

        if(getFile.mime == "application/pdf") { 
            showPDF(decodeURIComponent(getFile.url), getFile.name, 0)
            $(".showbox").removeClass('show')

        }else if(getFile.mime == "image/png" || getFile.mime == "image/jpeg" ){
            imageLoad(getFile.url, getFile.name)
            $(".showbox").removeClass('show')
        }

    }else if(change == 0 && sharedLink == 1){

        console.log("change0 sl1")
        console.log(getFile.url)




        $.ajax({
            url: getFile.url,
            type:'HEAD',
            async: false,
            error: function()
            {
                console.log("exifailed")
                fileExist = 0
        //file not exists
    },
    success: function()
    {
        //file exists
        console.log("existsssd")
        fileExist = 1
    }
});



        nameofFile = localStorage.getItem("drwFileName")


        console.log("extes ion check")

        console.log(getFileExtension(localStorage.getItem('drwFileName')))

        filename = "file:////storage/emulated/0/Android/data/com.hanum.ezpermit.ezpermitoffile/files/" + localStorage.getItem("drwFileURL")


        localOpen = 0
        serverOpen = 1

        getFile.name = nameofFile
        getFile.url = filename
        getFile.path = filename

        type = getFileExtension(localStorage.getItem('drwFileName'))

        console.log(type)
        if(type == "pdf") { 
            console.log("innn2")
            showPDF(decodeURIComponent(filename), nameofFile, 0)
            $(".showbox").removeClass('show')

            change = 0
            sharedLink = 0



        }else if(type == "jpg" || type == "png") { 

            type = "image"

            nameofFile = localStorage.getItem('drwFileName')

            filename = "file:////storage/emulated/0/Android/data/com.hanum.ezpermit.ezpermitoffile/files/" + localStorage.getItem("drwFileURL")

            console.log(filename , nameofFile)



            imageLoad(filename, nameofFile)
            $(".showbox").removeClass('show')

            change = 0
            sharedLink = 0


        }

    }else if(change == 1 && sharedLink == 0){

        console.log("change01sl0")

        var e = eventPush

        change = 0


        localOpen = 1
        serverOpen = 0
        sharedLink = 0

        fileExist = 1


        canvas.setViewportTransform([ 1, 0 , 0, 1 , 0 ,0 ])

        $("#layerTable").empty()

        layerUserID = []

        activeLayer = 0

        imageObjectCount = 0

        totalLayerCount = 0

        canvas.clear()

        console.log("cleareverything")

        $("#menuContainer").empty()
        $("#layerTable").empty()
        $("#hideThis").removeClass('hide')
        allitems=[]



        $("#startP").hide()

        $(".showbox").removeClass('show')

        // $("#clearCanvas-modal").removeClass('close')

        $('.highlight').removeClass('highlight');
        $(this).addClass("highlight")

        var file = e.target.files[0];
        var reader = new FileReader();

        $("#filesection").removeClass('hide')


        canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));

        if( file.type == "application/pdf" ){


            $("#filesection").removeClass('hide')
            $("#filename").val(file.name)
            document.title = file.name;

            console.log(url)
            // $("#filename").text(file.name)

            showPDF(decodeURIComponent(URL.createObjectURL($("#image").get(0).files[0])), file.name, 1);

        }else{

            $(".canvas-container").removeClass('hide')
            // $("#filename").text(file.name)
            $("#filesection").removeClass('hide')
            $("#filename").val(file.name)

            document.title = file.name;
            reader.onload = function(f) {



                var data = f.target.result;
                var rotation, exifData = 0

                var MAX_HEIGHT
                var imageData





                var image = new Image();
                image.onload = function(){

                    var canvas1 = document.createElement('canvas');
                    canvas1.id = 'imageCanvas'
                    document.getElementById("body").appendChild(canvas1);



                    MAX_HEIGHT = (image.height * 70) / 100

                    image.width *= MAX_HEIGHT / image.height;
                    image.height = MAX_HEIGHT;


                    var ctx = canvas1.getContext("2d");
                    ctx.clearRect(0, 0, canvas1.width, canvas1.height);
                    canvas1.width = image.width;
                    canvas1.height = image.height;
                    ctx.drawImage(image, 0, 0, image.width, image.height);
                    imageData = canvas1.toDataURL("image/jpeg");


                    fabric.Image.fromURL(imageData, function(img) {

  // add background image
  
  canvas.setViewportTransform([1,0,0,1,0,0])
  
  clearEverything()
  
  canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
  
  canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {

    originX: 'left',
    originY: 'top'

});




  errorRotation = 0
  

  switch(_correction) {
    case 6:
    exifData = 1;
    errorRotation = 1
    break;
}

imageWidthData = img.width
imageHeightData = img.height



if(exifData == 1){


    canvas.backgroundImage.rotate(90)

    var abc = height / img.width


    zoomLevel = abc
    canvas.setWidth(img.height);
    canvas.setHeight(img.width);

    canvas.backgroundImage.top = 0
    canvas.backgroundImage.left = (canvas.width / 2) + (img.height / 2) 

    canvasPageZoom = abc
    canvas.setZoom(abc)
    canvas.backgroundImage.defaultZoomValue = abc



    if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2)-((canvas.width * abc) /2) , 0])


}
else{



    var ratio = img.width / img.height

    var abc = height / img.height


    zoomLevel = abc



    if(width > img.width){
        if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - (img.width *abc) /2 , 0])

    }
if(width == img.width){
    if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - (canvas.width *abc) /2 , 0])

        canvas.setWidth(img.width);
    canvas.setHeight(img.height);
}
if(img.width > width){
    if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2)-((img.width * abc) /2) , 0])

        canvas.setWidth(img.width);
    canvas.setHeight(img.height);
}

if(canvas.height < height){
    canvas.setHeight(height);
}




canvasPageZoom = abc
canvas.backgroundImage.defaultZoomValue = abc
canvas.setZoom(abc)

canvasViewport = canvas.viewportTransform


}


document.getElementById("body").style.backgroundColor = "#f4f4f4";
$("#toolbox").addClass('hide')

$("#toolbox").css('transform', 'translate(0px, 0px)');
$("#toolbox").attr('data-x', 0);
$("#toolbox").attr('data-y', 0);
toolboxDrag = 0
isPdfUpload = 0
backgroundImageLoaded = 1

$(window).trigger('resize')

$('#layersButton').removeClass('deactive')



$(".loader").hide().fadeOut('slow');

if(initialLayer == 1){
    initialLayer = 0;
    $("#layers").removeClass('hide')
    $(".layerSubDiv[data-subsection='" + sharedLayerId + "']").removeClass('hide')
}

});

                    canvas1.remove()
                };
                image.src = f.srcElement.result;




            };
            getOrientation(file, function(orientation) {
                _correction = orientation


    //alert("orientation: " + _correction)


})

            reader.readAsDataURL(file);

            $(".loader").show().fadeIn('slow');
        }
    }
    
})



// $("#clearCanvas-action").click()



$(document).on('click', '.editButton', function(event) {

    event.stopPropagation()

    var contains = $.inArray(activeLayer, savedCounter)

    if(contains != -1){



        $("#imageEye").removeClass('deactive')


    }



    if(!$("#layeraction-" + activeLayer).find(".editButton").hasClass('deactive')){

        if($("#submitText").length != 0){
            $("#layerName-" + prevActive).html(inputTempBuffer)
            $('.temp').remove()
        }

        var a = layerUserID.filter(function(a){
            if(a.totalLayerCount == activeLayer){
                if(a.user_id == user_id) {return 1}
                    else{ return 0;}
            }
        })

        var isOwner = a.map(function(a,index) { 
           if(a.totalLayerCount == activeLayer){
              if(a.user_id == user_id) {return 1}
                 else{ return 0}
             }
     })


        console.log(isOwner)


        if(($("#layerDiv-" + activeLayer).hasClass('locked')) && (isOwner[0] != 1)){
           console.log("editMoal")
           $("#modal").removeClass('close')

       }else{

           activeLayer = $(this).parent().parent(".layerSubDiv").attr("data-subsection")
           $(".editActivate").removeClass('editActivate')
           $(".cancelEdit").addClass('hide')
           $(".editButton").removeClass('hide')
           console.log("editNot")
           editON = 0
           $('.deleteVideo').addClass('hide')
           $("#toolbutton").addClass('hide');
           $("#paste").addClass('hide')
           $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
           $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
           $(".categories").addClass('hide')

           $(".pswp__button--delete").addClass('hide')
           $("#editLayer-action").click()




       }
   }

});


$(document).on('click', '.cancel-modal', function(event){
    change = 0
    $(this).parents(".modal-card").addClass('close')

    $("#inputVal").val("")

    deleteON = 0

})

$(document).on('click', '.saveLayer', function(event){
    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }


})

$(document).on('click', '.createURL', function(event){

    var type

    var url = user_id + service_id  + new Date().getTime()

    console.log(url)


    if(sharedLink == 1){
        getFile.name = nameofFile
        getFile.url = filename

    }

    if(getFile.mime == 'application/pdf' || getFile.mime == "pdf"){
        type = 1
    }
    else{
        type = 2
    }


    $.get("file:///android_assets/views/phppages/allProjectController.php?createURL=createURL&url=" + url + "&nameofFile=" + getFile.name + "&layer=" + activeLayer+ "&filelocation=" + getFile.url+ "&type=" + type, function(data, status){

        console.log(data)

        data = JSON.parse(data)

        // $(".saveLayer").click()
        
        // alert(data['url'])


        $(".copylink").val(data['url'])

        $("#copylink-modal").removeClass('close')


    })


})


$(document).on('click', '#copylink-action', function(event) {




  var copyTextarea = document.querySelector('.copylink');
  copyTextarea.focus();
  copyTextarea.select();

  try {
     var successful = document.execCommand('copy');
     var msg = successful ? 'successful' : 'unsuccessful';
     console.log('Copying text command was ' + msg);
 } catch (err) {
     console.log('Oops, unable to copy');
 }

 $("#copylink-modal").addClass('close')

})


$(document).on('click', '#copylink-action', function(event) {




  var copyTextarea = document.querySelector('.copylink');
  copyTextarea.focus();
  copyTextarea.select();

  try {
     var successful = document.execCommand('copy');
     var msg = successful ? 'successful' : 'unsuccessful';
     console.log('Copying text command was ' + msg);
 } catch (err) {
     console.log('Oops, unable to copy');
 }

 $("#copylink-modal").addClass('close')

})

$(document).on('click', '#edit-modal-action', function(event) {



    //$(".layerSelected").removeClass('layerSelected')

    $("#edit-modal").addClass('close')

    $("#layerDiv-" + activeLayer).siblings('.layerSubDiv').find('.passwordLock').attr({
        'src': 'assets/drawing2/icons/lock-closed.svg',
        'title': '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다',
        'alt' : '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다'
    });
    $("#layerDiv-" + activeLayer).removeClass('locked')


    $("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").removeClass('deactive')
    $("#layeraction-" + activeLayer).find(".editButton").removeClass('deactive')


    
})


$(document).on('click', '#modal-action', function(event) {





  var inputVal = $("#inputVal").val()


  console.log("inputVal")
  console.log(inputVal)

  $("#inputVal").val("")


  var a = layerUserID.filter(function(a){
     if(a.totalLayerCount == activeLayer){
        return a
    }
})




  var temp_password = a.map(function(a,index) { 
     if(a.totalLayerCount == activeLayer){

        return a.password


    }
})

  console.log(temp_password)

  if(temp_password == inputVal || usertype == 0 || usertype == 1){

     $(".error-message").addClass('hide')


     $("#layerDiv-" + activeLayer).siblings('.layerSubDiv').find('.passwordLock').attr({
        'src': 'assets/drawing2/icons/lock-closed.svg',
        'title': '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다',
        'alt' : '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다'
    });


     $("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").removeClass('deactive')
     $("#layeraction-" + activeLayer).find(".editButton").removeClass('deactive')


     var a = layerUserID.filter(function(a){
        if(a.totalLayerCount == activeLayer){
           if(a.user_id == user_id) {return 1}
              else{ return 0;}
      }
  })


     var isOwner = a.map(function(a,index) { 
         if(a.totalLayerCount == activeLayer){
            if(a.user_id == user_id) {return 1}
               else{ return 0}
           }
   })

     if(isOwner[0] == 0){
         $(".passwordLock").addClass('deactive')
     }

     $("#layerDiv-" + activeLayer).removeClass('locked')

     objs = canvas.getObjects().map(function(o) {

         o.editable = false

         return o.set('selectable', false);
     });

     $("#modal").addClass('close')



     $('#layerunlocked-modal').removeClass("close")

     setTimeout(function(){ $('#layerunlocked-modal').addClass("close");}, 3000);


 }
 else{
   $(".error-message").removeClass('hide')
}

$("#inputVal").val("")

})

$(document).on('click', '#creator-modal-action', function(event) {






    var password = $("#passwordInput").val()
    console.log(password)

    $("#passwordInput").val("")

    layerUserID.map(function(a,index) { 
        if(a.totalLayerCount == activeLayer){

            // layerUserID.['"' + index + '"'].password = password
            // layerUserID.['"' + index + '"'].isPassword = 1

            a.password = password
            a.isPassword = 1

        }
    })

    auto_save = 1
    console.log("autosave")
    $("#layeraction-" + activeLayer + " .saveLayer").click()

    $('#toolbutton').removeClass('deactive')
    $('#imageEye').removeClass('deactive')

    $('#layeraction-' + activeLayer).find(".editButton").removeClass('editActivate')
    $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
    $('#layeraction-' + activeLayer).find(".cancelEdit").addClass('hide')
    editON = 0
    $('.deleteVideo').addClass('hide')
    $("#toolbutton").addClass('hide');
    $("#paste").addClass('hide')
    $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
    $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
    $(".categories").addClass('hide')
    $(".pswp__button--delete").addClass('hide')
    selection = 0
    flag = 0


    $("#layerDiv-" + activeLayer).siblings('.layerSubDiv').find('.passwordLock').attr({
        'src': 'assets/drawing2/icons/lock.svg',
        'title': '레이어 잠김. 클릭하여 다른이의 편집을 허용할 수 있습니다 ',
        'alt' : '레이어 잠김. 클릭하여 다른이의 편집을 허용할 수 있습니다 '
    });

    $("#layerDiv-" + activeLayer).addClass('locked')

    $("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").addClass('deactive')
    $("#layeraction-" + activeLayer).find(".editButton").addClass('deactive')

    $("#toolbutton").addClass('deactive')
    $("#imageEye").addClass('deactive')

    $("#layerDiv-" + activeLayer).addClass('locked')

    objs = canvas.getObjects().map(function(o) {

        o.editable = false

        return o.set('selectable', false);
    });


    $("#creator-modal").addClass('close')






    $('#layerlocked-modal').removeClass("close")

    setTimeout(function(){ $('#layerlocked-modal').addClass("close");}, 3000);



})


$(document).on('click', '.passwordLock', function(event) {



  var a = layerUserID.filter(function(a){
     if(a.totalLayerCount == activeLayer){
        if(a.user_id == user_id) {return 1}
           else{ return 0;}
   }
})


  var isOwner = a.map(function(a,index) { 
     if(a.totalLayerCount == activeLayer){
        if(a.user_id == user_id) {return 1}
           else{ return 0}
       }
})

  console.log(isOwner)

  if(usertype == 0 || usertype == 1 || usertype == 2){

     $('#layeraction-' + activeLayer).find(".editButton").removeClass('editActivate')
     $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
     $('#layeraction-' + activeLayer).find(".cancelEdit").addClass('hide')
     editON = 0
     $('.deleteVideo').addClass('hide')
     $("#toolbutton").addClass('hide');
     $("#paste").addClass('hide')
     $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
     $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
     $(".categories").addClass('hide')
     $(".pswp__button--delete").addClass('hide')

     if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }







    if($(this).parents(".layerSubDiv").siblings(".layerDiv").hasClass('locked')){

        console.log("checki1")

        $('#passwordLockOpen-modal').removeClass("close")

        setTimeout(function(){ $('#passwordLockOpen-modal').addClass("close");}, 3000);

        if(usertype == 0 || usertype == 1 || isOwner[0] == 1){

           if($("#layerDiv-" + activeLayer).hasClass('locked')){

              $("#layerDiv-" + activeLayer).siblings('.layerSubDiv').find('.passwordLock').attr({
                 'src': 'assets/drawing2/icons/lock-closed.svg',
                 'title': '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다',
                 'alt' : '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다'
             });

              $("#layerDiv-" + activeLayer).removeClass('locked')
              $("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").removeClass('deactive')
              $("#layeraction-" + activeLayer).find(".editButton").removeClass('deactive')
          }else{

              $("#creator-modal").removeClass('close')
          }

      }else{

       console.log("chicke1 mddal")
       $("#modal").removeClass('close')

   }


}
else{
    console.log("checki2")



    if(usertype == 0 || usertype == 1 || isOwner[0] == 1){

        // $("#creator-modal").removeClass('close')

        if($("#layerDiv-" + activeLayer).hasClass('locked')){

            $("#layerDiv-" + activeLayer).siblings('.layerSubDiv').find('.passwordLock').attr({
                'src': 'assets/drawing2/icons/lock-closed.svg',
                'title': '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다',
                'alt' : '레이어 잠금 해제. 클릭하여 다른이의 편집을 제한할 수 있습니다'
            });

            $("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").removeClass('deactive')
            $("#layeraction-" + activeLayer).find(".editButton").removeClass('deactive')

            $("#layerDiv-" + activeLayer).removeClass('locked')
        }else{
            console.log("chicke2 mddal")
            $("#creator-modal").removeClass('close')
        }


    }else{

        $('#gmlock-modal').removeClass("close")

        setTimeout(function(){ $('#gmlock-modal').addClass("close");}, 3000);
    }

}


}
else{

    $('#gmlock-modal').removeClass("close")

    setTimeout(function(){ $('#gmlock-modal').addClass("close");}, 3000);
}


});


$(document).on('click', '.layernameP', function(event) {

  var data_attr = $(this).parent().attr('data-section')

  console.log('aaa')

  if(editON == 1 && data_attr == activeLayer){

     textareaeditCLick = 0

     $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")



     event.preventDefault()
     event.stopPropagation()


     var layerID = activeLayer

     layernamep = 1

     var val = $("#layerName-" + layerID).html()

     inputTempBuffer = val
     prevActive = layerID

     $("#layerName-" + layerID).removeClass("textareaEditStyle")

     $("#layerName-" + activeLayer).prop("disabled", false);

 }





})


$(document).on('click', '.textareaeditCLick', function(event) {

  if(editON == 1){

     if(layernamep == 1){


        $("#layerName-" + activeLayer).addClass("textareaEditStyle")

        $("#layerName-" + activeLayer).prop("disabled", true);


        layernamep = 0
    }

    textareaeditCLick = 1

    $(".textareaonedit-" + activeLayer + " textarea").removeClass("textareaEditStyle")

}

})


// $(document).on('click', '.layernameP', function(event) {

//         event.preventDefault()
//         event.stopPropagation()

//         var layerID = activeLayer

//             var val = $("#layerName-" + layerID).html()

//             inputTempBuffer = val
//             prevActive = layerID

//             $("#layerName-" + layerID).html("<input type='text' class='mod temp 1' value='"+ val +"'>")


// })


$(document).on('click', '#editText-action', function(event) {


    editTextClicked = 1

    if($("#submitText").length == 0){

        var layerID = activeLayer

        if($("#layerDiv-" + layerID).hasClass('locked')){

            $("#modal").removeClass('close')

        }
        else{



            inputWait = 1
        }
    }

    $("#editText-modal").addClass('close')

})


$(document).on('click', '.editText', function(event) {


    $(".textareaonedit-" + activeLayer).toggleClass('hide')


    // 
    // 



    // if( $('#layerDiv-' + activeLayer).hasClass('locked') ){

    //     $("#modal").removeClass('close')


    // }else{

    //     if($('#editText-modal').find(".checkedBox").prop('checked')){
    //         $("#editText-action").click()
    //     }else{

    //         $("#editText-modal").removeClass('close')
    //     }

    // }





});

$(document).on('click', '#submitText', function(event) {

    // 

    var layerID = $(this).parents(".layerDiv").attr('data-section');

    console.log(layerID)


    var inputVal = $(this).siblings('input').val()

    $("#layerName-" + layerID).append(inputVal)

    console.log("inputVal")
    console.log(inputVal)

    layerUserID.map(function(a) { 
        if(a.totalLayerCount == layerID){

            a.layerName = inputVal

        }
    })

    console.log(layerUserID)

    $('.temp').remove()

    $("#layername").val( $("#layerName-"+ sectionId).val())


    inputWait = 0





});


$(document).on('click', '.cancelEdit', function(event) {

   console.log("CancelEdit clicked")    

   $('#editEnd-modal').removeClass("close")

   layernamep = 0
   textareaeditCLick = 0


   setTimeout(function(){ $('#editEnd-modal').addClass("close");}, 3000);

   if(localOpen == 0 && serverOpen == 1){

     $.get("file:///android_assets/views/phppages/allProjectController.php?deleteActiveLayer=deleteActiveLayer&layerId=" + activeLayer + "&filename=" + getFile.name + "&fileURL=" + getFile.url + "&hash=" + getFile.hash + "&timestamp=" + getFile.ts , function(data, status){

        console.log(data)
        endEditMode()

    })

 }


 $("#layerName-" + activeLayer).addClass("textareaEditStyle")

 $("#layerName-" + activeLayer).prop("disabled", true);

})


function cancelEditNoModal() {



   if(localOpen == 0 && serverOpen == 1){

      $.get("file:///android_assets/views/phppages/allProjectController.php?deleteActiveLayer=deleteActiveLayer&layerId=" + activeLayer + "&filename=" + getFile.name + "&fileURL=" + getFile.url + "&hash=" + getFile.hash + "&timestamp=" + getFile.ts , function(data, status){

         console.log(data)
         endEditMode()

     })

  }


}







function endEditMode(){

   console.log("ending edit")
   flag = 0                
   $('#toolbutton').addClass('deactive')
    $('#imageEye').addClass('deactive')                                 // flag for toolbar allow status
    $(".editActivate").removeClass('editActivate')              //editActivate color class
    $(".cancelEdit").addClass('hide')

    
    console.log('layerrrrrrrrrrrrrrrrrrrrrrrrrr')

    $(".upbutton").addClass('hide')

    canvas.discardActiveObject()

    $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
    editON = 0
    $('.deleteVideo').addClass('hide')
    $("#toolbutton").addClass('hide');

    $('.iframeImageUploader').addClass('hide')

    $("#paste").addClass('hide')
    $("#submitText").click()
    $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
    $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
    $(".categories").addClass('hide')   
    $(".pswp__button--delete").addClass('hide')                                             //edit Mode Flag

    objs = canvas.getObjects().map(function(o) {

        return o.set({
            selectable: false,
            editable : false,
            hoverCursor: 'auto'
        });

    });



    for(i = 1; i <= canvas.getObjects().length; i++){

                //item = canvas.getItem("imageObject")
                object = canvas.item(i-1)

                type = object.get("id")

                if( type == 'imageObject'){
                    object.lockMovementX = object.lockMovementY = true
                    object.lockScalingX = object.lockScalingX = true
                    object.lockRotation = true
                    object.hasControls= false
                    object.set({
                        hoverCursor: 'pointer'
                    });
                    object.set('selectable', true)

                }
            }   



        }




        $(document).on('click', '.no-select', function(event) {



            $("#layername__action-section").addClass('hide');
            $("#filename__action-section").addClass('hide');

        })


        $(document).on('click', '.layerDiv', function(event) {


            var data_attr = $(this).attr('data-section')

            console.log('aaa')
            console.log(data_attr)

            if(editON == 1 && data_attr == activeLayer){



                textareaeditCLick = 0

                $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")



                event.preventDefault()
                event.stopPropagation()


                var layerID = activeLayer

                layernamep = 1

                var val = $("#layerName-" + layerID).html()

                inputTempBuffer = val
                prevActive = layerID

                $("#layerName-" + layerID).removeClass("textareaEditStyle")

                $("#layerName-" + activeLayer).prop("disabled", false);



            }else{



                if(layernamep == 1){

                    console.log('kkkkszzkz')

                    $('#saveRequiredNocreate-modal').removeClass('close')

                }else{







                    if(editON == 1){
                        console.log("CancelEdit clicked")    

                        $('#editEnd-modal').removeClass("close")


                        setTimeout(function(){ $('#editEnd-modal').addClass("close");}, 3000);

                        if(localOpen == 0 && serverOpen == 1){

                           $.get("file:///android_assets/views/phppages/allProjectController.php?deleteActiveLayer=deleteActiveLayer&layerId=" + activeLayer + "&filename=" + getFile.name + "&fileURL=" + getFile.url + "&hash=" + getFile.hash + "&timestamp=" + getFile.ts , function(data, status){

                              console.log(data)
                              endEditMode()

                          })

                       }


                       $("#layerName-" + activeLayer).addClass("textareaEditStyle")

                       $("#layerName-" + activeLayer).prop("disabled", true);


                       $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", false);

                   }

                   $("#permissionArea").addClass('hide')

                   $(".mainNav").addClass('hide')

                   editON = 0
                   $('.deleteVideo').addClass('hide')
                   $("#toolbutton").addClass('hide');
                   $("#paste").addClass('hide')
                   $("#submitText").click()
                   $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
                   $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
                   $(".categories").addClass('hide')
                   $(".pswp__button--delete").addClass('hide')


                   $(".layerSelected").removeClass('layerSelected')

                   if(usertype != '3'){

                       $(".upbutton").removeClass('hide')
                   }

                   $(".editButton").addClass('hide')

                   canvas.discardActiveObject()
                   canvas.renderAll()

                   flag = 0

                   $(".inline-btn").addClass('hide')


                   canvas.skipTargetFind = false
                   canvas.selection = false




                   var sectionId = $(this).attr('data-section');

                   console.log(sectionId)

                   if($("#submitText").length != 0){
                       $("#layerName-" + prevActive).html(inputTempBuffer)
                       $('.temp').remove()
                   }

                   $(".editActivate").removeClass('editActivate')
                   $(".cancelEdit").addClass('hide')
                   editON = 0
                   $('.deleteVideo').addClass('hide')
                   $("#toolbutton").addClass('hide');
                   $("#paste").addClass('hide')

                   $("#layerName-" + activeLayer).addClass("textareaEditStyle")

                   $("#layerName-" + activeLayer).prop("disabled", true);


                   $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
                   $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
                   $(".categories").addClass('hide')
                   $(".pswp__button--delete").addClass('hide')



                   $('#toolbutton').addClass('deactive')
                   $('#imageEye').addClass('deactive')

                   $("#layersection").removeClass('hide')
                   $("#layername").val( $("#layerName-"+ sectionId).val())


                   $(".layerSubDiv").not(".layerSubDiv[data-subsection='" + sectionId + "']").addClass("hide")






                   for(i = 1; i <= canvas.getObjects().length; i++){


                       object = canvas.item(i-1)

                       Lid = object.get("layerId")


                       if(Lid == sectionId){


                          object.visible=true
                          canvas.renderAll()

                      }else{

                          object.visible=false
                          canvas.renderAll()

                      }
                  }

                  if( $(".layerSubDiv[data-subsection='" + sectionId + "']").hasClass('hide')){
                   $(".layerSubDiv[data-subsection='" + sectionId + "']").removeClass('hide')
                   activeLayer = sectionId


                   if(!$("#newLayerNotice-" + activeLayer).hasClass('hide')){


                       $.get('assets/views/phppages/allProjectController.php?removeLayerNoti=removeLayerNoti&taskid=' + taskid + '&layerid=' + activeLayer, function(data, status){


                        console.log(data)


                    })

                   }


                   $("#newLayerNotice-" + activeLayer).addClass('hide')


                   $(this).find(".editButton").addClass('hide')
               }
               else if(!$(".layerSubDiv[data-subsection='" + sectionId + "']").hasClass('hide')){
                   $(".layerSubDiv[data-subsection='" + sectionId + "']").addClass('hide')

                   $(".editButton").addClass('hide')

                   activeLayer = 0
               }

               if($(".layerSubDiv[data-subsection='" + sectionId + "']").is(":visible")){
                   $(this).addClass('layerSelected')
                   $(".upbutton").addClass('hide')
                   $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')

                   if(backgroundImageLoaded == 0 && isPdfUpload == 0) {document.getElementById("body").style.backgroundColor = "#fff"; $(".canvas-container").removeClass('hide')}


               }
               else{


                   $("#layersection").addClass('hide')
                   $("#layername").val("")




                   $('#layeraction-' + activeLayer).find(".editButton").removeClass('editActivate')
                   $('#layeraction-' + activeLayer).find(".editButton").toggle('hide')
                   $('#layeraction-' + activeLayer).find(".cancelEdit").addClass('hide')
                   editON = 0
                   $('.deleteVideo').addClass('hide')
                   $("#toolbutton").addClass('hide');
                   $("#paste").addClass('hide')

                   $("#layerName-" + activeLayer).addClass("textareaEditStyle")

                   $("#layerName-" + activeLayer).prop("disabled", true);
                   $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
                   $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
                   $(".categories").addClass('hide')
                   $(".pswp__button--delete").addClass('hide')
                   selection = 0
                   flag = 0

                   if(backgroundImageLoaded == 0 && isPdfUpload == 0) {document.getElementById("body").style.backgroundColor = "#f4f4f4"; $(".canvas-container").addClass('hide')}



                   for(i = 1; i <= canvas.getObjects().length; i++){


                      object = canvas.item(i-1)

                      Lid = object.get("layerId")


    // object.set("opacity", 0)
    object.visible=false
    canvas.renderAll()


}




}

if($("#layerDiv-" + activeLayer).hasClass('locked')){



    $('#toolbutton').addClass('deactive')

    $('#layeraction-' + activeLayer).find(".editButton").removeClass('editActivate')
    $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
    $('#layeraction-' + activeLayer).find(".cancelEdit").addClass('hide')
    editON = 0
    $('.deleteVideo').addClass('hide')
    $("#toolbutton").addClass('hide');
    $("#paste").addClass('hide')

    $("#layerName-" + activeLayer).addClass("textareaEditStyle")

    $("#layerName-" + activeLayer).prop("disabled", true);
    $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
    $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
    $(".categories").addClass('hide')
    $(".pswp__button--delete").addClass('hide')
    selection = 0
    flag = 0
}


objs = canvas.getObjects().map(function(o) {

    return o.set({
        selectable: false,
        editable: false,
        hoverCursor: 'auto'
    });

});



for(i = 1; i <= canvas.getObjects().length; i++){

    object = canvas.item(i-1)

    type = object.get("id")

    if( type == 'imageObject'){
        object.lockMovementX = object.lockMovementY = true
        object.lockScalingX = object.lockScalingX = true
        object.lockRotation = true
        object.hasControls= false
        object.set({
            hoverCursor: 'pointer'
        });
        object.set('selectable', true)

    }
}   

if(layerFinished == 1){


    $("#createLayer").addClass('hide')
    $("#permissionDone").addClass('deactive')
    $(".editButton").addClass('hide')
    $(".editButton").hide()
    $(".upbutton ").addClass('hide')

    $("#permission_title").addClass('hide')
    $("#permission_desc").addClass('hide')
    $("#datenow").addClass('hide')

    $("#permission_title1").removeClass('hide')
    $("#permission_desc1").removeClass('hide')
    $("#datenow1").removeClass('hide')


}


if(usertype == 3){


    layerUserID.map(function(a) { 

        if(a.totalLayerCount == activeLayer){


            if(a.user_id == user_id){

                console.log("no HIDE IT")


                $(".layeraction").removeClass('hide')

                $(".editButton").addClass('hide')
                $(".upbutton").addClass('hide')
                $(".passwordLock").addClass('hide')
                $(".saveLayer").addClass('hide')
                $(".editText").addClass('hide')
                $(".copyObject ").addClass('hide')
                $(".layerDelete").addClass('hide')

                $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')

                $('#layerDiv-' + activeLayer).siblings(".layerSubDiv").find(".editText").removeClass('hide')
                $('#layerDiv-' + activeLayer).siblings(".layerSubDiv").find(".passwordLock").removeClass('hide')
                $('#layerDiv-' + activeLayer).siblings(".layerSubDiv").find(".saveLayer").removeClass('hide')
                $('#layerDiv-' + activeLayer).siblings(".layerSubDiv").find(".editText").removeClass('hide')
                $('#layerDiv-' + activeLayer).siblings(".layerSubDiv").find(".layerDelete").removeClass('hide')
                $('#layerDiv-' + activeLayer).siblings(".layerSubDiv").find(".createURL").removeClass('hide')
                $('#layerDiv-' + activeLayer).siblings(".layerSubDiv").find(".copyObject").removeClass('hide')
                            // $('#layeraction-' + activeLayer).removeClass('hide')

                        }else{

                            console.log("HIDE IT")

                            $('#layeraction-' + activeLayer).find(".editButton").addClass('hide')
                             // $('#layeraction-' + activeLayer).addClass('hide')

                         }
                     }
                 })



}






}

}


});






$(document).on('click', '.layerDelete', function(event) {

    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }


    if(usertype == 2 || usertype == 3){

        if( $('#layerDiv-' + activeLayer).hasClass('locked') ){

            $("#modal").removeClass('close')


        }else{

            if($('#deleteLayer-modal').find(".checkedBox").prop('checked')){
                $("#deleteLayer-action").click()
            }else{

                $("#deleteLayer-modal").removeClass('close')
            }

        }
    }else if(usertype == 0 || usertype == 1){


        $("#deleteLayer-modal").removeClass('close')


    }


})


$(document).on('click', '#deleteLayer-action', function(event) {



    $.get("file:///android_assets/views/phppages/allProjectController.php?deleteLayerFile=deleteLayerFile&layerId=" + activeLayer + "&filename=" + getFile.name + "&fileURL=" + getFile.url + "&hash=" + getFile.hash + "&timestamp=" + getFile.ts , function(data, status){

        result = JSON.parse(data)
        console.log(result)

        console.log(data)
        endEditMode()

        console.log(data.status)                        

        if($("#submitText").length != 0){
            $("#layerName-" + prevActive).html(inputTempBuffer)
            $('.temp').remove()
        }

        var id = activeLayer

        $("#deleteLayer-modal").addClass('close')

        $("#inline-btn-container-" + activeLayer).remove()

        imageCountArray


        var counter = 0

        layerUserID.map(function(a) { 
            if(a.totalLayerCount == activeLayer){

                layerUserID.splice(counter, 1);
            }
            counter++;
        })

        delete imageCountArray[activeLayer]
        delete allitems[activeLayer]

        $("#layerTR-" + activeLayer).remove()

        $("#layersection").addClass('hide')


        $('#layerDeleted-modal').removeClass("close")

        setTimeout(function(){ $('#layerDeleted-modal').addClass("close");}, 3000);

        activeLayer = 0

        console.log(layerUserID)


        canvas.getObjects().map(function(o) {

            if(o.layerId == id){

                canvas.remove(o);

            }

        });


    // $("#saveDatatoFile").click()



    var counter = 0


    canvas.getObjects().map(function(o) {

        if(o.layerId == id){

            counter++

        }

    });


    for(i = 0; i <= canvas.getObjects().length; ++i){


        if( canvas.getObjects() != 0 && counter > 0 ){


            object = canvas.item(i)

            Lid = object.get("layerId")

            if(Lid == id){



                canvas.remove(object)

                counter--
                i = -1

            }
        }
    }


    $("#layerDiv-" + id).parent().parent("tr").remove()



    $('#toolbutton').addClass('deactive')
    $('#imageEye').addClass('deactive')


    $('#layeraction-' + activeLayer).find(".editButton").removeClass('editActivate')
    $('#layeraction-' + activeLayer).find(".editButton").removeClass('hide')
    $('#layeraction-' + activeLayer).find(".cancelEdit").addClass('hide')
    editON = 0
    $('.deleteVideo').addClass('hide')
    $("#toolbutton").addClass('hide');
    $("#paste").addClass('hide')

    $("#layerName-" + activeLayer).addClass("textareaEditStyle")

    $("#layerName-" + activeLayer).prop("disabled", true);
    $(".textareaonedit-" + activeLayer + " textarea").addClass("textareaEditStyle")
    $(".textareaonedit-" + activeLayer + " textarea").prop("disabled", true);
    $(".categories").addClass('hide')
    selection = 0
    flag = 0
    document.getElementById("body").style.backgroundColor = "#f4f4f4";

    canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));

    if($("#layerTable tr").length == 0){
        // $("#startP").removeClass('hide')
        $("#hideThis").removeClass('hide')
    }

    $(".inline-btn").addClass('hide')


})


});



var disableScroll = function(){
  if(selection != 0 || created == 1){
     canvas.allowTouchScrolling = false;
     pausePanning = true;
     console.log("aaa1")
 }
};

var enableScroll = function(){
  canvas.allowTouchScrolling = true;
  if(backgroundImageLoaded != 0 || isPdfUpload != 0) pausePanning = false;
};

$('#deletepdf').click(function(event) {
  $('#pdf-canvas').remove()
});


canvas.on('selection:created', disableScroll);  

canvas.on('selection:created', function(){
  created = 1;
});

canvas.on('selection:cleared', function(){
  created = 0
  $(".inline-btn").addClass('hide')
});

canvas.on('selection:cleared', enableScroll);

canvas.on('object:moving', function(e){
  pausePanning = true;

  console.log("aaa1")


  $("#layers").css('transform', 'translate(0px, 0px)');
  $("#layers").attr('data-x', 0);
  $("#layers").attr('data-y', 0);

  $(".bwinPopupd").addClass('hide')

  $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
  $(".bwinPopupd").attr('data-x', 0);
  $(".bwinPopupd").attr('data-y', 0);

  $("#layers").addClass('hide')
  $(".mainNav").addClass('hide')
  $("#liveeditbutton").addClass('hide')
  // var obj = e.target;
  //         // if object is too big ignore
  //         if(obj.currentHeight > obj.canvas.height || obj.currentWidth > obj.canvas.width){
  //            return;
  //         }        
  //         obj.setCoords();        
  //        // top-left  corner
  //        if(obj.getBoundingRect().top < 0 || obj.getBoundingRect().left < 0){
  //            obj.top = Math.max(obj.top, obj.top-obj.getBoundingRect().top);
  //            obj.left = Math.max(obj.left, obj.left-obj.getBoundingRect().left);
  //        }
  //        // bot-right corner
  //        if(obj.getBoundingRect().top+obj.getBoundingRect().height  > obj.canvas.height || obj.getBoundingRect().left+obj.getBoundingRect().width  > obj.canvas.width){
  //            obj.top = Math.min(obj.top, obj.canvas.height-obj.getBoundingRect().height+obj.top-obj.getBoundingRect().top);
  //            obj.left = Math.min(obj.left, obj.canvas.width-obj.getBoundingRect().width+obj.left-obj.getBoundingRect().left);
  //        }
});
canvas.on('object:scaling', disableScroll);
canvas.on('object:rotating', disableScroll);
canvas.on('object:selected', disableScroll);
canvas.on('before:selection:cleared', enableScroll);

  // canvas.on('touch:drag', disableScroll)
  
   // canvas.on('object:over', disableScroll);
   // canvas.on('object:out', disableScroll);

   canvas.on('mouse:move', disableScroll)

   $(document).on('click', '.snapimages', function(event) {

    $(".checked").removeClass('checked')
    $(this).toggleClass('checked');
    value = $(this).attr("data-id")
    snapselectedID = value

    $("#snapshot-" + snapselectedID).toggleClass('full')

    // if($("#snapshot-" + snapselectedID).hasClass('full')){
    //     $("#liveeditbutton").draggable({ disabled: true });
    // }
    // else{
    //     $("#liveeditbutton").draggable({ disabled: false });
    // }

    $("#deletesnap").toggleClass('show')
    $("#deletesnap1").toggleClass('show')


});

//    $(document).on('click', '#deletesnap', function(event) {

//     $("#liveeditbutton").draggable({ disabled: false });

//     if(snapselectedID == 0){

//     }
//     else{

//         $("#snapshot-" + snapselectedID).remove()
//         $("#deletesnap").removeClass('show')
//         $("#deletesnap1").removeClass('show')
//         $("#liveeditbutton").draggable({ disabled: false });
//     }



//     if($("#snaparea").length <= 1){
//         console.log("this")
//         $("#liveeditbutton").removeClass('added')
//         $("#hideThis2").removeClass('hide')
//     }

//     /* Act on the event */
// });

$(document).on('click', '#view', function(event) {


    if(snapselectedID == 0){

    }
    else{

        $("#snapshot-" + snapselectedID).toggleClass('full')
        $("#delete").addClass('show')
    }

    /* Act on the event */
});



$('input').blur(function() {
    console.log('out')
})
.focus(function() {
    console.log('focued')
});

var allowResize = 1


$( window ).on( "orientationchange", function( event ) {

    canvas.discardActiveObject()

    console.log(event)

    setTimeout(function(){   resizer()  }, 50); 


});


canvas.on('text:editing:entered', function (options) {

   allowResize = 0


})

canvas.on('text:editing:exited', function (options) {

   allowResize = 1


})




$(window).resize(function(e) { 


   $('#layerBody').height($(window).height() - 38)



   if(allowResize == 1){

      resizer()
  }


});



function resizer(){


   var height, width

   $(".inline-btn").addClass('hide')

   var normalHeight = document.documentElement.clientHeight
   var originalHeight = screen.height

   var normalWidth = document.documentElement.clientWidth
   var originalWidth = screen.width


   if(isMobile == 1){

      if(fullsc == 0){

         height = normalHeight
         width =  normalWidth

         console.log('non fullScreen height')


     }else if(fullsc == 1){


         height =  originalHeight
         width = originalWidth

         console.log('fullScreen height')
         console.log(height)


     }

 }else{


  height = window.innerHeight
  width = window.innerWidth


}
$("#body").height(height)
$("#body").width(width)


    // alert(height)


    // $("#filename1").val( height );


    console.log(canvas.viewportTransform)
    console.log(canvas.height, canvas.width)

    var abc

    if(isPdfUpload == 0 && backgroundImageLoaded == 0){
        canvas.setHeight(height)
        canvas.setWidth(width)
    }

    // alert(viewportData.height)

    if(isPdfUpload != 0){
        canvas.setHeight(viewportData.height)
        canvas.setWidth(viewportData.width)
        if(canvas.width < width){ 
            canvas.setWidth(width)
        }
        if(canvas.height < height){ 
            canvas.setHeight(height)
        }



    }else if( backgroundImageLoaded != 0 ){
        canvas.setHeight(height)
        canvas.setWidth(width)

        if(canvas.width < width && errorRotation == 0){ 
            canvas.setWidth(width)
        }

    }





    if(isMobile == 1){
        if(backgroundImageLoaded == 1 && errorRotation == 1){
            abc = height / imageWidthData
        }
        else if(backgroundImageLoaded == 1 && errorRotation == 0){
            abc = height / imageHeightData
        }
        else if(isPdfUpload == 1) {
            abc = height / viewportData.height
        }
        else{abc = 1} 

            canvasPageZoom = abc
        console.log("aaa")
        console.log(abc)
                    // alert(abc)
                    canvas.setViewportTransform([abc, 0, 0, abc, 0, 0])
                    canvas.setZoom(abc)

                    canvas.setHeight(height)
                    canvas.setWidth(width)


                }else{


                    if(isPdfUpload == 1){ 
                        abc = height/viewportData.height
                        canvasPageZoom = abc
                        console.log(abc)
                        canvas.setViewportTransform([abc, 0, 0, abc, (width/2)-((viewportData.width * abc) /2) , 0])
                        canvas.setZoom(abc)
                    }else if(backgroundImageLoaded == 1 && errorRotation == 0){
                        abc = height/imageHeightData
                        canvasPageZoom = abc
                        canvas.setZoom(abc);

                        if(width > imageWidthData){
                            if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - ((imageWidthData * abc) /2) , 0])

                        }
                    if(width == imageWidthData){
                        if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - (canvas.width * abc) /2 , 0])

                    }
                if(imageWidthData > width){
                    if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2)- ((imageWidthData * abc) /2) , 0])

                }
        }else if(backgroundImageLoaded == 1 && errorRotation == 1){
            abc = height / imageWidthData
            canvasPageZoom = abc
            canvas.setZoom(abc);

            if(width > imageWidthData){
                if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - ((imageWidthData * abc) /2) , 0])

            }
        if(width == imageWidthData){
            if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - (canvas.width * abc) /2 , 0])

        }
    if(imageWidthData > width){
        if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2)- ((imageHeightData * abc) /2) , 0])

    }
}




}






canvas.renderAll()



}






//    $(window).resize(function() { 


//      console.log("reazix")

//      height = window.innerHeight
//      width =  window.innerWidth

//      $("#body").height(height)
//      $("#body").width(width)

//      console.log(canvas.viewportTransform)
//      console.log(canvas.height, canvas.width)

//      var abc

//      if(isPdfUpload == 0 && backgroundImageLoaded == 0){
//          canvas.setHeight(height)
//          canvas.setWidth(width)
//      }

//     // alert(viewportData.height)

//     if(isPdfUpload != 0){
//      canvas.setHeight(viewportData.height)
//      canvas.setWidth(viewportData.width)
//      if(canvas.width < width){ 
//          canvas.setWidth(width)
//      }
//      if(canvas.height < height){ 
//          canvas.setHeight(height)
//      }



//     }else if( backgroundImageLoaded != 0 ){
//      canvas.setHeight(height)
//      canvas.setWidth(width)

//      if(canvas.width < width && errorRotation == 0){ 
//          canvas.setWidth(width)
//      }

//     }





//     if(isMobile == 1){
//      if(backgroundImageLoaded == 1 && errorRotation == 1){
//                 abc = height / imageWidthData
//             }
//          else if(backgroundImageLoaded == 1 && errorRotation == 0){
//                 abc = height / imageHeightData
//             }
//          else if(isPdfUpload == 1) {
//                 abc = height / viewportData.height
//             }
//             else if(isPdfUpload == 0 && backgroundImageLoaded == 0){abc = 1}

//                      canvasPageZoom = abc
//                  console.log("aaa")
//                  console.log(abc)
//                     // alert(abc)
//                     canvas.setViewportTransform([abc, 0, 0, abc, 0, 0])
//                     canvas.setZoom(abc)
//                 }else if(isPdfUpload == 1){ 
//                  abc = height/viewportData.height
//                  canvasPageZoom = abc
//                  console.log(abc)
//                  canvas.setViewportTransform([abc, 0, 0, abc, (width/2)-((viewportData.width * abc) /2) , 0])
//                  canvas.setZoom(abc)
//                 }else if(backgroundImageLoaded == 1 && errorRotation == 0){
//                  abc = height/imageHeightData
//                  canvasPageZoom = abc
//                  canvas.setZoom(abc);

//                  if(width > imageWidthData){
//                      if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - ((imageWidthData * abc) /2) , 0])

//                  }
//                 if(width == imageWidthData){
//                  if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - (canvas.width * abc) /2 , 0])

//                 }
//             if(imageWidthData > width){
//              if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2)- ((imageWidthData * abc) /2) , 0])

//             }
//     }else if(backgroundImageLoaded == 1 && errorRotation == 1){
//      abc = height / imageWidthData
//      canvasPageZoom = abc
//      canvas.setZoom(abc);

//      if(width > imageWidthData){
//          if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - ((imageWidthData * abc) /2) , 0])

//      }
//     if(width == imageWidthData){
//      if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - (canvas.width * abc) /2 , 0])

//     }
// if(imageWidthData > width){
//  if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2)- ((imageHeightData * abc) /2) , 0])

// }
// }

// canvas.renderAll()


// });

var browserZoomLevel = Math.round(window.devicePixelRatio * 100);
$("#zoomValue").html(browserZoomLevel)

function getImage(){

    var saveButton = document.getElementById('myButton')
    var snaparea = document.getElementById('snaparea')


    if( canvasImageLoaded == 1 && pdfImageLoaded == 1 ){


        var dataURL = saveBuffer.toDataURL( "image/png" );

        var data = atob( dataURL.substring( "data:image/png;base64,".length ) ),
        asArray = new Uint8Array(data.length);

        for( var i = 0, len = data.length; i < len; ++i ) {
            asArray[i] = data.charCodeAt(i);    
        }

        var blob = new Blob( [ asArray.buffer ], {type: "image/png"} );
        url = decodeURIComponent(window.URL.createObjectURL(blob));

        console.log(url)


        var d1 = document.getElementById('snaparea');
        snapshot++
        d1.insertAdjacentHTML('beforeend', '<img class="snapimages" id="snapshot-'+ snapshot +'" data-id= "'+ snapshot +'"  src="' + url +'">');
        $("#liveeditbutton").addClass('added')




        $("#pdfcanvaswidth").html(pdfcanvasWidth)
        $("#pdfcanvasheight").html(pdfcanvasHeight)

        $("#savebufferheight").html(saveBuffer.getHeight())
        $("#savebufferwidth").html(saveBuffer.getWidth())

        $("#canvasheight").html(saveBuffer.getHeight())
        $("#canvaswidth").html(saveBuffer.getWidth())

        $("#screenwidth").html(($(window).width() ))
        $("#screenheight").html(($(window).width() ))








        canvasImageLoaded = 0;
        pdfImageLoaded = 0
    }



}


$("#startP").click(function(event) {
    $("#layerSection").addClass('hide')


    $("#layers").css('transform', 'translate(0px, 0px)');
    $("#layers").attr('data-x', 0);
    $("#layers").attr('data-y', 0);
    $("#layers").addClass('hide')
    $(".mainNav").addClass('hide')
    $(".showbox").removeClass('show')
    $("#liveeditbutton").addClass('hide')
    $(".highlight").removeClass('highlight')
    $("#cancelButtonforLayerButton").addClass('hide')
    $("#layersButton").removeClass('hide')

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);

//      if( initialLayer == 1 ){
//  console.log("jmmmmmmmmmmmmmmmmmmmmmmm")
//  $("#layersButton").click()
//  $("#layerName-" + initialLayerID).click()

// }
});




// $(document).on('click', '.copyObject', function(event) {
//  // clone what are you copying since you
//  // may want copy and paste on different moment.
//  // and you do not want the changes happened
//  // later to reflect on the copy.
//  $("#copy").addClass('hide')
//  $("#paste").removeClass('hide')
//  $("#cancel").removeClass('hide')
//  canvas.getActiveObject().clone(function(cloned) {
//      _clipboard = cloned;
//  });
// })


var copiedLayerID

$(document).on('click', '.copyObject', function(event) {

    copyOn = 1


    $("#layerTR-"+activeLayer).find(".copyObject").hide()
    $("#layerTR-"+activeLayer).find(".cancelCopy").removeClass("hide")
    // $("#paste").removeClass('hide')


    copiedLayerID = activeLayer

    console.log(copiedLayerID)

})




var group

// $(document).on('click', '.copyObject', function(event) {

//  // clone what are you copying since you
//  // may want copy and paste on different moment.
//  // and you do not want the changes happened
//  // later to reflect on the copy.
//      $("#layerTR-"+activeLayer).find(".copyObject").hide()
//      $("#layerTR-"+activeLayer).find(".cancelCopy").removeClass("hide")
//  $("#paste").removeClass('hide')


//  var objs = canvas.getObjects().filter(function(o) {
//         if (o.get('layerId') === activeLayer) {
//             return o.set('active', true);
//         }
//     });

// //create group
// group = new fabric.Group(objs, {
// originX: 'center',
// originY: 'center'
// });

// group.type = "group"

// canvas._activeObject = null;
// group.setCoords();

// canvas.getObjects().filter(function(o) {
//             return o.set('active', false);

//  });

// canvas.getObjects().filter(function(o) {
//           if(o.type=="group"){
//         var items = activeObject._objects;
//         console.log(items);
//         activeObject._restoreObjectsState();
//         canvas.remove(activeObject);
//         for(var i = 0; i < items.length; i++) {
//           items[i].layerId = activeLayer 
//           canvas.add(items[i]);
//           canvas.item(canvas.size()-1).hasControls = true;
//         }

//         canvas.renderAll();
//     }
//     });



// canvas.setActiveObject(group).renderAll();


//  group.clone(function(cloned) {
//      _clipboard = cloned;
//  });

//      canvas.discardActiveObject()
// })




//  function copy() {
//  // clone what are you copying since you
//  // may want copy and paste on different moment.
//  // and you do not want the changes happened
//  // later to reflect on the copy.
//  $("#copy").addClass('hide')
//  $("#paste").removeClass('hide')
//  $("#cancel").removeClass('hide')
//  canvas.setActiveGroup(new fabric.Group(canvas.getObjects())).renderAll();
//  canvas.renderAll()
//  canvas.getActiveObject().clone(function(cloned) {
//      _clipboard = cloned;
//  });
// }

$(document).on('click', '.cancelCopy', function(event) {


    copyOn = 0

    $(".copyObject").show()
    $(".cancelCopy").addClass("hide")
    $("#paste").addClass('hide')
});
function paste() {

    canvas.getObjects().map(function(o) {

        console.log(o)

        if (o.get('layerId') === copiedLayerID && o.id != 'imageObject') {

            o.clone(function(clonedObj) {
                canvas.discardActiveObject();
                clonedObj.set({
                    evented: true,
                });
                if (clonedObj.type === 'activeSelection') {
            // active selection needs a reference to the canvas.
            clonedObj.canvas = canvas;
            clonedObj.forEachObject(function(obj) {

                obj.layerId = activeLayer
                canvas.add(obj);
            });
            // this should solve the unselectability
            clonedObj.setCoords();
        } else {
            clonedObj.layerId = activeLayer
            clonedObj.visible = true
            canvas.add(clonedObj);
        }
        canvas.setActiveObject(clonedObj);
        canvas.requestRenderAll();
    }, ['id']);

        }

    });


    copyOn = 0

    $(".copyObject").show()
    $("#paste").addClass('hide')
    $(".cancelCopy").addClass("hide")

    // clone again, so you can do multiple copies.
    // _clipboard.clone(function(clonedObj) {
    //  canvas.discardActiveObject();
    //  clonedObj.set({
    //      left: clonedObj.left + 10,
    //      top: clonedObj.top + 10,
    //      evented: true,
    //  });
    //  if (clonedObj.type === 'activeSelection') {
    //      // active selection needs a reference to the canvas.
    //      clonedObj.canvas = canvas;
    //      clonedObj.forEachObject(function(obj) {
    //          canvas.add(obj);
    //      });
    //      // this should solve the unselectability
    //      clonedObj.setCoords();
    //  } else {
    //      canvas.add(clonedObj);
    //  }
    //  _clipboard.top += 10;
    //  _clipboard.left += 10;
    //  _clipboard.layerId = activeLayer
    //  canvas.setActiveObject(clonedObj);
    //  canvas.requestRenderAll();
    // });
}

// function paste() {
//  // clone again, so you can do multiple copies.
//  _clipboard.clone(function(clonedObj) {
//      canvas.discardActiveObject();
//      clonedObj.set({
//          left: clonedObj.left + 10,
//          top: clonedObj.top + 10,
//          layerId: activeLayer,
//          evented: true,
//      });
//      if (clonedObj.type === 'group') {
//          // active selection needs a reference to the canvas.
//          clonedObj.canvas = canvas;
//          clonedObj.forEachObject(function(obj) {
//              canvas.add(obj);
//          });
//          // this should solve the unselectability
//          clonedObj.setCoords();
//      } else {
//          canvas.add(clonedObj);
//      }
//      _clipboard.top += 10;
//      _clipboard.left += 10;
//      _clipboard.selectable = true;
//      canvas.setActiveObject(clonedObj);
//      canvas.requestRenderAll();
//  });

//     var activeObject = canvas.getActiveObject();
//     console.log("activeObject")
//     console.log(activeObject)
//     if(activeObject.type=="group"){
//         var items = activeObject._objects;
//         console.log(items);
//         activeObject._restoreObjectsState();
//         canvas.remove(activeObject);
//         for(var i = 0; i < items.length; i++) {
//           items[i].layerId = activeLayer 
//           canvas.add(items[i]);
//           canvas.item(canvas.size()-1).hasControls = true;
//         }

//         canvas.renderAll();
//     }

//     canvas.getObjects().map(function(o) {
//      if(o.type=="group"){
//              canvas.remove(o)
//          }
//          });

//  $(".copyObject").show()
//  $("#paste").addClass('hide')
//  $(".cancelCopy").addClass("hide")
// }




function pdfImageLoad(dataURLPdf){

    fabric.util.loadImage(dataURLPdf, function (img) {


        buffering = new fabric.Image(img);
        buffering.set({
            left: 0,
            right: 0
        });


        saveBuffer.add(buffering)
        pdfImageLoaded = 1;


        saveBuffer.renderAll();
        getImage();
    });


}

function canvasImageLoad(dataURLCanvas){


    fabric.util.loadImage(dataURLCanvas, function (img) {

        buffering = new fabric.Image(img);
        buffering.set({
            left:0,
            right: 0,
            height: pdfcanvasHeight,
            width: pdfcanvasWidth
        });

        saveBuffer.add(buffering)
        canvasImageLoaded = 1;

        saveBuffer.renderAll();
        getImage()
    });

}



$("#modeToggler").click(function(event) {

    console.log(  $(this).data('mode') )

    if($(this).data('mode') == "selection"){

        $(this).data('mode', 'tool')

        switch(selection){

            case -1 :  $(this).children('img').attr('src', 'icons/eraser.svg'); $(this).data('prevtool' , '-1'); $(this).children('img').attr('title', '텍스트'); $(this).children('img').attr('alt', '텍스트'); break;

            case 1 :  $(this).children('img').attr('src', 'icons/text.svg'); $(this).data('prevtool' , '1'); $(this).children('img').attr('title', '텍스트'); $(this).children('img').attr('alt', '텍스트'); break;

            case 3 : $(this).children('img').attr('src', 'icons/circle.svg'); $(this).data('prevtool' , '3'); $(this).children('img').attr('title', '원'); $(this).children('img').attr('alt', '원'); break;

            case 4 : $(this).children('img').attr('src', 'icons/polygon.svg');  $(this).data('prevtool' , '4'); $(this).children('img').attr('title', '다각형'); $(this).children('img').attr('alt', '다각형'); if(is_touch_device() == false){ escaped = 1; prototypefabric.polygon.generatePolygon(pointArray); escaped = 0 ; }else{ prototypefabric.polygon.generatePolygon(pointArray); escaped = 0 } break;

            case 5 : $(this).children('img').attr('src', 'icons/free.svg'); $(this).data('prevtool' , '5'); $(this).children('img').attr('title', '선'); $(this).children('img').attr('alt', '선'); break;

            case 7 : $(this).children('img').attr('src', 'icons/rectangle.svg'); $(this).data('prevtool' , '7'); $(this).children('img').attr('title', '사각형'); $(this).children('img').attr('alt', '사각형'); break;

            case 9 : $(this).children('img').attr('src', 'icons/line.svg'); $(this).data('prevtool' , '9'); $(this).children('img').attr('title', '직선'); $(this).children('img').attr('alt', '직선'); break;

            case 11 : $(this).children('img').attr('src', 'icons/arrow.svg');$(this).data('prevtool' , '11'); $(this).children('img').attr('title', '화살표'); $(this).children('img').attr('alt', '화살표'); break;

            case 99 : $(this).children('img').attr('src', 'icons/line.svg');$(this).data('prevtool' , '99'); $(this).children('img').attr('title', '화살표'); $(this).children('img').attr('alt', '화살표'); console.log('ttytttt'); if(is_touch_device() == false){ escapedLines = 1; prototypefabric1.polygon.generatePolygon(pointArray);  escapedLines = 0;}else{ prototypefabric1.polygon.generatePolygon(pointArray); escapedLines = 0; } break;

            // default : $(this).data('prevtool' , '0');

        }


        $('#selection').click()


        
    }else if($(this).data('mode') == "tool"){

        $(this).data('mode', 'selection')

        console.log(parseInt($(this).data('prevtool')))

        switch(parseInt($(this).data('prevtool'))){

            case -1 : $('#delete').click(); selection = -1; $(this).children('img').attr('src', 'icons/eraser.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

            case 1 : $('#text').click(); selection = 1; $(this).children('img').attr('src', 'icons/move.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

            case 3 : $('#circle').click(); selection = 3; $(this).children('img').attr('src', 'icons/move.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

            case 4 : $('#polyline').click(); selection = 4; $(this).children('img').attr('src', 'icons/move.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

            case 5 : $('#free').click(); selection = 5; $(this).children('img').attr('src', 'icons/move.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

            case 7 : $('#rectangle').click(); selection = 7; $(this).children('img').attr('src', 'icons/move.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

            case 9 : $('#line').click(); selection = 9; $(this).children('img').attr('src', 'icons/move.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

            case 11 : $('#arrow').click(); selection = 11; $(this).children('img').attr('src', 'icons/move.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

            case 99 :                  canvas.getObjects().forEach(function(obj){
                obj.selectable = false
            });


            canvas.selection = false;

            canvas.skipTargetFind = false; 

            canvas.renderAll();
            prototypefabric1.polygon.drawPolygon();  selection = 99; $(this).children('img').attr('src', 'icons/move.svg'); $(this).children('img').attr('title', '켄버스 스크롤(S)'); $(this).children('img').attr('alt', '켄버스 스크롤(S)'); break;

        }


    }




})



$("#centerFit").click(function(event) {
    $(".highlight").removeClass('highlight')
    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }


    if(selection == 4  && polygonCreated == 0){

        escaped = 1

        prototypefabric.polygon.generatePolygon(pointArray);


        selection = 0;
        $(".selectedTool").removeClass('selectedTool')
        $("#selection").click()

    }


    canvas.discardActiveObject()
    canvas.renderAll()



    $("#layers").css('transform', 'translate(0px, 0px)');
    $("#layers").attr('data-x', 0);
    $("#layers").attr('data-y', 0);
    escaped = 0

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);

    $("#liveeditbutton").addClass('hide')
    $("#layers").addClass('hide');
    $(".mainNav").addClass('hide');
    $("#toolbox").addClass('hide');

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);

    $(".showbox").removeClass('show');

//      if( initialLayer == 1 ){
//  console.log("jmmmmmmmmmmmmmmmmmmmmmmm")
//  initialLayer = 0
//  $("#layersButton").click()
//  $("#layerName-" + initialLayerID).click()
// }

if(isMobile == 0 && isPdfUpload == 1){

        // canvas.setViewportTransform([canvasPageZoom, 0, 0, canvasPageZoom, (width/2)-((canvas.width * canvasPageZoom) /2), 0])
        canvas.setViewportTransform([canvasPageZoom, 0, 0, canvasPageZoom, (width/2)-((viewportData.width * canvasPageZoom) /2) , 0])
        canvas.setZoom(canvasPageZoom)

    }else if(isMobile == 0 && backgroundImageLoaded == 1 && errorRotation == 0){

        canvas.setViewportTransform([canvasPageZoom, 0, 0, canvasPageZoom, (width/2)-((imageWidthData * canvasPageZoom) /2), 0])
        canvas.setZoom(canvasPageZoom)

    }else if(isMobile == 0 && backgroundImageLoaded == 1 && errorRotation == 1){

        // canvas.setViewportTransform([canvasPageZoom, 0, 0, canvasPageZoom, (width/2)-((imageWidthData * canvasPageZoom) /2), 0])
        canvas.setViewportTransform([canvasPageZoom, 0, 0, canvasPageZoom, (width/2)- ((imageHeightData * canvasPageZoom) /2) , 0])
        canvas.setZoom(canvasPageZoom)

    }
    else if(isMobile == 1){
        canvas.setViewportTransform([1, 0, 0, 1, 0, 0])
        canvas.setZoom(canvasPageZoom)
    }
    else if(backgroundImageLoaded == 0 && isPdfUpload == 0){
        canvas.setZoom(1)
        canvas.setViewportTransform([1, 0, 0, 1, 0, 0])
    }
});



$("#saveCanvas").click(function(event) {

    if($('#snapshot-modal').find(".checkedBox").prop('checked')){
        $("#snapshot-action").click()
    }else{

        $("#snapshot-modal").removeClass('close')

    }

})




$("#snapshot-action").click(function(event) {
    $("#snapshot-modal").addClass('close')


    // $(".loader").css('background', 'rgba(255,255,255,0.7)');
    $(".loader").show().fadeIn('slow');

    setTimeout(function(){ snapIt()  }, 50); 

})


function snapIt(){

  $('.highlight').removeClass('highlight')


  $("#layers").css('transform', 'translate(0px, 0px)');
  $("#layers").attr('data-x', 0);
  $("#layers").attr('data-y', 0);

  $(".bwinPopupd").addClass('hide')

  $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
  $(".bwinPopupd").attr('data-x', 0);
  $(".bwinPopupd").attr('data-y', 0);


  $("#layers").addClass('hide');
  $(".mainNav").addClass('hide');




  var saveButton = document.getElementById('myButton')

  var canvasZoom = canvas.getZoom()
  var canvasHeight = canvas.height
  var canvasWidth = canvas.width
  canvasViewport = canvas.viewportTransform

  console.log(canvasZoom)


    // for(i = 1; i <= canvas.getObjects().length; i++){

    //             //item = canvas.getItem("imageObject")
    //             object = canvas.item(i-1)

    //             type = object.get("id")

    //             if( type == 'imageObject'){
    //                 // object.set('opacity', 0)
    //                 object.visible=false

    //             }
    //         }   

    canvas.setZoom(1)
    canvas.setViewportTransform([1, 0, 0, 1, 0, 0])

    if(backgroundImageLoaded == 1 && errorRotation == 0)
    {
        canvas.setHeight(imageHeightData)
        canvas.setWidth(imageWidthData)
    }else if(backgroundImageLoaded == 1 && errorRotation == 1){
        canvas.setHeight(imageWidthData)
        canvas.setWidth(imageHeightData)
    }
    else if( isPdfUpload == 1 ){
        canvas.setHeight(viewportData.height)
        canvas.setWidth(viewportData.width)
    }
    canvas.renderAll()


    var dataURL = canvas.toDataURL( "image/png" );

    var data = atob( dataURL.substring( "data:image/png;base64,".length ) ),
    asArray = new Uint8Array(data.length);

    for( var i = 0, len = data.length; i < len; ++i ) {
        asArray[i] = data.charCodeAt(i);    
    }

    var blob = new Blob( [ asArray.buffer ], {type: "image/png"} );
    url = decodeURIComponent(window.URL.createObjectURL(blob));
    console.log(url)


    var d1 = document.getElementById('snaparea');
    snapshot++
    d1.insertAdjacentHTML('beforeend', '<img class="snapimages"  id="snapshot-'+ snapshot +'" data-id="'+ snapshot +'"  src="' + url +'">');
    $("#liveeditbutton").addClass('added')

    $("#hideThis2").addClass('hide')


            // for(i = 1; i <= canvas.getObjects().length; i++){

            //     object = canvas.item(i-1)

            //     type = object.get("id")


            //     if( type == 'imageObject'){
            //         // object.set('opacity', 1)
            //         object.visible=true
            //     }
            // }   

            canvas.setZoom(canvasZoom)
            canvas.setViewportTransform(canvasViewport)
            canvas.setHeight(canvasHeight)
            canvas.setWidth(canvasWidth)
            canvas.renderAll()

            $(".loader").hide().fadeOut('slow') 




            console.log("ssssqqq")

            $('#snapshotadded-modal').removeClass("close")


            setTimeout(function(){ $('#snapshotadded-modal').addClass("close");  console.log("ssssxxxs");}, 3000);



            console.log("ssss")
            $("#liveedit").click(); 




        }



        ctx = canvas.getContext("2d")
        ctx.lineWidth = 6;
        ctx.strokeStyle = "#333";
        ctx.beginPath();
        ctx.moveTo(82, 273);
        ctx.bezierCurveTo(92, 98, 223, 311, 400, 250);
        ctx.stroke();

        fabric.Canvas.prototype.getItem = function(id) {
            var object = null,
            objects = this.getObjects();

            for (var i = 0, len = this.size(); i < len; i++) {
                if (objects[i].id && objects[i].id === id) {
                    object = objects[i];
                    break;
                }
            }

            return object;
        };




        var min = 99;
        var max = 999999;
        var polygonMode = false;
        var pointArray = new Array();
        var lineArray = new Array();
        var activeLine;
        var activeShape = false;



        function groupthem(){

            var objs = [];
    //get all the objects into an array
    objs = canvas._objects.filter(function(obj){
        if(obj.layerId == activeLayer && obj.id == 'lineTemp' && obj.width != 0){
            obj.id == 'line'
            return obj;
        }
        
    });



    console.log(objs)

    //group all the objects 
    var alltogetherObj = new fabric.Group(objs,{
        id : 'angle',
        perPixelTargetFind: true,
        layerId : activeLayer});


    //clear previous objects
    canvas.getObjects().forEach(function(obj){
        if(obj.id == 'lineTemp' || obj.id == 'polyLinesTemp') canvas.remove(obj);
    });

    if(escapedLines == 0){
        canvas.add(alltogetherObj);
        alltogetherObj.setCoords(); 

    }

    canvas.renderAll();
}



var prototypefabric = new function () {
    this.initCanvas = function () {

        console.log("init")


                  // canvas.on('mouse:over', function(options) {
                  //       if(options.target && options.target.id == pointArray[0].id){
                  //           prototypefabric.polygon.generatePolygon(pointArray);
                  //           // polygonCreated = 1
                  //           console.log("aaa")
                  //           $("#selection").trigger('click')
                  //           pointArray = []
                  //       }
                  //     });


                  canvas.on('mouse:down', function (options) {


                    console.log("aaa1aaaaa")


                    if(selection ==4 ){

                        canvas.selection = true

                        canvas.skipTargetFind = false

                        console.log("aaa1")

                        console.log(options)

                        if(options.target && options.target.id == pointArray[0].id){
                            prototypefabric.polygon.generatePolygon(pointArray);
                            // polygonCreated = 1
                            console.log("aaa")
                            $("#selection").trigger('click')
                            pointArray = []
                        }
                        if(polygonMode){
                            prototypefabric.polygon.addPoint(options);
                        }

                    }

                });
                  canvas.on('mouse:dblclick', function (options) {

                    if(selection ==4 ){


                        prototypefabric.polygon.generatePolygon(pointArray);
                        // polygonCreated = 1
                        $("#selection").trigger('click')
                        pointArray = []


                    }

                });
                  canvas.on('mouse:move', function (options) {

                    if(selection == 4 && is_touch_device() == false ){
                        if(activeLine && activeLine.class == "line"){
                            var pointer = canvas.getPointer(options.e);
                            activeLine.set({ x2: pointer.x, y2: pointer.y });

                            var points = activeShape.get("points");
                            points[pointArray.length] = {
                                x:pointer.x,
                                y:pointer.y
                            }
                            activeShape.set({
                                points: points
                            });
                            canvas.renderAll();
                        }
                        canvas.renderAll();
                    }

                });
              };
          };




          prototypefabric.initCanvas();


          console.log("inqait")

          $('#create-polygon').click(function() {

          });


          prototypefabric.polygon = {
            drawPolygon : function() {
                polygonMode = true;
                pointArray = new Array();
                lineArray = new Array();
                activeLine;
            },
            addPoint : function(options) {

                var random = Math.floor(Math.random() * (max - min + 1)) + min;
                var id = new Date().getTime() + random;
                var pointer = canvas.getPointer(options.e);
                console.log(options)
                var circle = new fabric.Circle({
                    radius: 5/canvas.getZoom(),
                    fill: 'green',
                    stroke: '#333333',
                    strokeWidth: 0.5,
                    left: pointer.x,
                    top: pointer.y,
                    selectable: false,
                    hasBorders: false,
                    hasControls: false,
                    originX:'center',
                    originY:'center',
                    id:id
                });
                if(pointArray.length == 0){
                    circle.set({
                        fill:'red'
                    })
                }
                var points = [(pointer.x),(pointer.y),(pointer.x),(pointer.y)];

                strokedashWidth = parseInt($("#polygon-dash-width").val())
                strokedashSpace = parseInt($("#polygon-dash-space").val())
                strokeWidth = parseInt($("#polygon-stroke-width").val());
                strokeColor= $("#polygon-stroke-color").val();
                opacity = parseFloat($("#polygon-opacity").val());
                color = $('#polygon-color').val();

                line = new fabric.Line(points, {
                    strokeWidth: strokeWidth,
                    fill: '#999999',
                    stroke: strokeColor,
                    class:'line',
                    strokeDashArray: [strokedashWidth, strokedashSpace],
                    originX:'center',
                    originY:'center',
                    opacity:opacity,
                    selectable: false,
                    hasBorders: false,
                    hasControls: false
                });
                if(activeShape){
                    var pos = canvas.getPointer(options.e);
                    var points = activeShape.get("points");
                    points.push({
                        x: pos.x,
                        y: pos.y
                    });
                    var polygon = new fabric.Polygon(points,{
                        stroke:'#333333',
                        strokeWidth:1,
                        fill: color,
                        opacity: opacity,
                        // perPixelTargetFind: true,
                        selectable: false,
                        hasBorders: false,
                        hasControls: false,
                        evented: false
                    });
                    canvas.remove(activeShape);
                    canvas.add(polygon);
                    activeShape = polygon;
                    canvas.renderAll();
                }
                else{
                    var polyPoint = [{x:(pointer.x),y:(pointer.y)}];
                    var polygon = new fabric.Polygon(polyPoint,{
                        stroke:'#333333',
                        strokeWidth:1,
                        fill: '#cccccc',
                        opacity: 0.1,
                        // perPixelTargetFind: true,
                        selectable: false,
                        hasBorders: false,
                        hasControls: false,
                        evented: false
                    });
                    activeShape = polygon;
                    canvas.add(polygon);
                }
                activeLine = line;

                pointArray.push(circle);
                lineArray.push(line);

                canvas.add(line);
                canvas.add(circle);
                canvas.selection = false;
            },
            generatePolygon : function(pointArray){
                var points = new Array();
                $.each(pointArray,function(index,point){
                    points.push({
                        x:point.left,
                        y:point.top
                    });
                    canvas.remove(point);
                });
                $.each(lineArray,function(index,line){
                    canvas.remove(line);
                });
                canvas.remove(activeShape).remove(activeLine);


                color = $('#polygon-color').val();
                opacity = parseFloat($("#polygon-opacity").val());
                strokeWidth = parseInt($("#polygon-stroke-width").val());
                strokeColor= $("#polygon-stroke-color").val();

                strokedashWidth = parseInt($("#polygon-dash-width").val())
                strokedashSpace = parseInt($("#polygon-dash-space").val())


                var polygon = new fabric.Polygon(points,{
                    stroke: strokeColor,
                    strokeWidth: strokeWidth,
                    fill: color,
                    strokeDashArray: [strokedashWidth, strokedashSpace],
                    layerId: activeLayer,
                    opacity: opacity,
                    hasBorders: true,
                    hasControls: true,
                    perPixelTargetFind: true,
                    id: 'polygon'
                });
                if(escaped == 0){
                    canvas.add(polygon);
                }
                activeLine = null;
                updateCanvasState()
                activeShape = null;
                polygonMode = false;
                canvas.selection = true;

                console.log("aaa1")
            }
        };



        var counterLine = 0
        var escapedLines = 0

        var prototypefabric1 = new function () {
            this.initCanvas = function () {

                console.log("init")


                  // canvas.on('mouse:over', function(options) {
                  //       if(options.target && options.target.id == pointArray[0].id){
                  //           prototypefabric.polygon.generatePolygon(pointArray);
                  //           // polygonCreated = 1
                  //           console.log("aaa")
                  //           $("#selection").trigger('click')
                  //           pointArray = []
                  //       }
                  //     });


                  canvas.on('mouse:down', function (options) {


                    console.log("aaa1aaaaa")


                    if(selection == 99 ){

                        canvas.selection = true

                        canvas.skipTargetFind = false

                        console.log("aaa1")

                        console.log(options)

                        if(polygonMode){
                            prototypefabric1.polygon.addPoint(options);
                        }

                    }

                });
                  canvas.on('mouse:dblclick', function (options) {

                    if(selection == 99  && is_touch_device() == false ){


                        prototypefabric1.polygon.generatePolygon(pointArray);
                        // polygonCreated = 1
                        $("#selection").trigger('click')
                        pointArray = []


                    }

                });
                  canvas.on('mouse:move', function (options) {

                    if(previousSelection == 99 && is_touch_device() == false  ){
                        if(activeLine && activeLine.class == "line"){
                            var pointer = canvas.getPointer(options.e);
                            activeLine.set({ x2: pointer.x, y2: pointer.y });

                            var points = activeShape.get("points");
                            points[pointArray.length] = {
                                x:pointer.x,
                                y:pointer.y
                            }
                            activeShape.set({
                                points: points
                            });
                            canvas.renderAll();
                        }
                        canvas.renderAll();
                    }

                });
              };
          };




          prototypefabric1.initCanvas();


          var points_counter = 0


          console.log("inqait")

          $('#create-polygon').click(function() {

          });


          prototypefabric1.polygon = {
            drawPolygon : function() {
                polygonMode = true;
                pointArray = new Array();
                lineArray = new Array();
                activeLine;
                points_counter = 0
            },
            addPoint : function(options) {


                canvas.getObjects().forEach(function(obj){
                    obj.selectable = false
                });


                canvas.selection = false;

                canvas.skipTargetFind = false; 

                canvas.renderAll()


                var random = Math.floor(Math.random() * (max - min + 1)) + min;
                var id = new Date().getTime() + random;
                var pointer = canvas.getPointer(options.e);
                console.log(options)
                var circle = new fabric.Circle({
                    radius: 5/canvas.getZoom(),
                    fill: 'green',
                    stroke: '#333333',
                    strokeWidth: 0.5,
                    left: pointer.x,
                    top: pointer.y,
                    selectable: false,
                    hasBorders: false,
                    hasControls: false,
                    originX:'center',
                    originY:'center',
                    id:id
                });
                if(pointArray.length == 0){
                    circle.set({
                        fill:'red'
                    })
                }
                var points = [(pointer.x),(pointer.y),(pointer.x),(pointer.y)];


                strokeWidth = parseInt($("#line-stroke-width").val());
                strokeColor= $("#line-stroke-color").val();

                line = new fabric.Line(points, {
                    class:'line',
                    id : 'lineTemp',
                    strokeWidth: strokeWidth,
                    stroke: strokeColor,
                    perPixelTargetFind: true,
                    layerId: activeLayer,
                    originX:'center',
                    originY:'center',
                    selectable: false,
                    hasBorders: false,
                    hasControls: false
                });


                if(activeShape){
                    var pos = canvas.getPointer(options.e);
                    var points = activeShape.get("points");
                    points.push({
                        x: pos.x,
                        y: pos.y
                    });
                    var polygon = new fabric.Polygon(points,{
                        stroke:'#333333',
                        strokeWidth:1,
                        fill: 'transparent',
                        'test': 'poly',
                        opacity: 1,
                        id: 'polyLinesTemp', 
                        // perPixelTargetFind: true,
                        selectable: false,
                        hasBorders: false,
                        hasControls: false,
                        evented: false
                    });


                    canvas.add(new fabric.Line([points[points_counter].x , points[points_counter].y , points[points_counter + 1].x, points[points_counter + 1].y], {
                        layerId : activeLayer,
                        strokeWidth: strokeWidth,
                        fill: '#999999',
                        stroke: strokeColor,
                        class:'line',
                        id : 'polyLinesTemp',
                        perPixelTargetFind: true,
                        originX:'center',
                        originY:'center',
                        selectable: false,
                        hasBorders: false,
                        hasControls: false
                    }));

                    points_counter++


                    canvas.remove(activeShape);
                    // canvas.add(polygon);
                    activeShape = polygon;
                    canvas.renderAll();
                }
                else{
                    var polyPoint = [{x:(pointer.x),y:(pointer.y)}];
                    var polygon = new fabric.Polygon(polyPoint,{
                        stroke:'#333333',
                        strokeWidth:1,
                        fill: '#cccccc',
                        opacity: 0.1,
                        // perPixelTargetFind: true,
                        selectable: false,
                        hasBorders: false,
                        hasControls: false,
                        evented: false
                    });
                    activeShape = polygon;
                    // canvas.add(polygon);
                }
                activeLine = line;

                pointArray.push(circle);
                lineArray.push(line);

                canvas.add(line);
                canvas.add(circle);
                canvas.selection = false;
            },
            generatePolygon : function(pointArray){
                var points = new Array();
                $.each(pointArray,function(index,point){
                    points.push({
                        x:point.left,
                        y:point.top
                    });
                    canvas.remove(point);
                });
                // $.each(lineArray,function(index,line){
                //     canvas.remove(line);
                // });
                // canvas.remove(activeShape).remove(activeLine);


                // color = $('#polygon-color').val();
                // opacity = parseFloat($("#polygon-opacity").val());
                // strokeWidth = parseInt($("#polygon-stroke-width").val());
                // strokeColor= $("#polygon-stroke-color").val();

                // strokedashWidth = parseInt($("#polygon-dash-width").val())
                // strokedashSpace = parseInt($("#polygon-dash-space").val())

                strokeWidth = parseInt($("#line-stroke-width").val());
                strokeColor= $("#line-stroke-color").val();

                console.log(escapedLines)
                console.log("escaped")

                if(escapedLines == 0){


                    console.log('tttttiitt')
                    console.log('tttttiitt')

                    for(i = 0; i < points.length - 1; i ++){
                      canvas.add(new fabric.Line([points[i].x , points[i].y , points[i+1].x, points[i+1].y], {
                        layerId : activeLayer,
                        strokeWidth: strokeWidth,
                        fill: '#999999',
                        stroke: strokeColor,
                        class:'line',
                        id : 'lineTemp',
                        perPixelTargetFind: true,
                        layerId: activeLayer,
                        originX:'center',
                        originY:'center',
                        selectable: false,
                        hasBorders: false,
                        hasControls: false
                    }));

                  }

              }

                // var polygon = new fabric.Line(points,{
                //     stroke: strokeColor,
                //     strokeWidth: strokeWidth,
                //     fill: 'transparent',
                //     strokeDashArray: [strokedashWidth, strokedashSpace],
                //     layerId: activeLayer,
                //     opacity: opacity,
                //     hasBorders: true,
                //     hasControls: true,
                //     perPixelTargetFind: true,
                //     id: 'polygon'
                // });
                // canvas.add(polygon); 
                groupthem()
                activeLine = null;
                updateCanvasState()
                activeShape = null;
                polygonMode = false;
                canvas.selection = true;

                $('#modeToggler').children('img').attr('src', 'icons/line.svg');  $('#modeToggler').children('img').attr('title', '직선'); $('#modeToggler').children('img').attr('alt', '직선');

                console.log("aaa1")
            }
        };


        fabric.LineArrow = fabric.util.createClass(fabric.Line, {

            type: 'lineArrow',


            initialize: function(element, options) {
                options || (options = {});
                this.callSuper('initialize', element, options);
            },

            toObject: function() {
                return fabric.util.object.extend(this.callSuper('toObject'),{
                    layerId: this.layerId,
                    id: this.id,
                    selectable: this.selectable
                });
            },

            _render: function(ctx) {
                this.callSuper('_render', ctx);

  // do not render if width/height are zeros or object is not visible
  if (this.width === 0 || this.height === 0 || !this.visible) return;
  
  ctx.save();
  
  strokeWidth = parseInt($("#arrow-width").val());
  
  var xDiff = this.x2 - this.x1;
  var yDiff = this.y2 - this.y1;
  var angle = Math.atan2(yDiff, xDiff);
  ctx.translate((this.x2 - this.x1) / 2, (this.y2 - this.y1) / 2);
  ctx.rotate(angle);
  ctx.beginPath();
  //move 10px in front of line to start the arrow so it does not have the square line end showing in front (0,0)
  ctx.moveTo(5, 0);
  ctx.lineTo(-20, strokeWidth);
  ctx.lineTo(-20, -strokeWidth);
  ctx.closePath();
  ctx.fillStyle = this.stroke;
  ctx.fill();
  
  ctx.restore();
  
}
});

        fabric.LineArrow.fromObject = function(object, callback) {
            callback && callback(new fabric.LineArrow([object.x1, object.y1, object.x2, object.y2], object));
        };

        fabric.LineArrow.async = true;


        var Arrow = (function() {

            function Arrow(canvas) {
               this.canvas = canvas;
               this.className = 'Arrow';
               this.isDrawing = false;
               this.bindEvents();
           }

           Arrow.prototype.bindEvents = function() {
               var inst = this;
               inst.canvas.on('mouse:down', function(o) {
                  inst.onMouseDown(o);
              });
               inst.canvas.on('mouse:move', function(o) {
                inst.onMouseMove(o);
            });
               inst.canvas.on('mouse:up', function(o) {
                inst.onMouseUp(o);
            });
               inst.canvas.on('object:moving', function(o) {
                 inst.disable();
             })
           }

           Arrow.prototype.onMouseUp = function(o) {
               var inst = this;
               inst.disable();
           };

           Arrow.prototype.onMouseMove = function(o) {
               var inst = this;
               if (!inst.isEnable()) {
                  return;
              }

              var pointer = inst.canvas.getPointer(o.e);
              var activeObj = inst.canvas.getActiveObject();
              activeObj.set({
                  x2: pointer.x,
                  y2: pointer.y
              });
              activeObj.setCoords();
              inst.canvas.renderAll();
          };


          Arrow.prototype.onMouseDown = function(o) {
           if( selection == 11){
              var inst = this;
              inst.enable();
              var pointer = inst.canvas.getPointer(o.e);

              opacity = parseFloat($("#arrow-opacity").val());
              strokeColor = $("#arrow-color").val();
              strokeWidth = parseInt($("#arrow-width").val());

              strokedashWidth = parseInt($("#polygon-dash-width").val())
              strokedashSpace = parseInt($("#polygon-dash-space").val())



              var points = [pointer.x, pointer.y, pointer.x, pointer.y];
              var line = new fabric.LineArrow(points, {
                 strokeWidth: strokeWidth,
                 opacity: opacity,
                 stroke: strokeColor,
                 strokeDashArray: [strokedashWidth, strokedashSpace],
                 originX: 'center',
                 originY: 'center',
                 layerId: activeLayer,
                 id: "arrow",
                 perPixelTargetFind: true,
                 padding: 20
             });

              line.layerId = activeLayer
              line.id = "Arrow"
              line.selectable = true

              inst.canvas.add(line).setActiveObject(line);
          }
      };

      Arrow.prototype.isEnable = function() {
       return this.isDrawing;
   }

   Arrow.prototype.enable = function() {
       this.isDrawing = true;
   }

   Arrow.prototype.disable = function() {
       this.isDrawing = false;
   }

   return Arrow;
}());

        var arrow = new Arrow(canvas);


        $(document).on('change keyup', '#text-content', function() { 

           if($(this).val() != ''){
              $('#text-content').html($(this).val());
              console.log("runug")
          }
          console.log($(this).val())

   //  $("#text").trigger('click')

});

        $(document).on('change keyup', 'input:not([type="file"]):not([type="checkbox"])', function() { 

           if($(this).val() != ''){
              $(this).html($(this).val());
              console.log("runug")
          }
          console.log($(this).val())

   //  $("#text").trigger('click')

});

        $(document).on('dblclick', 'input:not([type="file"]):not([type="checkbox"])', function() { 

           this.select()
           console.log($(this).val())

   //  $("#text").trigger('click')

});


        $('#text-content').focus( function() {
           if($(this).val()=="Note\n"){
              $(this).val("")
          }
      }).blur( function() {
       if($(this).val()==""){
          $(this).val("Note\n")
      }
  });



      $("#toolhide").click(function(event) {

            // if(selectionControl == 1){

            //  console.log('selection1111')

            // }else if(selectionControl == 0){

            //  console.log('selection00')

            // }

            $('#modeToggler').removeClass('hide')

            $('#modeToggler').data('mode', 'selection')

            $("#modeToggler").children('img').attr('src', 'icons/move.svg');

            $("#modeToggler").children('img').attr('title', '켄버스 스크롤(S)'); $("#modeToggler").children('img').attr('alt', '켄버스 스크롤(S)');

            $("#toolbox").toggleClass('hide')

            $("#layers").addClass('hide')



            if(previousSelection == 9 && $("#line-angle").prop('checked') == true){

                previousSelection = 99;

                prototypefabric1.polygon.drawPolygon(); 

            }


            selection = previousSelection





            // objs = canvas.getObjects().map(function(o) {
            //  return o.set('selectable', true);
            // });


            canvas.discardActiveObject()

            canvas.getObjects().forEach(function(obj){
                obj.selectable = false
            });


            canvas.selection = false;

            canvas.skipTargetFind = false; 

            canvas.renderAll()
        });

// $("#multidrawValue").change(function(event) {


//  if(multidrawEnabled == 1)multidrawEnabled = 0
//      else if(multidrawEnabled == 0)multidrawEnabled = 1

//          console.log(multidrawEnabled)

//  });



$("#elfinder-elfinderSearchFromAll").trigger('click')



$("#touchOverlay").addClass('hide')



  // Create a text object. 
  // Does not display it-the canvas doesn't 
  // know about it yet.
  //var text = new fabric.IText('hello world', { left: 100, top: 100 });
  //canvas.add(text);
  
  
  canvas.setBackgroundColor("white", canvas.renderAll.bind(canvas));
  $(".canvas-container").addClass('hide')
  
  canvas.on('selection:created', function(evn) {

    isobjectselected = 0
    $("#touchOverlay").addClass('hide')

})
  canvas.on('selection:cleared', function(evn) {

    isobjectselected = 1
    $("#touchOverlay").removeClass('hide')

})
  canvas.on('object:moving', function(evn) {

    $(".inline-btn").addClass('hide')
    $("div").addClass('pointerEvents')
    canvas.selection = false

})
  canvas.on('object:modified', function(evn) {

    $("div").removeClass('pointerEvents')
})
  
  
  var objectselected = 0
  
  
  
  canvas.on('mouse:down', function(o){

  // if(objectselected == 1){
  //    isobjectselected = 0
  //    $("#touchOverlay").addClass('hide')
  // }
  // if(objectselected == 0){
  //    isobjectselected = 1
  //    $("#touchOverlay").removeClass('hide')
  // }

  console.log(JSON.stringify(o))
  console.log(o)

  // if(!$(".inline-btn").hasClass('hide')){

  //    $(".inline-btn").addClass('hide')

  // }

  console.log("canvzs clicked")
  $(".showbox").removeClass('show')
  
  
})
  
  canvas.on('object:selected', function(o){

    objectselected = 1
    $("#touchOverlay").addClass('hide')

    var activeObj = o.target;
    if(activeObj.id == 'imageObject') {
        activeObj.set({'borderColor':'#87ceeb','cornerColor':'#87ceeb'});
    }


})
  
  canvas.on('object:created', function(o){

    objectselected = 1
    canvas.skipTargetFind = false
    canvas.selection = true



    console.log("aaa1")


})
  canvas.on('object:out', function(o){

    objectselected = 0
    $("#touchOverlay").addClass('hide')


})
  
  $(document).on('mouseover', '.inline-image', function(event) {
    $(".tooltip-own").removeClass('hide')
});
  $(document).on('mouseout', '.inline-image', function(event) {
    $(".tooltip-own").addClass('hide')
});
  
  canvas.on('mouse:up', function(o){  
    objectselected = 0
    $("#touchOverlay").addClass('hide')
})
  
  
  var clicked = false, clickX, clickY;
  var toolboxDrag = 0
  
  // $( "#toolbox" ).draggable({ scroll: false,

  //   containment: "document",

  //   start: function() {
  //       $('#body').addClass('overflow')
  //       toolboxDrag = 1
  //       console.log("Drag start" + toolboxDrag)
  //   },
  //   drag: function() {
  //       $('#body').addClass('overflow')
  //       toolboxDrag = 1
  //       console.log("Drag drag" + toolboxDrag)
  //   },
  //   stop: function() {
  //       $('#body').removeClass('overflow')
  //       toolboxDrag = 0
  //       console.log("Drag stop" + toolboxDrag)
  //   }
  // });
  
//   $( "#liveeditbutton").draggable({ scroll: false,

//     containment: "document",

//     start: function() {
//         $('#body').addClass('overflow')
//         toolboxDrag = 1
//         console.log("Drag start" + toolboxDrag)
//     },
//     drag: function() {
//         $('#body').addClass('overflow')
//         toolboxDrag = 1
//         console.log("Drag drag" + toolboxDrag)
//     },
//     stop: function() {
//         $('#body').removeClass('overflow')
//         toolboxDrag = 0
//         console.log("Drag stop" + toolboxDrag)
//     }
// });




interact('.inline-btn')
.draggable({
    // enable inertial throwing
    inertia: false,
    ignoreFrom: '.gallery-li',
    // keep the element within the area of it's parent
    // restrict: {
    //   restriction: "document",
    //   endOnly: true,
    //   elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
    // },
    // enable autoScroll
    autoScroll: true,

    // call this function on every dragmove event
    onmove: dragMoveListener1,

    onstart: function (event) {
        $('#body').addClass('overflow')
        toolboxDrag = 1
        if($("#submitText").length != 0){
            $("#layerName-" + prevActive).html(inputTempBuffer)
            $('.temp').remove()
        }

        console.log("Drag start" + toolboxDrag)
    },
    // call this function on every dragend event
    onend: function (event) {
        console.log("Drag stop" + toolboxDrag)
        console.log(event)
        $('#body').removeClass('overflow')
        toolboxDrag = 0
    }
});

interact('.bwinPopupd')
.draggable({
    // enable inertial throwing
    inertia: false,
    // keep the element within the area of it's parent
    // restrict: {
    //   restriction: "document",
    //   endOnly: true,
    //   elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
    // },
    // enable autoScroll
    autoScroll: true,

    // call this function on every dragmove event
    onmove: dragMoveListener1,

    onstart: function (event) {
        $('#body').addClass('overflow')
        toolboxDrag = 1
        if($("#submitText").length != 0){
            $("#layerName-" + prevActive).html(inputTempBuffer)
            $('.temp').remove()
        }

        console.log("Drag start" + toolboxDrag)
    },
    // call this function on every dragend event
    onend: function (event) {
        console.log("Drag stop" + toolboxDrag)
        console.log(event)
        $('#body').removeClass('overflow')
        toolboxDrag = 0
    }
});



interact('#toolbox')
.draggable({
    // enable inertial throwing
    inertia: false,
    ignoreFrom: '#layerBody',
    // keep the element within the area of it's parent
    // restrict: {
    //   restriction: "document",
    //   endOnly: true,
    //   elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
    // },
    // enable autoScroll
    autoScroll: true,

    // call this function on every dragmove event
    onmove: dragMoveListener1,

    onstart: function (event) {
        $('#body').addClass('overflow')
        toolboxDrag = 1
        if($("#submitText").length != 0){
            $("#layerName-" + prevActive).html(inputTempBuffer)
            $('.temp').remove()
        }

        console.log("Drag start" + toolboxDrag)
    },
    // call this function on every dragend event
    onend: function (event) {
        console.log("Drag stop" + toolboxDrag)
        console.log(event)
        $('#body').removeClass('overflow')
        toolboxDrag = 0
    }
});

function dragMoveListener1 (event) {

   console.log("Drag moving" + toolboxDrag)
   console.log(event)
   var target = event.target,
  // keep the dragged position in the data-x/data-y attributes
  x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
  y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

  // translate the element
  target.style.webkitTransform = target.style.transform
  = 'translate(' + x + 'px, ' + y + 'px)';
  // update the posiion attributes
  target.setAttribute('data-x', x);
  $('#body').addClass('overflow')
  toolboxDrag = target.setAttribute('data-y', y);


}





interact('#layers')
.draggable({
    // enable inertial throwing
    inertia: false,
    ignoreFrom: '#layerBody',
    // keep the element within the area of it's parent
    // restrict: {
    //   restriction: "document",
    //   endOnly: true,
    //   elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
    // },
    // enable autoScroll
    autoScroll: true,

    // call this function on every dragmove event
    onmove: dragMoveListener,

    onstart: function (event) {
        $('#body').addClass('overflow')
        toolboxDrag = 1
        if($("#submitText").length != 0){
            $("#layerName-" + prevActive).html(inputTempBuffer)
            $('.temp').remove()
        }

        console.log("Drag start" + toolboxDrag)
    },
    // call this function on every dragend event
    onend: function (event) {
        $('#body').removeClass('overflow')
        toolboxDrag = 0
    }
});

function dragMoveListener (event) {
   var target = event.target,
  // keep the dragged position in the data-x/data-y attributes
  x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
  y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

  // translate the element
  target.style.webkitTransform = target.style.transform
  = 'translate(' + x + 'px, ' + y + 'px)';
  // update the posiion attributes
  target.setAttribute('data-x', x);
  $('#body').addClass('overflow')
  toolboxDrag = target.setAttribute('data-y', y);


}

//   // this is used later in the resizing and gesture demos
//   window.dragMoveListener = dragMoveListener;



if(!$("#layerSection").has("hide")){
    pausePanning = true
    console.log("aaa1")
}


$("#toolbox").mousedown(function(event) {
    toolboxDrag = 1
    console.log("toolboxdrag" + toolboxDrag)
});


canvas.on('object:removed', function(event) {
    toolboxDrag = 0;
    canvas.selection = false
});


$(document).on({
    'mousemove': function(e) {
        if(toolboxDrag == 0){
            if( selection == 0 && isobjectselected == 1) clicked && updateScrollPos(e); 
        }
    },
    'mousedown': function(e) {

        // e.preventDefault();    

        if(toolboxDrag == 0){
            if( selection == 0 && isobjectselected == 1 ) {clicked = true;
                clickX = e.pageX;
                clickY = e.pageY;
            }
        }
    },
    'mouseup': function() {
        if(toolboxDrag == 0){
            if( selection == 0 && isobjectselected == 1 ) {
                clicked = false;
                $('html').css('cursor', 'auto');
            }
        }
    }
});

function updateScrollPos(e) {
  // $('html').css('cursor', 'grabbing');
  // $(window).scrollLeft($(window).scrollLeft() + (clickX - e.pageX));
  // $(window).scrollTop($(window).scrollTop() + (clickY - e.pageY));
  
  // console.log("Left: " + $(window).scrollLeft() + (clickX - e.pageX))
  // console.log("Top: " + $(window).scrollTop() + (clickY - e.pageY))
}



var line, isDown,objs;

$("#selection").click( function(){

    if(selection == 4 && polygonCreated == 0){

       escaped = 1
       // prototypefabric.polygon.generatePolygon(pointArray);


   }

   deleteON = 0

   selection = 0;
   escaped = 0
   pausePanning = false
   canvas.skipTargetFind = false;
// canvas.selection = true

canvas.allowTouchScrolling = true

created = 0

isobjectselected = 1

console.log("aaa1")
canvas.discardActiveObject()
canvas.isDrawingMode= 0;
canvas.renderAll()

$("#toolbox").addClass('hide')

$("#toolbox").css('transform', 'translate(0px, 0px)');
$("#toolbox").attr('data-x', 0);
$("#toolbox").attr('data-y', 0);

$(".bwinPopupd").addClass('hide')

$(".bwinPopupd").css('transform', 'translate(0px, 0px)');
$(".bwinPopupd").attr('data-x', 0);
$(".bwinPopupd").attr('data-y', 0);


$("#layers").addClass('hide')

$("#layers").css('transform', 'translate(0px, 0px)');
$("#layers").attr('data-x', 0);
$("#layers").attr('data-y', 0);


if(editON == 1){
    objs = canvas.getObjects().map(function(o) {
        console.log(o)

        o.editable = true

        return o.set('selectable', true);
    });}

    objs = canvas.getObjects().map(function(o) {
       if(o.id=='imageObject'){
          o.set('selectable', true);

      }
  });

    $("#touchOverlay").removeClass('hide')


  //canvas.selection = true;
  
  $(".tool-options").hide();
  
  $('.highlight').removeClass('highlight');
  
  $('.selectedTool').removeClass("selectedTool")
  $('.editingTool').removeClass("editingTool")
  $(this).addClass("highlight")
  
  
});


$("#saveCanvas").click( function(){           if(selection == 4 && polygonCreated == 0){

    escaped = 1
    prototypefabric.polygon.generatePolygon(pointArray);

}

selection = 0;
escaped = 0
canvas.isDrawingMode= 0;


objs = canvas.getObjects().map(function(o) {
    console.log(o)
    o.editable = true
    return o.set('selectable', true);
});

objs = canvas.getObjects().map(function(o) {
    if(o.id=='imageObject'){
        o.set('selectable', false);

    }
});



canvas.selection = false;

$(".tool-options").hide();

  //$('.highlight').removeClass('highlight');
  
  $('.selectedTool').removeClass("selectedTool")
  $('.editingTool').removeClass("editingTool")
  
  
  
});

var deleteON = 0

$("#delete").click( function(){           

    if(selection ==4 ){
        escaped = 1

        prototypefabric.polygon.generatePolygon(pointArray);

    }


    deleteON = 1

    canvas.discardActiveObject();
    canvas.renderAll();


    escaped = 0
    $("#toolbox").addClass('hide')

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);


    $("#layers").addClass('hide')

    $("#layers").css('transform', 'translate(0px, 0px)');
    $("#layers").attr('data-x', 0);
    $("#layers").attr('data-y', 0);

    canvas.selection = true;



    console.log("aaa1")

    pausePanning = true


    previousSelection = -1;
    canvas.isDrawingMode= 0;
    objs = canvas.getObjects().map(function(o) {
        o.editable = true
        return o.set('selectable', true);
    });







    $(".tool-options").hide();


  //canvas.discardActiveObject();
  //canvas.renderAll();
  
  //$("#toolbox").hide();
  
  $('.highlight').removeClass('highlight');
  
  $('.editingTool').removeClass("editingTool")
  $('.selectedTool').removeClass("selectedTool")
  $(this).addClass("highlight")
  
});




$("#imageEye").click(function(event) {

  if (!$('#imageEye').hasClass('deactive')){


     if($('#imageObject-modal').find(".checkedBox").prop('checked')){

        $("#imageObject-action").click()

    }else{


        $("#imageObject-modal").removeClass('close')

    }


}else{

}
});


$("#imageObject-action").click( function(){ 

  $("#imageObject-modal").addClass('close') 


  if(selection == 20){
     selection = 0;
    //$('.highlight').removeClass('highlight');

    $('.selectedTool').removeClass("selectedTool")
    $('.editingTool').removeClass("editingTool")


}else{

    selection = 20;


    $("#layerSection").addClass('hide')
    $("#liveeditbutton").addClass('hide')
    $("#toolbox").addClass('hide');

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);


    $("#layers").css('transform', 'translate(0px, 0px)');
    $("#layers").attr('data-x', 0);
    $("#layers").attr('data-y', 0);
    $("#layers").addClass('hide')
    $(".mainNav").addClass('hide')
    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }

    $(this).toggleClass('highlight');

    $(".showbox").removeClass('show')


    if(flag == 1){

        if(selection == 4 ){

            escaped = 1
            prototypefabric.polygon.generatePolygon(pointArray);

        }

        escaped = 0

        canvas.isDrawingMode= 0;

        $("#toolbox").addClass('hide')

        $("#toolbox").css('transform', 'translate(0px, 0px)');
        $("#toolbox").attr('data-x', 0);
        $("#toolbox").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);

        $(".inline-btn").addClass('hide')

        objs = canvas.getObjects().map(function(o) {
            o.editable = false
            return o.set('selectable', false);
        });        canvas.skipTargetFind =true
        canvas.selection = false


        canvas.selection = false;
        $(".tool-options").hide();
        canvas.discardActiveObject();
        canvas.renderAll();

  //$("#toolbox").hide();
  
  $('.highlight').removeClass('highlight');
  
  $('.selectedTool').removeClass("selectedTool")
  $('.editingTool').removeClass("editingTool")
  console.log("dddfdfd")
  $("#imageEye").addClass("highlight")
  
}

}
});
$("#Line").click( function(){
  if(selection ==4 ){
     escaped = 1

     prototypefabric.polygon.generatePolygon(pointArray);

 }

 escaped = 0
 $(".tool-options").show();


 previousSelection = 9;



 canvas.isDrawingMode= 0;
 canvas.discardActiveObject();
 canvas.selection = false;

 objs = canvas.getObjects().map(function(o) {
     console.log(o)
     o.editable = false
     return o.set('selectable', false);
 });        canvas.skipTargetFind =true
 canvas.selection = false

 canvas.renderAll()
 $(".tool").addClass("hide");
 $(".tool-line").removeClass('hide');
 $('.selectedTool').removeClass("selectedTool")
 $('.editingTool').removeClass("editingTool")
 $('.highlight').removeClass("highlight")
 $(this).addClass("selectedTool")
});

$("#point").click( function(){
 if(selection ==4 ){


    prototypefabric.polygon.generatePolygon(pointArray);

}

previousSelection = 2;




objs = canvas.getObjects().map(function(o) {
    o.editable = false
    return o.set('selectable', false);
});        canvas.skipTargetFind =true
canvas.selection = false

$(".tool-options").show();
canvas.selection = false;
canvas.isDrawingMode= 0;
canvas.discardActiveObject();
canvas.renderAll()

$('.editingTool').removeClass("editingTool")
$('.selectedTool').removeClass("selectedTool")
$('.highlight').removeClass("highlight")
$(this).addClass("selectedTool")

$(".tool").addClass("hide");
$(".tool-point").removeClass('hide');

});

$("#text").click( function(){ 
    if(selection ==4 ){

       escaped = 1
       prototypefabric.polygon.generatePolygon(pointArray);

   }

   escaped = 0

   $('#text-content').empty().append("Note\n");
   $("#text-content").val('Note\n');
   $(".tool-options").show();
   previousSelection = 1;canvas.isDrawingMode= 0;
   canvas.discardActiveObject();
   canvas.selection = false;
   $('.editingTool').removeClass("editingTool")
   $('.selectedTool').removeClass("selectedTool")
   $(this).addClass("selectedTool")
   $('.highlight').removeClass("highlight")
   objs = canvas.getObjects().map(function(o) {
       o.editable = false
       console.log(o)
       return o.set('selectable', false);
   });        canvas.skipTargetFind =true
   canvas.selection = false


   $(".tool").addClass("hide");
   $(".tool-text").removeClass('hide');
   canvas.renderAll()});

$("#textbox").click( function(){ 
   if(selection ==4 ){

      escaped = 1
      prototypefabric.polygon.generatePolygon(pointArray);

  }
  escaped = 0
  $(".tool-options").show();

  previousSelection = 14;canvas.isDrawingMode= 0;
  canvas.discardActiveObject();
  canvas.selection = false;
  $('.editingTool').removeClass("editingTool")
  $('.selectedTool').removeClass("selectedTool")
  $(this).addClass("selectedTool")
  $('.highlight').removeClass("highlight")
  objs = canvas.getObjects().map(function(o) {
      o.editable = false
      console.log(o)
      return o.set('selectable', false);
  });        canvas.skipTargetFind =true
  canvas.selection = false


  $(".tool").addClass("hide");
  $(".tool-textbox").removeClass('hide');
  canvas.renderAll()});

$("#polyline").click( function(){
  if(selection ==4 ){

     escaped = 1
     prototypefabric.polygon.generatePolygon(pointArray);

 }
 escaped = 0
 previousSelection = 4;canvas.isDrawingMode= 0;
 canvas.discardActiveObject(); 
 canvas.selection = false;
 prototypefabric.polygon.drawPolygon(); 
 $('.editingTool').removeClass("editingTool")
 $('.selectedTool').removeClass("selectedTool")
 $(this).addClass("selectedTool")
 $('.highlight').removeClass("highlight")
 objs = canvas.getObjects().map(function(o) {
     o.editable = false
     console.log(o)
     return o.set('selectable', false);
 });        canvas.skipTargetFind =true
 canvas.selection = false





 $(".tool-options").show();
 $(".tool").addClass("hide");
 $(".tool-polygon").removeClass('hide');


 canvas.renderAll()
});
$("#triangle").click( function(){

 canvas.selection = false;
 $('.editingTool').removeClass("editingTool")
 $('.selectedTool').removeClass("selectedTool")
 $(this).addClass("selectedTool")
 $('.highlight').removeClass("highlight")
 if(selection ==4 ){


    prototypefabric.polygon.generatePolygon(pointArray);

}
previousSelection = 6;
canvas.discardActiveObject();
objs = canvas.getObjects().map(function(o) {
    o.editable = false
    console.log(o)
    return o.set('selectable', false);
});        canvas.skipTargetFind =true
canvas.selection = false

canvas.renderAll()
$(".tool-options").show();
canvas.isDrawingMode= 0;
$(".tool").addClass("hide");
$(".tool-triangle").removeClass('hide');
});
$("#rectangle").click( function(){            if(selection ==4 ){

    escaped = 1
    prototypefabric.polygon.generatePolygon(pointArray);

} previousSelection = 7;canvas.isDrawingMode= 0;
escaped = 0
canvas.discardActiveObject();
canvas.renderAll();
canvas.selection = false;
objs = canvas.getObjects().map(function(o) {
    o.editable = false
    console.log(o)
    return o.set('selectable', false);
});        canvas.skipTargetFind =true
canvas.selection = false

$('.editingTool').removeClass("editingTool")
$('.selectedTool').removeClass("selectedTool")
$(this).addClass("selectedTool")
$('.highlight').removeClass("highlight")
$(".tool-options").show();
$(".tool").addClass("hide");
$(".tool-rectangle").removeClass('hide');
});
$("#ellipse").click( function(){          if(selection ==4 ){


    prototypefabric.polygon.generatePolygon(pointArray);

}previousSelection = 8;canvas.isDrawingMode= 0;
canvas.selection = false;
canvas.discardActiveObject();
canvas.renderAll();
$('.editingTool').removeClass("editingTool")
$('.selectedTool').removeClass("selectedTool")
$(this).addClass("selectedTool")
$('.highlight').removeClass("highlight")
$(".tool").addClass("hide");
objs = canvas.getObjects().map(function(o) {
    o.editable = false
    console.log(o)
    return o.set('selectable', false);
});        canvas.skipTargetFind =true
canvas.selection = false

$(".tool-options").show();
$(".tool-ellipse").removeClass('hide');
});


$("#circle").click( function(){

    if(selection ==4 ){

       escaped = 1
       prototypefabric.polygon.generatePolygon(pointArray);

   }

   escaped = 0

   previousSelection = 3; 


   $("#touchOverlay").addClass('hide')
   canvas.isDrawingMode= 0;
   canvas.selection = false;
   $('.selectedTool').removeClass("selectedTool")
   $('.editingTool').removeClass("editingTool")
   $('#circle').addClass("selectedTool")
   canvas.discardActiveObject();
   canvas.renderAll()
   objs = canvas.getObjects().map(function(o) {
       o.editable = false
       console.log(o)
       return o.set('selectable', false);
   });
   $('.highlight').removeClass("highlight")
   $(".tool").addClass("hide");
   $(".tool-options").show();
   $(".tool-circle").removeClass('hide');

   canvas.skipTargetFind =true
   canvas.selection = false

   console.log("circle clicked")
   previousSelection = 3
   console.log(selection)
});
$("#arrow").click( function(){            if(selection ==4 ){

   escaped = 1
   prototypefabric.polygon.generatePolygon(pointArray);

}
escaped = 0
$(".tool-options").show();
previousSelection = 11; 
canvas.isDrawingMode= 0;
canvas.selection = false;
$('.editingTool').removeClass("editingTool")
$('.selectedTool').removeClass("selectedTool")
$(this).addClass("selectedTool")
canvas.discardActiveObject();
canvas.renderAll()
$(".tool").addClass("hide");
$('.highlight').removeClass("highlight")      
objs = canvas.getObjects().map(function(o) {
   o.editable = false
   console.log(o)
   return o.set('selectable', false);
});
canvas.skipTargetFind =true
canvas.selection = false

$(".tool-arrow").removeClass('hide');

});
$("#free").click( function(){ 
   if(selection ==4 ){
      escaped = 1

      prototypefabric.polygon.generatePolygon(pointArray);

  }
  escaped = 0
  previousSelection = 5;
  canvas.isDrawingMode= 0;

  canvas.discardActiveObject();
  canvas.renderAll()
  canvas.isDrawingMode= 1;

  canvas.freeDrawingBrush.color = $("#free-color").val()
  canvas.freeDrawingBrush.width = parseInt($("#free-width").val());
  canvas.freeDrawingBrush.opacity = parseFloat($("#free-opacity").val());



  canvas.skipTargetFind = true
  canvas.selection = false

  $('.editingTool').removeClass("editingTool")
  $('.selectedTool').removeClass("selectedTool")
  $(this).addClass("selectedTool")
  $(".tool-options").show();
  $('.highlight').removeClass("highlight")
  canvas.renderAll()
  objs = canvas.getObjects().map(function(o) {
      o.editable = false
      console.log(o)
      return o.set('selectable', false);
  });


  $(".tool").addClass("hide");
  $(".tool-free").removeClass('hide');
});

var src
$(document).on("mousedown", function (event) {
  var a = event.target

  src = $(".slick-active img").attr('src')

});

  // $(document).on('click', '.custom-file-input', function(){
  //    jQuery('.category').addClass('inactive').addClass('hide')
  //    console.log("change")
  //    jQuery('.category:first').addClass('active').removeClass('inactive').removeClass('hide')
  // })
  $(document).on('change', '.custom-file-input', function() {

    $('.categories').append('<div class="loaderSmall anim"><div class="spinnerSmall"></div></div>')


    $('.inline-image').hide()

    var fileExtension = ['jpg', 'png', 'jpeg'];
    if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
        $('.inline-image').show()
        $('.loaderSmall').remove()

        $("#jpgpngonly-modal").removeClass('close')
    }else{


        console.log($(this).attr("data-id"))
        console.log(imageObjectCount)


        console.log("change")


        imagesPreview(this, $(this).attr("data-id") );


    }
});
  
  
  
  
  
  
  
  
  
  // canvas.on('mouse:dblclick', function(o) {

  //     if(o.target && o.target.get("id") == 'imageObject'){
  //                $("#selection").trigger('click');
  //                var redirectWindow = window.open(o.target.get("address"), '_blank');
  //                    redirectWindow.location;
  
  
  //    }
  
  // })
  
  var data = 0;
  
  
  canvas.on('selection:cleared', function(evn) {
    $("#selection").trigger('click')
    console.log("seletcion clears")
    data = 0

})
  
  
  canvas.on('object:selected', function(evn) {




    canvas.bringToFront(evn.target);


    $(".inline-btn").addClass('hide')

    for(i = 1; i <= canvas.getObjects().length; i++){

                //item = canvas.getItem("imageObject")
                object = canvas.item(i-1)

                type = object.get("id")

                if( type == 'imageObject'){
                    canvas.bringToFront(object);
                }
            }


        })
  
  var selectedObject, selectedObjectID, selectionControl = 0

  canvas.on('selection:cleared', function(evn) {
    selectedObject = null;
    selectionControl = 0
    selectedObjectID = null
})





  var imageEye__deleting = 0
  var target__delete = 0


  $("#imageEyeDeleting-action").click(function(event) {

    $("#imageEyeDeleting-modal").addClass('close')


    jQuery.ajax({
        contentType: false,
        cache: false,
        processData: false,
        url: 'file:///android_assets/views/phppages/allProjectController.php?deleteEyeImage=deleteEyeImage&layerCount=' + target__delete.layerCount + '&filelocation=' + getFile.url + '&activeLayer=' + activeLayer,
        success: function (result) {

            imageAction = 1

            canvas.remove(target__delete)

            $("#layeraction-" + activeLayer + " .saveLayer").click()

            result = JSON.parse(result)

            console.log(result)

            $("#inline-btn-" + target__delete.layerCount + activeLayer).remove()
        }
    })


    // window.location.href = '#/app/ViewProjectDetails';
});


  var textSelection = function(evn){

  }
  var objectSelection = function(evn){


    data = 1
    selectionControl = 1


    $("#toolhide").addClass('hide')
    $(".toolhide").addClass('hide')



    if(deleteON == 1){



        console.log(evn.target.id)

        if(evn.target.id == 'imageObject'){

            console.log(evn.target.layerCount)

            imageEye__deleting = evn.target.layerCount

            if( allitems[activeLayer][imageEye__deleting].length != 0 ){

                target__delete = evn.target

                $("#imageEyeDeleting-modal").removeClass('close')

            }else{




                canvas.remove(evn.target);
                canvas.selection = false;
                console.log("removeAll")
                canvas.renderAll()

                deleteON = 0


                $("#inline-btn-" + target__delete.layerCount + activeLayer).remove()

                target__delete = 0

                imageEye__deleting = 0


            }


        }else{



            canvas.remove(evn.target);

            canvas.selection = false;
            console.log("removeAll")
            canvas.renderAll()

            deleteON = 0

        }






    }else{


        console.log("selected")
        if(evn.target && selectionControl == 1 ){

            selectedObject = evn.target;

            selectedObjectID = selectedObject.get('id')
            if(selectedObjectID === 'text'){
                $(".editingTool").removeClass('editingTool');
                $("#text").addClass('editingTool');

                $(".tool").addClass("hide");
                $(".tool-text").removeClass('hide');

                $("#text-opacity").val(selectedObject.get('opacity'));
                $("#text-content").val(selectedObject.get('text'));
                $("#text-font").val(selectedObject.get('fontSize'));
                $("#text-backgroundopacity").val(selectedObject.get('backgroundopacity'));
                $("#text-color").spectrum("set", selectedObject.get('fill'));
                $("#text-backgroundcolor").spectrum("set", selectedObject.get('backgroundColor'));



                $(document).on('change', '#text-opacity', function() {
                    if(selectionControl == 1){
                        rgbatext = convertHex(selectedObject.get('originalcolor'), parseFloat($('#text-opacity').val()) )

                        console.log(rgbatext)
                        selectedObject.set('fill', rgbatext)    
                        updateCanvasState()
                        canvas.renderAll();
                    }
                });

                $(document).on('change', '#text-backgroundopacity', function() {
                    if(selectionControl == 1){
                        rgba = convertHex(selectedObject.get('originalbg'), parseFloat($('#text-backgroundopacity').val()) )

                        console.log(rgba)

                        selectedObject.set('backgroundColor', rgba) 
                        updateCanvasState()
                        canvas.renderAll();
                    }
                });
                $(document).on('change keyup', '#text-content', function() { 
                    if(selectionControl == 1){
                        if( data == 1){
                            selectedObject.set('text', $('#text-content').val())
                            updateCanvasState() 
                            canvas.renderAll();
                        }
                    }
                });
                $(document).on('change', '#text-font', function() { 
                    if(selectionControl == 1){
                        selectedObject.set('fontSize', $('#text-font').val())
                        updateCanvasState() 
                        canvas.renderAll();
                    }
                });
                $(document).on('change', '#text-color', function() {  
                    if(selectionControl == 1){
                        selectedObject.set('fill', $('#text-color').val())  
                        selectedObject.set('originalcolor', $('#text-color').val()) 
                        updateCanvasState()
                        canvas.renderAll();
                    }
                });
                $(document).on('change', '#text-backgroundcolor', function() { 
                    if(selectionControl == 1){
                        selectedObject.set('backgroundColor', $('#text-backgroundcolor').val()) 
                        selectedObject.set('originalbg', $('#text-backgroundcolor').val())      
                        updateCanvasState()
                        canvas.renderAll();
                    }
                });
            }
        }

        console.log("object is selected ererere")

        $(".highlight").removeClass('highlight')

        if($("#submitText").length != 0){
            $("#layerName-" + prevActive).html(inputTempBuffer)
            $('.temp').remove()
        }

        $(".showbox").removeClass('show')


        selectionControl = 1


        if (evn.target) {

            console.log(evn.target)

            $(".tool-options").show();
    //$("#toolbox").css('display', 'block');

    selectedObject = evn.target;
    selectedObjectID = selectedObject.get('id')

    $('.highlight').removeClass("highlight")

    if(selectedObjectID === 'triangle'){
        $(".editingTool").removeClass('editingTool');
        $("#triangle").addClass('editingTool');

        $(".tool").addClass("hide");
        $(".tool-triangle").removeClass('hide');
    //selection = 6;
    //$("#triangle").trigger('click');

    $("#triangle-opacity").val(selectedObject.get('opacity'));
    $("#triangle-stroke-width").val(selectedObject.get('strokeWidth'));
    $("#triangle-stroke-color").spectrum("set", selectedObject.get('stroke'));
    $("#triangle-color").spectrum("set", selectedObject.get('fill'));

    $(document).on('change', '#triangle-opacity', function() {
        selectedObject.set('opacity', parseFloat($('#triangle-opacity').val())) 
        updateCanvasState() 
        canvas.renderAll();
    });
    $(document).on('change', '#triangle-stroke-width', function() { 
        console.log("sgtoreke") 
        selectedObject.set('strokeWidth', parseInt($('#triangle-stroke-width').val()))  
        updateCanvasState() 
        canvas.renderAll();
    });
    $(document).on('change', '#triangle-stroke-color', function() { 
        selectedObject.set('stroke', $('#triangle-stroke-color').val())     
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change', '#triangle-color', function() {  
        selectedObject.set('fill', $('#triangle-color').val())      
        updateCanvasState()
        canvas.renderAll();
    });
}
if(selectedObjectID === 'polygon'){
    $(".editingTool").removeClass('editingTool');
    $("#polyline").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-polygon").removeClass('hide');

    strokedash = selectedObject.get('strokeDashArray')
    strokedashWidth = strokedash[0]
    strokedashSpace = strokedash[1]

    //selection = 6;
    //$("#triangle").trigger('click');

    $("#polygon-opacity").val(selectedObject.get('opacity'));
    $("#polygon-stroke-width").val(selectedObject.get('strokeWidth'));
    $("#polygon-stroke-color").spectrum("set", selectedObject.get('stroke'));
    $("#polygon-color").spectrum("set", selectedObject.get('fill'));

    $("#polygon-dash-width").val(strokedashWidth);
    $("#polygon-dash-space").val(strokedashSpace);

    $(document).on('change', '#polygon-dash-width', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeDashArray', [parseFloat($('#polygon-dash-width').val()),parseFloat($('#polygon-dash-space').val())])  
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#polygon-dash-space', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeDashArray', [parseFloat($('#polygon-dash-width').val()),parseFloat($('#polygon-dash-space').val())])      
            updateCanvasState() 
            canvas.renderAll();
        }
    });


    $(document).on('change', '#polygon-opacity', function() {
        if(selectionControl == 1){
            selectedObject.set('opacity', parseFloat($('#polygon-opacity').val()))      
            updateCanvasState()
            canvas.renderAll();
        }
    });
    $(document).on('change', '#polygon-stroke-width', function() {  
        if(selectionControl == 1){
            selectedObject.set('strokeWidth', parseInt($('#polygon-stroke-width').val()))   
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#polygon-stroke-color', function() { 
        if(selectionControl == 1){
            selectedObject.set('stroke', $('#polygon-stroke-color').val())      
            updateCanvasState()
            canvas.renderAll();
        }
    });
    $(document).on('change', '#polygon-color', function() {  
        if(selectionControl == 1){
            selectedObject.set('fill', $('#polygon-color').val())       
            updateCanvasState()
            canvas.renderAll();
        }
    });
}
if(selectedObjectID === 'point'){

    $(".editingTool").removeClass('editingTool');
    $("#point").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-point").removeClass('hide');

    $("#point-size").val(selectedObject.get('radius'));
    $("#point-opacity").val(selectedObject.get('opacity'));
    $("#point-stroke-width").val(selectedObject.get('strokeWidth'));
    $("#point-stroke-color").spectrum("set", selectedObject.get('stroke'));
    $("#point-color").spectrum("set", selectedObject.get('fill'));

    $(document).on('change', '#point-size', function() {
        selectedObject.set('radius', parseInt($('#point-size').val()))  
        updateCanvasState() 
        canvas.renderAll();
    });
    $(document).on('change', '#point-opacity', function() {
        selectedObject.set('opacity', parseFloat($('#point-opacity').val()))    
        updateCanvasState() 
        canvas.renderAll();
    });
    $(document).on('change', '#point-stroke-width', function() {  
        selectedObject.set('strokeWidth', parseInt($('#point-stroke-width').val()))     
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change', '#point-stroke-color', function() { 
        selectedObject.set('stroke', $('#point-stroke-color').val())    
        updateCanvasState() 
        canvas.renderAll();
    });
    $(document).on('change', '#point-color', function() {  
        selectedObject.set('fill', $('#point-color').val())     
        updateCanvasState()
        canvas.renderAll();
    });
}
if(selectedObjectID === 'line'){

    $(".editingTool").removeClass('editingTool');
    $("#Line").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-line").removeClass('hide');

    $("#line-opacity").val(selectedObject.get('opacity'));
    $("#line-stroke-width").val(selectedObject.get('strokeWidth'));
    $("#line-stroke-color").spectrum("set", selectedObject.get('stroke'));
    $("#line-color").spectrum("set", selectedObject.get('fill'));

    $(document).on('change', '#line-opacity', function() {
        if(selectionControl == 1){
            selectedObject.set('opacity', parseFloat($('#line-opacity').val()))     
            updateCanvasState()
            canvas.renderAll();
        }
    });
    $(document).on('change', '#line-stroke-width', function() { 

        if(selectionControl == 1){
            selectedObject.set('strokeWidth', parseInt($('#line-stroke-width').val()))      
            updateCanvasState()
            canvas.renderAll();
        }
    });
    $(document).on('change', '#line-stroke-color', function() { 
        if(selectionControl == 1){
            selectedObject.set('stroke', $('#line-stroke-color').val()) 
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#line-color', function() { 
        if(selectionControl == 1){ 
            selectedObject.set('fill', $('#line-color').val())      
            updateCanvasState()
            canvas.renderAll();
        }
    });
}
if(selectedObjectID === 'angle'){

    $(".editingTool").removeClass('editingTool');
    $("#Line").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-line").removeClass('hide');
    
    var items = canvas.getActiveObject()._objects;

    console.log(items)

    $("#line-opacity").val(items[0].get('opacity'));
    $("#line-stroke-width").val(items[0].get('strokeWidth'));
    $("#line-stroke-color").spectrum("set", items[0].get('stroke'));
    $("#line-color").spectrum("set", items[0].get('fill'));
    

    $(document).on('change', '#line-opacity', function() {
        if(selectionControl == 1){


            for (var i = 0; i < canvas.getActiveObject()._objects.length; i++) {
                console.log(canvas.getActiveObject()._objects[i])
                canvas.getActiveObject()._objects[i].set('opacity', parseFloat($('#line-opacity').val()))     
                updateCanvasState()
                canvas.renderAll();
            }




        }
    });
    $(document).on('change', '#line-stroke-width', function() { 

        if(selectionControl == 1){

            for (var i = 0; i < canvas.getActiveObject()._objects.length; i++) {
                canvas.getActiveObject()._objects[i].set('strokeWidth', parseInt($('#line-stroke-width').val()))      
                updateCanvasState()
                canvas.renderAll();
            }
        }
    });
    $(document).on('change', '#line-stroke-color', function() { 
        if(selectionControl == 1){
            for (var i = 0; i < canvas.getActiveObject()._objects.length; i++) {
             canvas.getActiveObject()._objects[i].set('stroke', $('#line-stroke-color').val()) 
             updateCanvasState()
             canvas.renderAll();
         }
     }
 });
    $(document).on('change', '#line-color', function() { 
        if(selectionControl == 1){ 
            for (var i = 0; i < canvas.getActiveObject()._objects.length; i++) {    
                canvas.getActiveObject()._objects[i].set('fill', $('#line-color').val())      
                updateCanvasState()
                canvas.renderAll();
            }

        }
    });
}
if(selectedObjectID === 'rectangle'){
    $(".editingTool").removeClass('editingTool');
    $("#rectangle").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-rectangle").removeClass('hide');

    $("#rectangle-opacity").val(selectedObject.get('opacity'));
    $("#rectangle-stroke-width").val(selectedObject.get('strokeWidth'));
    $("#rectangle-stroke-color").spectrum("set", selectedObject.get('stroke'));
    $("#rectangle-color").spectrum("set", selectedObject.get('fill'));


    // $("#rectangle-dash-width").val(strokedashWidth);
    // $("#rectangle-dash-space").val(strokedashSpace);

    $(document).on('change', '#rectangle-dash-width', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeDashArray', [parseFloat($('#rectangle-dash-width').val()),parseFloat($('#rectangle-dash-space').val())])  
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#rectangle-dash-space', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeDashArray', [parseFloat($('#rectangle-dash-width').val()),parseFloat($('#rectangle-dash-space').val())])      
            updateCanvasState() 
            canvas.renderAll();
        }
    });

    $(document).on('change', '#rectangle-opacity', function() {
        if(selectionControl == 1){
            selectedObject.set('opacity', parseFloat($('#rectangle-opacity').val()))    
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#rectangle-stroke-width', function() { 
        if(selectionControl == 1){ 
            selectedObject.set('strokeWidth', parseInt($('#rectangle-stroke-width').val()))     
            updateCanvasState()
            canvas.renderAll();
        }
    });
    $(document).on('change', '#rectangle-stroke-color', function() { 
        if(selectionControl == 1){
            selectedObject.set('stroke', $('#rectangle-stroke-color').val())        
            updateCanvasState()
            canvas.renderAll();
        }
    });
    $(document).on('change', '#rectangle-color', function() {  
        if(selectionControl == 1){
            selectedObject.set('fill', $('#rectangle-color').val()) 
            updateCanvasState() 
            canvas.renderAll();
        }
    });
}
if(selectedObjectID === 'circle'){

    $(".editingTool").removeClass('editingTool');
    $("#circle").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-circle").removeClass('hide');

    $("#circle-opacity").val(selectedObject.get('opacity'));
    $("#circle-stroke-width").val(selectedObject.get('strokeWidth'));
    $("#circle-stroke-color").spectrum("set", selectedObject.get('stroke'));
    $("#circle-color").spectrum("set", selectedObject.get('fill'));

    // $("#circle-dash-width").val(strokedashWidth);
    // $("#circle-dash-space").val(strokedashSpace);

    $(document).on('change', '#circle-dash-width', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeDashArray', [parseFloat($('#circle-dash-width').val()),parseFloat($('#circle-dash-space').val())])  
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#circle-dash-space', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeDashArray', [parseFloat($('#circle-dash-width').val()),parseFloat($('#circle-dash-space').val())])      
            updateCanvasState() 
            canvas.renderAll();
        }
    });

    $(document).on('change', '#circle-opacity', function() {
        if(selectionControl == 1){
            selectedObject.set('opacity', parseFloat($('#circle-opacity').val()))
            updateCanvasState();    
            canvas.renderAll();
        }
    });
    $(document).on('change', '#circle-stroke-width', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeWidth', parseInt($('#circle-stroke-width').val()))    
            updateCanvasState();
            canvas.renderAll();
        }
    });
    $(document).on('change', '#circle-stroke-color', function() { 
        if(selectionControl == 1){
            selectedObject.set('stroke', $('#circle-stroke-color').val())   
            canvas.renderAll();}
        });
    $(document).on('change', '#circle-color', function() { 
        if(selectionControl == 1){ 
            selectedObject.set('fill', $('#circle-color').val())    
            updateCanvasState();
            canvas.renderAll();
        }
    });
}
if(selectedObjectID === 'ellipse'){

    $(".editingTool").removeClass('editingTool');
    $("#ellipse").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-ellipse").removeClass('hide');

    $("#ellipse-opacity").val(selectedObject.get('opacity'));
    $("#ellipse-stroke-width").val(selectedObject.get('strokeWidth'));
    $("#ellipse-stroke-color").spectrum("set", selectedObject.get('stroke'));
    $("#ellipse-color").spectrum("set", selectedObject.get('fill'));

    $(document).on('change', '#ellipse-opacity', function() {
        selectedObject.set('opacity', parseFloat($('#ellipse-opacity').val()))      
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change', '#ellipse-stroke-width', function() { 
        console.log("sgtoreke") 
        selectedObject.set('strokeWidth', parseInt($('#ellipse-stroke-width').val()))   
        updateCanvasState() 
        canvas.renderAll();
    });
    $(document).on('change', '#ellipse-stroke-color', function() { 
        selectedObject.set('stroke', $('#ellipse-stroke-color').val())      
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change', '#ellipse-color', function() {  
        selectedObject.set('fill', $('#ellipse-color').val())   
        updateCanvasState() 
        canvas.renderAll();
    });
}


if(selectedObjectID === 'textbox'){


    $(".editingTool").removeClass('editingTool');
    $(".highlight").removeClass('highlight');
    $("#textbox").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-textbox").removeClass('hide');


    $("#textbox-opacity").val(selectedObject.get('opacity'));
    $("#textbox-content").val(selectedObject.getObjects()[1].get('text'));
    $("#textbox-font").val(selectedObject.getObjects()[1].get('fontSize'));
    $("#textbox-border-width").val(selectedObject.getObjects()[0].get('strokeWidth'));
    $("#textbox-border-opacity").val(selectedObject.getObjects()[0].get('opacity'));
    $("#textbox-border-color").spectrum("set", selectedObject.getObjects()[0].get('stroke'));
    $("#textbox-border-color").spectrum("set", selectedObject.getObjects()[0].get('fill'));

    $("#textbox-color").spectrum("set", selectedObject.getObjects()[1].get('fill'));

    $(document).on('change', '#textbox-opacity', function() {
        selectedObject.getObjects()[1].set('opacity', parseFloat($('#textbox-opacity').val()))      
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change keydown', '#textbox-content', function() { 
        dynamicTextWidth = selectedObject.getObjects()[1].get('dynamicMinWidth')+100;
        selectedObject.getObjects()[0].set('width', dynamicTextWidth)
        selectedObject.set('width', dynamicTextWidth) 


        dynamicTextHeight = selectedObject.getObjects()[1].get('height')+100;
        selectedObject.getObjects()[0].set('height', dynamicTextHeight)
        selectedObject.set('height', dynamicTextHeight)

        selectedObject.getObjects()[1].set('text', $('#textbox-content').val())     
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change', '#textbox-font', function() {
        dynamicTextWidth = selectedObject.getObjects()[1].get('dynamicMinWidth')+100;
        selectedObject.getObjects()[0].set('width', dynamicTextWidth)
        selectedObject.set('width', dynamicTextWidth) 

        dynamicTextHeight = selectedObject.getObjects()[1].get('height')+100;
        selectedObject.getObjects()[0].set('height', dynamicTextHeight)
        selectedObject.set('height', dynamicTextHeight)

        selectedObject.getObjects()[1].set('fontSize', $('#textbox-font').val())    
        updateCanvasState() 
        canvas.renderAll();
    });
    $(document).on('change', '#textbox-border-width', function() { 
        selectedObject.getObjects()[0].set('strokeWidth', $('#textbox-border-width').val())     
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change', '#textbox-border-opacity', function() { 
        selectedObject.getObjects()[0].set('opacity', $('#textbox-border-opacity').val())       
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change', '#textbox-border-color', function() {  
        selectedObject.getObjects()[0].set('stroke', $('#textbox-border-color').val())  
        updateCanvasState() 
        canvas.renderAll();
    });
    $(document).on('change', '#textbox-color', function() {  
        selectedObject.getObjects()[1].set('fill', $('#textbox-color').val())       
        updateCanvasState()
        canvas.renderAll();
    });
    $(document).on('change', '#textbox-backgroundcolor', function() {  
        selectedObject.getObjects()[0].set('fill', $('#textbox-backgroundcolor').val()) 
        updateCanvasState() 
        canvas.renderAll();
    });
}
if(selectedObjectID === 'Arrow'){

    $(".editingTool").removeClass('editingTool');
    $("#arrow").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-arrow").removeClass('hide');

    strokedash = selectedObject.get('strokeDashArray')
    strokedashWidth = strokedash[0]
    strokedashSpace = strokedash[1]

    $("#arrow-opacity").val(selectedObject.get('opacity'));
    $("#arrow-width").val(selectedObject.get('strokeWidth'));
    $("#arrow-dash-width").val(strokedashWidth);
    $("#arrow-dash-space").val(strokedashSpace);
    $("#arrow-color").spectrum("set", selectedObject.get('stroke'));

    $(document).on('change', '#arrow-opacity', function() {
        if(selectionControl == 1){
            selectedObject.set('opacity', parseFloat($('#arrow-opacity').val()))    
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#arrow-width', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeWidth', parseFloat($('#arrow-width').val()))      
            updateCanvasState()
            canvas.renderAll();
        }
    });
    $(document).on('change', '#arrow-dash-width', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeDashArray', [parseFloat($('#arrow-dash-width').val()),parseFloat($('#arrow-dash-space').val())])  
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#arrow-dash-space', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeDashArray', [parseFloat($('#arrow-dash-width').val()),parseFloat($('#arrow-dash-space').val())])      
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#arrow-color', function() {  
        if(selectionControl == 1){
            selectedObject.set('stroke', $('#arrow-color').val())

            updateCanvasState() 
            canvas.renderAll();
        }
    });
}

if(selectedObjectID === 'path' ){

    $(".editingTool").removeClass('editingTool');
    $("#free").addClass('editingTool');

    $(".tool").addClass("hide");
    $(".tool-free").removeClass('hide');

    $("#free-opacity").val(selectedObject.get('opacity'));
    $("#free-width").val(selectedObject.get('strokeWidth'));
    $("#free-color").spectrum("set", selectedObject.get('stroke'));

    $(document).on('change', '#free-opacity', function() {
        if(selectionControl == 1){
            selectedObject.set('opacity', parseFloat($('#free-opacity').val())) 
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#free-width', function() { 
        if(selectionControl == 1){
            selectedObject.set('strokeWidth', parseFloat($('#free-width').val()))   
            updateCanvasState() 
            canvas.renderAll();
        }
    });
    $(document).on('change', '#free-color', function() {  
        if(selectionControl == 1){
            selectedObject.set('stroke', $('#free-color').val())    
            updateCanvasState() 
            canvas.renderAll();
        }
    });
}


if(selectedObjectID === 'imageObject'){
    $(".tool-options").hide();
    $("#toolbox").addClass('hide')

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);

    selectedLayerCount = selectedObject.get('layerCount')
    jQuery('#categories-'+ selectedLayerCount + ' .category:first').addClass('active').removeClass('inactive').removeClass('hide')

    var btn = new Array();



    fabric.Canvas.prototype.getAbsoluteCoords = function(object) {
        return {
            left: object.left + this._offset.left,
            top: object.top + this._offset.top
        };
    }

    for(i = 1 ; i <= selectedLayerCount; i++){

        btn[i] = document.getElementById('inline-btn-' + i   + activeLayer)
    }


    var pointer = canvas.getPointer(evn.e);

    console.log(evn)

    console.log(selectedLayerCount)

    var absCoords = canvas.getAbsoluteCoords(selectedObject);


    if(isMobile == 1 || is_touch_device() == true){


        if(evn.e.type=="mousedown"){

            if(btn[selectedLayerCount]){

              btn[selectedLayerCount].style.left = (evn.e.clientX + 25) + 'px';
              btn[selectedLayerCount].style.top = (evn.e.clientY + 25) + 'px';

          }


      }else{

        if(btn[selectedLayerCount]){

            btn[selectedLayerCount].style.left = (evn.e.changedTouches["0"].clientX + 25) + 'px';
            btn[selectedLayerCount].style.top = (evn.e.changedTouches["0"].clientY + 25) + 'px';

        }

    }

}
else{

    if(btn[selectedLayerCount]){

        btn[selectedLayerCount].style.left = (evn.e.clientX + 25) + 'px';
        btn[selectedLayerCount].style.top = (evn.e.clientY + 25) + 'px';
        
    }

}

        // prevX = evn.e.pageZ
        // prevY = evn.e.clientY

        // console.log(btn[selectedLayerCount].style.left , btn[selectedLayerCount].style.top)
        console.log(absCoords.left , absCoords.top)



        if($("#gallery-li-"+ selectedLayerCount  + activeLayer + " .slick-track div").length == 0){
            $('#gallery-'+ selectedLayerCount + activeLayer + '.slick-initialized').slick("unslick");
            console.log("image object clicked")
            $("#inline-btn-" + selectedLayerCount + activeLayer + " .slickButton").addClass('hide')
        }


    //$("#inline-btn").addClass('hide');

    // selectedObject.on('moving', function() { for(i = 1 ; i <= selectedLayerCount; i++){ positionBtn(selectedObject,i) }});
    // selectedObject.on('scaling', function() { for(i = 1 ; i <= selectedLayerCount; i++){ positionBtn(selectedObject,i) }});
    //for(i = 1 ; i <= selectedLayerCount; i++){ positionBtn(selectedObject,i)};



    if($("#inline-btn-" + selectedLayerCount   + activeLayer).hasClass('hide')){

        $(".inline-btn").addClass('hide');

        console.log("upper")

        $('.inline-image').show()
        $('.loaderSmall').remove()


        $("#inline-btn-" + selectedLayerCount   + activeLayer).removeClass('hide');


        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);
        $("#layers").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);

        $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')
        $("#liveeditbutton").addClass('hide')

    }
    else{
       objs = canvas.getObjects().map(function(o) {
          console.log("jjjjjjj")

          if(o.id == 'imageObject'){
             o.set('selectable', true);
         }
     });

       console.log("lower")


       $("#inline-btn-" + selectedLayerCount  + activeLayer).addClass('hide');

       $(".inline-btn").addClass('hide');

   }


   $('.gallery.slick-initialized').slick("unslick")

   $('.gallery').slick({
       infinite: true,
       slidesToShow: 3,
       slidesToScroll: 3,
       dots: false,
       prevArrow: false,
       nextArrow: false
   })



   $(".videoIcon").remove();

   var slides = window.parent.document.getElementsByClassName("videoOpen");
   for(var i = 0; i < slides.length; i++)
   {
     slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
 }



}

  // selectedObject.set('width', 300);
  
  if(selection == -1){

    if(selectedObject.get("id") !='imageObject'){

    }
    layerCount = selectedObject.get("layerCount")


    canvas.renderAll();
}

}


}
}




canvas.on('object:selected', objectSelection )
canvas.on('selection:updated', objectSelection)

canvas.on('path:created', function(e){
    var path = e.path;
    path.selectable = false
    path.opacity = parseFloat($("#free-opacity").val())
    path.stroke = $("#free-color").val()
    path.strokeWidth = parseInt($("#free-width").val())
    path.id = 'path'
    path.setCoords();
    updateCanvasState()
    canvas.renderAll()
});


$(document).on('click', '.slick-prev', function(event) {
    console.log("this i clickd")
    dataID = $(this).parent().attr("data-id")
    console.log(dataID)
    $('#gallery-'+ dataID + activeLayer).slick('slickPrev');
});

$(document).on('click', '.slick-next', function(event) {
    console.log("this i clickd")
    dataID = $(this).parent().attr("data-id")
    console.log(dataID)
    $('#gallery-'+ dataID + activeLayer).slick('slickNext');
});

$(document).on('click', '.remove', function(event) {
    dataID = $(this).attr("data-id")
    $('#gallery-'+ dataID + activeLayer).slick('slickRemove',slideIndex - 1);
    if (slideIndex !== 0){
        slideIndex--;
    }
});



$('#remove-'+ imageObjectCount).on('click', function() {
    $('#gallery-'+ imageObjectCount + activeLayer).slick('slickRemove',slideIndex - 1);
    if (slideIndex !== 0){
        slideIndex--;
    }
});



$(document).on('click', '.gallery', function(event) {

    dataID = $(this).attr("data-id")


    if( $(this).hasClass('sliderFullScreen') ){

        allowMove = 1


        $('#imageOptions-'+ dataID).addClass('hide')

        $('.imageMainOptions').addClass('hide')

        $('#remove-'+ dataID).addClass('hide')

        $('#inline-btn-'+ dataID  + activeLayer).css('opacity', '0.8');

        $(this).removeClass('sliderFullScreen')
        console.log("$(this)")
        console.log($(this))
        // $(this).slick("unslick");
        $('#gallery-'+ dataID + activeLayer + '.slick-initialized').slick("unslick");
        $('#gallery-li-'+ dataID + activeLayer).removeClass('hide')

        $('#gallery-'+ dataID + activeLayer).slick({
            infinite: true,
            slidesToShow: 3,
            slidesToScroll: 3,
            dots: false,
            prevArrow: false,
            nextArrow: false
        })




        $(".videoIcon").remove();

        var slides = window.parent.document.getElementsByClassName("videoOpen");
        for(var i = 0; i < slides.length; i++)
        {
         slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
     }

     $('#prev-'+ dataID).removeClass('fullscreen')
     $('#next-'+ dataID).removeClass('fullscreen')
 }

 else{
    $(this).addClass('sliderFullScreen')

    allowMove = 0

    $('#imageOptions-'+ dataID).removeClass('hide')
    $('.imageMainOptions').removeClass('hide')

    $('#remove-'+ dataID).removeClass('hide')

    console.log("dataID" + dataID)

    $('#gallery-'+ dataID + activeLayer + '.slick-initialized').slick("unslick");
    $('#gallery-'+ dataID + activeLayer).slick({
        infinite: true,
        nextArrow: false,
        slidesToShow: 3,
        slidesToScroll: 3,
        arrows: false,dots: false,
        prevArrow: false,
    })


    $(".videoIcon").remove();

    var slides = window.parent.document.getElementsByClassName("videoOpen");
    for(var i = 0; i < slides.length; i++)
    {
     slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
 }


 $('#inline-btn-'+ dataID  + activeLayer).css('opacity', '1');



     //$('#gallery-'+ dataID).slick('slickGoTo', elt - 1);

     //$('#gallery-'+ dataID).slick('slickGoTo', elt - 1);


     $('.slickButton #prev-'+ dataID).addClass('fullscreen')
     $('.slickButton #next-'+ dataID).addClass('fullscreen')


     $('.gallery-li-' + dataID).removeClass('hide')

     var currentSlide = $('.gallery').slick('slickCurrentSlide');

 }

});




$(document).on('mouseleave', '.categories', function(event) {

    jQuery('.categories .inactive').addClass('hide')

});


canvas.on('object:added', function(o){

    console.log('object Added')

    if(polygonMode == false){

        objectAdded = 1

        console.log(selection)


        if(selection != 0){

            console.log('mode tool')
            $('#modeToggler').data('mode', 'tool')

        }


        switch(selection){

            case -1 : $('#modeToggler').children('img').attr('src', 'icons/eraser.svg'); $('#modeToggler').children('img').attr('title', '텍스트'); $('#modeToggler').children('img').attr('alt', '텍스트'); break;

            case 1 : $('#modeToggler').children('img').attr('src', 'icons/text.svg'); $('#modeToggler').children('img').attr('title', '텍스트'); $('#modeToggler').children('img').attr('alt', '텍스트'); break;

            case 3 : $('#modeToggler').children('img').attr('src', 'icons/circle.svg');  $('#modeToggler').children('img').attr('title', '원'); $('#modeToggler').children('img').attr('alt', '원'); break;

            case 4 : $('#modeToggler').children('img').attr('src', 'icons/polygon.svg');  $('#modeToggler').children('img').attr('title', '다각형'); $('#modeToggler').children('img').attr('alt', '다각형');break;

            case 5 : $('#modeToggler').children('img').attr('src', 'icons/free.svg');  $('#modeToggler').children('img').attr('title', '선'); $('#modeToggler').children('img').attr('alt', '선'); break;

            case 7 : $('#modeToggler').children('img').attr('src', 'icons/rectangle.svg'); $('#modeToggler').children('img').attr('title', '사각형'); $('#modeToggler').children('img').attr('alt', '사각형'); break;

            case 9 : $('#modeToggler').children('img').attr('src', 'icons/line.svg');  $('#modeToggler').children('img').attr('title', '직선'); $('#modeToggler').children('img').attr('alt', '직선'); break;

            case 11 : $('#modeToggler').children('img').attr('src', 'icons/arrow.svg'); $('#modeToggler').children('img').attr('title', '화살표'); $('#modeToggler').children('img').attr('alt', '화살표');break;

            case 99 : $('#modeToggler').children('img').attr('src', 'icons/arrow.svg'); $('#modeToggler').children('img').attr('title', '화살표'); $('#modeToggler').children('img').attr('alt', '화살표');break;

        }

    }




    // if($('#multidrawValue').prop('checked') == false){

    //     $("#modeToggler").addClass('hide')

    // }



    // for(i = 1; i <= canvas.getObjects().length; i++){

    //             //item = canvas.getItem("imageObject")
    //             object = canvas.item(i-1)

    //             type = object.get("id")

    //             if( type == 'imageObject'){
    //                 canvas.bringToFront(object);
    //             }
    //         }

})








var isDragging = 0;


canvas.on('mouse:down', function(o){

    toolboxDrag = 0
    $("#dependsLeft").addClass('hide');
    $("#dependsRight").addClass('hide');

    if(selection != 0){
        $("#layerSection").addClass('hide')
        $("#liveeditbutton").addClass('hide')
        $("#toolbox").addClass('hide');

        $("#toolbox").css('transform', 'translate(0px, 0px)');
        $("#toolbox").attr('data-x', 0);
        $("#toolbox").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);

        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);
        $("#layers").attr('data-y', 0);

        $("#layers").addClass('hide');

        $(".mainNav").addClass('hide');
        toolboxDrag = 0
    }




    if(!o.target && selection == 0){
        if(selection != 20 ){
            $("#toolbox").addClass('hide');

            $("#toolbox").css('transform', 'translate(0px, 0px)');
            $("#toolbox").attr('data-x', 0);
            $("#toolbox").attr('data-y', 0);

            $(".bwinPopupd").addClass('hide')

            $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
            $(".bwinPopupd").attr('data-x', 0);
            $(".bwinPopupd").attr('data-y', 0);

            $("#layerSection").addClass('hide')
            $("#liveeditbutton").addClass('hide')


            $("#layers").css('transform', 'translate(0px, 0px)');
            $("#layers").attr('data-x', 0);
            $("#layers").attr('data-y', 0);
            $("#toolbox").addClass('hide');

            $("#toolbox").css('transform', 'translate(0px, 0px)');
            $("#toolbox").attr('data-x', 0);
            $("#toolbox").attr('data-y', 0);
            $("#layers").addClass('hide');
            $(".mainNav").addClass('hide');

            $("#selection").trigger('click')
            for(i=1;i<=imageObjectCount;i++) $("#inline-btn-" + i  + activeLayer).addClass('hide')
        }
}


var pointer = canvas.getPointer(o.e);


if(selection == 20){
    isDown = true;
    var pointer = canvas.getPointer(o.e);

    var img = "icons/eye.svg"


    fabric.util.loadImage(img, function (img) {

        imageCountArray[activeLayer]++

        imageObjectCount = imageCountArray[activeLayer]
        console.log(imageCountArray)
        console.log(imageObjectCount)


        imageObject = new fabric.Image(img);
        imageObject.set({
            id: 'imageObject',
            selectable: true,
            left: pointer.x,
            top: pointer.y,
            src:img,
            cornerSize: 15,
            layerId: activeLayer,
            layerCount: imageObjectCount
        });

        imageObject.setControlVisible('mb', false);
        imageObject. setControlVisible('mt', false);
        imageObject. setControlVisible('ml', false);
        imageObject. setControlVisible('mr', false);


        var d1 = document.getElementById('inline-btn-container-' + activeLayer);
        d1.insertAdjacentHTML('beforeend', '<div id="inline-btn-'+ imageObjectCount +  activeLayer +'"  data-layerId="'+ activeLayer +'"  data-id="'+ imageObjectCount +'"  class=" inline-btn" style="opacity: 0.8;width: 200px; background: rgb(10, 84, 142); box-shadow: 1px 3px 10px rgba(22,22,22,0.09); border-radius: 3px;position: absolute;z-index: 120;max-width: 400px;  left: '+ (imageX + 25) +'px; top:'+ (imageY+25) +'px"><ul class="gallery-ul'+ imageObjectCount +'""><li style="display: flex;align-items: center;height:36px"><div class="no-select" style="flex-basis: 50%;display:flex;justify-content: center"><p style="color:white">포토룸</p></div><iframe class="iframeImageUploader" style="width:62%; height:100%;border: 0px;" src="eyeIconFrame.html?param1='+ imageObjectCount + '&v='+ new Date().getTime() +'"></iframe><div style="flex-basis: 10%;position: absolute;pointer-events:none;right: 6px;z-index:120;height:20px"></div></li><li id="gallery-li-'+ imageObjectCount + activeLayer + '" class="gallery-li hide"><div class="gallery" data-id="'+ imageObjectCount +'"  id="gallery-' + imageObjectCount + activeLayer + '" style="width: 100%"></div></li><li class="slickButton hide" data-id="'+ imageObjectCount +'"  ><button class="slick-prev slick-arrow" type="button" id="prev-'+ imageObjectCount +'" style="display: block;">이전</button><button class="slick-next slick-arrow" type="button" id="next-'+ imageObjectCount +'" style="display: block;">다음</button></li></ul><div class="imageOptions hide" id="imageOptions-'+ imageObjectCount +'"></div></div> ');



           // d1.insertAdjacentHTML('beforeend', '<div id="inline-btn-'+ imageObjectCount +  activeLayer +'"  data-layerId="'+ activeLayer +'"  data-id="'+ imageObjectCount +'"  class=" inline-btn" style="opacity: 0.8;width: 200px; background: rgb(10, 84, 142); box-shadow: 1px 3px 10px rgba(22,22,22,0.09); border-radius: 3px;position: absolute;z-index: 120;max-width: 400px;  left: '+ (imageX + 25) +'px; top:'+ (imageY+25) +'px"><ul><li style="display: flex;align-items: center;height:36px"><div class="no-select" style="flex-basis: 50%;display:flex;justify-content: center"><p style="color:white">포토룸</p></div><div style="flex-basis: 70%;position: relative;height:35px"><div class="categories" id="categories-'+ imageObjectCount + '" data-id="'+ imageObjectCount +'"  ><div style="display:flex"><iframe style="width:100%; height:100%;border: 0px;" src="eyeIconFrame.html"></iframe><div class="no-select" style="flex-grow:1"><input type="file" accept="image/*" id="gallery-photo-add1-'+ imageObjectCount + '" class="custom-file-input" title=" " data-id="'+ imageObjectCount +'" style="width: 100%"><label style="position: absolute;top: 0;width:57px;text-align:center" for="gallery-photo-add1-'+ imageObjectCount + '"><img title="사진첨부" alt="사진첨부" class="inline-image" style="width:initial" height="25" src="icons/imageAdd.svg"></label></div><div class="no-select" style="flex-grow:1"><input type="file" accept="image/*" capture="capture" id="gallery-photo-add-'+ imageObjectCount + '" class="custom-file-input" title=" " data-id="'+ imageObjectCount +'" style="width: 100%"><label style="position: absolute;top: 0;width:57px;text-align:center" for="gallery-photo-add-'+ imageObjectCount + '"><img title="사진첨부" alt="사진첨부" class="inline-image"  style="width:initial" height="25" src="icons/cameraIcon.svg?v=1"></label></div></div></div></div><div style="flex-basis: 10%;position: absolute;pointer-events:none;right: 6px;z-index:120;height:20px"></div></li><li id="gallery-li-'+ imageObjectCount + activeLayer + '" class="gallery-li hide"><div class="gallery" data-id="'+ imageObjectCount +'"  id="gallery-' + imageObjectCount + activeLayer + '" style="width: 100%"></div></li><li class="slickButton hide" data-id="'+ imageObjectCount +'"  ><button class="slick-prev slick-arrow" type="button" id="prev-'+ imageObjectCount +'" style="display: block;">이전</button><button class="slick-next slick-arrow" type="button" id="next-'+ imageObjectCount +'" style="display: block;">다음</button></li></ul><div class="imageOptions hide" id="imageOptions-'+ imageObjectCount +'"></div></div> ');


        //    $('#gallery-'+ imageObjectCount + activeLayer).slick({
        //     infinite: true,
        //     slidesToShow: 3,
        //     slidesToScroll: 3,
        //     dots: false,
        //     prevArrow: false,
        //     nextArrow: false
        // })



        // if(!allitems.hasOwnProperty(activeLayer)){


        //     allitems[activeLayer] = {}


        // }

        // if(!allitems[activeLayer].hasOwnProperty(imageObjectCount)){

        //     allitems[activeLayer][imageObjectCount] = []

        // }






  //This is while page load showing first element
  jQuery('.category').addClass('inactive').addClass('hide')
  
  
  var acc = document.getElementsByClassName("accordion");
  var i;
  
  for (i = 0; i < acc.length; i++) {
    acc[i].onclick = function(){
        this.classList.toggle("active");
        var panel = this.nextElementSibling;
        if (panel.style.display === "block") {
            panel.style.display = "none";
        } else {
            panel.style.display = "block";
        }
    }
}


if(canvas.getZoom() >= 1){

    imageObject.scaleX = imageObject.scaleY = 0.05 / canvas.getZoom()
}
else if(canvas.getZoom() < 1){

    imageObject.scaleX = imageObject.scaleY = 0.05 / canvas.getZoom()

}




imageObjectCreated = 1;
canvas.add(imageObject)
eyeIconLen = imageObjectCount
canvas.renderAll();
}, {crossOrigin: 'Anonymous'});

}
if(selection == 14){



}

if(selection == 5){

    var color = $("#free-color").val();

    canvas.freeDrawingBrush.color = color
    canvas.freeDrawingBrush.width = parseInt($("#free-width").val());
    canvas.freeDrawingBrush.opacity = parseFloat($("#free-opacity").val());

    canvas.renderAll()

}

text_box = $('#text-content').html();

if(selection == 1 && text_box.length > 0){


    isDown = true;
    var pointer = canvas.getPointer(o.e);
    origX = pointer.x;
    origY = pointer.y;

    text = $('#text-content').html();
    textfont = parseInt($('#text-font').val());
    color = $('#text-color').val();
    backgroundColor = $("#text-backgroundcolor").spectrum('get').toRgbString()
    backgroundopacity = parseFloat($('#text-backgroundopacity').val());

    opacity = parseFloat($('#text-opacity').val());

    rgbatext = convertHex(color,opacity)



    text = new fabric.Textbox(text, {
        fontSize: textfont,
        selectable: false,
        left: origX,
        top: origY, width: 200,
        fill: rgbatext,
        textAlign: 'center',
        layerId: activeLayer,
        editable: true,
        // stroke: 'red',
        originalbg: backgroundColor,
        originalcolor: color,
        perPixelTargetFind: true,
        backgroundopacity: backgroundopacity,
        id: "text",
        backgroundColor: backgroundColor 
    });
    // text. setControlVisible('bl', false);
    // text. setControlVisible('br', false);
    // text. setControlVisible('tl', false);
    // text. setControlVisible('tr', false);
    text. setControlVisible('mt', false);
    text. setControlVisible('mb', false);
    canvas.add(text);   

}

if( selection == 9 ){

    isDown = true;
    var pointer = canvas.getPointer(o.e);
    var points = [ pointer.x, pointer.y, pointer.x, pointer.y ];

    opacity = $('#line-opacity').val();
    strokeWidth = parseInt($('#line-stroke-width').val());
    strokeColor = $('#line-stroke-color').val()

    line = new fabric.Line(points, {
        strokeWidth: strokeWidth,
        id: "line",
        width: 100,
        layerId: activeLayer,
        opacity: opacity,
        stroke: strokeColor,
        originX: 'center',
        originY: 'center',
        perPixelTargetFind: true,
        selectable: false
    });
    canvas.add(line);
}

if( selection == 3 ){
    isDown = true;

    var pointer = canvas.getPointer(o.e);
    color = $('#circle-color').val();
    opacity = parseFloat($("#circle-opacity").val());
    strokeWidth = parseInt($("#circle-stroke-width").val());
    strokeColor= $("#circle-stroke-color").val();


    strokedashWidth = parseInt($("#circle-dash-width").val())
    strokedashSpace = parseInt($("#circle-dash-space").val())

    origX = pointer.x;
    origY = pointer.y;
    circle = new fabric.Circle({
        left: pointer.x,
        top: pointer.y,
        radius: 10,
        cornerSize: 20,
        id: "circle",
        fill: color,
        layerId: activeLayer,
        perPixelTargetFind: true,
        opacity: opacity,
        strokeWidth: strokeWidth,
        stroke: strokeColor,

        strokeDashArray: [strokedashWidth, strokedashSpace],
        selectable: false,
        perPixelTargetFind: true,
        originX: 'center', originY: 'center'
    });

    canvas.add(circle);
}

if( selection == 2 ){
    isDown = true;
    var pointer = canvas.getPointer(o.e);
    origX = pointer.x;
    origY = pointer.y;
    radius = parseInt($('#point-size').val());
    color = $('#point-color').val();
    strokeWidth = parseInt($('#point-stroke-width').val())
    strokeColor = $('#point-stroke-color').val();

    if(strokeWidth == 0){
        strokeColor = color
    }

    opacity = $('#point-opacity').val();
    point = new fabric.Circle({
        left: pointer.x,
        top: pointer.y,
        radius: radius,
        id: "point",
        layerId: activeLayer,
        perPixelTargetFind: true,
        fill: color,
        strokeWidth: strokeWidth,
        opacity: opacity,
        stroke: strokeColor,
        selectable: false,
        originX: 'center', originY: 'center'
    });
    canvas.add(point);
}

if( selection == 5){
    canvas.renderAll();

}
if( selection == 6){
    isDown = true;
    var pointer = canvas.getPointer(o.e);
    origX = pointer.x;
    origY = pointer.y;

    color = $('#triangle-color').val();
    opacity = parseFloat($("#triangle-opacity").val())
    strokeWidth = parseInt($("#triangle-stroke-width").val())
    strokeColor= $("#triangle-stroke-color").val();

    tri = new fabric.Triangle({
        left: pointer.x,
        top: pointer.y,
        perPixelTargetFind: true,
        id: "triangle",
        layerId: activeLayer,
        width:10,height:10,
        strokeWidth: strokeWidth,
        stroke: strokeColor,
        fill: color,
        opacity: opacity,
        selectable: false,
        originX: 'center'

    });
    canvas.add(tri);

}
if(selection == 7){
    isDown = true;
    var pointer = canvas.getPointer(o.e);
    origX = pointer.x;
    origY = pointer.y;

    color = $('#rectangle-color').val();
    opacity = parseFloat($("#rectangle-opacity").val())
    strokeWidth = parseInt($("#rectangle-stroke-width").val())
    strokeColor = $("#rectangle-stroke-color").val()
    strokeOpacity = $("#rectangle-stroke-opacity").val()


    strokedashWidth = parseInt($("#rectangle-dash-width").val())
    strokedashSpace = parseInt($("#rectangle-dash-space").val())




    var pointer = canvas.getPointer(o.e);
    rect = new fabric.Rect({
        left: origX,
        top: origY,
        selectable: false,
        originX: 'left',
        originY: 'top',
        layerId: activeLayer,
        perPixelTargetFind: true,
        width: 20,
        id: "rectangle",
        height: 10,
        angle: 0,
        strokeDashArray: [strokedashWidth, strokedashSpace],
        strokeWidth: strokeWidth,
        stroke: strokeColor,
        opacity: opacity,
        fill: color,
        transparentCorners: false
    });
    canvas.add(rect);
}

if(selection == 8){
    isDown = true;
    var pointer = canvas.getPointer(o.e);
    origX = pointer.x;
    origY = pointer.y;

    color = $('#ellipse-color').val();
    opacity = parseFloat($("#ellipse-opacity").val())
    strokeWidth = parseInt($("#ellipse-stroke-width").val())
    strokeColor = $("#ellipse-stroke-color").val()

    ellip = new fabric.Ellipse({
        left: pointer.x,
        top: pointer.y,
        fill: color,
        layerId: activeLayer,
        perPixelTargetFind: true,
        stroke: strokeColor,
        strokeWidth : strokeWidth, 
        opacity: opacity,
        id: "ellipse",
        selectable: false,
        originX: 'center', originY: 'center',
        rx: 5,
        ry: 1
    });
    canvas.add(ellip);
}

});

canvas.on('path:created', function(o){

    o.path.layerId = activeLayer

})

canvas.on('mouse:move', function(o){

    var pointer = canvas.getPointer(o.e);



    if( selection == 9 ){
        if (!isDown) return;
        console.log("sdsd")
        line.set({ x2: pointer.x, y2: pointer.y });
        canvas.renderAll();
    }

    if( selection == 3 ){
        if (!isDown) return;
        circle.set({ radius: Math.abs(origX - pointer.x) });
        canvas.renderAll();
    }
    if( selection == 2 ){
        if (!isDown) return;
        canvas.renderAll();
    }
    if( selection == 6){

        if (!isDown) return;
        var pointer = canvas.getPointer(o.e);
        tri.set({ width: Math.abs(origX - pointer.x),height: Math.abs(origY - pointer.y)});
        canvas.renderAll();

    }
    if(selection == 7){
        if (!isDown) return;
        var pointer = canvas.getPointer(o.e);

        if(origX>pointer.x){
            rect.set({ left: Math.abs(pointer.x) });
        }
        if(origY>pointer.y){
            rect.set({ top: Math.abs(pointer.y) });
        }

        rect.set({ width: Math.abs(origX - pointer.x) });
        rect.set({ height: Math.abs(origY - pointer.y) });


        canvas.renderAll();
    }
    if(selection == 8){
        if (!isDown) return;
        var pointer = canvas.getPointer(o.e);
        ellip.set({ rx: Math.abs(origX - pointer.x),ry:Math.abs(origY - pointer.y) });
        canvas.renderAll();
    }

});

canvas.on('mouse:up', function(o){
    isDown = false;

    if(selection != 0){

        $("#modeToggler").data('prevtool' , selection);
        
    }


    if(selection  == 9){
      line.setCoords();
      updateCanvasState();
      if($('#multidrawValue').prop('checked') == false){    
         $("#selection").trigger('click');
     }
 }
 if(selection  == 3){
  circle.setCoords();
  updateCanvasState();
  if($('#multidrawValue').prop('checked') == false){    
     $("#selection").trigger('click');
 }
}
if(selection  == 5){
        // circle.setCoords();
        updateCanvasState();
        if($('#multidrawValue').prop('checked') == false){    
            $("#selection").trigger('click');
        }
    }
    if(selection  == 2){
        point.setCoords();  
        updateCanvasState()
        if($('#multidrawValue').prop('checked') == false){    
            $("#selection").trigger('click');
        }
    }
    if(selection  == 6){
        tri.setCoords();    
        updateCanvasState()
        if($('#multidrawValue').prop('checked') == false){    
            $("#selection").trigger('click');
        }
    }
    if(selection  == 7){
        rect.setCoords();   
        updateCanvasState()
        if($('#multidrawValue').prop('checked') == false){    
            $("#selection").trigger('click');
        }
    }
    if(selection  == 20){
     // imageObject.setCoords();
     updateCanvasState();
    // if(multidrawEnabled != 1){
        $("#selection").trigger('click');
     //}
 }
 if(selection  == 8){
    ellip.setCoords();  
    updateCanvasState()
    if($('#multidrawValue').prop('checked') == false){    
        $("#selection").trigger('click');
    }
}

if(selection  == 1){
    $('#text-content').html("Note");

    updateCanvasState()
    if($('#multidrawValue').prop('checked') == false){    
        $("#selection").trigger('click');
    }
}
  // if(selection  == 20){
  //    imgInstance.scale(my_value).center().setCoords()
  //    $("#selection").trigger('click');
  // }
  if( selection == 10 ||selection == 11 || selection == 14){
    if($('#multidrawValue').prop('checked') == false){    

        updateCanvasState()
        $("#selection").trigger('click');
    }
}

})

  // canvas.on('object:added',function(){
  //    if(!isRedoing){
  //        h = [];
  //    }
  //    isRedoing = false;
  // });
  
  // var isRedoing = false;
  // var h = [];
  
  // $("#undo").click(function(){
  //    if(canvas._objects.length>0){
  //        h.push(canvas._objects.pop());
  //        canvas.renderAll();
  //    }
  
  // //$("#toolbox").hide();
  // $('.highlight').removeClass('highlight');
  
  // $('.selectedTool').removeClass("selectedTool")
  // $('.editingTool').removeClass("editingTool")
  // $(this).addClass("highlight")
  
  // })
  
  // $("#redo").click(function(){
  //    if(h.length>0){
  //        isRedoing = true;
  //        canvas.add(h.pop());
  //    }
  // //$("#toolbox").hide();
  
  // $('.highlight').removeClass('highlight');
  
  // $('.editingTool').removeClass("editingTool")
  // $('.selectedTool').removeClass("selectedTool")
  // $(this).addClass("highlight")
  
  // })
  
  var Draggable = function (id,moveArea,data) {  
    var el = document.getElementById(id),  
    isDragReady = false,  
    dragoffset = {  
        x: 0,  
        y: 0  
    }; 
  //var area = document.getElementById(moveArea)
  
  this.init = function () {  
  //only for this demo 
  el.style.position = "absolute";  
  //this.initPosition(); 
  this.events();  
}; 
  //only for this demo 
  this.initPosition = function () {  
    el.style.top = "20px";  
    el.style.left = "48%";  
}; 
  //events for the element 
  this.events = function () {  
    var self = this;  
    _on(el, 'mousedown', function (e) {  

        $(".movethis").parent().removeClass('active')
        isDragReady = true;  
  //corssbrowser mouse pointer values 
  e.pageX = e.pageX || e.clientX + (document.documentElement.scrollLeft ?  
    document.documentElement.scrollLeft :  
    document.getElementById("body").scrollLeft);  
  e.pageY = e.pageY || e.clientY + (document.documentElement.scrollTop ?  
    document.documentElement.scrollTop :  
    document.getElementById("body").scrollTop);  
  dragoffset.x = e.pageX - el.offsetLeft;  
  dragoffset.y = e.pageY - el.offsetTop;  
}); 
    _on(document, 'mouseup', function () {  
        isDragReady = false; 
        objs = canvas.getObjects().map(function(o) {


            if(o.id == 'imageObject'){
                o.set('selectable', true);
            }
        }); 
    }); 
    _on(document, 'mousemove', function (e) {

        if( allowMove == 1){ 
            if (isDragReady) {  
                e.pageX = e.pageX || e.clientX + (document.documentElement.scrollLeft ?  
                    document.documentElement.scrollLeft :  
                    document.getElementById("body").scrollLeft);  
                e.pageY = e.pageY || e.clientY + (document.documentElement.scrollTop ?  
                    document.documentElement.scrollTop :  
                    document.getElementById("body").scrollTop);  
                el.style.top = (e.pageY - dragoffset.y) + "px";  
                el.style.left = (e.pageX - dragoffset.x) + "px"; 


            }

        } 
    }); 
}; 

var _on = function (el, event, fn) {  
    document.attachEvent ? el.attachEvent('on' + event, fn) : el.addEventListener(event, fn, !0);  
}; 
this.init();  
} 


function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
        x: evt.clientX - rect.left,
        y: evt.clientY - rect.top
    };
}




function getOffset( el ) {
    var _x = 0;
    var _y = 0;
    while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) ) {
        _x += el.offsetLeft - el.scrollLeft;
        _y += el.offsetTop - el.scrollTop;
        el = el.offsetParent;
    }
    return { top: _y, left: _x };
}

$(".movethis").click(function(event) {
    objs = canvas.getObjects().map(function(o) {

        if(o.id == 'imageObject'){
            o.set('selectable', true);
        }
    });
});




$(document).on('click', '.movethis', function(event) {

  $(this).attr('attribute', 'value');
});




function imageLoad(MY_URL, file){
  var request = new XMLHttpRequest();
  request.open('GET', MY_URL, true);
  request.responseType = 'blob';
  $(".canvas-container").removeClass('hide')
  $("#filesection").removeClass('hide')
  $("#startP").addClass('hide')
  $("#layerSection").addClass('hide')
    // $("#filename").text(file)
    $("#filename").val(file)

    document.title = file;
    $("#filesection").removeClass('hide')




    request.onload = function() {
        var reader = new FileReader();
        getOrientation(request.response, function(orientation) {
            _correction = orientation


        })
        reader.readAsDataURL(request.response);
        reader.onload =  function(f){

            var data = f.target.result;
            var rotation, exifData = 0

            var MAX_HEIGHT
            var imageData





            var image = new Image();
            image.onload = function(){

                var canvas1 = document.createElement('canvas');
                canvas1.id = 'imageCanvas'
                document.getElementById("body").appendChild(canvas1);



                MAX_HEIGHT = (image.height * 70) / 100

                image.width *= MAX_HEIGHT / image.height;
                image.height = MAX_HEIGHT;




                var ctx = canvas1.getContext("2d");
                ctx.clearRect(0, 0, canvas1.width, canvas1.height);
                canvas1.width = image.width;
                canvas1.height = image.height;
                ctx.drawImage(image, 0, 0, image.width, image.height);
                imageData = canvas1.toDataURL("image/jpeg");


                fabric.Image.fromURL(imageData, function(img) {

  // add background image
  
 // canvas.setViewportTransform([1,0,0,1,0,0])

 getInit()

 canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {

    originX: 'left',
    originY: 'top'

});



 canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));

 errorRotation = 0

 switch(_correction) {
    case 6:
    exifData = 1;
    errorRotation = 1

    break;
}

imageWidthData = img.width
imageHeightData = img.height

console.log("img.width , iimg.width , img.heigh")
console.log(img.width , img.height)

if(exifData == 1){

    canvas.backgroundImage.rotate(90)

    var abc = height / img.width


    zoomLevel = abc
    canvas.setWidth(img.height);
    canvas.setHeight(img.width);

    canvas.backgroundImage.top = 0
    canvas.backgroundImage.left = (canvas.width / 2) + (img.height / 2) 

    canvasPageZoom = abc
    canvas.setZoom(abc)
    canvas.backgroundImage.defaultZoomValue = abc



    if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2)-((canvas.width * abc) /2) , 0])


}
else{



    var ratio = img.width / img.height

    var abc = height / img.height


    zoomLevel = abc



    if(width > img.width){
        if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - (img.width *abc) /2 , 0])

            imageW = img.width
    }
    if(width == img.width){
        if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2) - (canvas.width *abc) /2 , 0])

            canvas.setWidth(img.width);
        canvas.setHeight(img.height);
    }
    if(img.width > width){
        if(isMobile == 0) canvas.setViewportTransform([abc, 0, 0, abc, (width/2)-((img.width * abc) /2) , 0])

            canvas.setWidth(img.width);
        canvas.setHeight(img.height);
    }

    if(isMobile == 1){
        canvas.setViewportTransform([abc, 0, 0, abc, 0 , 0])
        canvas.setHeight(height)
    }

    if(canvas.height < height){
        canvas.setHeight(height);
    }

    canvasPageZoom = abc
    canvas.setZoom(abc)
    canvas.backgroundImage.defaultZoomValue = abc

    canvasViewport = canvas.viewportTransform


}


document.getElementById("body").style.backgroundColor = "#f4f4f4";
$("#toolbox").addClass('hide')
$("#toolbox").css('transform', 'translate(0px, 0px)');
$("#toolbox").attr('data-x', 0);
$("#toolbox").attr('data-y', 0);

$(".bwinPopupd").addClass('hide')

$(".bwinPopupd").css('transform', 'translate(0px, 0px)');
$(".bwinPopupd").attr('data-x', 0);
$(".bwinPopupd").attr('data-y', 0);

toolboxDrag = 0
isPdfUpload = 0
backgroundImageLoaded = 1
$('#layersButton').removeClass('deactive')

$("#filesection").removeClass('hide')

$(".loader").hide().fadeOut('slow');

if(initialLayer == 1){
    initialLayer = 0;
    $("#layers").removeClass('hide')
    $(".layerSubDiv[data-subsection='" + sharedLayerId + "']").removeClass('hide')
}

});

                canvas1.remove()
            };
            image.src = f.srcElement.result;

        };
    };
    request.send();

    // alert('imageLoaded')

    setTimeout(function(){ $(window).trigger('resize') }, 3000);

    $(window).trigger('resize')

}


var eventPush, change = 0

document.getElementById('image').addEventListener("change", function(e) {
    eventPush = e
    change = 1

    console.log("local selected")


    if(backgroundImageLoaded == 0 && isPdfUpload == 0){
        $("#clearCanvas-action").click()
    }else{
        $("#clearCanvas-action").click()

    }


});

var hack = 0

canvas.on({
    'touch:gesture': function(e) {
        if (e.e.touches && e.e.touches.length == 2) {
            canvas.allowTouchScrolling = false;
            pausePanning = true;
            console.log("aaa1")
            var point = new fabric.Point(e.self.x, e.self.y);
            if (e.self.state == "start") {
                zoomStartScale = self.canvas.getZoom();
            }

            var delta = zoomStartScale * e.self.scale;
            if(delta > 0.15){
                self.canvas.zoomToPoint(point, delta);
            }
            pausePanning = false;
        }
    },
    'object:selected': function() {
        pausePanning = true;
        console.log("aaa1")
    },
    'selection:cleared': function() {
        if(backgroundImageLoaded != 0 || isPdfUpload != 0) pausePanning = false;
    },
    'touch:drag': function(e) {
        imageX = e.e.pageX;
        imageY = e.e.pageY
        console.log("xxxx")
        console.log(e)
        hack++ 
        if(e.e.type == 'mousemove'){

            console.log('dragging start mouse')

            if(toolboxDrag == 0 && pausePanning == false){
                if( selection == 0 && isobjectselected == 1) {
                    canvas.selection = false
                    currentX = e.e.pageX;
                    currentY = e.e.pageY;
                    xChange = currentX - lastX;
                    yChange = currentY - lastY;


                    if( (Math.abs(currentX - lastX) <= 50) && (Math.abs(currentY - lastY) <= 50)) {
                        var delta = new fabric.Point(xChange, yChange);
                        canvas.relativePan(delta);
                        $(".inline-btn").addClass('hide')
                    }

                    lastX = e.e.pageX;
                    lastY = e.e.pageY;
                }
            }


        }else if( (is_touch_device() == true || isMobile == 1) && selection != -1 && e.e.type != "mousedown"){

            console.log('dragging start touch')

            if (pausePanning == false && e.e.changedTouches[0].pageX) {
                if(hack > 4){
                    canvas.selection = false
                    currentX = e.e.changedTouches[0].pageX;
                    currentY = e.e.changedTouches[0].pageY;
                    xChange = currentX - lastX;
                    yChange = currentY - lastY;


                    if( (Math.abs(currentX - lastX) <= 50) && (Math.abs(currentY - lastY) <= 50)) {
                        var delta = new fabric.Point(xChange, yChange);
                        canvas.relativePan(delta);
                    }

                    lastX = e.e.changedTouches[0].pageX;
                    lastY = e.e.changedTouches[0].pageY;
                }
            }
        }else{

            console.log('dragging start else')

        }
    }
});


canvas.on('mouse:up', function(o){
  hack = 0
})


var shiftKeyDown = false;
var mouseDownPoint = null;

$(canvas.wrapperEl).on('mousewheel', function(options) {
  var delta = options.originalEvent.wheelDelta;
  $(".inline-btn").addClass('hide')
  if (delta != 0) {
     var pointer = canvas.getPointer(options.e, true);
     var point = new fabric.Point(pointer.x, pointer.y);
     if (delta > 0) {
        zoomIn(point);
    } else if (delta < 0) {
        zoomOut(point);
    }
}
});


$("#zoominbutton").click(function(event) {

  $(".highlight").removeClass('highlight')

  var leftPoint = ((canvas.width * pdfScale)/2) + canvas.viewportTransform[4]
  var topPoint = ((canvas.height * pdfScale)/2) + canvas.viewportTransform[5]

  var point = new fabric.Point(leftPoint, topPoint);
  zoomIn(point)
});
$("#zoomoutbutton").click(function(event) {

  $(".highlight").removeClass('highlight')

  var leftPoint = ((canvas.width * pdfScale)/2) + canvas.viewportTransform[4]
  var topPoint = ((canvas.height * pdfScale)/2) + canvas.viewportTransform[5]

  var point = new fabric.Point(leftPoint, topPoint);
  zoomOut(point)
});


function zoomIn(point) {
  if (canvas.getZoom() < 3) {
     zoomLevel = zoomLevel + 0.1;
     canvas.zoomToPoint(point, zoomLevel);

 }
}

function zoomOut(point) {
  if (canvas.getZoom() > 0.15) {
     zoomLevel = zoomLevel - 0.1
     canvas.zoomToPoint(point, zoomLevel);

 }
}

function keepPositionInBounds() {
  var zoom = canvas.getZoom();
  var xMin = (2 - zoom) * canvas.getWidth() / 2;
  var xMax = zoom * canvas.getWidth() / 2;
  var yMin = (2 - zoom) * canvas.getHeight() / 2;
  var yMax = zoom * canvas.getHeight() / 2;

  var point = new fabric.Point(canvas.getWidth() / 2, canvas.getHeight() / 2);
  var center = fabric.util.transformPoint(point, canvas.viewportTransform);

  var clampedCenterX = clamp(center.x, xMin, xMax);
  var clampedCenterY = clamp(center.y, yMin, yMax);

  var diffX = clampedCenterX - center.x;
  var diffY = clampedCenterY - center.y;

  if (diffX != 0 || diffY != 0) {
     canvas.relativePan(new fabric.Point(diffX, diffY));
 }
}

function clamp(value, min, max) {
  return Math.max(min, Math.min(value, max));
}



canvas.on('mouse:down', function (o) {

  if(backgroundImageLoaded != 0 || isPdfUpload != 0) pausePanning = false
     var pointer = canvas.getPointer(o.e);
 origX = pointer.x;
 origY = pointer.y;

 if(isFingerDown == 1){



 }

})

canvas.on('mouse:up', function (options) {

  isFingerDown = 0

})



function renderPage(page) {


  var canvassection = document.getElementById("canvasforpdf"); 


  canvassection.innerHTML = "";

  var scale = pdfScale; 


  var viewport = page.getViewport(scale);

  viewportData = viewport 

  if(pdf_firstload == 1){

     pdf_firstload = 0


     pdfScale = height / viewport.height

     var viewport = page.getViewport(1.5);

 }

 document.getElementById("body").style.backgroundColor = "#f4f4f4";

 var canvasforpdf = document.createElement('canvas');
 canvasforpdf.id = 'pdf-canvas'
 canvassection.appendChild(canvasforpdf);


 errorRotation = 0

 ctx = canvasforpdf.getContext("2d")

 pdfcanvas = document.getElementById('pdf-canvas');
 var context = pdfcanvas.getContext('2d');


 canvas.setHeight(viewport.height);
 canvas.setWidth(viewport.width);

 console.log("viewport.width") 
 console.log(viewport.height) 






 $("#touchOverlay").height(viewport.height)
 $("#touchOverlay").width(viewport.width)

 pdfcanvas.height = viewport.height;
 pdfcanvas.width = viewport.width;

     //canvas.zoomToPoint(new fabric.Point(canvas.width / 2, canvas.height / 2), pdfScale);

     canvas.setZoom(pdfScale)


     if(isMobile == 0) canvas.setViewportTransform([pdfScale, 0, 0, pdfScale, (width/2)-((canvas.width * pdfScale) /2) , 0])
        canvasPageZoom = pdfScale

    pdfcanvasHeight = viewport.height;
    pdfcanvasWidth = viewport.width;

    $("#body").height(height)
    $("#body").width(width)

    zoomLevel = pdfScale;

    saveBuffer.setHeight(viewport.height);
    saveBuffer.setWidth(viewport.width);

    if(canvas.width < width){
        console.log("widssssth")
        console.log(width)
        canvas.setWidth(width)
        canvas.setViewportTransform([pdfScale, 0, 0, pdfScale, ((canvas.width) /2)-((viewport.width*pdfScale)/2) , 0])
    }
    if(canvas.height < height){ 
        canvas.setHeight(height)
        canvas.setViewportTransform([pdfScale, 0, 0, pdfScale, ((canvas.width) /2)-((viewport.width*pdfScale)/2) , 0])
    }

     // if(canvas.height < height){
     //     console.log("widssssth")
     //     console.log(width)
     //     canvas.setHeight(height)
     //     viewportData.height = heighty
     // }

     console.log(viewportData)
     console.log("aaaaaaaaaaaaaaaaaaaaaaaaviewportData")

     var renderContext = {
        canvasContext: context,
        viewport: viewport
    };
    var task = page.render(renderContext);

    task.promise.then(function(){


        canvas.setBackgroundImage(pdfcanvas.toDataURL("image/jpeg"), function() {
            canvas.renderAll();
            isPdfUpload = 1
            backgroundImageLoaded = 0
            // canvas.backgroundImage.defaultZoomValue = pdfScale
            canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
            updateCanvasState()
            $("#centerFit").click()
            $('#layersButton').removeClass('deactive')
            $('.canvas-container').removeClass('hide')
            if(initialLayer == 1){
                console.log('this is open it')
                initialLayer = 0;
                $("#layers").removeClass('hide')
                $("#layerDiv-" + sharedLayerId).click()
                for(i = 1; i <= canvas.getObjects().length; i++){


                   object = canvas.item(i-1)

                   Lid = object.get("layerId")


                   if(Lid == activeLayer){


                      object.visible=true
                      canvas.renderAll()

                  }else{

                      object.visible=false
                      canvas.renderAll()

                  }
              }

            // $(".layerSubDiv[data-subsection='" + sharedLayerId + "']").removeClass('hide')
        }

        console.log("resize done herer")
        $(window).trigger('resize')


    });






        $(".loader").hide().fadeOut('slow');

    });


    $("#layerSection").addClass('hide')

    ifPDFAdded = 1;





}

function displayPage(pdf, num) {


    pdf.getPage(num).then(function getPage(page) {  renderPage(page); });


}




function getStandard(){


    if(usertype == 3){



     $("#permission").removeClass('hide')

 }else{





     $("#permission").addClass('hide')


 }

 $.get("file:///android_assets/views/phppages/allProjectController.php?getDrawingStandardFile=getDrawingStandardFile", function(data, status){

    var obj = JSON.parse(data)
    console.log(obj)


    console.log('this one is running')

    console.log(permissionStatus)





    if(obj.files == null || permissionStatus == 1){

        standardFileAdded = 0
        isExcelAdded = 0

        $(".custom-file-upload__drawing").removeClass('hide')
        $(".custom-file-remove__drawing").addClass('hide')


    }else{



        excelURL = obj.path + obj.files['0']

        console.log(excelURL)

        $("#excelArea").empty()

        $("#excelArea").prepend('<a data-place="cleareverythingr" style="display: flex;flex-direction: column;align-items: center;" href="https://www.easypermit.net/test/spread2/drwExcel.html?v=' + excelURL +'" target="_blank"><img id="theImg" style="width: 30px;height: 100%;" src="assets/images/excel.svg" /><p style="width: 90px;text-align:center;word-break: break-all;font-size: 10px;">'+ excelURL.replace(/^.*[\\\/]/, '') +'</p></a>')


        isExcelAdded = 1
        standardFileAdded = 1
        
        $(".custom-file-upload__drawing").addClass('hide')
        $(".custom-file-remove__drawing").removeClass('hide')

    }


    if(permissionStatus == 1){

       $(".custom-file-upload__drawing").addClass('hide')
       $(".custom-file-remove__drawing").addClass('hide')


   }





})


}


function clearEverything(){




    $("#fullScreen").children('img').attr('src', 'icons/expand.svg')


    $("#modeToggler").children('img').attr('src', 'icons/move.svg');

    $("#modeToggler").children('img').attr('title', '켄버스 스크롤(S)'); $("#modeToggler").children('img').attr('alt', '켄버스 스크롤(S)');

    console.log("fullscreens Ezir")
                // viewportData = tempViewport
                // console.log("sdsdsdsdsd")
                // console.log(tempViewport)
                fullsc = 0

                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                }



                $('#toolbutton').addClass('deactive')
    // $('#imageEye').addClass('deactive')


    canvas.setViewportTransform([ 1, 0 , 0, 1 , 0 ,0 ])

    $("#layerTable").empty()

    if(isExcelAdded == 1){

        $(".custom-file-upload__drawing").removeClass('hide')
        $(".custom-file-remove__drawing").addClass('hide')

        
    }else{

        $(".custom-file-upload__drawing").addClass('hide')
        $(".custom-file-remove__drawing").removeClass('hide')

    }


    $("#modeToggler").addClass('hide')

    $("#filesection").addClass('hide')
    $("#layersection").addClass('hide')

    layerUserID = []
    layerOrderArray = []
    savedCounter = []

    activeLayer = 0

    $("#layersection").addClass('hide')

    if(usertype == 3 ){

        getStandard()


    }else{

        $("#permission").addClass('hide')

    }

    // imageAction = 0
    layerisCreating = 0

    signaturePad.clear()

    layerFinished = 0

    editON = 0
    $('.deleteVideo').addClass('hide')

    $("#toolbutton").addClass('hide');


    $(".layeraction").removeClass('hide')
    $("#createLayer").removeClass('hide')
    $(".editButton").removeClass('hide')
    $(".editButton").show()
    if(usertype != '3'){
        $(".upbutton").removeClass('hide')
    }

    $("#permissionDone").addClass('deactive')
    $("#permission_action").removeClass('hide')

    $("#permission").html('작업내용승인')

    $("#permissionArea").removeClass('afterPermission')
                // $("#permissionUserData").removeClass('afterPermission')

                $("#permission_title").removeClass('hide')
                $("#permission_desc").removeClass('hide')
                $("#permission_title").val('작업내용승인')
                $("#permission_desc").val('상기 작업내용을 정히 검수 하였으며...')
                $("#datenow").removeClass('hide')
                $("#signIMG").addClass('hide')
                $("#signIMGDone").addClass('hide')

                $("#signIMG").attr('src','')
                $("#signIMGDone").attr('src','')

                $("#zipDownload").addClass('hide')



                $("#permission_title1").addClass('hide')
                $("#permission_desc1").addClass('hide')
                $("#datenow1").addClass('hide')
                $("#permissionArea").addClass('hide')



                imageObjectCount = 0

                totalLayerCount = 0

                imageCountArray = []

                canvas.clear()

                console.log("cleareverything")

                $("#menuContainer").empty()
                $("#layerTable").empty()
                $("#hideThis").removeClass('hide')
                allitems=[]

            }

            function showPDF(url, filename, local){


                clearEverything()

                console.log(url)


                if(local == 0) getInit()


                    $(".showbox").removeClass('show')
                $("#hideThis").removeClass('hide')

                $(".canvas-container").removeClass('hide')
                $("#filesection").removeClass('hide')

    // $("#filename").text(filename)
    $("#filename").val(filename)

    document.title = filename;



    jQuery.ajax({
     url: 'file:///android_assets/views/phppages/allProjectController.php?checkReportStatus=checkReportStatus&filename=' + filename + '&filename=' + filename,

     async: false,
     success: function (result) {

        result = JSON.parse(result)
        console.log(result)

        if (result.status1 == "success") {

           $("#filenameAddTo").removeClass('hide')

           console.log('success1')

       }else{

           $("#filenameAddTo").addClass('hide')

       }

       if(result.status2 == "success") {

           console.log('success2')
           $("#layernameAddTo").removeClass('hide')

       }else{

           $("#layernameAddTo").addClass('hide')

       }

   }

})




    $("#filesection").removeClass('hide')


    $("#startP").hide()



    // if(fileExist == 1){

        var pdfDoc = PDFJS.getDocument(url).then(function getPdfHelloWorld(pdf) {
            pdf_firstload = 1 
            $(".loader").css('background', 'transparent');
            $(".loader").show().fadeIn('slow');

            console.log("heh111")
            $("#pdf-canvas").remove()
            pdfScale = 1.5
            displayPage(pdf, 1);
            shownPdf = pdf;

        });

    // }else{
    //  console.log('fai;edFile')


    //  $("#fileDoesntExist-modal").removeClass('close')

    //   $(".loader").hide().fadeOut('slow');
    // }


}

Array.prototype.pushUnique = function (item){
    if(this.indexOf(item) == -1) {
    //if(jQuery.inArray(item, this) == -1) {
        this.push(item);
        return true;
    }
    return false;
}




Array.prototype.pushIfNotExist = function(val) {
    if (typeof(val) == 'undefined' || val == '') { return; }
    val = $.trim(val);
    if ($.inArray(val, this) == -1) {
        this.push(val);
    }
};


function isJson(item) {
    item = typeof item !== "string"
    ? JSON.stringify(item)
    : item;

    try {
        item = JSON.parse(item);
    } catch (e) {
        return false;
    }

    if (typeof item === "object" && item !== null) {
        return true;
    }

    return false;
}

function getInit(){


    $("#layerTable").empty()
    clearEverything()

    console.log("jjjjjjjjjjjjjjjjjj")

    canvas.setViewportTransform([ 1, 0 , 0, 1 , 0 ,0 ])

    $("#layerTable").empty()

    var a, b

    canvas.setViewportTransform([ 1, 0 , 0, 1 , 0 ,0 ])

    $("#layerTable").empty()

    layerUserID = []

    activeLayer = 0

    imageObjectCount = 0

    totalLayerCount = 0

    canvas.clear()

    console.log("cleareverything")

    $("#menuContainer").empty()
    $("#layerTable").empty()
    $("#hideThis").removeClass('hide')
    allitems=[]
    // layerUserID = []

    a = JSON.stringify(fileJSON)
    b = JSON.parse(a)
    console.log(b)



    console.log( b.layers)

//      ifFileExist = b.status

//      console.log(ifFileExist)

//      if(ifFileExist == 1){

//              $('#toolbutton').addClass('deactive')
//  $('#imageEye').addClass('deactive')

//          b = JSON.parse(a).fileContent
//          console.log(b)
//          b = JSON.parse(b)

//          console.log("b")
//          console.log(b.layers)

if(b.status == 1){

    b.layers = b.layers.filter(function(x) { return x !== null }); 

    console.log(b.layers)


    var invited = b.layers.map(function(a) {  if(a != null) { if(a.creator == 0){ return a.user_id;} else{ return "NULL"; } } else{ return "NULL"; } });
    var owner = b.layers.map(function(a) {  if(a != null) { if(a.creator == 1){return a.user_id;}  else{ return "NULL"; }}  else{ return "NULL"; } });
    var supervisor = b.layers.map(function(a) {  if(a != null) { if(a.creator == 2){return a.user_id;}  else{ return "NULL"; }}  else{ return "NULL"; } });


    var owner = owner.filter(function(e) { return e !== 'NULL' })

    console.log(supervisor)
    console.log(invited)
    console.log(owner)

    // $.get("file:///android_assets/views/phppages/allProjectController.php?getUserListforLayer=getUserListforLayer&userArray=" + invited + "&owner=" + owner + "&supervisor=" + supervisor, function(data, status){




        layerUserID.length = 0

        data = {"service_id":"29","user_id":"351","first_name":"\uae40\ud604\uc7a5","last_name":"","company_name":"\ud55c\uc74c\uc774\uc5d4\uc528","UserProfileImage":"_profile351","email":"asdf@gmai.com","phone_1":"2147483647","phone_2":"2147483647","job_position":"\uacf5\uc0ac\uad00\ub9ac\ucc28\uc7a5"},{"service_id":"29","user_id":"27","first_name":"\uac15\uc0b0\uc5c5","last_name":"","company_name":"\ud55c\uc74c\uc774\uc5d4\uc528","UserProfileImage":"_profile27","email":"kzcbm@naver.com","phone_1":"012345445","phone_2":"012334566","job_position":"\ub300\ud45c"}

        console.log("sssssssssssssssssssssssssssssssssssssssss")
        console.log(data)
        var sum, count = 1
        var d1 = $('#menuContainer');

        b.layers.map(function(a) {



            var container = '<div id="inline-btn-container-'+ a.totalLayerCount +'" class="inline-btn-container"></div>'

            d1.append(container);


            layerUserID.push(a)

        });

        console.log(layerUserID)    

        imageCountArray = b.imageCountArray 

        totalLayerCount = layerUserID[layerUserID.length-1].totalLayerCount

        layerCount = layerUserID.length

        console.log(totalLayerCount)


        $('#menuContainer').empty()
        $('#layerTable').empty()



        // d1.append(b.eyeIcon[0]);
        // console.log(b.eyeIcon[0]);

        // b.eyeIcon.map(function(a, index){


            console.log(b)
            console.log(index)



         //    console.log('index')
         //    console.log(a)
         //    console.log(index)
         //    console.log(a.length)

         //    if(a.length > 0 && isJson(a)){




         //     a.map(function(c, index1){
         //        console.log(c)

         //        if(c != null){


         //            console.log(b.layers[index].totalLayerCount)
         //            layerid = b.layers[index].totalLayerCount

         //            if($("#inline-btn-container-" + layerid).length == 0){

         //                console.log('frist')


         //                var container = '<div id="inline-btn-container-'+ layerid +'" class="inline-btn-container"><div id="inline-btn-'+ (index1+1) + layerid +'" data-layerid="'+ layerid +'" data-id="'+(index1+1)+'" class="inline-btn hide" style="opacity: 0.8;width: 200px; background: rgb(10, 84, 142); box-shadow: 1px 3px 10px rgba(22,22,22,0.09); border-radius: 3px;position: absolute;z-index: 120;max-width: 400px;  left: 213px; top:251px"><ul class="gallery-ul-'+ layerid +'"><li style="display: flex;align-items: center;height:36px"><div class="no-select" style="flex-basis: 50%;display:flex;justify-content: center"><p style="color:white">포토룸</p></div><iframe  name="'+ new Date().getTime() +'" class="iframeImageUploader hide" style="width:62%; height:100%;border: 0px;" src="eyeIconFrame.html?param1='+(index1+1)+'"></iframe><div style="flex-basis: 10%;position: absolute;pointer-events:none;right: 6px;z-index:120;height:20px"></div></li>'+ c +'<li class="slickButton" data-id="'+(index1+1)+'"><button class="slick-prev slick-arrow" type="button" id="prev-'+(index1+1)+'" style="display: block;">이전</button><button class="slick-next slick-arrow" type="button" id="next-1" style="display: block;">다음</button></li></ul><div class="imageOptions hide" id="imageOptions-'+(index1+1)+'"></div></div></div>'
         //                d1.append(container);

         //            }else{

         //                console.log('second')

         //            var template =  '<div id="inline-btn-'+ (index1+1) + layerid +'" data-layerid="'+ layerid +'" data-id="'+(index1+1)+'" class="inline-btn hide" style="opacity: 0.8;width: 200px; background: rgb(10, 84, 142); box-shadow: 1px 3px 10px rgba(22,22,22,0.09); border-radius: 3px;position: absolute;z-index: 120;max-width: 400px;  left: 213px; top:251px"><ul class="gallery-ul-'+ layerid +'"><li style="display: flex;align-items: center;height:36px"><div class="no-select" style="flex-basis: 50%;display:flex;justify-content: center"><p style="color:white">포토룸</p></div><iframe  name="'+ new Date().getTime() +'" class="iframeImageUploader hide" style="width:62%; height:100%;border: 0px;" src="eyeIconFrame.html?param1='+(index1+1)+'"></iframe><div style="flex-basis: 10%;position: absolute;pointer-events:none;right: 6px;z-index:120;height:20px"></div></li>'+ c +'<li class="slickButton" data-id="'+(index1+1)+'"><button class="slick-prev slick-arrow" type="button" id="prev-'+(index1+1)+'" style="display: block;">이전</button><button class="slick-next slick-arrow" type="button" id="next-1" style="display: block;">다음</button></li></ul><div class="imageOptions hide" id="imageOptions-'+(index1+1)+'"></div></div>'


         //                var containerAdded = $("#inline-btn-container-" + layerid)

         //                containerAdded.append(template);


         //            }



         //        }



         //    })

         // }else{




         //            if($("#inline-btn-container-" + b.layers[index].totalLayerCount).length == 0){


         //                var container = '<div id="inline-btn-container-'+ b.layers[index].totalLayerCount +'" class="inline-btn-container"><div id="inline-btn-'+ (index+1) + b.layers[index].totalLayerCount +'" data-layerid="'+ b.layers[index].totalLayerCount +'" data-id="'+(index+1)+'" class="inline-btn hide" style="opacity: 0.8;width: 200px; background: rgb(10, 84, 142); box-shadow: 1px 3px 10px rgba(22,22,22,0.09); border-radius: 3px;position: absolute;z-index: 120;max-width: 400px;  left: 213px; top:251px"><ul class="gallery-ul-'+  b.layers[index].totalLayerCount +'"><li style="display: flex;align-items: center;height:36px"><div class="no-select" style="flex-basis: 50%;display:flex;justify-content: center"><p style="color:white">포토룸</p></div><iframe  name="'+ new Date().getTime() +'"  class="iframeImageUploader hide" style="width:62%; height:100%;border: 0px;" src="eyeIconFrame.html?param1='+(index+1)+'"></iframe><div style="flex-basis: 10%;position: absolute;pointer-events:none;right: 6px;z-index:120;height:20px"></div></li><li class="slickButton" data-id="'+(index+1)+'"><button class="slick-prev slick-arrow" type="button" id="prev-'+(index+1)+'" style="display: block;">이전</button><button class="slick-next slick-arrow" type="button" id="next-1" style="display: block;">다음</button></li></ul><div class="imageOptions hide" id="imageOptions-'+(index+1)+'"></div></div></div>'
         //                d1.append(container);

         //            }else{



         //     var template =  '<div id="inline-btn-'+ (index+1) + b.layers[index].totalLayerCount +'" data-layerid="'+ b.layers[index].totalLayerCount +'" data-id="'+(index+1)+'" class="inline-btn hide" style="opacity: 0.8;width: 200px; background: rgb(10, 84, 142); box-shadow: 1px 3px 10px rgba(22,22,22,0.09); border-radius: 3px;position: absolute;z-index: 120;max-width: 400px;  left: 213px; top:251px"><ul class="gallery-ul-'+  b.layers[index].totalLayerCount +'"><li style="display: flex;align-items: center;height:36px"><div class="no-select" style="flex-basis: 50%;display:flex;justify-content: center"><p style="color:white">포토룸</p></div><iframe  name="'+ new Date().getTime() +'"  class="iframeImageUploader hide" style="width:62%; height:100%;border: 0px;" src="eyeIconFrame.html?param1='+(index+1)+'"></iframe><div style="flex-basis: 10%;position: absolute;pointer-events:none;right: 6px;z-index:120;height:20px"></div></li><li class="slickButton" data-id="'+(index+1)+'"><button class="slick-prev slick-arrow" type="button" id="prev-'+(index+1)+'" style="display: block;">이전</button><button class="slick-next slick-arrow" type="button" id="next-1" style="display: block;">다음</button></li></ul><div class="imageOptions hide" id="imageOptions-'+(index+1)+'"></div></div>'


         //                var containerAdded = $("#inline-btn-container-" + b.layers[index].totalLayerCount)

         //                containerAdded.append(template);


         //            }





         // }
         //   // var template =  '<div id="inline-btn-container-293511550420817984" class="inline-btn-container"><div id="inline-btn-1293511550420817984" data-layerid="293511550420817984" data-id="1" class="inline-btn" style="opacity: 0.8; width: 200px; background: rgb(10, 84, 142); box-shadow: rgba(22, 22, 22, 0.09) 1px 3px 10px; border-radius: 3px; position: absolute; z-index: 120; max-width: 400px; left: 852px; top: 295px;"><ul><li style="display: flex;align-items: center;height:36px"><div class="no-select" style="flex-basis: 50%;display:flex;justify-content: center"><p style="color:white">포토룸</p></div><iframe class="iframeImageUploader" style="width:62%; height:100%;border: 0px;" src="eyeIconFrame.html?param1=1"></iframe><div style="flex-basis: 10%;position: absolute;pointer-events:none;right: 6px;z-index:120;height:20px"></div></li><li id="gallery-li-1293511550420817984" class="gallery-li"><div class="gallery slick-initialized slick-slider" data-id="1" id="gallery-1293511550420817984" style="width: 100%"><div class="slick-list draggable"><div class="slick-track" style="opacity: 1; width: 67px; transform: translate3d(0px, 0px, 0px);"><div class="slick-slide slick-current slick-active" style="width: 67px;" tabindex="0" data-slick-index="0" aria-hidden="false"><img data-tag="1" data-parent="1" class="sliderImages" id="image-293511550420817984-1550420857048" src=""></div></div></div></div></li><li class="slickButton" data-id="1"><button class="slick-prev slick-arrow" type="button" id="prev-1" style="display: block;">이전</button><button class="slick-next slick-arrow" type="button" id="next-1" style="display: block;">다음</button></li></ul><div class="imageOptions hide" id="imageOptions-1"></div></div> </div>'


       // })


       b.layers.map(function(a) {



        var container = '<div id="inline-btn-container-'+ a.totalLayerCount +'" class="inline-btn-container"></div>'

        console.log(d1)

        d1.append(container);

    });



       if (Object.keys(fileJSON.eyeIcon).length === 0) {
            // alert('empty obj')


            fileJSON.eyeIcon = fileJSON.allitems


        }


        var counterForImage = 0


        for (let layerid in fileJSON.allitems) {


        //layer


        if($("#inline-btn-container-" + layerid).length == 0){

            console.log('frist')


            var container = '<div id="inline-btn-container-'+ layerid +'" class="inline-btn-container"></div>'

            d1.append(container);


        }


        for (let eyeIconIndex in fileJSON.eyeIcon[layerid]) {



            console.log('second')

            var template =  '<div id="inline-btn-'+ eyeIconIndex + layerid +'" data-layerid="'+ layerid +'" data-id="'+eyeIconIndex+'" class="inline-btn hide" style="opacity: 0.8;width: 200px; background: rgb(10, 84, 142); box-shadow: 1px 3px 10px rgba(22,22,22,0.09); border-radius: 3px;position: absolute;z-index: 120;max-width: 400px;  left: 213px; top:251px"><ul class="gallery-ul-'+ layerid +'"><li style="display: flex;align-items: center;height:36px"><div class="no-select" style="flex-basis: 50%;display:flex;justify-content: center"><p style="color:white">포토룸</p></div><iframe class="iframeImageUploader hide" style="width:62%; height:100%;border: 0px;" src="eyeIconFrame.html?param1='+eyeIconIndex+'&v='+ new Date().getTime() +'"></iframe><div style="flex-basis: 10%;position: absolute;pointer-events:none;right: 6px;z-index:120;height:20px"></div></li><li id="gallery-li-'+ eyeIconIndex + layerid + '" class="gallery-li"><div class="gallery" data-id="'+ eyeIconIndex +'"  id="gallery-' + eyeIconIndex + layerid + '" style="width: 100%"></div></li><li class="slickButton" data-id="'+ eyeIconIndex +'"><button class="slick-prev slick-arrow" type="button" id="prev-'+eyeIconIndex+'" style="display: block;">이전</button><button class="slick-next slick-arrow" type="button" id="next-1" style="display: block;">다음</button></li></ul><div class="imageOptions hide" id="imageOptions-'+eyeIconIndex+'"></div></div>'


            var containerAdded = $("#inline-btn-container-" + layerid)

            if(eyeIconIndex != 0){

                containerAdded.append(template);
                
            }


            
            counterForImage = 0



            for (let singleElm in fileJSON.eyeIcon[layerid][eyeIconIndex]) {

                console.log(singleElm)
                console.log(singleElm)


                if(fileJSON.eyeIcon[layerid][eyeIconIndex][singleElm].src != "-37" && fileJSON.eyeIcon[layerid][eyeIconIndex][singleElm].src != undefined){

                   if(fileJSON.eyeIcon[layerid][eyeIconIndex][singleElm].type == 'video'){

                    var addingImages = '<div><img data-tag="'+ singleElm + '" data-parent="'+ eyeIconIndex +'" class="videoOpen" id="'+ fileJSON.eyeIcon[layerid][eyeIconIndex][singleElm].id + '" src="'+ fileJSON.eyeIcon[layerid][eyeIconIndex][singleElm].src + '"></div>'

                }else{

                    console.log("counterForImage")
                    console.log(fileJSON.eyeIcon[layerid][eyeIconIndex][singleElm].id )
                    console.log(counterForImage)

                    var addingImages = '<div><img data-current="'+ counterForImage +'" data-tag="'+ singleElm + '" data-parent="'+ eyeIconIndex +'" class="sliderImages" id="'+ fileJSON.eyeIcon[layerid][eyeIconIndex][singleElm].id + '" src="'+ fileJSON.eyeIcon[layerid][eyeIconIndex][singleElm].src + '"></div>'


                    counterForImage++

                }


                var imageContainer = $('#gallery-'+ eyeIconIndex + layerid)

                imageContainer.append(addingImages);



            }




        }
    }
}


$('.gallery').slick({
    infinite: true,
    slidesToShow: 3,
    slidesToScroll: 3,
    dots: false,
    prevArrow: false,
    nextArrow: false
})





$(".videoIcon").remove();

var slides = window.parent.document.getElementsByClassName("videoOpen");
for(var i = 0; i < slides.length; i++)
{
 slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
}


allitems = b.allitems

console.log("ssssssssssb")
console.log(allitems)

        // image

        // imageObjectCount = b.eyeIconLen


        console.log(layerUserID)

        if( b.permissionStatus == 1){

            layerUserID = b.permission.layerData
            console.log(layerUserID)
        }

        layerUserID.map(function(a) {

            if(a.layerName){

                a.layerName = a.layerName.replace(/^"(.*)"$/, '$1');

            }


            console.log("Layer FIle")
            console.log(a)

            if(!a.descrip){
                a.descrip = ""
            }

            if(b.permissionStatus == 1){


                var data = '<div id="layerTR-'+ a.totalLayerCount +'"><div style="border: 1px solid #f4f4f4"><div id="layerDiv-'+ a.totalLayerCount +'" class="layerDiv" data-section="'+ a.totalLayerCount+'" style="display: flex;justify-content: space-between; align-items: center; width: 100%; padding: 0 10px; box-sizing: border-box;"><input type="text" disabled class="mod temp 1 layernameP textareaEditStyle" style="flex-basis: 100%; font-weight: bold;display: flex; font-size: 13px;align-items:center;justify-content: space-between" value="'+ a.layerName + '"  id="layerName-'+ a.totalLayerCount +'" ><p class="newLayerNotice hide" id="newLayerNotice-'+ a.totalLayerCount +'">New</p><p style="flex-basis: 10%;width: 32px;height: 32px;border: 1px solid #1abdfe;box-sizing:border-box;margin-top:3px;font-size:10px;text-align:center;line-height:32px;font-weight: bold;color:#1abdfe;border-radius: 5px" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="upbutton tapHere" onclick="if(event.stopPropagation){}event.cancelBubble=true;goUp(\''+ a.totalLayerCount +'\')">UP</p></div><div class="layerSubDiv hide" data-subsection="'+ a.totalLayerCount +'" style="padding: 4px 10px 10px"><div style="display: flex;align-items: center;padding: 0 0 10px 5px;"><input id="allowNotification'+ a.totalLayerCount +'" type="checkbox" class="no-mar"><label style="font-size:12px;" class="no-margin no-padding" for="allowNotification'+ a.totalLayerCount +'">배지로 업데이트 알림</label></div><div class="layeraction"  id="layeraction-'+ a.totalLayerCount +'" style="display: flex;justify-content: space-between;padding: 0 10px"><p><img title="이 레이어 타이틀을 변경합니다" alt="이 레이어 타이틀을 변경합니다" class="editText tapHere" src="icons/editText.svg" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p><img title="이 레이어를 삭제합니다" alt="이 레이어를 삭제합니다" class="layerDelete tapHere" data-delete="'+ a.totalLayerCount +'" src="icons/delete_black.svg" style="width: 32px;height: 32px;border: 1px solid #1abdfe;object-fit:contain;padding:5px;box-sizing:border-box;"></p><p><img title="이 레이어의 변경사항을 저장합니다" alt="이 레이어의 변경사항을 저장합니다" src="icons/save.svg" class="saveLayer tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box;"></p><p><img title="이 레이어의 링크를 복사하여 다른이와 공유합니다" alt="이 레이어의 링크를 복사하여 다른이와 공유합니다" src="icons/link.svg" class="createURL tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p><img title="이 레이어를 복사해 클립보드에 저장합니다. 다른 레이어에 붙여 넣을수 있습니다" alt="이 레이어를 복사해 클립보드에 저장합니다. 다른 레이어에 붙여 넣을수 있습니다" src="icons/copy.svg" class="copyObject tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p class="cancelCopy hide tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;color:#1abdfe;text-align:center;line-height:29px;box-sizing:border-box;font-size:9px">cancel</p><p style="border:1px solid #1abdfe;width: 32px;height: 32px;box-sizing:border-box;font-size:10px;text-align:center;padding:4px;font-weight: bold;color:#1abdfe;" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="editButton tapHere"><img src="icons/edit.png"></p><p style="width: 32px;height: 32px;box-sizing:border-box;font-size:10px;text-align:center;line-height:32px;font-weight: bold;color:white;border:1px solid #1abdfe;" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="cancelEdit hide"><img style="width:16px" src="icons/cancel.png"></p></div><div class="hide textareaonedit-'+ a.totalLayerCount +'"><textarea class="textareaEditStyle textareascroll textareaeditCLick" onkeyup="auto_grow(this)" style="margin-top: 15px;min-height: 50px;width: 100%;height: 80px;max-height: 160px;overflow-y: auto;" disabled>'+ a.descrip +'</textarea></div><div style="display: flex; background-color: #f4f4f4; border-radius: 5px; align-items: center;margin-top:10px"><ul class="data-ul"> <li class="navToggleDrawing" id="navToggleDrawing-'+ a.totalLayerCount +'" class="no-select" style="position: relative;z-index: 3; display: flex;align-items: center;background-color: #F1F2F3;height: 72px;border: 1px solid rgba(149,12,154,0.12);"> <div style="flex-basis: 20%; text-align:center;align-items: center;display: flex;justify-content: center;"> <img  src="storage/'+ a.service_id +'/Private/'+ a.user_id +'/.info/_profile'+ a.user_id +'?v='+ new Date().getTime() +'" style="width: 46px;height:46px;border-radius:10px"> </div> <div style="flex-basis: 65%;display: flex;justify-content: flex-start;flex-direction: column;"> <p style="font-size: 12px;font-weight: bold;color: #727171;">'+ a.first_name + ' ' + a.last_name + '</p> <p style="font-size: 12px;color: #727171;">'+ a.email +'</p> <p style="font-size: 12px;color: #727171;">'+ a.job_position +' ' + a.company_name +'</p> </div> <div style="flex-basis: 15%;display: flex;justify-content: center;"> <img src="icons/navbar_icon_back.svg" class="navbar-toggler collapsed" style="height: 20px;width: 14px;"> </div> </li> <li style="position: relative;z-index: 2;top: 0; background-color: #f1f2f3;border: 1px solid rgba(149,12,154,0.12);height: 170px" id="mainNav" class="mainNav navbar collapsed hide"> <table> <tbody style="line-height: 35px"><tr><td style="font-size: 10px;color: #727171; line-height: 40px">Phone</td><td><div class="btn-blank"><a href="tel:'+ phone_1 +'" style="color:#00b6fe;font-size: 15px;margin-bottom: 0;padding: 0;background-color: transparent;">'+ phone_1 +'</a></div></td></tr><tr><td></td><td style="line-height: 40px"><div class="btn-blank"><a href="tel:'+ phone_2 +'" style="color:#00b6fe;font-size: 15px;margin-bottom: 0;padding: 0;background-color: transparent;">'+ phone_2 +'</a></div></td></tr><tr><td style="font-size: 10px;color: #727171; line-height: 40px">Email/SNS</td><td><div class="btn-blank"><a href="mailto:'+ email +'" style="font-size: 15px; color: #00b6fe; margin-bottom: 0;padding: 0;background-color: transparent;" target="_top">'+ email +'</a></div></td></tr></tbody> </table> <div style="display: flex;justify-content: space-around;padding: 0; align-items: center;position: relative;"> <div> <div class="btn-blank"><a href="skype:dhirusarania?chat"> <img src="assets/images/navicon/skype.svg" style="height: 36px;width: 36px;"></a></div> </div> <div> <div class="btn-blank"><a href="https://line.me/R/Sin5406"> <img src="icons/Image 118.svg" style="height: 36px;width: 36px;"></a> </div> </div> <div> <div class="btn-blank"><a href="https://twitter.com"> <img src="icons/twitter.svg" style="height: 36px;width: 36px;"></a></div> </div> <div> <div class="btn-blank"> <a  href="javascript:sendLink()"><img src="icons/Image 117.svg" style="height: 36px;width: 36px;"> </a></div> </div> </div> </li></ul></div></div></div></div>'



            }else{


                var data = '<div id="layerTR-'+ a.totalLayerCount +'"><div style="border: 1px solid #f4f4f4"><div id="layerDiv-'+ a.totalLayerCount +'" class="layerDiv" data-section="'+ a.totalLayerCount+'" style="display: flex;justify-content: space-between; align-items: center; width: 100%; padding: 0 10px; box-sizing: border-box;"><input type="text" disabled class="mod temp 1 layernameP textareaEditStyle" style="flex-basis: 100%; font-weight: bold;display: flex; font-size: 13px;align-items:center;justify-content: space-between" value="'+ a.layerName + '"  id="layerName-'+ a.totalLayerCount +'" ><p class="newLayerNotice hide" id="newLayerNotice-'+ a.totalLayerCount +'">New</p><p style="flex-basis: 10%;width: 32px;height: 32px;border: 1px solid #1abdfe;box-sizing:border-box;margin-top:3px;font-size:10px;text-align:center;line-height:32px;font-weight: bold;color:#1abdfe;border-radius: 5px" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="upbutton tapHere" onclick="if(event.stopPropagation){}event.cancelBubble=true;goUp(\''+ a.totalLayerCount +'\')">UP</p></div><div class="layerSubDiv hide" data-subsection="'+ a.totalLayerCount +'" style="padding: 4px 10px 10px"><div style="display: flex;align-items: center;padding: 0 0 10px 5px;"><input id="allowNotification'+ a.totalLayerCount +'" type="checkbox" class="no-mar"><label style="font-size:12px;" class="no-margin no-padding" for="allowNotification'+ a.totalLayerCount +'">배지로 업데이트 알림</label></div><div class="layeraction"  id="layeraction-'+ a.totalLayerCount +'" style="display: flex;justify-content: space-between;padding: 0 10px"><p><img title="이 레이어 타이틀을 변경합니다" alt="이 레이어 타이틀을 변경합니다" class="editText tapHere" src="icons/editText.svg" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p><img title="이 레이어를 삭제합니다" alt="이 레이어를 삭제합니다" class="layerDelete tapHere" data-delete="'+ a.totalLayerCount +'" src="icons/delete_black.svg" style="width: 32px;height: 32px;border: 1px solid #1abdfe;object-fit:contain;padding:5px;box-sizing:border-box;"></p><p><img title="이 레이어의 변경사항을 저장합니다" alt="이 레이어의 변경사항을 저장합니다" src="icons/save.svg" class="saveLayer tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box;"></p><p><img title="이 레이어의 링크를 복사하여 다른이와 공유합니다" alt="이 레이어의 링크를 복사하여 다른이와 공유합니다" src="icons/link.svg" class="createURL tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p><img title="이 레이어를 복사해 클립보드에 저장합니다. 다른 레이어에 붙여 넣을수 있습니다" alt="이 레이어를 복사해 클립보드에 저장합니다. 다른 레이어에 붙여 넣을수 있습니다" src="icons/copy.svg" class="copyObject tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;padding:5px;box-sizing:border-box"></p><p class="cancelCopy hide tapHere" style="width: 32px;height: 32px;border: 1px solid #1abdfe;color:#1abdfe;text-align:center;line-height:29px;box-sizing:border-box;font-size:9px">cancel</p><p style="border:1px solid #1abdfe;width: 32px;height: 32px;box-sizing:border-box;font-size:10px;text-align:center;padding:4px;font-weight: bold;color:#1abdfe;" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="editButton tapHere"><img src="icons/edit.png"></p><p style="width: 32px;height: 32px;box-sizing:border-box;font-size:10px;text-align:center;line-height:32px;font-weight: bold;color:white;border:1px solid #1abdfe;" title="이 레이어를 편집합니다" alt="이 레이어를 편집합니다" class="cancelEdit hide"><img style="width:16px" src="icons/cancel.png"></p></div><div class="hide textareaonedit-'+ a.totalLayerCount +'"><textarea class="textareaEditStyle textareascroll textareaeditCLick" onkeyup="auto_grow(this)" style="margin-top: 15px;min-height: 50px;width: 100%;height: 80px;max-height: 160px;overflow-y: auto;" disabled>'+ a.descrip +'</textarea></div><div style="display: flex; background-color: #f4f4f4; border-radius: 5px; align-items: center;margin-top:10px"><ul class="data-ul"> <li class="navToggleDrawing" id="navToggleDrawing-'+ a.totalLayerCount +'" class="no-select" style="position: relative;z-index: 3; display: flex;align-items: center;background-color: #F1F2F3;height: 72px;border: 1px solid rgba(149,12,154,0.12);"> <div style="flex-basis: 20%; text-align:center;align-items: center;display: flex;justify-content: center;"> <img src="storage/'+ a.service_id +'/Private/'+ a.user_id +'/.info/_profile'+ a.user_id +'?v='+ new Date().getTime() +'" style="width: 46px;height:46px;border-radius:10px"> </div> <div style="flex-basis: 65%;display: flex;justify-content: flex-start;flex-direction: column;"> <p style="font-size: 12px;font-weight: bold;color: #727171;">'+ a.first_name + ' ' + a.last_name + '</p> <p style="font-size: 12px;color: #727171;">'+ a.email +'</p> <p style="font-size: 12px;color: #727171;">'+ a.job_position +' ' + a.company_name +'</p> </div> <div style="flex-basis: 15%;display: flex;justify-content: center;"> <img src="icons/navbar_icon_back.svg" class="navbar-toggler collapsed" style="height: 20px;width: 14px;"> </div> </li> <li style="position: relative;z-index: 2;top: 0; background-color: #f1f2f3;border: 1px solid rgba(149,12,154,0.12);height: 170px" id="mainNav" class="mainNav navbar collapsed hide"> <table> <tbody style="line-height: 35px"><tr><td style="font-size: 10px;color: #727171; line-height: 40px">Phone</td><td><div class="btn-blank"><a href="tel:'+ phone_1 +'" style="color:#00b6fe;font-size: 15px;margin-bottom: 0;padding: 0;background-color: transparent;">'+ phone_1 +'</a></div></td></tr><tr><td></td><td style="line-height: 40px"><div class="btn-blank"><a href="tel:'+ phone_2 +'" style="color:#00b6fe;font-size: 15px;margin-bottom: 0;padding: 0;background-color: transparent;">'+ phone_2 +'</a></div></td></tr><tr><td style="font-size: 10px;color: #727171; line-height: 40px">Email/SNS</td><td><div class="btn-blank"><a href="mailto:'+ email +'" style="font-size: 15px; color: #00b6fe; margin-bottom: 0;padding: 0;background-color: transparent;" target="_top">'+ email +'</a></div></td></tr></tbody> </table> <div style="display: flex;justify-content: space-around;padding: 0; align-items: center;position: relative;"> <div> <div class="btn-blank"><a href="skype:dhirusarania?chat"> <img src="assets/images/navicon/skype.svg" style="height: 36px;width: 36px;"></a></div> </div> <div> <div class="btn-blank"><a href="https://line.me/R/Sin5406"> <img src="icons/Image 118.svg" style="height: 36px;width: 36px;"></a> </div> </div> <div> <div class="btn-blank"><a href="https://twitter.com"> <img src="icons/twitter.svg" style="height: 36px;width: 36px;"></a></div> </div> <div> <div class="btn-blank"> <a href="javascript:sendLink()"><img src="icons/Image 117.svg" style="height: 36px;width: 36px;"> </a></div> </div> </div> </li></ul></div></div></div></div>'



            }



            var d1 = $('#layerTable');



            d1.append(data);

            console.log("notification_list")
            console.log(notification_list)

            if(notification_list){
                for(i = 0; i < notification_list.length; i++){

                    console.log(notification_list[i], a.totalLayerCount)

                    if(notification_list[i] == a.totalLayerCount){
                        console.log('found it')
                        $("#newLayerNotice-" + a.totalLayerCount).removeClass('hide')
                    }

                }

                
            }




            if(a.user_id != user_id){
                console.log("not same user")

                $("#layeraction-" + a.totalLayerCount).find(".editButton").remove()

            }

            if(a.user_id != user_id && (usertype == 2 || usertype == 3)){



                console.log('this is reachewwwd')


                console.log(a.totalLayerCount)

                $("#layeraction-" + a.totalLayerCount).find(".saveLayer").parent().remove()
                $("#layeraction-" + a.totalLayerCount).find(".layerDelete").parent().remove()


            }


            if(a.user_id != user_id && (usertype == 0 || usertype == 1)){

                console.log('this is reached')


                console.log(a.totalLayerCount)


                $("#layeraction-" + a.totalLayerCount).find(".saveLayer").parent().remove()


            }


            layerOrderArray.pushUnique(a.totalLayerCount)

            savedCounter.pushUnique(a.totalLayerCount)


            if(a.isPassword == 1){
                $("#layeraction-" + a.totalLayerCount ).addClass('locked')
                $("#layeraction-" + a.totalLayerCount).siblings(".layerSubDiv").find(".saveLayer").addClass('deactive')
                $("#layeraction-" + a.totalLayerCount).find(".editButton").addClass('deactive')

                console.log("saved lyaer")

            }


            $("#hideThis").addClass('hide')

            if( b.permissionStatus == 1 ){


                permissionStatus = 1


                $("#permissionUserData").empty()

                var userdata =  '<div style="flex-basis: 20%; text-align:center;align-items: center;display: flex;justify-content: center;"> <img  src="' + b.permission.permittedInspector.UserProfileImage +'" onerror=this.src="images/noPic.png" style="width: 46px;height:46px;border-radius:10px"> </div> <div style="flex-basis: 65%;display: flex;justify-content: flex-start;flex-direction: column;"> <p style="font-size: 12px;font-weight: bold;color: #727171;">'+ b.permission.permittedInspector.first_name + ' ' + b.permission.permittedInspector.last_name + '</p> <p style="font-size: 12px;color: #727171;">'+ b.permission.permittedInspector.email +'</p> <p style="font-size: 12px;color: #727171;">'+ b.permission.permittedInspector.job_position +' ' + b.permission.permittedInspector.company_name +'</p></div><div id="excelArea"></div>' 

                var d1 = document.getElementById('permissionUserData');
                d1.insertAdjacentHTML('beforeend', userdata);


                layerFinished = 1

                $("#permissionArea").addClass('afterPermission')
                // $("#permissionUserData").addClass('afterPermission')

                $(".layeraction").removeClass('hide')
                // $(".editText").addClass('hide')
                $(".passwordLock").addClass('hide')
                $(".layerDelete").addClass('hide')
                $(".saveLayer").addClass('hide')
                $(".copyObject").addClass('hide')

                if(usertype == 0 || usertype == 1){


                    $("#cancelPermission").removeClass('hide')

                }else{


                    $("#cancelPermission").addClass('hide')

                }



                // $(".editText").parent().addClass('hide')
                $(".passwordLock").parent().addClass('hide')
                $(".layerDelete").parent().addClass('hide')
                $(".saveLayer").parent().addClass('hide')
                $(".copyObject").parent().addClass('hide')

                $("#permissionDone").addClass('deactive')
                $("#permission_action").addClass('hide')

                $("#createLayer").addClass('hide')
                $(".editButton").addClass('hide')

                $("#layerBody").css('padding-bottom', '0')

                $(".editButton").hide()
                $(".upbutton ").addClass('hide')


                $("#permission").html('승인완료')

                $("#permission").removeClass('hide')




                $("#permission_title").addClass('hide')
                $("#permission_desc").addClass('hide')
                $("#datenow").addClass('hide')
                $("#signIMG").addClass('hide')
                $(".custom-file-upload__drawing").addClass('hide')
                $(".custom-file-remove__drawing").addClass('hide')

                $("#zipDownload").removeClass('hide')



                $("#permission_title1").removeClass('hide')
                $("#permission_desc1").removeClass('hide')
                $("#datenow1").removeClass('hide')

                $("#permission_title1").html(b.permission.title)
                $("#permission_desc1").html(b.permission.desc)
                $("#datenow1").html(b.permission.date)

                var oldUrl = b.permission.downloadURL;
                var url = new URL(oldUrl);
                url.hostname = 'www.easypermit.net';
                url.href //'http://example.com:8080/one/two'


                $("#signIMGDone").attr("src", b.permission.signatureData)


                if(b.permission.excelfileurl){

                    $("#excelArea").prepend('<a data-place="permissionLoad" style="display: flex;flex-direction: column;align-items: center;" href="https://www.easypermit.net/test/spread/viewer.html?v=' + b.permission.excelfileurl + '" target="_blank"><img id="theImg" style="width: 30px;height: 100%;" src="assets/images/excel.svg" /><p style="width: 90px;text-align:center;word-break: break-all;font-size: 10px;">'+ b.permission.excelfileurl.replace(/^.*[\\\/]/, '') +'</p></a>')
                    
                }



                $("#zipDownload").attr('href', url.href)
                $("#signIMGDone").removeClass("hide")






            }else{


                $(".layeraction").removeClass('hide')
                $("#createLayer").removeClass('hide')
                // $(".editButton").removeClass('hide')
                $(".editButton").show()
                if(usertype != '3'){
                    $(".upbutton").removeClass('hide')
                }

                $("#layerBody").css('padding-bottom', '10px')

                $("#permission").html('작업내용승인')
                $("#permission").addClass('hide')

                $("#permission").addClass('hide')
                $("#permission_title").removeClass('hide')
                $("#permission_desc").removeClass('hide')
                $("#datenow").removeClass('hide')



                $("#permission_title1").addClass('hide')
                $("#permission_desc1").addClass('hide')
                $("#datenow1").addClass('hide')

                $("#permission_action").removeClass('hide')




            }



            if(usertype == 3){

                // $(".layeraction").addClass('hide')
                $("#permission").removeClass('hide')
                $(".editButton").addClass('hide')
                $(".upbutton").addClass('hide')
                $(".passwordLock").addClass('hide')
                $(".saveLayer").addClass('hide')
                $(".editText").addClass('hide')
                // $(".createURL").addClass('hide')
                $(".copyObject ").addClass('hide')
                $(".layerDelete").addClass('hide')
            }

                        // if(job_position != 1){
                        //  $(".editButton").hide()
                        // }
                        $(".inline-btn").addClass('hide')
                        

                        if(a.isPassword == 1){

                            $("#layerDiv-" + a.totalLayerCount).siblings('.layerSubDiv').find('.passwordLock').attr({
                                'src': 'assets/drawing2/icons/lock.svg',
                                'title': '레이어 잠김. 클릭하여 다른이의 편집을 허용할 수 있습니다 ',
                                'alt' : '레이어 잠김. 클릭하여 다른이의 편집을 허용할 수 있습니다 '
                            });

                        }   


                    })

// if( initialLayer == 1 ){
//  console.log("jmmmmmmmmmmmmmmmmmmmmmmm")
//  $("#layersButton").click()
//  $("#layerName-" + initialLayerID).click()
// }


b.canvasData.forEach(function (o) {


    console.log(o.id)   


    if(o.id == "imageObject"){
        o.src = window.location.origin + o.src.replace(/https?:\/\/[^\/]+/i, "");
        console.log(o.src)

    }


        // o.opacity = 0
        o.visible=false
        o.selectable =false
        console.log(o);
    });


fabric.util.enlivenObjects(b.canvasData, function (objects) {               
    console.log(objects);
    objects.forEach(function (o) {


        console.log(o.id)   


        if(o.id == "imageObject"){
            o.src = window.location.origin + o.src.replace(/https?:\/\/[^\/]+/i, "");
            console.log(o.src)

        }




        if(o.layerId == activeLayer){

            o.visible=true

        }else{

            o.visible=false

        }

        // o.opacity = 0
        o.selectable =false
        canvas.add(o);
        console.log(o);
    });

    canvas.renderAll();
});



// })
}

//      $('.gallery').slick({
//          infinite: true,
//          slidesToShow: 3,
//          slidesToScroll: 3,
//          dots: false,
//          prevArrow: false,
//          nextArrow: false
//      })


// $(".gallery").slick("unslick");

// $('.gallery').slick({
//          infinite: true,
//          slidesToShow: 3,
//          slidesToScroll: 3,
//          dots: false,
//          prevArrow: false,
//          nextArrow: false
//      })




$(window).trigger('resize')


// b.canvasData.forEach(function(o) {
//   canvas.add(o);
// });


// canvas.loadFromJSON(b.canvasData, function() {
//  $("#startP").hide()
//  backgroundImageLoaded=1
//  $("#layerSection").addClass('hide')
//  $(".canvas-container").removeClass('hide')
//  pausePanning = false;

//  // canvas.setZoom(b.canvasData.backgroundImage.defaultZoomValue)
//  canvas.renderAll(); 
// },function(o,object){
//  canvas.skipTargetFind = true
//  object.selectable = false
// })
}






$(document).ready(function(){


    $(".color-picker").spectrum({
        showInput: true,
        className: "full-spectrum",
        showInitial: true,
        showPalette: true,
        showAlpha: true,
        showSelectionPalette: true,
        maxSelectionSize: 10,
        preferredFormat: "rgb",
        localStorageKey: "spectrum.demo",
        move: function (color) {

        },
        show: function () {

        },
        beforeShow: function () {

            $('.color-picker').blur()
            $('.color-picker').focusout()
            console.log("thisthis")

        },
        hide: function () {

        },
        change: function( color) {
            freehandColor = color.toHexString();
            canvas.freeDrawingBrush.color = color.toHexString();

        },
        palette: [
        ["rgba(0, 0, 0, 0)","rgb(0, 0, 0)", "rgb(67, 67, 67)", "rgb(102, 102, 102)",
        "rgb(204, 204, 204)", "rgb(217, 217, 217)","rgb(255, 255, 255)"],
        ["rgb(152, 0, 0)", "rgb(255, 0, 0)", "rgb(255, 153, 0)", "rgb(255, 255, 0)", "rgb(0, 255, 0)",
        "rgb(0, 255, 255)", "rgb(74, 134, 232)", "rgb(0, 0, 255)", "rgb(153, 0, 255)", "rgb(255, 0, 255)"], 
        ["rgb(230, 184, 175)", "rgb(244, 204, 204)", "rgb(252, 229, 205)", "rgb(255, 242, 204)", "rgb(217, 234, 211)", 
        "rgb(208, 224, 227)", "rgb(201, 218, 248)", "rgb(207, 226, 243)", "rgb(217, 210, 233)", "rgb(234, 209, 220)", 
        "rgb(221, 126, 107)", "rgb(234, 153, 153)", "rgb(249, 203, 156)", "rgb(255, 229, 153)", "rgb(182, 215, 168)", 
        "rgb(162, 196, 201)", "rgb(164, 194, 244)", "rgb(159, 197, 232)", "rgb(180, 167, 214)", "rgb(213, 166, 189)", 
        "rgb(204, 65, 37)", "rgb(224, 102, 102)", "rgb(246, 178, 107)", "rgb(255, 217, 102)", "rgb(147, 196, 125)", 
        "rgb(118, 165, 175)", "rgb(109, 158, 235)", "rgb(111, 168, 220)", "rgb(142, 124, 195)", "rgb(194, 123, 160)",
        "rgb(166, 28, 0)", "rgb(204, 0, 0)", "rgb(230, 145, 56)", "rgb(241, 194, 50)", "rgb(106, 168, 79)",
        "rgb(69, 129, 142)", "rgb(60, 120, 216)", "rgb(61, 133, 198)", "rgb(103, 78, 167)", "rgb(166, 77, 121)",
        "rgb(91, 15, 0)", "rgb(102, 0, 0)", "rgb(120, 63, 4)", "rgb(127, 96, 0)", "rgb(39, 78, 19)", 
        "rgb(12, 52, 61)", "rgb(28, 69, 135)", "rgb(7, 55, 99)", "rgb(32, 18, 77)", "rgb(76, 17, 48)"]
        ]
    });

})




$(document).ready(function(){
    $("#toolbox").addClass('hide')

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);

})

$("#toolbutton").click(function(){

    console.log("toolbutton clicked")

    if(flag == 1 && !$("#toolbutton").hasClass('deactive')){

        var anv = $("#tool-main").hasClass('highlight')

        if(selection != 0){

            $('#selection').click()

        }

        // $(".inline-btn").addClass('hide');

        $("#toolbox").toggleClass('hide')

        $("#toolbox").css('transform', 'translate(0px, 0px)');
        $("#toolbox").attr('data-x', 0);
        $("#toolbox").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);

        // if(totalLayerCount > 0) $("#toolbox").removeClass('hide');

        console.log("toolbutton toggled")


        console.log("Selection before: " + selection)

        console.log("Selection after: " + selection)

    }


})



$("#toolbutton").click(function(event) {



    $("#layers").css('transform', 'translate(0px, 0px)');
    $("#layers").attr('data-x', 0);
    $("#layers").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);


    if(selection == 4  && polygonCreated == 0){

        escaped = 1

        prototypefabric.polygon.generatePolygon(pointArray);


        selection = 0;
        $(".selectedTool").removeClass('selectedTool')
        $("#selection").click()

    }


    // canvas.discardActiveObject()
    // canvas.renderAll()

    escaped = 0

    // $("#layerSection").addClass('hide')
    $("#liveeditbutton").addClass('hide')
    
    $("#test1").css('z-index', '105');
    $("#test2").css('z-index', '90');
    // $("#layers").addClass('hide')
    $(".mainNav").addClass('hide')

    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }


    $(".showbox").removeClass('show')
    if($(this).hasClass('highlight')){
        $(this).removeClass('highlight')
    }
    else{
        $('.highlight').removeClass('highlight')

        if($(this).hasClass('deactive')){

        }else{

            $(this).addClass('highlight')

        }

    }
});

$("#pdf-upload").click(function(event) {

    if(selection == 4  && polygonCreated == 0){

        escaped = 1

        prototypefabric.polygon.generatePolygon(pointArray);


        selection = 0;
        $(".selectedTool").removeClass('selectedTool')
        $("#selection").click()

    }


    canvas.discardActiveObject()
    canvas.renderAll()

    escaped = 0
    if(!$("#layerSection").hasClass('hide')){
        $("#layerSection").addClass('hide')
    }
    else{
        $("#layerSection").removeClass('hide')
        $("#liveeditbutton").addClass('hide')
        $("#toolbox").addClass('hide');

        $("#toolbox").css('transform', 'translate(0px, 0px)');
        $("#toolbox").attr('data-x', 0);
        $("#toolbox").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);


        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);
        $("#layers").attr('data-y', 0);
        $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')

        $("#test1").css('z-index', '103');
        $("#test2").css('z-index', '90');
    }

    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }


    $(".showbox").removeClass('show')

});
$("#liveedit").click(function(event) {

    if(selection == 4  && polygonCreated == 0){

        escaped = 1

        prototypefabric.polygon.generatePolygon(pointArray);


        selection = 0;
        $(".selectedTool").removeClass('selectedTool')
        $("#selection").click()

    }


    canvas.discardActiveObject()
    canvas.renderAll()

    escaped = 0
    if(!$("#liveeditbutton").hasClass('hide')){
        $("#liveeditbutton").addClass('hide')
        $("#liveedit").removeClass('highlight')

    }
    else{
        $("#layerSection").addClass('hide')
        $("#liveeditbutton").removeClass('hide')
        $("#toolbox").addClass('hide');

        $("#toolbox").css('transform', 'translate(0px, 0px)');
        $("#toolbox").attr('data-x', 0);
        $("#toolbox").attr('data-y', 0);

        $(".bwinPopupd").addClass('hide')

        $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
        $(".bwinPopupd").attr('data-x', 0);
        $(".bwinPopupd").attr('data-y', 0);


        $("#layers").css('transform', 'translate(0px, 0px)');
        $("#layers").attr('data-x', 0);
        $("#layers").attr('data-y', 0);
        $("#layers").addClass('hide')
        $(".mainNav").addClass('hide')
        $(".highlight").removeClass('highlight')
        $("#liveedit").addClass('highlight')
        $("#test1").css('z-index', '103');
        $("#test2").css('z-index', '90');
    }

    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }

    $(".showbox").removeClass('show')
    $(".inline-btn").addClass('hide')
});


$("#layersButton").click(function(event) {



    $("#layers").css('transform', 'translate(0px, 0px)');
    $("#layers").attr('data-x', 0);
    $("#layers").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);


    // $("#modeToggler").addClass('hide')

    if(selection == 4  && polygonCreated == 0){

      escaped = 1

      prototypefabric.polygon.generatePolygon(pointArray);


      if(canvas.getActiveObjects().length == 0){

          selection = 0;
          $(".selectedTool").removeClass('selectedTool')
          $("#selection").click()


      }



  }



  if(canvas.getActiveObjects().length == 0){

   canvas.discardActiveObject()
   canvas.renderAll()

}

escaped = 0


if(backgroundImageLoaded == 1 || isPdfUpload == 1){ 

  if(!$("#layers").hasClass('hide')){


     $("#layers").addClass('hide')
     $(".mainNav").addClass('hide')
     $('.highlight').removeClass('highlight')
 }
 else{
     $("#layerSection").addClass('hide')
     $("#layers").removeClass('hide')
     $("#liveeditbutton").addClass('hide')

     if(objectAdded == 1 && editON == 1){

        $("#toolbox").removeClass('hide');

    }else{


        $("#toolbox").addClass('hide');


    }


    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);
    $("#test1").css('z-index', '103');
    $("#test2").css('z-index', '90');
    $('.highlight').removeClass('highlight')
    $(this).addClass('highlight')
}
$(".showbox").removeClass('show')
$(".inline-btn").addClass('hide')
}

//          if( initialLayer == 1 ){
//  console.log("jmmmmmmmmmmmmmmmmmmmmmmm")
//  $("#layerName-" + initialLayerID).click()
// }

});


$("#zoominbutton").click(function(event) {

    if(selection == 4  && polygonCreated == 0){

        escaped = 1

        prototypefabric.polygon.generatePolygon(pointArray);


        selection = 0;
        $(".selectedTool").removeClass('selectedTool')
        $("#selection").click()

    }


    canvas.discardActiveObject()
    canvas.renderAll()

    escaped = 0
    $("#layerSection").addClass('hide')
    $("#liveeditbutton").addClass('hide')
    $("#toolbox").addClass('hide');

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);


    $("#layers").css('transform', 'translate(0px, 0px)');
    $("#layers").attr('data-x', 0);
    $("#layers").attr('data-y', 0);


    $("#layers").addClass('hide')
    $(".mainNav").addClass('hide')
    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }

    $(".showbox").removeClass('show')
});
$("#zoomoutbutton").click(function(event) {

    if(selection == 4  && polygonCreated == 0){

        escaped = 1

        prototypefabric.polygon.generatePolygon(pointArray);


        selection = 0;
        $(".selectedTool").removeClass('selectedTool')
        $("#selection").click()

    }


    canvas.discardActiveObject()
    canvas.renderAll()

    escaped = 0
    $("#layerSection").addClass('hide')
    $("#liveeditbutton").addClass('hide')
    $("#toolbox").addClass('hide');

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);

    $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);


    $("#layers").css('transform', 'translate(0px, 0px)');
    $("#layers").attr('data-x', 0);
    $("#layers").attr('data-y', 0);

    $("#layers").addClass('hide')
    $(".mainNav").addClass('hide')
    if($("#submitText").length != 0){
        $("#layerName-" + prevActive).html(inputTempBuffer)
        $('.temp').remove()
    }

    $(".showbox").removeClass('show')
});



function convertHex(color,opacity){
  var oldBGColor = color //rgb(100,100,100),
     newBGColor = oldBGColor.replace('rgb', 'rgba').replace(')', ',' + opacity + ')')//rgba(100,100,100,.8);
     console.log(oldBGColor)

     return newBGColor

 }

 function rgb2hex(rgb){
    rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return (rgb && rgb.length === 4) ? "#" +
    ("0" + parseInt(rgb[1],10).toString(16)).slice(-2) +
    ("0" + parseInt(rgb[2],10).toString(16)).slice(-2) +
    ("0" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';
}

 // (function($){
 //    $.fn.focusTextToEnd = function(){
 //        this.focus();
 //        var $thisVal = this.val();
 //        if($thisVal != ''){
 //            this.val('').val($thisVal);
 //        }

 //        console.log(this.val('').val($thisVal))

 //        return this;
 //    }
 // }(jQuery));

 $(document).on('click', 'input:not([type="file"]):not([type="checkbox"])', function(event) {


 });


 $(document).on('click', '.mod', function(event) {

    event.stopPropagation()

});



 // $('textarea').click(function(){
 //    this.focus();
 //    $(this).focusTextToEnd();
 // });

 // $(document).on('click', 'textarea', function(event) {
 //    this.focus();
 //    $(this).focusTextToEnd();
 // });

 var parent, idHere


 function deleteVideo(parent){

    $('#gallery-' + parent + activeLayer + '.slick-initialized').slick("unslick");
    
    $('#gallery-li-'+ parent + activeLayer).removeClass('hide')


    $("#" + idHere).parent().remove()
    $('#gallery-'+ parent + activeLayer).slick({
        infinite: true,
        slidesToShow: 3,
        slidesToScroll: 3,
        dots: false,
        prevArrow: false,
        nextArrow: false
    })

    $("#div_video").hide()




    $(".videoIcon").remove();

    var slides = window.parent.document.getElementsByClassName("videoOpen");
    for(var i = 0; i < slides.length; i++)
    {
     slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
 }





 allitems[activeLayer][parent].filter(function(obj, index){
   if(obj.id == idHere){
    allitems[activeLayer][parent].splice(index,1)
};
})



 $(".slickButton").addClass('hide')
 $('#gallery-'+ valThis + activeLayer).addClass('hide')

 objs = canvas.getObjects().map(function(selected_object) {

    if(selected_object.id == 'imageObject' &&  selected_object.layerCount == parent){

        console.log(selected_object)

        if(allitems[activeLayer][2].length == 0){

            src = "file:///android_asset/drawing2/icons/eye.svg"

            selected_object.setSrc(src, function () {
                canvas.renderAll();

            });
        }

    }
}); 


 imageAction = 1


 $("#layeraction-" + activeLayer + " .saveLayer").click()

}



function setvideo(src, dataVal11) {
    document.getElementById('div_video').innerHTML = '<div class="btn closeDiv" onclick="$(this).parent().hide()" style="right: 0;position: fixed;margin: 30px;"><p>X</p></div> <div class="btn deleteVideo" onclick="deleteVideo('+ dataVal11 + ')" style="right: 75px;position: fixed;margin: 30px;"><img style="height: 30px;" src="icons/delete.svg"></div> <video controls id="video_ctrl" style="height: 50%; width: 50%;"><source src="'+src+'" type="video/mp4"></video>';
    // document.getElementById('video_ctrl').play();

    if(editON == 1){
        $(".deleteVideo ").removeClass('hide')
    }else{
        $(".deleteVideo ").addClass('hide')

    }

    $("#div_video").show()


}

$(document).on('click', '.videoOpen', function(event) {

    console.log($(this))


    var dataVal11 = $(this).attr('data-parent')
    idHere = $(this).attr('id')

    console.log(dataVal11 , idHere)

    items = allitems[activeLayer][dataVal11].filter(function(obj, index){
      return obj.id == idHere;
  })



    console.log(items)





        // window.open(items[0].url, '_blank')


        setvideo(items[0].url, dataVal11);







    })


$(document).on('click', '.sliderImages', function(event) {



    valThis = activeLayer
    // valThis = $(this).attr('data-parent');

    console.log(valThis)
    console.log("valThis")

    parent = parseInt($(this).attr('data-parent'));
    console.log(parent)
    if(allitems[valThis].length != 0 ){

        current = parseInt($(this).attr('data-current'));

        console.log(current)

        var pswpElement = document.querySelectorAll('.pswp')[0];

        items = allitems[valThis][parent]


        items = items.filter(function(obj, index){
          return obj.type !='video';
      })


        console.log(items)

        for(var itr = 0; itr < items.length; itr++){

            if(items[itr] != null){

                items[itr].src = window.location.origin + items[itr].src.replace(/https?:\/\/[^\/]+/i, "");

            }


        }


        console.log(items)


        var options = {

            history: false,
            focus: false,
            likeEl: true,

            showAnimationDuration: 0,
            hideAnimationDuration: 0

        };

        gallery = new PhotoSwipe($('.pswp')[0], PhotoSwipeUI_Default, items, options)
        gallery.listen('close', function() { 
            photoswipeClose = 0
        });
        gallery.init();
        if(photoswipeClose == 0){
            console.log(current)  
            gallery.goTo(current);
            photoswipeClose = 1
        }
    }


});

 // $(document).on('click', '.snapimages', function(event) {
 //     

 //     valThis = $(this).attr('data-parent');

 //     console.log("dfd")

 //     if(allitems[valThis].length != 0 ){

 //         current = parseInt($(this).parent().attr('data-slick-index'));

 //         var pswpElement = document.querySelectorAll('.pswp')[0];

 //         items = allitems[valThis]

 //         var options = {

 //             history: false,
 //             focus: false,
 //             likeEl: true,

 //             showAnimationDuration: 0,
 //             hideAnimationDuration: 0

 //         };

 //         gallery = new PhotoSwipe($('.pswp')[0], PhotoSwipeUI_Default, items, options)
 //         gallery.listen('close', function() { 
 //             photoswipeClose = 0
 //         });
 //         gallery.init();
 //         if(photoswipeClose == 0){
 //             gallery.goTo(current);
 //             photoswipeClose = 1
 //         }
 //     }


 // });



 function deleteImage(){






    if(isMobile == 0 && is_touch_device() == false ){


        var length = allitems[valThis].length


        console.log(valThis)


        var currentIndex = gallery.getCurrentIndex() 
        console.log(currentIndex)


        // parent = parseInt($("#gallery-"+ valThis + " .sliderImages" ).parent().attr("data-slick-index"))


        console.log(parent)


        var id = allitems[valThis][parent][currentIndex].id

        var src = allitems[valThis][parent][currentIndex].src

        jQuery.ajax({
            contentType: false,
            cache: false,
            processData: false,
            url: 'file:///android_assets/views/phppages/allProjectController.php?deleteImage=deleteImage&url=' + src,
            success: function (result) {

                result = JSON.parse(result)

                console.log(result)

                if(result.status == "success" || result.status == "404"){

                    // $("#filename").val("Deleted Image")

                    var timestamp = allitems[valThis][parent][currentIndex].id

                    allitems[valThis][parent].splice(currentIndex,1);

                    console.log(allitems)



                    console.log("#" + timestamp)


        // $("#" + timestamp).parent().remove()



        $('#gallery-' + valThis + activeLayer).slick('slickRemove',$('#' + id).parent().attr('data-slick-index'));

        gallery.close()

        console.log('#gallery-'+ parent + activeLayer)
        $('#gallery-' + parent + activeLayer + '.slick-initialized').slick("unslick");
        $('#gallery-li-'+ parent + activeLayer).removeClass('hide')
        console.log(items)

        $("#" + timestamp).parent().remove()
        $('#gallery-'+ parent + activeLayer).slick({
            infinite: true,
            slidesToShow: 3,
            slidesToScroll: 3,
            dots: false,
            prevArrow: false,
            nextArrow: false
        })




        $(".videoIcon").remove();

        var slides = window.parent.document.getElementsByClassName("videoOpen");
        for(var i = 0; i < slides.length; i++)
        {
         slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
     }


     console.log(items)


     if(allitems[valThis][parent].length != 0){

        console.log(items)

        var pswpElement = document.querySelectorAll('.pswp')[0];

        items = allitems[valThis][parent]


        console.log(items)


        var options = {

            history: false,
            focus: false,
            likeEl: true,

            showAnimationDuration: 0,
            hideAnimationDuration: 0

        };




        gallery = new PhotoSwipe($('.pswp')[0], PhotoSwipeUI_Default, items, options);



        gallery.init();



    }else{

        $(".slickButton").addClass('hide')
        $('#gallery-'+ valThis + activeLayer).addClass('hide')


        src = "icons/eye.svg"

        canvas.getActiveObject().setSrc(src, function () {
            canvas.renderAll();

        });

            // objs = canvas.getObjects().map(function(selected_object) {

            //     console.log(selected_object)

            //     if(selected_object.id == 'imageObject' && selected_object.layerCount == valThis){

            //         src = "icons/eye.svg"

            //         selected_object.setSrc(src, function () {
            //             canvas.renderAll();

            //         });
            //     }
            // }); 
        }


        console.log('this is itsss')

        imageAction = 1

                    // $(".saveLayer").click()

                    $("#layeraction-" + activeLayer + " .saveLayer").click()

                }else if(result.status == "failed"){
                    alert('error on image deletion')
                }

            }

        })

        console.log('this is itsss')


    }

}


if (!HTMLCanvasElement.prototype.toBlob) {
    Object.defineProperty(HTMLCanvasElement.prototype, 'toBlob', {
        value: function(callback, type, quality) {

            var binStr = atob(this.toDataURL(type, quality).split(',')[1]),
            len = binStr.length,
            arr = new Uint8Array(len);

            for (var i = 0; i < len; i++) {
                arr[i] = binStr.charCodeAt(i);
            }

            callback(new Blob([arr], {type: type || 'image/png'}));
        }
    });
}

window.URL = window.URL || window.webkitURL;

// Modified from https://stackoverflow.com/a/32490603, cc by-sa 3.0
// -2 = not jpeg, -1 = no data, 1..8 = orientations
function getExifOrientation(file, callback) {
    // Suggestion from http://code.flickr.net/2012/06/01/parsing-exif-client-side-using-javascript-2/:
    if (file.slice) {
        file = file.slice(0, 131072);
    } else if (file.webkitSlice) {
        file = file.webkitSlice(0, 131072);
    }

    var reader = new FileReader();
    reader.onload = function(e) {
        var view = new DataView(e.target.result);
        if (view.getUint16(0, false) != 0xFFD8) {
            callback(-2);
            return;
        }
        var length = view.byteLength, offset = 2;
        while (offset < length) {
            var marker = view.getUint16(offset, false);
            offset += 2;
            if (marker == 0xFFE1) {
                if (view.getUint32(offset += 2, false) != 0x45786966) {
                    callback(-1);
                    return;
                }
                var little = view.getUint16(offset += 6, false) == 0x4949;
                offset += view.getUint32(offset + 4, little);
                var tags = view.getUint16(offset, little);
                offset += 2;
                for (var i = 0; i < tags; i++)
                    if (view.getUint16(offset + (i * 12), little) == 0x0112) {
                        callback(view.getUint16(offset + (i * 12) + 8, little));
                        return;
                    }
                }
                else if ((marker & 0xFF00) != 0xFF00) break;
                else offset += view.getUint16(offset, false);
            }
            callback(-1);
        };
        reader.readAsArrayBuffer(file);
    }

// Derived from https://stackoverflow.com/a/40867559, cc by-sa
function imgToCanvasWithOrientation(img, rawWidth, rawHeight, orientation) {
    var canvas = document.createElement('canvas');
    if (orientation > 4) {
        canvas.width = rawHeight;
        canvas.height = rawWidth;
    } else {
        canvas.width = rawWidth;
        canvas.height = rawHeight;
    }

    if (orientation > 1) {
        console.log("EXIF orientation = " + orientation + ", rotating picture");
    }

    var ctx = canvas.getContext('2d');
    switch (orientation) {
        case 2: ctx.transform(-1, 0, 0, 1, rawWidth, 0); break;
        case 3: ctx.transform(-1, 0, 0, -1, rawWidth, rawHeight); break;
        case 4: ctx.transform(1, 0, 0, -1, 0, rawHeight); break;
        case 5: ctx.transform(0, 1, 1, 0, 0, 0); break;
        case 6: ctx.transform(0, 1, -1, 0, rawHeight, 0); break;
        case 7: ctx.transform(0, -1, -1, 0, rawHeight, rawWidth); break;
        case 8: ctx.transform(0, -1, 1, 0, 0, rawWidth); break;
    }
    ctx.drawImage(img, 0, 0, rawWidth, rawHeight);
    return canvas;
}


function reduceFileSize(file, acceptFileSize, maxWidth, maxHeight, quality, callback) {
    if (file.size <= acceptFileSize) {
        callback(file);
        return;
    }
    var img = new Image();
    img.onerror = function() {
        URL.revokeObjectURL(this.src);
        callback(file);
    };
    img.onload = function() {
        URL.revokeObjectURL(this.src);
        getExifOrientation(file, function(orientation) {
            var w = img.width, h = img.height;
            var scale = (orientation > 4 ?
                Math.min(maxHeight / w, maxWidth / h, 1) :
                Math.min(maxWidth / w, maxHeight / h, 1));
            h = Math.round(h * scale);
            w = Math.round(w * scale);

            var canvas = imgToCanvasWithOrientation(img, w, h, orientation);
            canvas.toBlob(function(blob) {
                console.log("Resized image to " + w + "x" + h + ", " + (blob.size >> 10) + "kB");
                callback(blob);
            }, 'image/jpeg', quality);
        });
    };
    img.src = URL.createObjectURL(file);
}

// var imagesPreview = function(input, imageCount) {

//     var $img

//     if (input.files) {
//         var filesAmount = input.files.length;

//         var counter = 0

//         console.log(input.files)

//         total_byte = input.files["0"].size


//         jQuery.ajax({
//             url: 'file:///android_assets/views/phppages/allProjectController.php?getStorage1=getStorage1&upload_size=' + total_byte,

//             async: false,
//             success: function (result) {

//                 result = JSON.parse(result)
//                 console.log(result)
//                 if (result.result == "full") {
//                     console.log("failed full")

//                     $("#fullStorageOnPhotoUpload-modal").removeClass("close")


//                 } else if(result.result == "success") {
//                     console.log("success")


//                     for (i = 0; i < filesAmount; i++) {
//                         var reader = new FileReader();
//                         var file;
//                         staticNumb = 0;

//                         counter++;








//                         reader.onload = function(event) {


//                             $(".loader").css('background', 'rgba(255,255,255,0.7)');
//                             $(".loader").show().fadeIn('slow');

//                             staticNumb++
//                             if( staticNumb == 1 ){

//                                 console.log(event)

//                                 var MAX_HEIGHT
//                                 var imageData

//                                 var timestamp = Date.now();





//                                 var image = new Image();
//                                 image.onload = function(){




//                                     var temp_height = image.height
//                                     var temp_width = image.width








//                                     var canvas = document.createElement('canvas');
//                                     canvas.id = 'imageCanvas'
//                                     document.getElementById("body").appendChild(canvas);

//                         // MAX_HEIGHT = (image.height * 70) / 100
//                         MAX_HEIGHT = 50


//                         image.width *= MAX_HEIGHT / image.height;
//                         image.height = MAX_HEIGHT;


//                         var ctx = canvas.getContext("2d");


//                         ctx.clearRect(0, 0, canvas.width, canvas.height);


//                         canvas.width = image.width;
//                         canvas.height = image.height;
//                         ctx.drawImage(image, 0, 0, image.width, image.height);
//                         imageData = canvas.toDataURL("image/jpeg");



//                         if(_correction == 6){

//                             canvas.remove()


//                             doIt(imageData, imageCount, temp_width, temp_height ,input,timestamp)

//                         }

//                         else{


//                             reduceFileSize(input.files[0], 500*1024, 2000, Infinity, 0.5, blob => {
//                                 let body = new FormData();
//                                 body.set('file', blob,  blob.name || "file.jpg");
//                                 body.set('filename', getFile.url);
//                                 body.set('activeLayer', activeLayer);
//                                 body.set('imageCount', imageCount);
//                                 console.log(blob)
//                                 console.log(body)
//                                 fetch('textImageServer.php', {method: 'POST', body})
//                                 .then((res) => { return res.text();})
//                                 .then((data) => { 
//                                     console.log(data)  
//                                     var data = JSON.parse(data)
//                                     console.log(data)
//                                     console.log(body)

//                                     if(data.status == "success"){






//                                         imageO = { src: data.path, w: temp_width, h: temp_height, id: "image-" + activeLayer + '-' + timestamp   }

//                                         console.log(imageO)

//                                         buffer.push(imageO)

//                                         console.log(buffer)
//                                         console.log(imageCount)

//                             // buffer1[imageCount] = buffer

//                         //  if (!Array.isArray(allitems) || !allitems.length) {

//                             //      allitems[activeLayer] = []

//                             //      console.log("asss")

//                             //      allitems[activeLayer] = imageO
//                             // }

//                             // imageCount = imageCountArray[activeLayer]

//                             console.log("ImageCountL " + imageCount)


//                             if(allitems[activeLayer] == undefined){
//                                 console.log("aaaa")
//                                 allitems[activeLayer] = []
//                             }

//                             if(allitems[activeLayer][imageCount] == undefined){
//                                 console.log("aaaa")
//                                 allitems[activeLayer][imageCount] = []
//                             }



//                             // if ( allitems[activeLayer][imageCount] !== void 0 && allitems[activeLayer] !== void 0){

//                             //  allitems[activeLayer][imageCount] = []

//                             //  console.log("aaaaaaaaaaaaaaaaaaaaaaaa")

//                             // }

//                             allitems[activeLayer][imageCount].reverse();


//                             allitems[activeLayer][imageCount].push(imageO)


//                             allitems[activeLayer][imageCount].reverse();
//                             // console.log(allitems)


//                             // if ( allitems[activeLayer] !== void 0 ){ allitems[activeLayer][imageCount] = 1; buffer = allitems[activeLayer][imageCount]; console.log("runnnn") }

//                             console.log(allitems)

//                             imageO.length = 0

//                             console.log("imageAction")

//                             imageAction = 1

//                             console.log(imageAction)

//                             console.log("imageAction")
//                             console.log(imageAction)
//                             $("#layeraction-" + activeLayer + " .saveLayer").click()

//                         }else if(data.status == "error" && data.type == "not jpg"){

//                             $('#image-' +  activeLayer + '-' + timestamp).unwrap()
//                             $('#image-' +  activeLayer + '-' + timestamp).parent().remove()

//                             $('.gallery').slick("unslick")

//                             $('.gallery').slick({
//                                 infinite: true,
//                                 slidesToShow: 3,
//                                 slidesToScroll: 3,
//                                 dots: false,
//                                 prevArrow: false,
//                                 nextArrow: false
//                             })


//                             $("#jpgpngonly-modal").removeClass('close')


//                         }else if(data.status == "error"){

//                             $('#image-' +  activeLayer + '-' + timestamp).unwrap()
//                             $('#image-' +  activeLayer + '-' + timestamp).parent().remove()

//                             $('.gallery').slick("unslick")

//                             $('.gallery').slick({
//                                 infinite: true,
//                                 slidesToShow: 3,
//                                 slidesToScroll: 3,
//                                 dots: false,
//                                 prevArrow: false,
//                                 nextArrow: false
//                             })


//                             $("#uploadfailed-modal").removeClass('close')

//                         }


//                         $('.loaderSmall').remove()
//                         $('.inline-image').show()

//                     });
// });



//     //                         $.ajax({
//     //                             url: "textImageServer.php",
//     //                             cache: false,
//     //                              xhr: function () {
//     //     var xhr = $.ajaxSettings.xhr();
//     //     xhr.upload.onprogress = function (e) {
//     //         if (e.lengthComputable) {
//     //             console.log(e.loaded / e.total);
//     //             $("#filename").val(e.loaded / e.total)
//     //         }
//     //     };
//     //     return xhr;
//     // },
//     //                             dataType: 'json',
//     //                             contentType: false,
//     //                             processData: false,
//     //                                     data: myFormData,                         // Setting the data attribute of ajax with file_data
//     //                                     type: 'post'
//     //                                 }).success(function(data, status, headers, config) {
//     //                                     console.log(data);




//     //                     });




//     _imageCount++

//     var d1 = document.getElementById('gallery-'+ imageCount + activeLayer);

//     d1.insertAdjacentHTML('beforeend', '<div><img data-tag="'+ _imageCount + '" data-parent="'+ imageCount +'" class="sliderImages" id="image-' +  activeLayer + '-' + timestamp + '" src="' + imageData +'"></div>');



//     var buffer1 = {}

//                             // buffer.length = 0


//                             console.log("sdsdssssssssssssssssssssssssssssssss")
//                             console.log(imageCount)



//                             //  console.log(buffer)

//                             //  buffer.unshift(imageO)

//                             // allitems[activeLayer][imageCount] = buffer


//                             $img = $("#image-" + activeLayer)



//                             switch(_correction) {
//                                 case 2:
//                                 $img.addClass('flip'); break;
//                                 case 3:
//                                 $img.addClass('rotate-180'); break;
//                                 case 4:
//                                 $img.addClass('flip-and-rotate-180'); break;
//                                 case 5:
//                                 $img.addClass('flip-and-rotate-270'); break;
//                                 case 6:
//                                 $img.addClass('rotate-90'); break;
//                                 case 7:
//                                 $img.addClass('flip-and-rotate-90'); break;
//                                 case 8:
//                                 $img.addClass('rotate-270'); break;
//                             }


//                             slideIndex++

//                             console.log("imageCount" + imageCount + activeLayer)
//                             $('#gallery-'+ imageCount + activeLayer).slick("unslick");
//                             $('#gallery-li-'+ imageCount + activeLayer).removeClass('hide')

//                             $('#gallery-'+ imageCount + activeLayer).slick({
//                                 infinite: true,
//                                 slidesToShow: 3,
//                                 slidesToScroll: 3,
//                                 dots: false,
//                                 prevArrow: false,
//                                 nextArrow: false
//                             })

//                             $('#gallery-'+ imageCount + activeLayer).removeClass('hide')


//                             $(".slickButton").removeClass('hide')

//                             canvas.remove()

//                             console.log('Image Uploaded successfully')

//                             $(".loader").hide().fadeOut('slow');




//                         }





//                     };
//                     image.src = event.srcElement.result;






//                 }



//             }

//             if( counter <= filesAmount ) {


//                 getOrientation(input.files[0], function(orientation) {
//                     _correction = orientation


//                 })


//                 reader.readAsDataURL(input.files[i])

//                 objs = canvas.getObjects().map(function(selected_object) {

//                     if(selected_object.id == 'imageObject' &&  selected_object.layerCount == imageCount){

//                         src = "icons/eyeGreen.svg"

//                         selected_object.setSrc(src, function () {
//                             canvas.renderAll();

//                         });
//                     }
//                 }); 



//             }

//         }
//     }
// },
// });



// }

// };

$(document).on('click', '#layerCloseButton', function() { 

    $("#toolbox").addClass('hide');

    $("#toolbox").css('transform', 'translate(0px, 0px)');
    $("#toolbox").attr('data-x', 0);
    $("#toolbox").attr('data-y', 0);                            $(".bwinPopupd").addClass('hide')

    $(".bwinPopupd").css('transform', 'translate(0px, 0px)');
    $(".bwinPopupd").attr('data-x', 0);
    $(".bwinPopupd").attr('data-y', 0);
    $('#layersButton').click(); 
});



$(document).on('click', '.custom-file-input', function() { 
    $(this).val(''); 
});

function getOrientation(file, callback) {
    var reader = new FileReader();
    reader.onload = function(e) {

        var view = new DataView(e.target.result);
        if (view.getUint16(0, false) != 0xFFD8) return callback(-2);
        var length = view.byteLength, offset = 2;
        while (offset < length) {
            var marker = view.getUint16(offset, false);
            offset += 2;
            if (marker == 0xFFE1) {
                if (view.getUint32(offset += 2, false) != 0x45786966) return callback(-1);
                var little = view.getUint16(offset += 6, false) == 0x4949;
                offset += view.getUint32(offset + 4, little);
                var tags = view.getUint16(offset, little);
                offset += 2;
                for (var i = 0; i < tags; i++)
                    if (view.getUint16(offset + (i * 12), little) == 0x0112){
                        return callback(view.getUint16(offset + (i * 12) + 8, little));
                    }
                }
                else if ((marker & 0xFF00) != 0xFF00) break;
                else offset += view.getUint16(offset, false);
            }
            return callback(-1);
        };
        reader.readAsArrayBuffer(file);
    }




    var rotate64 = function(base64data, degrees, enableURI) {
        return new Promise(function(resolve, reject) {
    //assume 90 degrees if not provided
    degrees = degrees ? degrees : 90;

    var canvas = document.createElement("canvas");
    canvas.setAttribute("id", "hidden-canvas");
    canvas.style.display = "none";
    document.getElementById("body").appendChild(canvas);

    var ctx = canvas.getContext("2d");

    var image = new Image();
     //assume png if not provided
     image.src =  base64data;
     image.onload = function() {
        var w = image.width;
        var h = image.height;
        var rads = degrees * Math.PI/180;
        var c = Math.cos(rads);
        var s = Math.sin(rads);
        if (s < 0) { s = -s; }
        if (c < 0) { c = -c; }
       //use translated width and height for new canvas
       canvas.width = h * s + w * c;
       canvas.height = h * c + w * s;
       //draw the rect in the center of the newly sized canvas
       ctx.translate(canvas.width/2, canvas.height/2);
       ctx.rotate(degrees * Math.PI / 180);
       ctx.drawImage(image, -image.width/2, -image.height/2);
       //assume plain base64 if not provided
       resolve(enableURI ? canvas.toDataURL() : canvas.toDataURL().split(",")[1]);
       document.getElementById("body").removeChild(canvas);
   };
   image.onerror = function() {
    reject("Unable to rotate data\n" + image.src);
};
});
    }

    function doIt(base64, imageCount, imagewidth, imageheight, input, timestamp) {
        rotate64(base64)
        .then(function(imageData) {
            imageData = "data:image/jpeg;base64," + imageData

            // console.log(myFormData)
            console.log("samsugn")
            console.log(_imageCount)
            console.log(imageCount)
            _imageCount++




            reduceFileSize(input.files[0], 500*1024, 1000, Infinity, 0.9, blob => {
                let body = new FormData();
                body.set('file', blob,  blob.name || "file.jpg");
                body.set('filename', getFile.url);
                body.set('activeLayer', activeLayer);
                body.set('imageCount', imageCount);
                console.log(blob)
                console.log(body)
                fetch('textImageServer.php', {method: 'POST', body})
                .then((res) => { return res.text();})
                .then((data) => { 
                    console.log(data)  
                    var data = JSON.parse(data)
                    console.log(data)

                    if(data.status == "success"){

                        imageO = { src: data.path, h: imagewidth, w: imageheight, id: "image-" + activeLayer + '-' + timestamp   }

                        console.log(imageO)

                        buffer.push(imageO)

                        console.log(buffer)
                        console.log(imageCount)

                            // buffer1[imageCount] = buffer

                        //  if (!Array.isArray(allitems) || !allitems.length) {

                            //      allitems[activeLayer] = []

                            //      console.log("asss")

                            //      allitems[activeLayer] = imageO
                            // }

                            // imageCount = imageCountArray[activeLayer]

                            console.log("ImageCountL " + imageCount)


                            if(allitems[activeLayer] == undefined){
                                console.log("aaaa")
                                allitems[activeLayer] = []
                            }

                            if(allitems[activeLayer][imageCount] == undefined){
                                console.log("aaaa")
                                allitems[activeLayer][imageCount] = []
                            }



                            // if ( allitems[activeLayer][imageCount] !== void 0 && allitems[activeLayer] !== void 0){

                            //  allitems[activeLayer][imageCount] = []

                            //  console.log("aaaaaaaaaaaaaaaaaaaaaaaa")
                            
                            // }

                            allitems[activeLayer][imageCount].reverse();

                            
                            allitems[activeLayer][imageCount].push(imageO)
                            

                            allitems[activeLayer][imageCount].reverse();
                            // console.log(allitems)


                            // if ( allitems[activeLayer] !== void 0 ){ allitems[activeLayer][imageCount] = 1; buffer = allitems[activeLayer][imageCount]; console.log("runnnn") }

                            console.log(allitems)

                            imageO.length = 0



                            imageAction = 1

                            $("#layeraction-" + activeLayer + " .saveLayer").click()


                        }else if(data.status == "error" && data.type == "not jpg"){

                            $('#image-' +  activeLayer + '-' + timestamp).unwrap()
                            $('#image-' +  activeLayer + '-' + timestamp).parent().remove()
                            $('.gallery.slick-initialized').slick("unslick")

                            $('.gallery').slick({
                                infinite: true,
                                slidesToShow: 3,
                                slidesToScroll: 3,
                                dots: false,
                                prevArrow: false,
                                nextArrow: false
                            })



                            $(".videoIcon").remove();

                            var slides = window.parent.document.getElementsByClassName("videoOpen");
                            for(var i = 0; i < slides.length; i++)
                            {
                             slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
                         }



                         $("#jpgpngonly-modal").removeClass('close')


                     }else if(data.status == "error"){

                        $('#image-' +  activeLayer + '-' + timestamp).unwrap()
                        $('#image-' +  activeLayer + '-' + timestamp).parent().remove()

                        $('.gallery.slick-initialized').slick("unslick")

                        $('.gallery').slick({
                            infinite: true,
                            slidesToShow: 3,
                            slidesToScroll: 3,
                            dots: false,
                            prevArrow: false,
                            nextArrow: false
                        })




                        $(".videoIcon").remove();

                        var slides = window.parent.document.getElementsByClassName("videoOpen");
                        for(var i = 0; i < slides.length; i++)
                        {
                         slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
                     }



                     $("#uploadfailed-modal").removeClass('close')

                 }

                 $('.inline-image').show()
                 $('.loaderSmall').remove()

             });
});



var d1 = document.getElementById('gallery-'+ imageCount + activeLayer);

d1.insertAdjacentHTML('beforeend', '<div><img data-tag="'+ _imageCount + '" data-parent="'+ imageCount +'" class="sliderImages" id="image-' +  activeLayer + '-' + timestamp + '" src="' + imageData +'"></div>');






slideIndex++

console.log("imageCount2 " + imageCount)
$('#gallery-'+ imageCount + activeLayer + '.slick-initialized').slick("unslick");
$('#gallery-li-'+ imageCount + activeLayer).removeClass('hide')

$('#gallery-'+ imageCount + activeLayer).slick({
    infinite: true,
    slidesToShow: 3,
    slidesToScroll: 3,
    dots: false,
    prevArrow: false,
    nextArrow: false
})




$(".videoIcon").remove();

var slides = window.parent.document.getElementsByClassName("videoOpen");
for(var i = 0; i < slides.length; i++)
{
 slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
}


$('#gallery-'+ imageCount + activeLayer).removeClass('hide')


$(".slickButton").removeClass('hide')

$(".loader").hide().fadeOut('slow');




})
}

canvas.on(
    'object:modified', function(e){

        updateCanvasState();
        console.log("modified")
    }
    );

canvas.on(
    'object:removed', function(){
        updateCanvasState();

    }
    );



var updateCanvasState = function() {
    if((_config.undoStatus == false && _config.redoStatus == false)){
        canvas.includeDefaultValues = false;
        var jsonData        = canvas.toJSON(['id','_controlsVisibility', 'layerId', 'layerCount', 'hasRotatingPoint','perPixelTargetFind']);
        var canvasAsJson        = JSON.stringify(jsonData);
        if(_config.currentStateIndex < _config.canvasState.length-1){
            var indexToBeInserted                  = _config.currentStateIndex+1;
            _config.canvasState[indexToBeInserted] = canvasAsJson;
            var numberOfElementsToRetain           = indexToBeInserted+1;
            _config.canvasState                    = _config.canvasState.splice(0,numberOfElementsToRetain);
            console.log("hshshs")
        }else{
            _config.canvasState.push(canvasAsJson);
            console.log("hshshs1")
        }
        _config.currentStateIndex = _config.canvasState.length-1;
        if((_config.currentStateIndex == _config.canvasState.length-1) && _config.currentStateIndex != -1){
            _config.redoButton.disabled= "disabled";


        }
    }
}


var undo = function() {
    if(_config.undoFinishedStatus){
        if(_config.currentStateIndex == -1){
            _config.undoStatus = false;
        }
        else{
            if (_config.canvasState.length >= 1) {
                _config.undoFinishedStatus = 0;
                if(_config.currentStateIndex != 0){
                    _config.undoStatus = true;
                    canvas.loadFromJSON(_config.canvasState[_config.currentStateIndex-1],function(){
                        var jsonData = JSON.parse(_config.canvasState[_config.currentStateIndex-1]);
                        canvas.renderAll();
                        _config.undoStatus = false;
                        _config.currentStateIndex -= 1;
                        _config.undoButton.removeAttribute("disabled");
                        if(_config.currentStateIndex !== _config.canvasState.length-1){
                            _config.redoButton.removeAttribute('disabled');
                        }
                        _config.undoFinishedStatus = 1;
                    });
                }
                else if(_config.currentStateIndex == 0){
                    canvas.clear();
                    _config.undoFinishedStatus = 1;
                    _config.undoButton.disabled= "disabled";
                    _config.redoButton.removeAttribute('disabled');
                    _config.currentStateIndex -= 1;
                }
            }
        }
    }
}

var redo = function() {
    if(_config.redoFinishedStatus){
        if((_config.currentStateIndex == _config.canvasState.length-1) && _config.currentStateIndex != -1){
            _config.redoButton.disabled= "disabled";
        }else{
            if (_config.canvasState.length > _config.currentStateIndex && _config.canvasState.length != 0){
                _config.redoFinishedStatus = 0;
                _config.redoStatus = true;
                canvas.loadFromJSON(_config.canvasState[_config.currentStateIndex+1],function(){
                    var jsonData = JSON.parse(_config.canvasState[_config.currentStateIndex+1]);
                    canvas.renderAll();
                    _config.redoStatus = false;
                    _config.currentStateIndex += 1;
                    if(_config.currentStateIndex != -1){
                    }
                    _config.undoButton.removeAttribute('disabled');
                    _config.redoFinishedStatus = 1;
                    if((_config.currentStateIndex == _config.canvasState.length-1) && _config.currentStateIndex != -1){
                        _config.redoButton.disabled= "disabled";
                    }
                });
            }
        }
    }
}


var fullsc = 0

$("#undo").click(function(event) {
    console.log("undo done")
    undo();
});

$("#redo").click(function(event) {
    console.log("redo done")
    redo();
});



$(document).keydown(function(e){
    if(e.keyCode == 83 && editON == 1 && allowResize == 1) {

        if(!$("#modeToggler").hasClass('hide')){

            $("#modeToggler").click()
            
        }


    }

})


$(document).keydown(function(e){
    if(e.keyCode == 46 && editON == 1) {

        // if(canvas.getActiveObject().id == "imageObject"){

        //  $("#imageEyeDeleting-modal").removeClass('close')

        // }

        if(canvas.getActiveObject().id == 'imageObject'){

            console.log(canvas.getActiveObject().layerCount)

            imageEye__deleting = canvas.getActiveObject().layerCount

            if(allitems[activeLayer] != undefined){

                if( allitems[activeLayer][imageEye__deleting].length != 0 ){

                    target__delete = canvas.getActiveObject()

                    $("#imageEyeDeleting-modal").removeClass('close')

                }else{




                    canvas.remove(canvas.getActiveObject());
                    canvas.selection = false;
                    console.log("removeAll")
                    canvas.renderAll()

                    deleteON = 0

                    target__delete = 0

                    imageEye__deleting = 0


                }

            }else{


                canvas.remove(canvas.getActiveObject())

                $("#inline-btn-" + imageEye__deleting + activeLayer).remove()


            }


        }else{

            if(canvas.getActiveObject().id != 'text'){

                canvas.remove(canvas.getActiveObject())
                
            }else if(canvas.getActiveObject().id == 'text' && allowResize == 1){


                canvas.remove(canvas.getActiveObject())

            }


            canvas.selection = false;
            console.log("removeAll")
            canvas.renderAll()

            deleteON = 0
            
        }


    }
});


$(document).keydown(function(e){
    if( e.which === 89 && e.ctrlKey ){
        $("#redo").click()
    }
    if(  e.which === 90 && e.ctrlKey && e.shiftKey ){
        $("#redo").click()
    }
    else if( e.which === 90 && e.ctrlKey ){
        $("#undo").click()
    }  

    // if(e.keyCode == 46 && editON==1) {
    //     if($("#toolbox").hasClass('hide')){

    //         $("#delete").click()

    //     }
    // }    
    if (e.keyCode === 27){

        if(selection == 4  && polygonCreated == 0){

            escaped = 1

            prototypefabric.polygon.generatePolygon(pointArray);


            selection = 0;
            $(".selectedTool").removeClass('selectedTool')
            $("#selection").click()

        }


        canvas.discardActiveObject()
        canvas.renderAll()

        escaped = 0
    }  
     // if (e.keyCode === 13) $('#selection').click();      
 }); 






// var someData = [
//    {firstName: "Max", lastName: "Mustermann", age: 40},
//    {firstName: "Hagbard", lastName: "Celine", age: 44},
//    {firstName: "Karl", lastName: "Koch", age: 42},
// ];

// for(var i in someData) {

//     var item = someData[i];

//    accounting.push({ 
//         "firstName" : item.firstName,
//         "lastName"  : item.lastName,
//         "age"       : item.age 
//     });
// }

// employees.accounting = accounting;


// var student = [];
// var obj = {
//     'first_name': "name",
//     'last_name': "namess",
//     'age': 13,
// }
// student.push(obj);

var savingInProgress = 0

$(document).on('click', '.saveLayer', function(event) {


    console.log("aa");

    // if(layernamep == 1){

    //     var _editedLayerName = $("#layerName-"+ activeLayer+ " input").val()

    // }else{

    //     var _editedLayerName = $("#layerName-"+ activeLayer).html()

    //     layerisCreating = 0

    // }


    if(!$("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").hasClass('deactive')){

        var a = layerUserID.filter(function(a){
            if(a.totalLayerCount == activeLayer){
                if(a.user_id == user_id) {return 1}
                    else{ return 0;}
            }
        })



        console.log("aa");  
        console.log("aa");  



        var isOwner = a.map(function(a,index) { 
           if(a.totalLayerCount == activeLayer){
              if(a.user_id == user_id) {return 1}
                 else{ return 0;}


         }
     })

        console.log(isOwner)



        if((!$("#layerDiv-" + activeLayer).hasClass('locked') || auto_save == 1) || (isOwner[0] == 1 || usertype == 0 || usertype == 1 || usertype== 2 || usertype == 3)){



           $(".loader").css('background', 'rgba(255,255,255,0.7)');
           $(".loader").show().fadeIn('slow');


           /* Act on the event */
           var canvasObjects = []
           var inlinebtn = []
           var allitemsLayerBased = []
           var layerData
           var employees = {};

           console.log(activeLayer)


           auto_save = 0

           var data = {}


    //        $(".gallery.slick-initialized").slick("unslick")

    //        imageCountArray[activeLayer] = 0


    //        canvas.getObjects().map(function(o) {

    //           if(o.id == 'imageObject' && o.layerId == activeLayer && o.layerCount){

    //             console.log(o.layerCount-1)

    //             imageCountArray[activeLayer]++

    //         // data[(o.layerCount - 1)] = 0

    //         if($('#gallery-' + o.layerCount + activeLayer + ' .sliderImages').length != 0){

    //         for(i = 0; i < $('#gallery-' + o.layerCount + activeLayer + ' .sliderImages').length; i++){




    //             if($("#gallery-li-" + o.layerCount + activeLayer).length != 0){

    //                 console.log('gallerydxkdjskdskdsd')

    //                 var temp = {}

    //                 temp['id'] = $('#gallery-' + o.layerCount + activeLayer + ' .sliderImages').eq(i).attr('id')
    //                 temp['src'] = $('#gallery-' + o.layerCount  + activeLayer + ' .sliderImages').eq(i).attr('src')

    //                 $('#gallery-' + o.layerCount + '.slick-initialized').slick("unslick")

    //                 if(!data.hasOwnProperty(activeLayer)){


    //                     data[activeLayer] = {}


    //                 }

    //                 if(!data[activeLayer].hasOwnProperty(o.layerCount)){

    //                     data[activeLayer][o.layerCount] = {}

    //                 }


    //                 data[activeLayer][o.layerCount][i] = temp



    //             }else{


    //                 src = "icons/eye.svg"

    //                 o.setSrc(src, function () {
    //                     canvas.renderAll();

    //                 });

    //                 data[(o.layerCount - 1)] = '0'

    //             }

    //         }

    //     }else{

















    //           if($("#gallery-li-" + o.layerCount + activeLayer).length != 0){

    //                 console.log('gallerydxkdjskdskdsd')

    //                 var temp = {}

    //                 temp['id'] = "-37"
    //                 temp['src'] = "-37"

    //                 $('#gallery-' + o.layerCount + '.slick-initialized').slick("unslick")

    //                 if(!data.hasOwnProperty(activeLayer)){


    //                     data[activeLayer] = {}


    //                 }

    //                 if(!data[activeLayer].hasOwnProperty(o.layerCount)){

    //                     data[activeLayer][o.layerCount] = {}

    //                 }


    //                 data[activeLayer][o.layerCount][i] = temp

    //                  src = "icons/eye.svg"

    //                 o.setSrc(src, function () {
    //                     canvas.renderAll();

    //                 });




    //             }else{



    //             }
    //     }

    //     }else if(o.id == 'imageObject' && o.layerId == activeLayer && !o.layerCount){



    //         o.layerCount = ++imageCountArray[activeLayer]



    //     }

    // })


           // console.log(data)


           canvasJSON = canvas.toJSON(['id','_controlsVisibility', 'layerId', 'layerCount', 'hasRotatingPoint', 'defaultZoomValue','selectable', 'perPixelTargetFind']);

           canvasJSON.objects.map(function(o) {
              if(activeLayer == o.layerId){
                 canvasObjects.push(o)
             }
         })

           console.log(canvasObjects)



       //   if(allitems[activeLayer] != undefined){

       //      for(i = 1; i < allitems[activeLayer].length; i++){

       //          if($("#gallery-li-1"+ activeLayer).length == 0) {


       //              data.push("0")

       //          }else{

       //              data.push($("#gallery-li-" + i + activeLayer)[0].outerHTML)

       //          }





       //      }

       //      console.log(data)

       //  }else{

       //      for( i = 0 ; i <  $(".inline-btn[data-layerid="+ activeLayer +"]").length; i++){

       //         data.push($("#gallery-li-" + 1 + activeLayer)[0].outerHTML)

       //     }




       // }

       // inlinebtn.push(data)

      //  $('.gallery').slick({
      //     infinite: true,
      //     slidesToShow: 3,
      //     slidesToScroll: 3,
      //     dots: false,
      //     prevArrow: false,
      //     nextArrow: false
      // })


       // console.log(inlinebtn)

       layerUserID.map(function(a) { 

          if(a.totalLayerCount == activeLayer){ 

                    // alert($("#layerName-" + activeLayer).val())

                    layerData = a;

                    layerData.descrip = $(".textareaonedit-" + activeLayer + " textarea").val();



                    layerData.layerName = $("#layerName-" + activeLayer).val()
                }
            });

       console.log(layerData)




       allitemsLayerBased[activeLayer] = allitems[activeLayer]
       console.log(allitemsLayerBased)

       allitemsLayerBased = JSON.stringify(allitems[activeLayer])

       console.log(allitemsLayerBased)


       employees.canvasData = canvasObjects;
       employees.eyeIcon = data;
       employees.allitems = allitemsLayerBased
       employees.imageCountArray = imageCountArray[activeLayer]
       employees.eyeIconLen = eyeIconLen
       employees.layers = layerData;

       console.log(employees)

       employees = JSON.stringify(employees)

       console.log(employees)

    // var id = []
    // id.push(activeLayer) 

    if(getFile.name == undefined){

        getFile.name = nameofFile

    }

    console.log(getFile)


    var person = {
        data :  employees,
        baseURL :  getFile.url,
        path : getFile.path,
        filename :  getFile.name,
        phash :  getFile.phash,
        taskid :  taskid,
        id: activeLayer,
        showNotification : $("#allowNotification"+ activeLayer).prop('checked')
    }

    console.log(person)


    // Android.saveLayer(person);
    Android.saveLayer(employees , getFile.url , getFile.path , activeLayer);


    $(".loader").hide().fadeOut('slow');

//     $.ajax({
//         url: 'file:///android_assets/views/phppages/allProjectController.php?createLayerFile=createLayerFile',
//         type: 'post',
//         dataType: 'json',
//         data: person,
//         success: function (data) {

//             showNotification = 0


//             console.log('hsssssssssssssssssssssssss')
//             console.log(data)


//             if(data.status == "file missing"){

//                 $(".loader").hide().fadeOut('slow');


//                 $('#filedeletedOnSave-modal').removeClass("close");


//             }else{






//                 console.log("success")
//                 console.log(data)
//                 console.log(imageAction)

//                 if(imageAction != 1){

//                     console.log("imageAction != 1")


//                     $("#layerName-" + activeLayer).addClass("textareaEditStyle")

//                     $("#layerName-" + activeLayer).prop("disabled", true);

//                     savedCounter.pushUnique(activeLayer)

//                     cancelEditNoModal()
//                 }

//                 if(imageAction == 1){

//                     imageAction = 0
//                 }

//             // $("#imageEye").removeClass('deactive')

//             $(".loader").hide().fadeOut('slow');

//             $('.gallery.slick-initialized').slick("unslick");

//             $('.gallery').slick({
//                 infinite: true,
//                 slidesToShow: 3,
//                 slidesToScroll: 3,
//                 dots: false,
//                 prevArrow: false,
//                 nextArrow: false
//             })




//             $(".videoIcon").remove();

//             var slides = window.parent.document.getElementsByClassName("videoOpen");
//             for(var i = 0; i < slides.length; i++)
//             {
//              slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
//          }



//          layernamep = 0


//          console.log("saved")

//          if(layerIsCreatedModal != 1){

//             $('#aftersave-modal').removeClass("close")

//             setTimeout(function(){ $('#aftersave-modal').addClass("close");}, 3000);


//         }

//         layerIsCreatedModal = 0


//     }


// }
// });

    }else{

    // $("#modal").removeClass('close')


}
}

});



    function saveLayer(){




        console.log("aa");



        if(!$("#layerDiv-" + activeLayer).siblings(".layerSubDiv").find(".saveLayer").hasClass('deactive')){

            var a = layerUserID.filter(function(a){
                if(a.totalLayerCount == activeLayer){
                    if(a.user_id == user_id) {return 1}
                        else{ return 0;}
                }
            })



            console.log("aa");  
            console.log("aa");  



            var isOwner = a.map(function(a,index) { 
                if(a.totalLayerCount == activeLayer){
                    if(a.user_id == user_id) {return 1}
                        else{ return 0;}


                }
            })

            console.log(isOwner)



            if((!$("#layerDiv-" + activeLayer).hasClass('locked') || auto_save == 1) || (isOwner[0] == 1 || usertype == 0 || usertype == 1 || usertype== 2 || usertype == 3)){



                $(".loader").css('background', 'rgba(255,255,255,0.7)');
                $(".loader").show().fadeIn('slow');


                /* Act on the event */
                var canvasObjects = []
                var inlinebtn = []
                var allitemsLayerBased = []
                var layerData
                var employees = {};

                console.log(activeLayer)


                console.log(canvasObjects)

                auto_save = 0

                var data = {}


    //        $(".gallery.slick-initialized").slick("unslick")

    //        imageCountArray[activeLayer] = 0


    //        canvas.getObjects().map(function(o) {

    //           if(o.id == 'imageObject' && o.layerId == activeLayer && o.layerCount){

    //             console.log(o.layerCount-1)

    //             imageCountArray[activeLayer]++

    //         // data[(o.layerCount - 1)] = 0

    //         for(i = 0; i < $('#gallery-' + o.layerCount + activeLayer + ' .sliderImages').length; i++){




    //             if($("#gallery-li-" + o.layerCount + activeLayer).length != 0){

    //                 console.log('gallerydxkdjskdskdsd')

    //                 var temp = {}

    //                 temp['id'] = $('#gallery-' + o.layerCount + activeLayer + ' .sliderImages').eq(i).attr('id')
    //                 temp['src'] = $('#gallery-' + o.layerCount  + activeLayer + ' .sliderImages').eq(i).attr('src')

    //                 $('#gallery-' + o.layerCount + '.slick-initialized').slick("unslick")

    //                 if(!data.hasOwnProperty(activeLayer)){


    //                     data[activeLayer] = {}


    //                 }

    //                 if(!data[activeLayer].hasOwnProperty(o.layerCount)){

    //                     data[activeLayer][o.layerCount] = {}

    //                 }


    //                 data[activeLayer][o.layerCount][i] = temp



    //             }else{


    //                 src = "icons/eye.svg"

    //                 o.setSrc(src, function () {
    //                     canvas.renderAll();

    //                 });

    //                 data[(o.layerCount - 1)] = '0'

    //             }

    //         }

    //     }else if(o.id == 'imageObject' && o.layerId == activeLayer && !o.layerCount){



    //         o.layerCount = ++imageCountArray[activeLayer]



    //     }

    // })


    //        console.log(data)


    canvasJSON = canvas.toJSON(['id','_controlsVisibility', 'layerId', 'layerCount', 'hasRotatingPoint', 'defaultZoomValue','selectable', 'perPixelTargetFind']);

    canvasJSON.objects.map(function(o) {
      if(activeLayer == o.layerId){
         canvasObjects.push(o)
     }
 })

    console.log(canvasObjects)

        // inlinebtn.push(data)

        // $('.gallery').slick({
        //     infinite: true,
        //     slidesToShow: 3,
        //     slidesToScroll: 3,
        //     dots: false,
        //     prevArrow: false,
        //     nextArrow: false
        // })


        // console.log(inlinebtn)

        layerUserID.map(function(a) { if(a.totalLayerCount == activeLayer){ layerData = a; layerData.descrip = $(".textareaonedit-" + activeLayer + " textarea").val(); layerData.layerName = $("#layerName-" + activeLayer).val() }});

        console.log(layerData)




        allitemsLayerBased[activeLayer] = allitems[activeLayer]
        console.log(allitemsLayerBased)

        allitemsLayerBased = JSON.stringify(allitems[activeLayer])

        console.log(allitemsLayerBased)

        employees.canvasData = canvasObjects;
        employees.eyeIcon = data;
        employees.allitems = allitemsLayerBased
        employees.imageCountArray = imageCountArray[activeLayer]
        employees.eyeIconLen = eyeIconLen
        employees.layers = layerData;

        console.log(employees)

        employees = JSON.stringify(employees)

    // var id = []
    // id.push(activeLayer) 

    if(getFile.name == undefined){

        getFile.name = nameofFile

    }

    console.log(getFile)


    var person = {
        data :  employees,
        baseURL :  getFile.url,
        path : getFile.path,
        filename :  getFile.name,
        phash :  getFile.phash,
        id: activeLayer
    }

    console.log(person)

        Android.saveLayer(employees , getFile.url , getFile.path , activeLayer);


    $(".loader").hide().fadeOut('slow');

//     $.ajax({
//         url: 'file:///android_assets/views/phppages/allProjectController.php?createLayerFile=createLayerFile',
//         type: 'post',
//         dataType: 'json',
//         data: person,
//         success: function (data) {


//             if(data.status == "file missing"){

//                 $(".loader").hide().fadeOut('slow');


//                 $('#filedeletedOnSave-modal').removeClass("close");


//             }else{






//                 console.log("success")
//                 console.log(data)

//                 if(imageAction != 1){

//                     console.log("imageAction != 1")


//                     $("#layerName-" + activeLayer).addClass("textareaEditStyle")

//                     $("#layerName-" + activeLayer).prop("disabled", true);

//                     savedCounter.pushUnique(activeLayer)

//                     cancelEditNoModal()
//                 }

//                 if(imageAction == 1){

//                     imageAction = 0
//                 }

//             // $("#imageEye").removeClass('deactive')

//             $(".loader").hide().fadeOut('slow');

//             $('.gallery.slick-initialized').slick("unslick");

//             $('.gallery').slick({
//                 infinite: true,
//                 slidesToShow: 3,
//                 slidesToScroll: 3,
//                 dots: false,
//                 prevArrow: false,
//                 nextArrow: false
//             })




//             $(".videoIcon").remove();

//             var slides = window.parent.document.getElementsByClassName("videoOpen");
//             for(var i = 0; i < slides.length; i++)
//             {
//              slides.item(i).insertAdjacentHTML('afterend', '<div class="videoIcon"><img src="icons/play.svg"></div>');
//          }




//          console.log("saved")

//          layernamep = 0

//          if(layerIsCreatedModal != 1){

//             $('#aftersave-modal').removeClass("close")

//             setTimeout(function(){ $('#aftersave-modal').addClass("close");}, 3000);


//         }

//         layerIsCreatedModal = 0

//     }


// }
// });

}else{

    // $("#modal").removeClass('close')


}
}



}




// $("#saveDatatoFile").click(function(event) {

//  $(".loader").show().fadeIn('slow');

//      for(i = 1; i <= canvas.getObjects().length; i++){

//                 //item = canvas.getItem("imageObject")
//                 object = canvas.item(i-1)

//                 type = object.get("id")

//                  object.set('opacity', 0)
//                  canvas.renderAll()

//             }   


//  var employees = {};
//  var jsonData = canvas.toJSON(['id','_controlsVisibility', 'layerId', 'layerCount', 'hasRotatingPoint', 'defaultZoomValue','selectable', 'perPixelTargetFind']);


//      for(i = 1; i <= canvas.getObjects().length; i++){

//                 //item = canvas.getItem("imageObject")
//                 object = canvas.item(i-1)

//                 type = object.get("layerId")

//                 if(type == activeLayer){

//                  object.set('opacity', 1)
//                  canvas.renderAll()
//                 }


//             }   

//  //  canvas.getObjects().map(function(o) {

//  //  if(o.layerId == activeLayer){

//  //      canvas.set('opacity', 1)
//  //      canvas.renderAll()

//  //  }

//  // }); 

//  $(".gallery").slick("unslick")

//  var data = $("#menuContainer").html()

//  $(".gallery").slick()

//  employees.baseImage = getFile.url;
//  employees.canvasData = jsonData;
//  employees.eyeIcon = data;
//  employees.allitems = allitems
//  employees.eyeIconLen = eyeIconLen
//  employees.layers = layerUserID;

//  console.log(employees)
//  console.log(getFile.name)





//  console.log(allitems)


//  // filename = getFile.name.replace(/\.[^.$]+$/, '');
//  filename = getFile.name

//  employees = JSON.stringify(employees)


//  var person = {
//      data :  employees,
//      baseURL :  getFile.url,
//      path : getFile.path,
//      filename :  filename
//  }

//  $.ajax({
//      url: 'http://13.124.239.52file:///android_assets/views/phppages/allProjectController.php?saveJson=saveJson',
//      type: 'post',
//      dataType: 'json',
//      data: person,
//      success: function (data) {
//          console.log("success")
//                  console.log(data)
//                      $.get("http://13.124.239.52file:///android_assets/views/phppages/allProjectController.php?deleteActiveLayer=deleteActiveLayer&layerId=" + activeLayer + "&filename=" + getFile.name + "&fileURL=" + getFile.url + "&hash=" + getFile.hash + "&timestamp=" + getFile.ts , function(data, status){

//                              console.log(data)
//                              endEditMode()

//                      })


//                  if(savingInProgress == 1){
//                      savingInProgress = 0
//                      window.location.href = '#/app/ViewProjectDetails';
//                  }


//                  $(".loader").hide().fadeOut('slow');
//              // console.log(JSON.parse(JSON.stringify(data)));
//          }
//      });
// });


function auto_grow(element) {
    element.style.height = "150px";
    element.style.height = (element.scrollHeight)+"px";
}

function getAllUrlParams(url) {

  // get query string from url (optional) or window
  var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

  // we'll store the parameters here
  var obj = {};

  // if query string exists
  if (queryString) {

    // stuff after # is not part of query string, so get rid of it
    queryString = queryString.split('#')[0];

    // split our query string into its component parts
    var arr = queryString.split('&');

    for (var i=0; i<arr.length; i++) {
      // separate the keys and the values
      var a = arr[i].split('=');

      // in case params look like: list[]=thing1&list[]=thing2
      var paramNum = undefined;
      var paramName = a[0].replace(/\[\d*\]/, function(v) {
        paramNum = v.slice(1,-1);
        return '';
    });

      // set parameter value (use 'true' if empty)
      var paramValue = typeof(a[1])==='undefined' ? true : a[1];

      // (optional) keep case consistent
      paramName = paramName.toString().toLowerCase();
      paramValue = paramValue.toString().toLowerCase();

      // if parameter name already exists
      if (obj[paramName]) {
        // convert value to array (if still string)
        if (typeof obj[paramName] === 'string') {
            obj[paramName] = [obj[paramName]];
        }
        // if no array index number specified...
        if (typeof paramNum === 'undefined') {
          // put the value on the end of the array
          obj[paramName].push(paramValue);
      }
        // if array index number specified...
        else {
          // put the value at that index number
          obj[paramName][paramNum] = paramValue;
      }
  }
      // if param name doesn't exist yet, set it
      else {
        obj[paramName] = paramValue;
    }
}
}

return obj;
}


function goback(){

    window.location.href = "calendar.html";


    // if(editON == 0){
    //     $("#saveAlert-action").click()
    //     $(".loader").show().fadeIn('slow');
    // }else{

    //     if(backgroundImageLoaded == 0 && isPdfUpload == 0){
    //         $("#saveAlert-action").click()
    //     }else if($('#saveAlert-modal').find(".checkedBox").prop('checked')){
    //         $("#saveAlert-action").click()
    //     }else{  
    //         $("#saveAlert-modal").removeClass('close')
    //     }
    // }


}


$("#saveAlert-action").click(function(event) {

    console.log(project_id)

    $.get("file:///android_assets/views/phppages/Afterlogin.php?ProjectSession=ProjectSession&ProjectId="+project_id, function(data, status){
        console.log(data)
        localStorage.setItem('ViewProjectId', project_id);              
        if(linked == 0 ) {  window.history.pushState('obj', 'newtitle', "#/app/ViewProjectDetails")
            // window.location.href = '#/app/ViewProjectDetails';
        window.location.reload()
    }
    else if(linked == 1 ) { window.history.pushState('obj', 'newtitle', "#/app/ViewProjectDetails")
        window.location.reload() 
}
});

    // window.location.href = '#/app/ViewProjectDetails';
});


function fadeOut(el){
  el.style.opacity = 1;

  (function fade() {
     if ((el.style.opacity -= .1) < 0) {
        el.style.display = "none";
    } else {
        requestAnimationFrame(fade);
    }
})();
}

// fade in

function fadeIn(el, display){
    el.style.opacity = 0;
    el.style.display = display || "block";

    (function fade() {
        var val = parseFloat(el.style.opacity);
        if (!((val += .1) > 1)) {
            el.style.opacity = val;
            requestAnimationFrame(fade);
        }
    })();
}




$("#signaturePadToggle").click(function(){

    if( layerFinished == 0  ){


        $("#signature-pad").removeClass('hide')

    }




})

$(".closeThisArea").click(function(){


    $("#signature-pad").addClass('hide')


})



function permissionpoll(){  


    var person = {
        layer_id :  activeLayer,
        hash: getFile.hash,
        url: getFile.url
    }

    console.log(person)
    console.log(person)

    poll_xhr = $.ajax({ 
        url: 'file:///android_assets/views/phppages/allProjectController.php?longPollPermission=longPollPermission',
        type: 'post',
        data: person,

        success: function(data){
            console.log(data)

            console.log(data.exist)
            console.log(permissionStatus)


            if(data.exist == "yes" && permissionStatus == 0 && cancelPermissionVar == 0){


                // console.log('reload')

                // window.location = 'https://www.easypermit.net/#/drawing?filelocation=https://www.easypermit.net' + filelocationURL;

                // window.location.reload()

            }


            if(data.array == 1){

                setTimeout(permissionpoll, 20000);

            }
        }, 
        dataType: "json",
        timeout: 30000 
    });
}


$("#permission").click(function(){



    if($("#permissionArea").hasClass('hide')){




        $.get("file:///android_assets/views/phppages/allProjectController.php?checkPermissionStatus=checkPermissionStatus&layers=" + layerOrderArray + "&filename=" + getFile.name + "&fileURL=" + getFile.url + "&hash=" + getFile.name + "&timestamp=" + new Date().getTime() , function(data, status){

            console.log(data)

            var obj = JSON.parse(data)
            console.log(obj)


            if(obj.status == "success"){


                permissionpoll()

                $(".layerSelected").trigger('click')

                $("#permissionArea").toggleClass('hide')


            }else{


                $("#permissionLayerEditing-modal").removeClass('close')

            }




        })


    }else if(!$("#permissionArea").hasClass('hide')){


       $.get("file:///android_assets/views/phppages/allProjectController.php?checkPermissionStatusOff=checkPermissionStatusOff&layers=" + layerOrderArray + "&filename=" + getFile.name + "&fileURL=" + getFile.url + "&hash=" + getFile.name + "&timestamp=" + new Date().getTime() , function(data, status){

          console.log(data)

          var obj = JSON.parse(data)
          console.log(obj)

          $("#permissionArea").toggleClass('hide')



      })



   }





})


$('#permission_title, #permission_desc').on('change keyup', function () {

    if( $("#permission_title").val() != "" &&  $("#permission_desc").val() != "" && signatureData.length != 0){



        $("#permissionDone").removeClass('deactive')


    }else{

        $("#permissionDone").addClass('deactive')

    }
});



$("#permissionDone").click(function(){

    $("#permissionYes-modal").removeClass('close')

})

$("#permissionYes-action").click(function(){


    $("#permissionYes-modal").addClass('close')


    if( $("#permission_title").val() != "" &&  $("#permission_desc").val() != "" && signatureData.length != 0 ){


        layerFinished = 1

        // $(".layeraction").addClass('hide')
        $("#permissionDone").addClass('deactive')
        $("#createLayer").addClass('hide')
        $("#permission_title").addClass('hide')
        $("#permission_desc").addClass('hide')
        $("#datenow").addClass('hide')
        $("#signIMG").addClass('hide')
        $(".editButton").addClass('hide')
        $(".editButton").hide()
        $(".upbutton ").addClass('hide')



        $("#permission_title1").removeClass('hide')
        $("#permission_desc1").removeClass('hide')
        $("#datenow1").removeClass('hide')


        $("#permission_title1").html($("#permission_title").val())
        $("#permission_desc1").html($("#permission_desc").val())
        $("#datenow1").html($("#datenow").val())

        $("#signIMGDone").attr("src", signatureData)
        $("#signIMGDone").removeClass("hide")



        var employees = {}


        employees.signatureData = signatureData
        employees.excelURL = excelURL
        employees.title = $("#permission_title").val()
        employees.desc = $("#permission_desc").val()
        employees.date = $("#datenow").val()
        employees.layerData = layerUserID


        console.log(employees)

        employees = JSON.stringify(employees)




        var person = {
            fileURL :  fileJSON.urr,
            data : employees,
            layerData : layerUserID,
            isExcelAdded : isExcelAdded,
            note :  encodeURIComponent(excelURL)
        }

        console.log(person)

        if(usertype == 3){

            $.ajax({
                url: 'file:///android_assets/views/phppages/allProjectController.php?permissionDone=permissionDone',
                type: 'post',
                dataType: 'json',
                data: person,
                success: function (data) {

                    console.log(data)


                    var obj = data
                    console.log(obj)


                    $("#permissionDone").addClass('deactive')
                    $("#permission_action").addClass('hide')
                    $("#permissionArea").addClass('afterPermission')
                // $("#permissionUserData").addClass('afterPermission')


                $('#permissionDone-modal').removeClass("close")

                setTimeout(function(){ $('#permissionDone-modal').addClass("close");}, 3000);


                $("#zipDownload").attr('href', obj.downloadURL)
                
                $("#excelArea").empty()

                $("#zipDownload").removeClass('hide')

                if(usertype == 0 || usertype == 1){


                    $("#cancelPermission").removeClass('hide')


                }else{

                    $("#cancelPermission").addClass('hide')

                }

                console.log(layerUserID)
                
                $(".custom-file-upload__drawing").addClass('hide')
                $(".custom-file-remove__drawing").addClass('hide')

                if(isExcelAdded == 0){



                }else{



                    $("#excelArea").prepend('<a data-place="after-permission" style="display: flex;flex-direction: column;align-items: center;" href="https://www.easypermit.net/test/spread/viewer.html?v=' + obj.excelfileurl + '" target="_blank"><img id="theImg" style="width: 30px;height: 100%" src="assets/images/excel.svg" /><p style="width: 90px;text-align:center;word-break: break-all;font-size: 10px;">'+ obj.foldername +'</p></a>')

                // $("#zipDownload").attr('href', "https://www.easypermit.net/test/spread/index.html?v=" obj.excelfileurl)





            }






        }
    });
            }


    //             $.get('assets/views/phppages/allProjectController.php?permissionDone=permissionDone&fileURL=' + fileJSON.urr, function(data, status){


    //              console.log(data)


                //  var obj = JSON.parse(data)
                //  console.log(obj)


                //  layerUserID.map(function(a,index) { 

    //              a.zipDownload = obj.downloadURL

    //          })


                // $("#permissionDone").addClass('deactive')
                // $("#permission_action").addClass('hide')



    //              $("#zipDownload").attr('href', obj.downloadURL)

    //              $("#zipDownload").removeClass('hide')

       //               console.log(layerUserID)

       //               $(".saveLayer").click()

                // });




            }else{


                $("#permissionError-modal").removeClass('close')

            }






        })


            $("#zipDownload").click(function(){

                window.location = $("#zipDownload").attr('href');

            })



            $(".saveSignature").click(function(){


                signatureData = signaturePad.toDataURL("image/jpeg");

                console.log(signatureData)


                $("#signIMG").attr('src', signatureData );

                $("#signIMG").removeClass('hide')

                $("#signature-pad").addClass('hide')





                if( $("#permission_title").val() != "" &&  $("#permission_desc").val() != "" && signatureData.length != 0){


                    $("#permissionDone").removeClass('deactive')


                }else{

                    $("#permissionDone").addClass ('deactive')


                }



            })



// $.get("file:///android_assets/views/phppages/allProjectController.php?getCalendarData=getCalendarData", function(data, status){
//     var obj = JSON.parse(data)
//     console.log(data)
//     if(obj.isLogged == 0){
//         $("#login-div").removeClass('hide')
//     }

// })


$("#end").click(function(){

    $("#ends_inputDate").click()

})

$("#start").click(function(){

    $("#starts_inputDate").click()

})



$("#clearCanvas-action").click()


</script>

</div>
</html>